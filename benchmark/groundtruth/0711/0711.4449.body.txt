Fitting function for asymmetric peaks

Introduction

During experimental data processing often there is a task to fit arbitrary distribution with the only peak to some function with a set of free parameters. This can be necessary for more precise determination of peak position, or full width at half maximum (devise resolution), or for the signal form approximation using Monte Carlo events for subsequent analysis of data distribution and so on. Available set of fitting functions does not always matches the experimental requirements, especially for high statistics (it is difficult to achieve suitable confidence level).

In practice most often the sum of the three Gaussian distributions is used to fit such histograms. In most cases this fit provides suitable confidence level. At least one can add more and more Gaussians until confidence level is admissible. Disadvantage of this method is that every Gaussian used is symmetric, so in principle one can not used sum of Gaussians with common center to fit asymmetric distributions, and if all Gaussians have different centers, then it is difficult to provide the only maximum of fitting function and monotony to the right and left of maximum.

Another often used function is a spline of two halves of different Gaussians. This function is good in case that the function "tails" can be approximated with Gaussian. However for high statistics the major experimental distributions far of peak have exponential or power-of-x dependence, which do not match Gaussian.

Logarithmic Gaussian distribution is also often used (at SLAC it is called "Novosibirsk" function):

[formula]

where xp is a peak location (function maximum), h is full width at half maximum (FWHM), λ is asymmetry parameter, A is normalization factor.

[formula]

[formula]

[formula]

As is seen from ([\ref=eq:xm-Expression]), for λ > 0 the boundary coordinate xm < xp and all x > xm. If λ < 0, then xm > xp and x < xm. Using these notations one can rewrite this function, excluding the inconvenient variable xm:

[formula]

Function is equal to 0 for all x, for which the logarithm argument is negative. Possible values of parameters: h > 0, λ is arbitrary, xp is arbitrary. For λ  ~  0 the formulae have an ambiguity of the type 0 / 0, so some parameters should be expanded to the Tailor series.

[formula]

therefore

[formula]

[formula]

[formula]

For λ = 0 the function converts to

[formula]

that is Gaussian distribution with root mean square

[formula]

This function is convenient for fitting the distributions with abrupt spectrum end. However many experimental distributions are more smooth, and suggested in this paper function can be more successful.

Convolution of Gaussian and exponential distributions

It is suggested to build the fitting function on the base of convolution of Gaussian and exponential distributions, which can be easily derived:

[formula]

Integral of this function over all x equals 1. Such a function was first used by the author in 2004 at SLAC (BaBar Note # 582) for fitting the deposited energy distributions in calorimeter with the aim of peak position and resolution determination for the algorithms of absolute photon energy calibration, and despite some technical difficulties, this function proved to be enough convenient for fitting such distributions, especially for high statistics.

Technical difficulties appear when the argument of ERF function is big

[formula]

If the argument of ERF function in formula ([\ref=eq:FitCurve1Explicit]) is denoted as z

[formula]

then the formula ([\ref=eq:FitCurve1Explicit]) looks like:

[formula]

If z  →    +    ∞  , then exponential index also goes to infinity, and so the ambiguity of the type 0  ·    ∞   arises. Because of finite accuracy of computer calculations, this difficulty appears rather fast, just for moderate values of z  ~  10.

To avoid this problem one can use the asymptotic expansion

[formula]

Substituting this expansion to ([\ref=eq:FitCurve1Reduced]), we obtain:

[formula]

Here for big z values no ambiguities appear, function goes to 0. This very expansion allows to find the limit for λ  →  0. Indeed,

[formula]

and

[formula]

Let us consider the limit σg  →  0.

[formula]

and substituting this to ([\ref=eq:FitCurve1Reduced]), we get

[formula]

Function FB1 plots for several sets of parameters are presented in Fig. [\ref=SampleOfFB1].

Sometimes the integral distribution can be useful:

[formula]

Usage of FB1 to fit the distributions would be more convenient, if the free parameter is xm -- location of function maximum, instead of xg. Equation for the search for xm looks rather complicated:

[formula]

or in other notations

[formula]

where [formula]. For ρ  →    ∞   zm  →    -    ∞  :

[formula]

or

[formula]

For ρ  ≪  1 zm  →    +    ∞  , and here we also can derive approximate solution:

[formula]

[formula]

or

[formula]

From ([\ref=eq:PeakCondition]) one can derive more terms of Taylor series:

[formula]

Let us return to the equation ([\ref=eq:maxFb1]), which should be solved in order to find FB1 maximum location. Let us transform the interval of ρ variable to the interval (0,1):

[formula]

At the ends of the interval we know the solution:

[formula]

Let us look for approximating function in the form:

[formula]

Function Fp(μ) plot and the approximating cubic spline with 5 knots are presented in Fig. [\ref=FpApproximation]. Root mean square deviation equals 4.1  ·  10- 4, maximum error of interpolation 2.2  ·  10- 3 is achieved at μ = 1.0  ·  10- 5. Spline coefficients are cited in Table [\ref=tab:FpSpline]. Now we can calculate the shift of peak position vs Gaussian center:

[formula]

The function ΔXmg can be easily implemented in any programming language, using the above formulae.

Build of fitting function on the base of FB1

In some cases the function FB1 itself can be suitable for fitting. However more often this function is not enough flexible to provide satisfactory confidence level with experimental distribution.

One could try to use the function which is the convolution of the three distributions: Gaussian and two different exponential. Such a function could be useful if the distribution "tails" both to the right and left from the peak do not match Gaussian distribution.

However in this case and in other difficult ones the distributions are fitted more successfully to the sum of different FB1 functions with the common parameter -- peak position xm. For the sum of two functions one can use the following expression:

[formula]

Sample of using such a function is presented in Fig. [\ref=FitEtraM0acFB1] (one more parameter is added -- common factor A).

In principle for complicated cases one can use the sum of more FB1 functions. However for so many free parameters the likelihood function minimization can be unstable, and one need to help MINUIT program. The simplest and enough effective trick is optimization of parameters in turn, initially fixed at some reasonable values.

Conclusion

For fitting the smooth distributions with one peak a function is suggested, which is the convolution of Gaussian and exponential distributions.

In cases when this function is not enough flexible to provide satisfactory confidence level, one can use the sum of several functions with different parameters, but the same peak position.