Momentum Strategies with L1 Filter

Keywords: Momentum strategy, L1 filtering, L2 filtering, trend-following, mean-reverting.

JEL classification: C01, C60, G11.

Introduction

Trend detection is a major task of time series analysis from both mathematical and financial point of view. The trend of a time series is considered as the component containing the global change which is in contrast to the local change due to the noise. The procedure of trend filtering concerns not only the problem of denoising but it must take into account also the dynamic of the underlying process. That explains why mathematical approaches to trend extraction have a long history and this subject still gives a great interest in the scientific community . In an investment perspective, trend filtering is the core of most momentum strategies developed in the asset management industry and the hedge funds community in order to improve performance and to limit risk of portfolios.

The paper is organized as follows. In section 2, we discuss the trend-cycle decomposition of time series and review general properties of L1 and L2 filtering. In section 3, we describe the L1 filter with its various extensions and the calibration procedure. In section 4, we apply L1 filters to some momentum strategies and present the results of some backtests with the S&P 500 index. In section 5, we discuss the possible extension to the multivariate case and we conclude in the last section.

Motivations

In economics, the trend-cycle decomposition plays an important role to describe a non-stationary time series into permanent and transitory stochastic components. Generally, the permanent component is assimilated to a trend whereas the transitory component may be a noise or a stochastic cycle. Moreover, the literature on business cycle has produced a large number of empirical research on this topic (see for example Cleveland and Tiao (1976), Beveridge and Nelson (1991), Harvey (1991) or Hodrick and Prescott (1997)). These last authors have then introduced a new method to estimate the trend of long-run GDP. The method widely used by economists is based on L2 filtering. Recently, Kim et al. (2009) have developed a similar filter by replacing the L2 penalty function by a L1 penalty function.

Let us consider a time series yt which can be decomposed by a slowly varying trend xt and a rapidly varying noise εt process: Let us first remind the well-known L2 filter (so-called Hodrick-Prescott filter). This scheme consists to determine the trend xt by minimizing the following objective function: with λ > 0 the regularization parameter which control the competition between the smoothness of xt and the residual yt - xt (or the noise εt). We remark that the second term is the discrete derivative of the trend xt which characterizes the smoothness of the curve. Minimizing this objective function gives a solution which is the trade-off between the data and the smoothness of its curvature. In finance, this scheme does not give a clear signature of the market tendency. By contrast, if we replace the L2 norm by the L1 norm in the objective function, we can obtain more interesting properties. Therefore, Kim et al. (2009) propose to consider the following objective function: This problem is closely related to the Lasso regression of Tibshirani (1996) or the L1 regularized least square problem of Daubechies et al. (2004). Here, the fact of taking the L1 norm will impose the condition that the second derivation of the filtered signal must be zero. Hence, the filtered signal is composed by a set of straight trends and breaks. The competition between these two terms in the objective function turns to the competition between the number of straight trends (or number of breaks) and the closeness to the raw data. Therefore, the smoothing parameter λ plays an important role for detecting the number of breaks. In the later, we present briefly how the L1 filter works for the trend detection and its extension to mean-reverting processes. The calibration procedure for λ parameter will be also discussed in detail.

L1 filtering schemes

Application to trend-stationary process

The Hodrick-Prescott scheme discussed in last section can be rewritten in the vectorial space [formula] and its L2 norm [formula] as: where [formula], [formula] and the D operator is the [formula] matrix:

[formula]

The exact solution of this estimation is given by The explicit expression of [formula] allows a very simple numerical implementation with sparse matrix. As L2 filter is a linear filter, the regularization parameter λ is calibrated by comparing to the usual moving-average filter. The detail of the calibration procedure is given in Appendix [\ref=L2Calibration].

The idea of L2 filter can be generalized to a lager class so-called Lp filter by using Lp penalty condition instead of L2 penalty. This generalization is already discussed in the work of Daubechies et al. (2004) for the linear inverse problem or in the Lasso regression problem by Tibshirani et al. (1996). If we consider a L1 filter, the objective function becomes: which is equivalent to the following vectorial form: It has been demonstrated in Kim et al. (2009) that the dual problem of this L1 filter scheme is a quadratic program with some boundary constraints. The detail of this derivation is shown in Appendix [\ref=appendix-dual-L1-T]. In order to optimize the numerical computation speed, we follow Kim et al. (2009) by using a primal-dual interior point method (see Appendix [\ref=appendix-interior-point]). In the following, we check the efficient of this technique on various trend-stationary processes.

The first model consists of data simulated by a set of straight trend lines with a white noise perturbation:

[formula]

We present in Figure [\ref=fig:test-model1-t] the comparison between L1 - T and HP filtering schemes. The top-left graph is the real trend xt whereas the top-right graph presents the noisy signal yt. The bottom graphs show the results of the L1 - T and HP filters. Here, we have chosen λ = 5  258 for the L1 - T filtering and λ = 1  217  464 for HP filtering. This choice of λ for L1 - T filtering is based on the number of breaks in the trend, which is fixed to 10 in this example. The second model model is a random walk generated by the following process:

[formula]

We present in Figure [\ref=fig:test-model2-t] the comparison between L1 - T filtering and HP filtering on this second model.

Extension to mean-reverting process

As shown in the last paragraph, the use of L1 penalty on the second derivative gives the correct description of the signal tendency. Hence, similar idea can be applied for other order of the derivatives. We present here the extension of this L1 filtering technique to the case of mean-reverting processes. If we impose now the L1 penalty condition to the first derivative, we can expect to get the fitted signal with zero slope. The cost of this penalty will be proportional to the number of jumps. In this case, we would like to minimize the following objective function: or in the vectorial form: Here the D operator is [formula] matrix which is the discrete version of the first order derivative:

[formula]

We may apply the same minimization algorithm as previously (see Appendix [\ref=appendix-dual-L1-C]). To illustrate that, we consider the model with step trend lines perturbed by a white noise process:

[formula]

We employ this model for testing the L1 - C filtering and HP filtering adapted to the first derivative, which corresponds to the following optimization program: In Figure [\ref=fig:test-model3-c], we have reported the corresponding results. For the second test, we consider a mean-reverting process (Ornstein-Uhlenbeck process) with mean value following a regime switching process:

[formula]

Here, μt is the process which characterizes the mean value and θ is inversely proportional to the return time to the mean value. In Figure [\ref=fig:test-model4-c], we show how the L1 - C filter can capture the original signal in comparison to the HP filter.

Mixing trend and mean-reverting properties

We now combine the two schemes proposed above. In this case, we define two regularization parameters λ1 and λ2 corresponding to two penalty conditions [formula] and [formula]. Our objective function for the primal problem becomes now:which can be again rewritten in the matrix form: where the D1 and D2 operators are respectively the [formula] and [formula] matrices defined in equations ([\ref=eq:D1]) and ([\ref=eq:D2]).

In Figures [\ref=fig:test-model1-tc] and [\ref=fig:test-model2-tc], we test the efficiency of the mixing scheme on the straight trend lines model ([\ref=eq:model1]) and the random walk model ([\ref=eq:model2]).

How to calibrate the regularization parameters?

As shown above, the trend obtained from L1 filtering depends on the parameter λ of the regularization procedure. For large values of λ, we obtain the long-term trend of the data while for small values of λ, we obtain short-term trends of the data. In this paragraph, we attempt to define a procedure which permits to do the right choice on the smoothing parameter according to our need of trend extraction.

A preliminary remark

For small value of λ, we recover the original form of the signal. For large value of λ, we remark that there exists a maximum value [formula] above which the trend signal has the affine form: where α and β are two constants which do not depend on the time t. The value of [formula] is given by: We can use this remark to get an idea about the order of magnitude of λ which should be used to determine the trend over a certain time period T. In order to show this idea, we take the data over the total period T. If we want to have the global trend on this period, we fix [formula]. This λ will gives the unique trend for the signal over the whole period. If one need to get more detail on the trend over shorter periods, we can divide the signal into p time intervals and then estimate λ via the mean value of all the [formula] parameter: In Figure [\ref=fig:lambda-S&P500-1], we show the results obtained with p = 2 (λ  =  1  500) and p = 6 (λ  =  75) on the S&P 500 index.

Moreover, the explicit calculation of a Brownian motion process gives us the scaling law of the the smoothing parameter λmax. For the trend filtering scheme, λmax scales as T5 / 2 while for the mean-reverting scheme, λmax scales as T3 / 2 (see Figure [\ref=fig:lambda-power-law]). Numerical calculation of these powers for 500 simulations of the model ([\ref=eq:model2]) gives very good agreement with the analytical result for Brownian motion. Indeed, we obtain empirically that the power for L1 - T filter is 2.51 while the one for L1 - C filter is 1.52.

Cross validation procedure

In this paragraph, we discuss how to employ a cross-validation scheme in order to calibrate the smoothing parameter λ of our model. We define two additional parameters which characterize the trend detection mechanism. The first parameter T1 is the width of the data windows to estimate the optimal λ with respect to our target strategy. This parameter controls the precision of our calibration. The second parameter T2 is used to estimate the prediction error of the trends obtained in the main window. This parameter characterizes the time horizon of the investment strategy. Figure [\ref=fig:algorithm1] shows how the data set is divided into different windows in the cross validation procedure. In order to get the optimal parameter λ, we compute the total error after scanning the whole data by the window T1. The algorithm of this calibration process is described as following:

Figure [\ref=fig:lambda3] illustrates the calibration procedure for the S&P 500 index with T1  =  400 and T2 = 50 for the S&P 500 index (the number of observations is equal to 1  008 trading days). With m = p = 12 and n = 15, the estimated optimal value [formula] for the L1 - T filter is equal to 7.03.

We have observed that this calibration procedure is more favorable for long-term time horizon, that is to estimate a global trend. For short-term time horizon, the prediction of local trends is much more perturbed by the noise. We have computed the probability of having good prediction on the tendency of the market for long-term and short-term time horizons. This probability is about 70% for 3 months time horizon while it is just 50% for one week time horizon. It comes that even if the fit is good for the past, the noise is however large meaning that the prediction of the future tendency is just [formula] for an increasing market and [formula] for a decreasing market. In order to obtain better results for smaller time horizons, we improve the last algorithm by proposing a two-trend model. The first trend is the local one which is determined by the first algorithm with the parameter T2 corresponding to the local prediction. The second trend is the global one which gives the tendency of the market over a longer period T3. The choice of this global trend parameter is very similar to the choice of the moving-average parameter. This model can be considered as a simple version of mean-reverting model for the trend. In Figure [\ref=fig:algorithm2], we describe how the data set is divided for estimating the local trend and the global trend.

The procedure for estimating the trend of the signal in the two-trend model is summarized in Algorithm [\ref=alg-FP]. The corrected trend is now determined by studying the relative position of the historical data to the global trend. The reference position is characterized by the standard deviation [formula] where xGt is the filtered global trend.

Application to momentum strategies

In this section, we apply the previous framework to the S&P 500 index. First, we illustrate the calibration procedure for a given trading date. Then, we backtest a momentum strategy by estimating dynamically the optimal filters.

Estimating the optimal filter for a given trading date

We would like to estimate the optimal filter for January 3rd, 2011 by considering the period from January 2007 to December 2010. We use the previous algorithms with T1  =  400 and T2  =  50. The optimal parameters are λ1  =  2.46 (for the L1 - C filter) and λ2  =  15.94 (for the L2 - T filter). Results are reported in Figure [\ref=fig:backtest1]. The trend for the next 50 trading days is estimated to 7.34% for the L1 - T filter and 7.84% for the HP filter whereas it is null for the L1 - C and L1 - TC filters. By comparison, the true performance of the S&P 500 index is 1.90% from January 3rd, 2011 to March 15th, 2011.

Backtest of a momentum strategy

Design of the strategy

Let us consider a class of self-financed strategies on a risky asset St and a risk-free asset Bt. We assume that the dynamics of these assets is:

[formula]

where rt is the risk-free rate, μt is the trend of the asset price and σt is the volatility. We denote αt the proportion of investment in the risky asset and [formula] the part invested in the risk-free asset. We start with an initial budget W0 and expect a final wealth WT. The optimal strategy is the one which optimizes the expectation of the utility function [formula] which is increasing and concave. It is equivalent to the Markowitz problem which consists of maximizing the wealth of the portfolio under a penalty of risk:which is equivalent to:As the objective function is concave, the maximum corresponds to the zero point of the gradient μt  -  λW0αtσ2t. We obtain the optimal solution:In order to limit the explosion of αt, we also impose the following constraint αmin   ≤  αt  ≤  αmax : The wealth of the portfolio is then given by the following expression:

Results

In the following simulations, we use the estimators t and σ̂t in place of μt and σt. For t, we consider different models like L1, HP and moving-average filters whereas we use the following estimator for the volatility: We consider a long/short strategy, that is [formula]. In the particular case of the L1t estimator, we consider three different models:

the first one is based on the local trend;

the second one is based on the global trend;

the combination of both local and global trends corresponds to the third model.

For all these strategies, the test set of the local trend T2 is equal to 6 months (or 130 trading days) whereas the length of the test set for global trend is four times the length of the test set - T3 = 4T2 - meaning that T3 is one year (or 520 trading days). This choice of T3 agrees with the habitual choice of the width of the windows in moving average estimator. The length of the training set is also four times the length of the test set T1. The study period is from January 1998 to December 2010. In the backtest, the trend estimation is updated every day. In Table [\ref=tab:backtest1], we summarize the results obtained with the different models cited above for the backtest. We remark that the best performances correspond to the case of global trend, HP and two-trend models. Because HP filter is calibrated to the window of the moving-average filter which is equal to T3, it is not surprising that the performances of these three models are similar. On the considered period of the backtest, the S&P does not have a clear upward or downward trend. Hence, the local trend estimator does not give a good prediction and this strategy gives the worst performance. By contrast, the two-trend model takes into account the trade-off between local trend and global trend and gives a better result

Extension to the multivariate case

We now extend the L1 filtering scheme to a multivariate time series [formula]. The underlying idea is to estimate the common trend of several univariate time series. In finance, the time series correspond to the prices of several assets. Therefore, we can build long/short strategies between these assets by comparing the individual trends and the common trend.

For the sake of simplicity, we assume that all the signals are rescaled to the same order of magnitude. The objective function becomes new:In Appendix [\ref=appendix-dual-L1-TM], we show that this problem is equivalent to the L1 univariate problem by considering [formula] as the signal.

Conclusion

Momentum strategies are efficient ways to use the market tendency for building trading strategies. Hence, a good estimator of the trend is essential from this perspective. In this paper, we show that we can use L1 filters to forecast the trend of the market in a very simple way. We also propose a cross-validation procedure to calibrate the optimal regularization parameter λ where the only information to provide is the investment time horizon. More sophisticated models based on a local and global trends is also discussed. We remark that these models can reflect the effect of mean-reverting to the global trend of the market. Finally, we consider several backtests on the S&P 500 index and obtain competing results with respect to the traditional moving-average filter.

Computational aspects of L1, L2 filters

The dual problem

The L1 - T filter

This problem can be solved by considering the dual problem which is a QP program. We first rewrite the primal problem with new variable z = Dx:

[formula]

We construct now the Lagrangian function with the dual variable [formula]:The dual objective function is obtained in the following way:for [formula]. According to the Kuhn-Tucker theorem, the initial problem is equivalent to the dual problem:

[formula]

This QP program can be solved by traditional Newton algorithm or by interior-point methods, and the final solution of the trend reads

The L1 - C filter

The optimization procedure for L1 - C filter follows the same strategy as the L1 - T filter. We obtain the same quadratic program with the D operator replaced by [formula] matrix which is the discrete version of the first order derivative:

The L1 - TC filter

In order to follow the same strategy presented above, we introduce two additional variables z1 = D1x and z2 = D2x. The initial problem becomes:

[formula]

The Lagrangian function with the dual variables [formula] and [formula] is:whereas the dual objective function is:for [formula] (i = 1,2). Introducing the variable [formula] and [formula], the initial problem is equivalent to the dual problem:

[formula]

with [formula], [formula], R = Dy and [formula]. The solution of the primal problem is then given by [formula].

The L1 - T multivariate filter

As in the univariate case, this problem can be solved by considering the dual problem which is a QP program. The primal problem is:

[formula]

Let us define [formula] with [formula]. The dual objective function becomes:for [formula]. According to the Kuhn-Tucker theorem, the initial problem is equivalent to the dual problem:

[formula]

This QP program can be solved by traditional Newton algorithm or by interior-point methods and the solution is:

The interior-point algorithm

We present briefly the interior-point algorithm of Boyd and Vandenberghe (2009) in the case of the following optimization problem:

[formula]

where [formula] are convex and twice continuously differentiable and [formula]. The inequality constraints will become implicit if one rewrite the problem as:

[formula]

where [formula] is the non-positive indicator function. This indicator function is discontinuous, hence the Newton method can not be applied. In order to overcome this problem, we approximate [formula] by the logarithmic barrier function [formula] with τ  →    ∞  . Finally the Kuhn-Tucker condition for this approximation problem gives [formula] with:The solution of [formula] can be obtained by Newton's iteration for the triple [formula]: This equation gives the Newton's step [formula] which defines the search direction.

The scaling of smoothing parameter of L1 filter

We can try to estimate the order of magnitude of the parameter λmax  by considering the continuous case. Assuming that the signal is a process Wt. The value of λmax  in the discrete case defined by:can be considered as the first primitive [formula] of the process Wt if D = D1 (L1 - C filtering) or the second primitive [formula] of Wt if D = D2 (L1 - T filtering). We have:

[formula]

The process [formula] is a Wiener integral (or a Gaussian process) with variance:In this case, we expect that λmax   ~  T3 / 2. The second order primitive can be calculated in the following way:

[formula]

This quantity is again a Gaussian process with variance:In this case, we expect that λmax   ~  T5 / 2.

Calibration of the L2 filter

We discuss here how to calibrate the L2 filter in order to extract the trend with respect to the investment time horizon T. Though the L2 filter admits an explicit solution which is a great advantage for numerical implementation, the calibration of the smoothing parameter λ is not trivial. We propose to calibrate the L2 filter by comparing the spectral density of this filter with the one obtained with the moving-average filter. For this last filter, we have: It comes that the spectral density is:For the L2 filter, we k now that the solution is [formula]. Therefore, the spectral density is:

[formula]

The width of the spectral density for the L2 filter is then [formula] whereas it is 2πT- 1 for the moving-average filter. Calibrate the L2 filter could be done by matching this two quantities. Finally, we obtain the following relationship:In Figure [\ref=fig:lambda4-a], we represent the spectral density of the moving-average filter for different windows T. We report also the spectral density of the corresponding L2 filters. For that, we have calibrated the optimal parameter [formula] by least square minimization. In Figure [\ref=fig:lambda4-b], we compare the optimal estimator [formula] with the one corresponding to [formula]. We notice that the approximation is very good.

Implementation issues

The computational time may be large when working with dense matrices even if we consider interior-point algorithms. It could be reduced by using sparse matrices. But the efficient way to optimize the implementation is to consider band matrices. Moreover, we may also notice that we have to solve a large linear system at each iteration. Depending on the filtering problem (L1 - T, L1 - C and L1 - TC filters), the system is 6-bands or 3-bands but always symmetric. For computing λmax, one may remark that it is equivalent to solve a band system which is positive definite. We suggest to adapt the algorithms in order to take into account all these properties.