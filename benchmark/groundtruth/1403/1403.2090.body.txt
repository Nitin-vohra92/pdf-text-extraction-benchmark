Upper Bounds on Syntactic Complexity of Left and Two-Sided Ideals

This work was supported by the Natural Sciences and Engineering Research Council of Canada grant No. OGP000087, and by Polish NCN grant DEC-2013/09/N/ST6/01194.

Introduction

The syntactic complexity [\cite=BrYe11] of a regular language is the size of its syntactic semigroup [\cite=Pin97]. The transition semigroup T of a deterministic finite automaton (DFA) D is the semigroup of transformations of the state set of D generated by the transformations induced by the input letters of D. The transition semigroup of a minimal DFA of a language L is isomorphic to the syntactic semigroup of L [\cite=Pin97]; hence syntactic complexity is equal to the cardinality of T.

The number n of states of D is known as the state complexity of the language [\cite=Brz10] [\cite=Yu01], and it is the same as the number of left quotients of the language. The syntactic complexity of a class of regular languages is the maximal syntactic complexity of languages in that class expressed as a function of n.

A right ideal (respectively, left ideal, two-sided ideal) is a non-empty language L over an alphabet Σ such that L = LΣ* (respectively, L = Σ*L, L = Σ*LΣ*). We are interested only in regular ideals; for reasons why they deserve to be studied see [\cite=BJL13]. Ideals appear in pattern matching. For example, if a text is a word w over some alphabet Σ, and a pattern is an arbitrary language L over Σ, then an occurrence of a pattern represented by L in text w is a triple (u,x,v) such that w = uxv and x is in L. Searching text w for words in L is equivalent to looking for prefixes of w that belong to the language Σ*L, which is the left ideal generated by L.

The syntactic complexity of right ideals was proved to be nn - 1 in [\cite=BrYe11]. The syntactic complexities of left and two-sided ideals were also examined in [\cite=BrYe11], where it was shown that nn - 1 + n - 1 and nn - 2 + (n - 2)2n - 2, respectively, are lower bounds on these complexities, and it was conjectured that they are also upper bounds. In this paper we prove these conjectures.

If w = uxv for some u,v,x∈Σ*, then v is a suffix of w and x is a factor of w. A suffix of w is also a factor of w. A language L is suffix-closed (respectively, factor-closed) if w∈L implies that every suffix (respectively, factor) of w is also in L. We are interested only in regular suffix- and factor-closed languages. Since every left (respectively, two-sided) ideal is the complement of a suffix-closed (respectively, factor-closed) language, and syntactic complexity is preserved by complementation, our theorems also apply to suffix- and factor-closed languages, but our proofs are given for left and two-sided ideals only.

Preliminaries

The left quotient or simply quotient of a regular language L by a word w is denoted by Lw and defined by Lw = {x|wx∈L}. A language is regular if and only if it has a finite number of quotients. The number of quotients of L is called its quotient complexity. We denote the set of quotients by [formula], where K0 = L = Lε by convention. Each quotient Ki can be represented also as Lwi, where wi∈Σ* is such that Lwi = Ki.

A deterministic finite automaton (DFA) is a quintuple D = (Q,Σ,δ,q0,F), where Q is a finite non-empty set of states, Σ is a finite non-empty alphabet δ:Q  ×  Σ  →  Q is the transition function, q0∈Q is the initial state, and F  ⊆  Q is the set of final states.

The quotient DFA of a regular language L with n quotients is defined by D = (K,Σ,δ,K0,F), where δ(Ki,w) = Kj if and only if Kiw = Kj, and F = {Ki|ε∈Ki}. To simplify the notation, we use the set [formula] of subscripts of quotients to denote the states of D; then D is denoted by D = (Q,Σ,δ,0,F). The quotient corresponding to q∈Q is then Kq  =  {w|δ(q,w)∈F}. The quotient K0 = L is the initial quotient. A quotient is final if it contains ε. A state q is empty if its quotient Kq is empty.

The quotient DFA of L is isomorphic to each complete minimal DFA of L. The number of states in the quotient DFA of L (the quotient complexity of L) is therefore equal to the state complexity of L.

In any DFA, each letter a∈Σ defines a transformation of the set Q of n states. Let TQ be the set of all nn transformations of Q; then TQ is a monoid under composition. The identity transformation [formula] maps each element to itself. For [formula], a transformation (permutation) t of a set [formula] is a k-cycle if [formula]. A k-cycle is denoted by [formula]. If a transformation t of Q acts like a k-cycle on some P  ⊆  Q, we say that t has a k-cycle. A transformation has a cycle if it has a k-cycle for some [formula]. A 2-cycle (q0,q1) is called a transposition. A transformation is constant if it maps all states to a single state q; it is denoted by (Q  →  q). If w is a word of Σ*, the fact that w induces transformation t is denoted by w:t. A transformation mapping i to qi for [formula] is sometimes denoted by

[formula]

Left Ideals

Basic Properties

Let [formula], let [formula] be a minimal DFA, and let Tn be its transition semigroup. Consider the sequence [formula] of states obtained by applying transformation t∈Tn repeatedly, starting with the initial state. Since Q is finite, there must eventually be a repeated state, that is, there must exist i and j such that [formula] are distinct, but 0tj = 0ti; the integer j - i is the period of t. If the period is 1, t is said to be initially aperiodic; then the sequence is [formula].

If Dn is a DFA of a left ideal, all the transformations in Tn are initially aperiodic, and no state of Dn is empty.

A language L  ⊆  Σ* is a left ideal if and only if for all x,y∈Σ*, Ly  ⊆  Lxy. Hence, if Lx  ≠  L, then L  ⊂  Lx for any x∈Σ+.

It is useful to restate this observation it terms of the states of Dn. For DFA Dn and states p,q∈Q, we write [formula] if Kp  ⊂  Kq.

A DFA Dn is a minimal DFA of a left ideal if and only if for all [formula], [formula]. If 0t  ≠  0, then [formula] for any t∈Tn. Also, if r∈Q has a t-predecessor, that is, if there exists q∈Q such that qt = r, then [formula]. (This follows because q = 0s for some transformation s since q is reachable from 0; hence [formula] and [formula].) In particular, if r appears in a cycle of t or is a fixed point of t, then [formula].

We consider chains of the form [formula], where the Kij are quotients of L. If L is a left ideal, the smallest element of any maximal-length chain is always L. Alternatively, we consider chains of states starting from 0 and strictly ordered by [formula].

For t∈Tn and p,q∈Q, [formula] implies [formula]. If [formula], then [formula] for some [formula]. Similarly, [formula] implies [formula], and [formula] implies [formula] for some [formula].

It was proved in [\cite=BrYe11] that the transition semigroup of the following DFA of a left ideal meets the bound nn - 1 + n - 1.

For [formula], we define the DFA [formula] where [formula], [formula], and [formula] is defined by [formula], b:(1,2), c:(n - 1  →  1), d:(n - 1  →  0), and e:(Q  →  1). For n = 3, a and b coincide, and we can use [formula].

In Wn, the transformations induced by a, b, and c restricted to [formula] generate all the transformations of the last n - 1 states. Together with the transformation of d, they generate all transformations of Q that fix 0. To see this, consider any transformation t that fixes 0. If some states from [formula] are mapped to 0 by t, we can map them first to n - 1 and n - 1 to one of them by the transformations of a, b, and c, and then map n - 1 to 0 by the transformation of d. Also the words of the form eai for [formula] induce constant transformations (Q  →  i + 1). Hence the transition semigroup of Wn contains all the constant transformations.

One verifies that the maximal-length chains of quotients in Wn have length 2. On the other hand, for [formula], let Σ  =  {a,b} and let L = Σ*an - 1. Then L has n quotients and the maximal-length chains are of length n.

Upper Bound

Our main result of this section shows that the lower bound nn - 1  +  n - 1 is also an upper bound. Our approach is as follows: We consider a minimal DFA [formula], where [formula], of an arbitrary left ideal with n quotients and let Tn be the transition semigroup of Dn. We also deal with the witness DFA [formula] of Definition [\ref=def:wit] that has the same state set as Dn and whose transition semigroup is Sn. We shall show that there is an injective mapping f:Tn  →  Sn, and this will prove that [formula].

If n = 1, the only left ideal is Σ* and the transition semigroup of its minimal DFA satisfies the bound 10 + 1 - 1 = 1. If n = 2, there are only three allowed transformations, since the transposition (0,1) is not initially aperiodic and so is ruled out by Lemma [\ref=lem:aperiodic]. Thus the bound 21 + 2 - 1 = 3 holds.

If [formula] and a maximal-length chain in Dn strictly ordered by [formula] has length 2, then [formula] and Tn is a subsemigroup of Sn.

Consider an arbitrary transformation t∈Tn and let p = 0t. If p = 0, then any state other than 0 can possibly be mapped by t to any one of the n states; hence there are at most nn - 1 such transformations. All of these transformations are in Sn by Remark [\ref=rem:left-ideals_transformations].

If p  ≠  0, then [formula]. Consider any state [formula]; by Remark [\ref=rem:left-ideals_xy2], [formula]. If p  ≠  qt, then [formula]. But then we have the chain [formula] of length 3, contradicting our assumption. Hence we must have p = qt, and so t is the constant transformation t = (Q  →  p). Since p can be any one of the n - 1 states other than 0, we have at most n - 1 such transformations. Since all of these transformations are in Sn by Remark [\ref=rem:left-ideals_transformations], Tn is a subsemigroup of Sn.

If [formula] and L is a left ideal or a suffix-closed language with n quotients, then its syntactic complexity is less than or equal to nn - 1 + n - 1.

It suffices to prove the result for left ideals. For a transformation t∈Tn, consider the following cases:

15pt Case 1: t∈Sn. Let f(t)  =  t; obviously f(t) is injective.

15pt Case 2: [formula] and 0t2  ≠  0t. Note that [formula] implies 0t  ≠  0 by Remark [\ref=rem:left-ideals_transformations]. Let 0t = p. We have [formula] by Remark [\ref=rem:left-ideals_xy2]. Let [formula] be the chain defined from p; this chain is of length at least 2. Let f(t) = s, where s is the transformation defined by

[formula]

Transformation s is shown in Figure [\ref=fig:left-case2], where the dashed transitions show how s differs from t.

By Remark [\ref=rem:left-ideals_transformations], s∈Sn. However, [formula], as it contains the cycle [formula] with states strictly ordered by [formula] in DFA Dn, which contradicts Proposition [\ref=prop:chain]. Since [formula], it is distinct from the transformations defined in Case 1.

In going from t to s, we have added one transition (0s = 0) that is a fixed point, and one (ptks = p) that is not. Since only one non-fixed-point transition has been added, there can be only one cycle in s with states strictly ordered by [formula]. Since 0 can't appear in this cycle, p is its smallest element with respect to [formula].

Suppose now that t'  ≠  t is another transformation that satisfies Case 2, that is, 0t'  =  p'  ≠  0 and p't'  ≠  p'; we shall show that f(t)  ≠  f(t'). Define s' for t' as s was defined for t. For a contradiction, assume s  =  f(t)  =  f(t') = s'.

Like s, s' contains only one cycle strictly ordered by [formula], and p' is its smallest element. Since we have assumed that s = s', we must have p = 0t = 0t' = p' and the cycles in s and s' must be identical. In particular, ptkt  =  ptk  =  p(t')kt'  =  p(t')k. For q of [formula], we have qt = qs = qs' = qt'. Hence t  =  t'--a contradiction. Therefore t  ≠  t' implies f(t)  ≠  f(t').

15 pt Case 3: [formula] and 0t2  =  0t. As before, let 0t = p. Consider any state [formula]; then [formula] by Remark [\ref=rem:left-ideals_xy2] and [formula] by Proposition [\ref=prop:chain]. Thus either [formula], or p = qt. We consider the following sub-cases:

15 pt [formula] (a): t has a cycle. Since t has a cycle, take a state r from the cycle; then r and rt are not comparable under [formula] by Proposition [\ref=prop:chain], and [formula] by Remark [\ref=rem:left-ideals_xy2]. Let f(t)  =  s, where s is the transformation shown in Figure [\ref=fig:left-case3a] and defined by

[formula]

By Remark [\ref=rem:left-ideals_transformations], s∈Sn. Suppose that s∈Tn; since [formula], we have [formula] by the definition of s and Proposition [\ref=prop:chain]; this contradicts that r and rt are not comparable. Hence [formula], and so s is distinct from the transformations of Case 1.

We claim that p is not in a cycle of s; this cycle would have to be

[formula]

for some [formula] because r  ≠  p = pt and rt  ≠  p. Since [formula] we have [formula]; but then we have a chain [formula], contradicting Proposition [\ref=prop:chain].

Since p is not in a cycle of s, it follows that s does not contain a cycle with states strictly ordered by [formula], as such a cycle would also be in t. So s is distinct from the transformations of Case 2.

We claim there is a unique state q such that (a) [formula], (b) [formula]. First we show that p satisfies these conditions: (a) holds because ps = r and [formula]; (b) holds because ps = r, ps2 = rt and r and rt are not comparable. Now suppose that q satisfies the two conditions, but q  ≠  p. Note that qs  ≠  p, because qs = p implies [formula], contradicting (b). Since [formula], we have [formula]. But Proposition [\ref=prop:chain] for [formula] implies that [formula]--a contradiction. Thus p is the only state satisfying these conditions.

If t'  ≠  t is another transformation satisfying the conditions of this case, we define s' like s. Suppose that s  =  f(t)  =  f(t')  =  s'. Since both s and s' contain a unique state p satisfying the two conditions above, we have 0t  =  0t'  =  p and pt  =  pt'  =  p. Since the other states are mapped by s exactly as by t and t', we have t  =  t'.

15pt [formula] (b): t has no cycles and has a fixed point r  ≠  p. Because [formula] by Remark [\ref=rem:left-ideals_xy2], [formula] by Proposition [\ref=prop:chain]. If r is a fixed point of t, then [formula]. Since r  ≠  p, we have [formula]. Let f(t) = s, where s is the transformation shown in Figure [\ref=fig:left-case3b] and defined by

[formula]

[formula]

By Remark [\ref=rem:left-ideals_transformations], s∈Sn. Suppose that s∈Tn; because [formula], ps = p, rs = 0, and [formula] by Proposition [\ref=prop:chain], we have [formula], which is a contradiction. Hence s is not in Tn and so is distinct from the transformations of Case 1. Also, s maps at least one state other than 0 to 0, and so is distinct from the transformations of Case 2 and also from the transformations of Case 3(a).

If t'  ≠  t is another transformation satisfying the conditions of this case, we define s' like s. Now suppose that s  =  f(t)  =  f(t') = s'. There is only one fixed point of s other than 0 (ps  =  p), and only one fixed point of s' other than 0 (p's'  =  p'); hence 0t = p = p' = 0t'. By the definition of s, for each state q  ≠  0 such that qs  =  0, we have qt  =  q. Similarly, for each state q  ≠  0 such that qs' = 0, we have qt'  =  q. Hence t and t' agree on these states. Since the remaining states are mapped by s exactly as they are mapped by t and t', we have t  =  t'. Thus we have proved that t  ≠  t' implies f(t)  ≠  f(t').

15 pt [formula] (c): t has no cycles, has no fixed point r  ≠  p and there is a state r such that [formula] with rt = p. Let f(t)  =  s, where s is the transformation shown in Figure [\ref=fig:left-case3c] and defined by

[formula]

[formula]

By Remark [\ref=rem:left-ideals_transformations], s∈Sn. Suppose that s∈Tn; because [formula], ps  =  r, rs  =  0, and [formula] by Proposition [\ref=prop:chain], we have [formula]--a contradiction. Hence [formula] and s is distinct from the transformations of Case 1.

Because s maps at least one state other than 0 to 0 (rs  =  0), it is distinct from the transformations of Case 2 and 3(a). Also s does not have a fixed point other than 0, while the transformations of Case 3(b) have such a fixed point.

We claim that there is a unique state q such that (a) [formula] and (b) qs2  =  0. First we show that p satisfies these conditions. By assumption [formula] and rt = p; also rs = 0 by the definition of s. Condition (a) holds because [formula], and (b) holds because 0  =  rs  =  ps2.

Now suppose that [formula], qs2  =  0 and q  ≠  p. Since qs  ≠  0, we have qs  =  qt by the definition of s. Because qt has a t-predecessor, [formula] by Remark [\ref=rem:left-ideals_xy2]. Also qt  =  qs  ≠  p, for qs  =  p implies 0 = qs2 = ps = r--a contradiction. Hence [formula]. From qt  =  qs and [formula], we have [formula]. Since qs2  =  0 we have (qt)s = 0 and so (qt)t  =  p, by the definition of s. By Proposition [\ref=prop:chain], from [formula] we have [formula], contradicting [formula]. So q = p.

If t'  ≠  t is another transformation satisfying the conditions of this case, we define s' like s. Suppose that s  =  f(t)  =  t(t')  =  s'. Since s and s' contain a unique state p satisfying the two conditions above, we have 0t  =  0t'  =  p and pt  =  pt'  =  p. Then r and the states [formula] with qt = p are determined by p, since they are precisely the states [formula] with qs  =  0. Since the other states are mapped by s exactly as by t and t', we have t  =  t', and f is again injective.

5pt [formula] All cases are covered: Now we need to ensure that any transformation t fits in at least one case. It is clear that t fits in Case 1 or 2 or 3. For Case 3, it is sufficient to show that if (i) [formula] does not contain a fixed point r  ≠  p, and (ii) there is no state r with [formula] and rt  =  p, then t contains a cycle.

First, if there is no r such that [formula], we claim that t is the constant transformation (Q  →  p). Consider any state q∈Q such that qt  ≠  p. Then [formula] by Remark [\ref=rem:left-ideals_xy2], contradicting that there is no state r such that [formula].

So let r be some state such that [formula]. Consider the sequence [formula]. By Remark [\ref=rem:left-ideals_xy2], [formula] for all [formula]. If rtk  =  p for some [formula], let i be the smallest such k; we have (rti - 1)t  =  p, contradicting (ii). Since p is the only fixed point by (i), we have rti  ≠  rti - 1. Since there are finitely many states, rti  =  rtj for some i and j such that [formula], and so the states [formula] form a cycle.

We have shown that for every transformation t in Tn there is a corresponding transformation f(t) in Sn, and f is injective. So |Tn|  ≤  |Sn| = nn - 1 + n - 1.

Next we prove that Sn is the only transition semigroup meeting the bound. It follows that minimal DFAs of left ideals with the maximal syntactic complexity have maximal-length chains of length 2.

If Tn has size nn - 1 + n - 1, then Tn = Sn.

Consider a maximal-length chain of states strictly ordered by [formula] in Dn. If its length is 2, then by Lemma [\ref=lem:chain2], Tn is a subsemigroup of Sn. Thus only Tn  =  Sn reaches the bound in this case.

Assume now that the length of a maximal-length chain is at least 3. Then there are states p and r such that [formula]. Let [formula], and let [formula]. We shall show that there exists a transformation s that is in Sn but not in f(Tn). To define s we use the constant transformation u = (Q  →  p) as an auxiliary transformation. Let 0s = 0, ps = r, rs = 0 for all r∈R, and qs  =  qu = p for q∈X; these are precisely the rules we used in Case 3(c) in the proof of Theorem [\ref=thm:left-ideals_upper-bound]. By Remark [\ref=rem:left-ideals_transformations], s∈Sn.

It remains to be shown that there is no transformation t∈Tn such that s = f(t). The proof that s is different from the transformations f(t) of Cases 1, 2, 3(a) and 3(b) is exactly the same as the corresponding proof in Case 3(c) following the definition of s.

It remains to verify that there is no u'∈Tn in Case 3(c) such that f(u') = s. Suppose there is such a u'. Recall that states p and r satisfying [formula] have been fixed by assumption. By the definition of s, state p satisfies the conditions (a) [formula] and (b) ps2  =  0. We claim that p is the only state satisfying these conditions. Indeed, if q  ≠  p then either qs  =  0, [formula] and (a) is violated, or qs  =  p, qs2  =  ps  =  r  ≠  0 and (b) is violated. This observation is used in the proof of Case 3(c) to prove the claim below.

Both u and u' satisfy the conditions of Case 3(c), except that u fails the condition [formula]. However, that latter condition is not used in the proof that if u  ≠  u' and u' satisfy the other conditions of Case 3(c), then s'  ≠  s, where s' is the transformation obtained from u' by the rules of s. Thus s is also different from the transformations in f(Tn) from Case 3(c).

Because [formula], s∈Sn and f(Tn)  ⊆  Sn, the bound nn - 1 + n - 1 cannot be reached if the length of the maximal-length chains is not 2.

Two-Sided Ideals

If a language L is a right ideal, then L = LΣ* and L has exactly one final quotient, namely Σ*; hence this also holds for two-sided ideals. For [formula], in a two-sided ideal every maximal chain is of length at least 3: it starts with L, every quotient contains L and is contained in Σ*.

It was proved in [\cite=BrYe11] that the transition semigroup of the following DFA of a two-sided ideal meets the bound nn - 2  +  (n - 2)2n - 2 + 1.

For [formula], define the DFA [formula], where [formula], [formula], and [formula] is defined by [formula], b:(1,2), c:(n - 2  →  1), d:(n - 2  →  0), for [formula], δ(q,e) = 1 and δ(n - 1,e) = n - 1, and f:(1  →  n - 1). For n = 4, inputs a and b coincide, and we can use [formula].

If n = 1, the only two-sided ideal is Σ*, its syntactic complexity is 1, and the bound above is not tight. If n = 2, each two-sided ideal is of the form L = Σ*ΓΣ*, where [formula], its syntactic complexity is 2, and the bound is tight. If n = 3, there are eight transformations that are initially aperiodic and such that (n - 1)t  =  t (the property of a right-ideal transformation). We have verified that the DFA having all eight or any seven of the eight transformations is not a two-sided ideal. Hence 6 is an upper bound, and we know from [\cite=BrYe11] that the transformations

[formula]

, and

[formula]

We consider a minimal DFA [formula], where [formula], of an arbitrary two-sided ideal with n quotients, and let Tn be the transition semigroup of Dn. We also deal with the witness DFA [formula] of Definition [\ref=def:wit2] with transition semigroup Sn.

In Wn, the transformations induced by a, b, and c restricted to [formula] generate all the transformations of the states [formula]. Together with the transformations of d and f, they generate all transformations of Q that fix 0 and n - 1. For any subset [formula], there is a transformation--induced by a word wS, say--that maps S to n - 1 and fixes [formula]. Then the words of the form wSeai, for [formula], induce all transformations that maps [formula] to n - 1 and [formula] to i + 1. In Wn, there is also the constant transformation ef:(Q  →  n - 1).

If [formula] and a maximal-length chain in Dn strictly ordered by [formula] has length 3, then [formula], and Tn is a subsemigroup of Sn.

Consider an arbitrary transformation t∈Tn; then (n - 1)t = n - 1. If 0t = 0, then any state not in {0,n - 1} can possibly be mapped by t to any one of the n states; hence there are at most nn - 2 such transformations.

If 0t  ≠  0, then [formula]. Consider any state [formula]; since Dn is minimal, q must be reachable from 0 by some transformation s, that is, q = 0s. If [formula], then [formula] by Remark [\ref=rem:left-ideals_xy2]. But then we have the chain [formula] of length 4, contradicting our assumption. Hence we must have either 0st = 0t, or 0st = n - 1. For a fixed 0t, a subset of the states in [formula] can be mapped to 0t and the remaining states in [formula] to n - 1, thus giving 2n - 2 transformations. Since there are n - 2 possibilities for 0t, we obtain the second part of the bound. Finally, all states can be mapped to n - 1.

By Remark [\ref=rem:2sided_transformations] all of the above-mentioned transformations are in Sn.

If L is a two-sided ideal or a factor-closed language with [formula] quotients, then its syntactic complexity is less than or equal to nn - 2  +  (n - 2)2n - 2 + 1.

It suffices to prove the result for two-sided ideals. As we did for left ideals, we show that [formula], by constructing an injective function f:Tn  →  Sn.

We have [formula] for any q∈Q, and n - 1 is a fixed point of every transformation in Tn and Sn.

For a transformation t∈Tn, consider the following cases:

15 pt Case 1: t∈Sn. The proof is the same as that of Case 1 of Theorem [\ref=thm:left-ideals_upper-bound].

15 pt Case 2: [formula], and 0t2  ≠  0t. Let [formula] be the chain defined from p.

15 pt [formula] (a): ptk  ≠  n - 1. The proof is the same as that of Case 2 of Theorem [\ref=thm:left-ideals_upper-bound].

15 pt [formula] (b): ptk  =  n - 1 and [formula]. Let f(t) = s, where s is the transformation shown in Figure [\ref=fig:2sided-case2b] and defined by

[formula]

[formula]

By Remark [\ref=rem:2sided_transformations], s∈Sn. Note that s contains the cycle (p,pt) where [formula], pts  =  p and ps  =  n - 1. By Proposition [\ref=prop:chain], [formula], that is, [formula], which contradicts the fact that p  ≠  n - 1, since pt  ≠  p. Thus s is not in Tn, and so it is different from the transformations of Case 1.

Observe that s does not have a cycle with states strictly ordered by [formula], since no state from [formula] can be in a cycle, and t cannot have such a cycle. Hence s is different from the transformations of Case 2(a).

In s, there is a unique state q such that qs  =  n - 1 and for which there exists a state r such that [formula] and rs  =  q, and that this state q must be p. Indeed, if q  ≠  p, then qt  =  qs  =  n - 1 by the definition of s. From [formula], we have [formula]; hence rs = rt = n - 1 and rt  ≠  q--a contradiction. Hence q = p.

By a similar argument, we show that there exists a unique state q such that [formula], and qs  =  p, and that this state q must be pt. If q  ≠  pt then qs  =  qt. But [formula] and [formula] contradicts that [formula]. Continuing in this way for [formula] we show that there is a unique chain [formula].

If t'  ≠  t is another transformation satisfying the conditions of this case, we define s' like s. Now suppose that s  =  f(t)  =  f(t')  =  s'. Since we have a unique state p such that ps  =  n - 1 for which there exists a state r such that [formula] and rs  =  p, we have 0t  =  0t'  =  p. Also the chain of states [formula] is unique in s and s' as we have shown above; so pti  =  pt'i for [formula]. Since the other states are mapped by s exactly as by t and t', we have t  =  t'.

15 pt [formula] (c): pt  =  n - 1. Let P = {0,p,n - 1}. Since [formula], there must be a state [formula]. If [formula] for all [formula], then [formula]; hence rt = n - 1 for all such r, and qt∈{p,n - 1} for all q∈Q. By Remark [\ref=rem:2sided_transformations], there is a transformation in Sn that maps [formula] to n - 1, and [formula] to p for any [formula]. Thus t∈Sn--a contradiction.

In view of the above, there must exist a state [formula] such that [formula]. By Remark [\ref=rem:left-ideals_xy2], we have [formula] and of course [formula]. If rt is p or n - 1 for all [formula], we again have the situation described above, showing that t∈Sn. Hence there must exist an [formula] such that [formula] and [formula].

Also we claim that t does not have a cycle. Indeed, if [formula], then q is mapped to n - 1; if [formula], then q is mapped to a state [formula] and again q cannot be in a cycle since the chain starting with q ends in n - 1.

Let f(t) = s, where s is the transformation shown in Figure [\ref=fig:2sided-case2c] and defined by

0s  =  0,  ps  =  rt,  (rt)s  =  p,  rs  =  0,

[formula]

Since s fixes both 0 and n - 1, it is in Sn by Remark [\ref=rem:2sided_transformations]. But s is not in Tn, as we have the cycle (p,rt) with [formula]. So s is different from the transformations of Case 1. Since s maps a state other than 0 to 0, it is different from the transformations of Cases 2(a) and 2(b).

Observe that t does not map any state to 0. Consequently, in s there is the unique state r  ≠  0 mapped to 0. Also, as t does not contain a cycle, the only cycle in s must be (p,rt).

If t'  ≠  t is another transformation satisfying the conditions of this case, we define s' like s. Now suppose that s  =  f(t)  =  f(t')  =  s'. Because both s and s' have the unique non-fixed point r mapped to 0, r  =  r'. Also s and s' contain the unique cycle (p,rt), [formula]. Thus p  =  p', pt  =  pt'  =  n - 1 and rt  =  rt'. It follows that 0t  =  0t'  =  p. Because [formula], we have (rt)t  =  (rt)t'  =  n - 1. The other states are mapped by s exactly as by t and t', and so t  =  t'.

15 pt Case 3: [formula], 0t  =  p  ≠  0 and pt  =  p.

15 pt [formula] (a): t has a cycle. The proof is analogous to that of Case 3(a) in Theorem [\ref=thm:left-ideals_upper-bound], but we need to ensure that s is different from the s of Cases 2(b) and 2(c).

Here there is the state r such that [formula], and rs and rs2 are not comparable under [formula]. Consider a transformation t' that fits in Case 2(b). Then in s' every state q  =  pti for [formula], and q  =  0, is mapped to a state comparable with q under [formula], and the other states are mapped as in t'. Since t'∈Tn cannot contain a state r' such that [formula] and r't and r't2 are not comparable under [formula], it follows that s' also does not contain such a state. Thus s  ≠  s'.

For a distinction from the transformations of Case 2(c) observe that s does not map to 0 any state other than 0.

15 pt [formula] (b): t has no cycles and has a fixed point [formula]. The proof is analogous to that of Case 3(b) in Theorem [\ref=thm:left-ideals_upper-bound], but we need to ensure that s is different from the s of Cases 2(b) and 2(c).

Since s maps to 0 a state other than 0, this case is distinct from Case 2(b). Because t does not have a cycle, and no state q mapped to 0 can be in a cycle in s, it follows that s does not have a cycle. Thus s is different from the transformations of Case 2(c).

15 pt [formula] (c): t has no cycles and no fixed point [formula], but has a state [formula] mapped to p. The proof is analogous to that of Case 3(c) in Theorem [\ref=thm:left-ideals_upper-bound], but we need to ensure that s is different from the s of Cases 2(b) and 2(c).

As before, since s maps to 0 a state other than 0, this case is distinct from Case 2(b). In s, 0 cannot be in a cycle, no state [formula] mapped to 0 can be in a cycle and p cannot be in a cycle as ps  =  r and rs  =  0. Since the other states are mapped as in t, s does not have a cycle. Thus s is different from the transformations of Case 2(c).

15 pt [formula] (d): t has no cycles, no fixed point [formula], and no state [formula] mapped to p, but has a state r such that [formula], mapped to n - 1. Let f(t) = s, where s is the transformation shown in Figure [\ref=fig:2sided-case3d] and defined by

[formula] [formula]

By Remark [\ref=rem:2sided_transformations], s∈Sn. However, s is not in Tn, as we have a fixed point r such that [formula] and ps  =  n - 1. So Proposition [\ref=prop:chain] yields [formula]--a contradiction. Thus s is different from the transformations of Case 1.

Transformation s does not have any cycles, as t does not have one in this case and fixed points q and p cannot be in a cycle. So s is different from the transformations of Cases 2(a) and 3(a). Also, since p is the unique state mapped to n - 1 and there is no state [formula] mapped to p, s is different from the transformations of Case 2(b). For a distinction from the transformations of Cases 2(c), 3(b) and 3(c), observe that s does not map to 0 any state other than 0.

If t'  ≠  t is another transformation satisfying the conditions of this case, we define s' like s. Now suppose that s  =  f(t)  =  f(t')  =  s'. Observe that t does not have a fixed point other than n - 1. So for every fixed point [formula] of s we have qt  =  qt'  =  n - 1. Also, since p is the unique state mapped to n - 1 in s, 0t  =  0t'  =  p and pt  =  pt'  =  p. The other states are mapped by s as by t and t'; so t  =  t'.

5pt [formula] All cases are covered: We need to ensure that any transformation t fits in at least one case. It is clear that t fits in Case 1 or 2 or 3. Any transformation from Case 2 fits in Case 2(a) or 2(b) or 2(c). For Case 3, it is sufficient to show that if (i) [formula] does not contain a fixed point [formula], and (ii) there is no state r, [formula], mapped to p or n - 1, then t has a cycle.

If there is no state r such that [formula], then qt∈{p,n - 1} for any q∈Q, since [formula]; by Remark [\ref=rem:2sided_transformations], t∈Sn--a contradiction.

So let r be some state such that [formula]. Consider the sequence [formula]. By Remark [\ref=rem:left-ideals_xy2], [formula] for all [formula]. If rtk∈{p,n - 1} for some [formula], then let i be the smallest such k. Then we have (rti - 1)t∈p, contradicting (ii). Since p and n - 1 are the only fixed points by (i), we have rti  ≠  rti - 1. Since there are finitely many states, rti  =  rtj for some i and j such that [formula], and so the states [formula] form a cycle.

If Tn has size nn - 2  +  (n - 2)2n - 2 + 1, then Tn = Sn.

The proof is very similar to that of Theorem [\ref=thm:left-ideals_unique-maximal].

Consider a maximal-length chain of states strictly ordered by [formula] in Dn. If its length is 3, then by Lemma [\ref=lem:chain3] Tn is a subsemigroup of Sn. Thus only Tn  =  Sn reaches the bound.

If there is a chain of length 4, then there are states p and r such that [formula]. Let f be the injective function from Theorem [\ref=thm:2sided-ideals_upper-bound]. Consider the transformation u that maps [formula] to p and fixes n - 1. Let s be defined from u in Case 3(c) of the proof of Theorem [\ref=thm:2sided-ideals_upper-bound]. The rest of the proof follows the proof of Theorem [\ref=thm:left-ideals_unique-maximal] with Case 3(d) of Theorem [\ref=thm:2sided-ideals_upper-bound] added.