Quadratic residues and difference sets

16pt

Background and Motivation

Sárközy [\cite=b:sa] conjectured that the set Rp of all quadratic residues modulo a prime p is not representable as a sumset {a + b:a∈A,  b∈B}, whenever [formula] satisfy min {|A|,|B|} > 1. Shkredov [\cite=b:sh] has recently established the particular case B = A of this conjecture, showing that {a' + a'':a',a''∈A}  ≠  Rp, except if p = 3 and A = {2}. He has also proved that Rp cannot be represented as a restricted sumset: {a' + a'':a',a''∈A,  a'  ≠  a''}  ≠  Rp for [formula], with several exceptions for p  ≤  13.

The argument of [\cite=b:sh] does not seem to extend to handle differences (instead of sums) and to show that

[formula]

We notice that for equality to hold in [\eqref=e:difnotres], one needs to have [formula], which readily yields

[formula]

At the same time, there is a famous, long-standing conjecture saying that for every ε > 0, if [formula] has the property that a' - a''∈Rp for all a',a''∈A with a'  ≠  a'', then

[formula]

provided that p is sufficiently large. (We refer the reader to [\cite=b:sh] for several more related conjectures and discussion.) Combining [\eqref=e:Aislarge] and [\eqref=e:Aissmall], one immediately derives that [\eqref=e:difnotres] is true for all but finitely many primes p.

Unfortunately, the conjecture just mentioned is presently out of reach, and neither could we prove [\eqref=e:difnotres]. As a step in this direction, we investigate the following, presumably easier, problem:

Even this question does not eventually receive a complete answer. However, we were able to establish a number of necessary conditions, and use them to show that in the range 13 < p < 1018, there are no "exceptional primes". This makes it extremely plausible to conjecture that no such primes exist at all, with just two exceptions p = 5 and p = 13 addressed below.

Summary of Results

In this section we introduce basic notation and present our results. Most of the proofs are postponed to subsequent sections; see the "proof locator" at the very end of the section.

Recall, that for a prime p we denote by [formula] the finite field of order p, and by Rp the set of all quadratic residues modulo p. We also denote by Np the set of all quadratic non-residues modulo p, to have the decomposition [formula].

For subsets A and S of an additively written abelian group, the notation [formula] will indicate that every element of S has a unique representation as a difference of two elements of A and, moreover, every such non-zero difference belongs to S. (In our context, the underlying group is always the additive group of the field [formula], and S is one of the sets Rp and Np.) Our goal is thus to show that, with few exceptions,

[formula]

does not hold.

One immediate observation is that for [\eqref=e:neverholds] to hold, letting n: = |A|, one needs to have [formula]; that is, p = 2n(n - 1) + 1. As a result, [formula] -- a conclusion which also follows by observing that the set of all differences a' - a'' is symmetric, whence Rp must be symmetric too.

Experimenting with small values of p, one finds two remarkable counterexamples to [\eqref=e:neverholds]: namely, the sets [formula] and [formula]. Clearly, all affinely equivalent sets of the form {μa + c:a∈Ap}, where μ∈Rp and [formula] are fixed parameters (and p∈{5,13}) work too, and it is not difficult to see that no other sets A satisfying [\eqref=e:neverholds] exist for p  ≤  13; indeed, we believe that there are no more such sets at all.

What makes the two sets A5 and A13 special? An interesting feature they have in common is that both of them are cosets of a subgroup of the multiplicative group of the corresponding field; indeed, A13 is a coset of the subgroup [formula], while A5 is a coset of the subgroup [formula]. In addition, A5 is affinely equivalent to the set {0,1}, which is a union of 0 and a subgroup of [formula]. Our first two theorems show that constructions of this sort do not work for p > 13.

For a prime p > 13, there is no coset A = gH, with [formula] and [formula], such that [formula].

For a prime p > 5, there is no coset gH, with [formula] and [formula], such that, letting [formula], we have [formula].

For integer μ and a subset A of an additively written abelian group, by μA we denote the dilate of A by the factor of μ:

[formula]

Extending slightly one of the central notions of the theory of difference sets, we say that μ is a multiplier of A if μ is co-prime with the exponent of the group, say e, and there exists a group element g such that μA = A + g. Clearly, in this case every integer from the residue class of μ modulo e is also a multiplier of A. This shows that the multipliers of a given set A can be considered as elements of the group of units [formula], and it is immediately seen that they actually form a subgroup; we denote this subgroup by MA, and call it the multiplier subgroup of A.

It is readily seen that all translates of a subset A of an abelian group have the same multiplier subgroup. If, furthermore, |A| is co-prime with the exponent e of the group, then there is a translate of A whose elements add up to 0. Denoting this translate by A0 and observing that μA0 = A0 + g implies g = 0 (as follows by comparing the sums of elements of each side), we conclude that if gcd (|A|,e) = 1, then A has a translate which is fixed by every multiplier μ∈MA.

Here we are interested in the situation where the underlying group has prime order. In this case, every subset A has a translate fixed by its multiplier subgroup MA. This translate is then a union of several cosets of MA and, possibly, the zero element of the group. Consequently, using multipliers, Theorems [\ref=t:NoGP1] and [\ref=t:NoGP2] can be restated as follows: if p > 13 and [formula] satisfies [formula], then choosing [formula] so that the elements of the translate A - g add up to 0, the set [formula] is a union of at least two cosets of MA.

Our next result shows, albeit in a rather indirect way, that "normally", a set [formula] satisfying [formula] must have a large multiplier subgroup.

For a prime [formula], let Gp denote the greatest common divisor of the orders modulo p of all primes dividing [formula]:

[formula]

If p is a prime and [formula] satisfies [formula], then the multiplier subgroup MA lies above the order-Gp subgroup of [formula]; equivalently, |MA| is divisible by Gp.

The quantity Gp is difficult to study analytically, but one can expect that it is usually quite large: for, if rv|p - 1 with r prime and v > 0 integer, then in order for rv not to divide Gp, there must be a prime [formula] which is a degree-r residue modulo p, the "probability" of which for every specific q is 1 / r. Computations show that, for instance, among all primes p  ≤  1012 of the form p = 2n(n - 1) + 1, there are less than 1.4% those satisfying [formula].

Recalling that [formula] implies p = 2n(n - 1) + 1 with n = |A|, from Theorem [\ref=t:gcdtest] and in view of Theorems [\ref=t:NoGP1] and [\ref=t:NoGP2] we get

Suppose that p is a prime. If there exists a subset [formula] with [formula] then, writing p = 2n(n - 1) + 1, either Gp is a proper divisor of n, or Gp is a proper divisor of n - 1.

To give an impression of how strong Corollary [\ref=c:gcdtest] is, we remark that it sieves out over 99.7% of all primes p = 2n(n - 1) + 1 with p < 1012.

For integer k  ≥  1, let Φk denote the k th cyclotomic polynomial. Yet another useful consequence of Theorem [\ref=t:gcdtest] is

Let p be a prime, and suppose that there exists a subset [formula] with [formula]. If an element [formula] and an integer k  ≥  2 satisfy [formula] and [formula], then Φk(z)∈Rp.

The practical implication of Corollary [\ref=c:cyclotomic] is that if we can find a residue [formula] of degree [formula] and an integer k  ≥  2 such that [formula] and Φk(z)∈Np, then there is no set [formula] with [formula].

To prove Corollary [\ref=c:cyclotomic], denote by H the order-Gp subgroup of [formula], and consider the differences h' - h'' with h',h''∈H, h'  ≠  h''. By Theorem [\ref=t:gcdtest], either all these differences are quadratic residues, or they all are quadratic non-residues. If [formula] and [formula], then both z and zk are non-unit elements of H, and consequently either both z - 1 and zk - 1 are quadratic residues, or they both are quadratic non-residues. In either case,

[formula]

and the claim follows by induction on k.

It is somewhat surprising that if a set [formula] with [formula] exists, then all orders [formula] appearing in the definition of the quantity Gp are odd.

Let p be a prime. If there exists a subset [formula] satisfying [formula], then for every prime [formula], the order [formula] is odd.

Let p be a prime. If there exists a subset [formula] satisfying [formula], then writing p = 2n(n - 1) + 1 we have [formula] or [formula]; hence, [formula].

To derive Corollary [\ref=c:paritytest] from Theorem [\ref=t:paritytest], observe that if we had [formula] or [formula], then [formula] were even and, consequently, [formula] and p - 1 would have same prime divisors. As a result, all prime divisors of p - 1 would be of odd order modulo p, which is impossible as p - 1 itself has even order.

Using a biquadratic reciprocity law due to Lemmermeyer [\cite=b:le], from Theorem [\ref=t:paritytest] we will derive

Let p be a prime. If there exists a subset [formula] satisfying [formula] then, writing p = 2n(n - 1) + 1, neither n nor n - 1 have prime divisors congruent to 7 modulo 8. Moreover, of the two numbers n and n - 1, the odd one has no prime divisors congruent to 5 modulo 8, and the even one has no prime divisors congruent to 3 modulo 8.

Computations show that there are very few primes passing both the test of Corollary [\ref=c:gcdtest] and that of Theorem [\ref=t:divtest]. In the range 13 < p < 1018, there are only five such primes, corresponding to the values of n listed in the following table:

Every individual value of n in the table is easy to rule out using Corollary [\ref=c:cyclotomic]. For instance, the first exceptional value n = 51 corresponds to the prime p = 5101; since (5101 - 1) / G5101 = 204, applying Corollary [\ref=c:cyclotomic] with k = 2 we conclude that if [formula] satisfying [formula] existed, then every degree-204 residue [formula] with z2  ≠  1 would satisfy z + 1∈R5101; this conclusion, however, is violated for z = 2204.

The remaining four exceptional cases can be dealt with in an analogous way; say, one can take z = 2(p - 1) / Gp for n = 650 and n = 377687811, and z = 3(p - 1) / Gp for n = 32283 and n = 57303490 (with k = 2 in each case). We thus conclude that there are no primes 13 < p < 1018 for which [formula] with [formula] exists.

Theorem [\ref=t:paritytest] will be derived as a straightforward corollary of the Semi-primitivity Theorem from the theory of difference sets. Recall, that for positive integer v,k, and λ, a (v,k,λ)-difference set is a k-element subset of a v-element group such that (assuming additive notation) every non-zero group element has exactly λ representations as a difference of two elements of the set. The following somewhat unexpected claim shows how difference sets come into the play, and allows us to apply the well-established machinery of difference sets in our problem.

Suppose that p is a prime and [formula] satisfies [formula]. Write n: = |A| and fix arbitrarily a quadratic non-residue ν∈Np. Then the n2 sums a' + νa'' with a',a''∈A are pairwise distinct, and the set D of all these sums is a (p,n2,n(n + 1) / 2)-difference set in [formula].

We remark that the Multiplier Conjecture [\cite=b:la] along with Claim [\ref=m:diff] lead to a conclusion much stronger than Corollary [\ref=c:gcdtest]: namely, if there is a subset [formula] with [formula], then, writing p = 2n(n - 1) + 1, the least common multiple [formula] is a divisor of either n or n - 1.

On a historical note, it was Broughton [\cite=b:b] who first used biquadratic reciprocity to study (2n(n - 1) + 1,n2,n(n + 1) / 2)-difference sets.

Our last result is a lemma which is used in the proof of Theorems [\ref=t:NoGP1] and [\ref=t:NoGP2], and which we believe is also of independent interest.

If p > 5 is a prime and [formula] satisfies [formula], then |MA| is odd; that is, - 1∉MA.

The rest of the paper is devoted to the proofs of the above-discussed results. We prove Lemma [\ref=l:MAodd] in the next section, and Theorems [\ref=t:NoGP1] and [\ref=t:NoGP2] in Section [\ref=s:NoGP]. In Section [\ref=s:diff] we prove Claim [\ref=m:diff], present the Semi-primitivity Theorem, and derive Theorem [\ref=t:paritytest]. In Section [\ref=s:divtest] we state Lemmermeyer's biquadratic reciprocity law and prove Theorem [\ref=t:divtest]. Theorem [\ref=t:gcdtest] is proved in Section [\ref=s:gcdtest]; the proof uses some basic algebraic number theory. Finally, in the Appendix we give an equivalent restatement of the problem studied in this paper in terms of algebraic number theory.

|MA| is odd: the proof of Lemma [\ref=l:MAodd]

Suppose that p is a prime and [formula] satisfies [formula]; we want to show that the multiplier subgroup [formula] has odd order.

For a subset [formula] and integer j  ≥  0, let

[formula]

subject to the agreement that if 0∈S and j = 0, then the corresponding summand is equal to 1 (so that σ0(S) = |S|). For every 1  ≤  k < (p - 1) / 2 we have

[formula]

expanding the binomial and changing the order of summation, we get

[formula]

Write m: = |MA|. Having A suitably translated, we can assume that [formula] is a union of cosets of MA, and let then C be the set of arbitrarily chosen representatives of these cosets. We distinguish two cases.

Suppose first that 0∉A. In this case σj(A) = σj(C)σj(MA) and whence [\eqref=e:tmp26] is non-trivial only if m|k, and in this case (with a minor change of notation) it can be re-written as

[formula]

Taking k = 1 gives (1 + ( - 1)m)σ0(C)σm(C) = 0, and if m were even (contrary to the assertion of the lemma) then, in view of σ0(C) = |C|  ≠  0, we would have σm(C) = 0. Furthermore, we could then re-write [\eqref=e:tmp27] as

[formula]

and substituting subsequently [formula] we conclude that σkm(C) = 0 whenever 0 < k < (p - 1) / (2m). Equivalently, the |C| elements cm (c∈C) have the property that the sum of their kth powers vanish for all 0 < k < (p - 1) / (2m); hence for all 0 < k  ≤  |C| in view of

[formula]

(we use here our standard notation: n = |A| and p = 2n(n - 1) + 1. Notice that this estimate uses the assumption p > 5.) As a result, all these elements, and therefore also all elements of C, are equal to 0, a contradiction establishing the assertion in the case 0∉A.

Turning to the situation where 0∈A, we write [formula] and notice that in this case σ0(A) = |A| = m|C| + 1 and σj(A) = σj(A0) = σj(C)σj(MA) for every j > 0; as a result,

[formula]

Hence, assuming that m is even, from [\eqref=e:tmp26] we get

[formula]

Now taking k = 1 yields σm(C) = 0, and then subsequently σkm(C) = 0 for each 0 < k < (p - 1) / (2m), leading to a contradiction exactly as above.

This completes the proof of Lemma [\ref=l:MAodd].

Proofs of Theorems [\ref=t:NoGP1] and [\ref=t:NoGP2]: One Coset is not Enough

For a prime p, let χp denote the quadratic character modulo p extended onto the whole field [formula] by χp(0) = 0. We need the following well-known identity (which is equivalent, for instance, to [\cite=b:ir]):

[formula]

Recall, that we are interested in the situation where [formula], in which case χp( - 1) = 1; equivalently, χp( - x) = χp(x) for all [formula].

Clearly, it suffices to show that for p > 13 prime and [formula], one cannot have [formula] or [formula]. For a contradiction, suppose that one of these relations holds true. Write n: = |H|, so that p = 2n(n - 1) + 1. From Lemma [\ref=l:MAodd] (as applied to a suitable coset of H in the case [formula]), we know that n is odd, implying - 1∉H; hence, H is disjoint with - H: = { - h:h∈H}.

For any h1,h2∈H with h1  ≠  h2, either both h21 - h22 and h1 - h2 are quadratic residues, or they both are quadratic non-residues. In either case, their quotient h1 + h2 is a quadratic residue; that is,

[formula]

We distinguish two cases, according to whether [formula] or [formula].

Suppose first that [formula], and let in this case

[formula]

In view of [\eqref=e:2HinQ] and our present assumption [formula], for each x∈H we have

[formula]

Along with σ( - x) = σ(x) (following from [formula] and χp( - 1) = 1 resulting from it), this yields

[formula]

On the other hand, the sum extended over all [formula] can be computed explicitly:

[formula]

as it follows from [\eqref=e:sum-chi] and since h1  ≠   - h2 whenever h1,h2∈H in view of - 1∉H. Comparing [\eqref=e:overB1] and [\eqref=e:complsum1] we conclude that [formula], which simplifies to (n - 2)2  ≤  0 and thus yields n = 2, contrary to the assumption p > 13.

Addressing now the case where [formula], we re-define the sum σ(x) letting this time

[formula]

In view of [\eqref=e:2HinQ] and the assumption [formula], we have again

[formula]

Since σ( - x) =  - σ(x), we derive that

[formula]

On the other hand, a computation similar to [\eqref=e:complsum1] gives

[formula]

As a result, 2n(2n - 3)2  ≤  2n(2n2 - 2n + 1), leading to n  ≤  4. To complete the proof we notice that n  ≤  3 correspond to p  ≤  13, while n = 4 yields p = 25, which is composite.

The proof is a variation of that of Theorem [\ref=t:NoGP1].

Aiming at a contradiction, suppose that p > 5 is prime, [formula], [formula], and [formula] satisfies [formula]. Since g is representable as a difference of two elements of A, we have g∈Rp, and dilating A by the factor g- 1 we can assume that, indeed, g = 1; that is, [formula].

Write n: = |A|, so that p = 2n(n - 1) + 1 and |H| = n - 1. From Lemma [\ref=l:MAodd], we know that |H| is odd, whence - 1∉H and therefore H is disjoint with - H.

For any h∈H and a1,a2∈A with a1  ≠  a2, both a1h - a2h and a1 - a2 are quadratic residues, and so must be their quotient h; thus,

[formula]

Similarly,

[formula]

in view of h1 + h2 = (h21 - h22) / (h1 - h2).

Let

[formula]

From [\eqref=e:HinQ2] and [\eqref=e:2HinQ2], and since [formula], we have

[formula]

and

[formula]

Observing that σ( - x) = σ(x) we derive that

[formula]

On the other hand, a computation similar to [\eqref=e:complsum1] gives

[formula]

As a result, 4n2 - 10n + 7  ≤  2n2 - 1, implying n  ≤  4. The assumption p > 5 now gives n = 3; consequently, p = 13 and |H| = 2, whence H = {1, - 1}. However, the set [formula] does not have the property [formula].

Proofs of Claim [\ref=m:diff] and Theorem [\ref=t:paritytest]

To see that the sums a' + νa'' are pairwise distinct, we notice that a1' + νa1'' = a2' + νa2'' with (a1',a1'')  ≠  (a2',a2'') would result in ν = (a1' - a2') / (a2'' - a1''), while for a1',a1'',a2',a2''∈A, both the numerator and the denominator are quadratic residues in view of [formula].

It remains to show that every non-zero element of [formula] has exactly n(n + 1) / 2 representations as a difference of two elements of the set D: = {a' + νa'':a',a''∈A}.

Let ζ be a fixed primitive root of unity of degree p, and denote by [formula] the pth cyclotomic field; that is, ζ  ≠  ζp = 1 and [formula]. Write [formula], so that [formula] yields

[formula]

where

[formula]

is a quadratic Gaussian period (see, for instance, [\cite=b:d]).

Set [formula]; thus,

[formula]

with [formula] defined by φ(ζ) = ζν. Let [formula] denote the complex conjugation automorphism. Since [formula] is abelian ([\cite=b:ir] or [\cite=b:m]), we have

[formula]

From [\eqref=e:abs^2]-[\eqref=e:alpsquared] and

[formula]

we obtain

[formula]

Comparing this equality with

[formula]

where r(x) is the number of representations of x as a difference of two elements of D, we conclude that r(x) = n(n + 1) / 2 for every [formula].

We remark that the second assertion of Claim [\ref=m:diff] can also be proved using the group ring approach. Namely, identifying subsets [formula] with the corresponding elements of the group ring [formula], we have

[formula]

the last equality reflecting the well-known fact that for [formula], every element of [formula] has exactly [formula] representations as a sum of quadratic residue and a quadratic non-residue. Hence, we have the chain of group ring equalities

[formula]

proving the assertion.

We now state the part of the Semi-primitivity Theorem that is relevant for our purposes. For co-prime integer q,e  ≥  1, by [formula] we denote the subgroup of [formula], multiplicatively generated by q.

Suppose that G is a finite abelian group of exponent e. If G possesses a (v,k,λ)-difference set, then for any prime q with q|k - λ and [formula], we have [formula].

To deduce Theorem [\ref=t:paritytest] from Theorem [\ref=t:st], we apply the latter to the set D of Claim [\ref=m:diff]. Since

[formula]

we conclude that if [formula] is prime, then [formula] is an odd-order subgroup of [formula]; that is, [formula] is odd. This proves Theorem [\ref=t:paritytest].

Bi-quadratic reciprocity and the Proof of Theorem [\ref=t:divtest]

The proof of Theorem [\ref=t:divtest] relies on Lemmermeyer's biquadratic reciprocity law. To state it, we recall that the rational biquadratic residue symbol is defined for prime [formula] and quadratic residue b∈Rp by

[formula]

Notice, that [formula] implies multiplicativity of the rational biquadratic residue symbol.

For consistency, in this section we use the Legendre symbol [formula] for the quadratic character modulo p (which was denoted χp(  ·  ) in Section [\ref=s:NoGP], mostly for typographical reasons).

Suppose that [formula] is prime, and write p = u2 + v2 with u odd and v even. Suppose also that q > 2 is a prime with [formula], and let c be an integer such that [formula]. Finally, let [formula], so that [formula] by multiplicativity of the Legendre symbol and the quadratic reciprocity law. Then

[formula]

We remark that, strictly speaking, the case where q|v + c is not addressed in [\cite=b:le], but it is easy to deduce from the case where [formula]. For, if q|v + c, then [formula] in view of [formula], and applying then the original Lemmermeyer's theorem with c replaced by - c, we get

[formula]

Suppose that p is a prime and [formula] satisfies [formula]; thus, p = 2n(n - 1) + 1 where n: = |A|. From Corollary [\ref=c:paritytest], we have [formula], whence

[formula]

Let u and v denote the odd and the even of the two numbers n - 1 and n, respectively; notice that this is consistent with the notation of Theorem [\ref=t:lemmer] as p = (n - 1)2 + n2 = u2 + v2. Since [formula], a prime q divides [formula] if and only if it is odd and divides either u, or v. In this case [formula], and we apply Theorem [\ref=t:lemmer] with c = 1 to obtain

[formula]

where [formula]. On the other hand, Theorem [\ref=t:paritytest] shows that q is a biquadratic residue modulo p, and therefore using [\eqref=e:-1Gauss] we get

[formula]

From[\eqref=e:qstar1] and [\eqref=e:qstar2],

[formula]

and

[formula]

If q|v, then the former of these equalities immediately gives q∈{1,5} mod 8. If q|u, we distinguish two further sub-cases: q|v + 1 and [formula]. If q|v + 1, then [\eqref=e:dag2] gives q∈{1,3} mod 8. If [formula], then u∈{v - 1,v + 1} along with our present assumption q|u show that u = v - 1; thus, q|v - 1, and [\eqref=e:dag1] leads to the same conclusion q∈{1,3} mod 8 as above.

We have shown that for a prime q > 2, if q divides the even of the two numbers n - 1 and n, then [formula] or [formula], and if q divides the odd of these two numbers, then [formula] or [formula]. Thus is equivalent to the assertion of Theorem [\ref=t:divtest].

Proof of Theorem [\ref=t:gcdtest]: MA lies above the order-Gp subgroup of [formula]

In this section and the Appendix we use several basic algebraic number theory facts, such as for instance:

the Galois group of the mth cyclotomic field is isomorphic to the group of units [formula]; hence, it is abelian;

if p and q are distinct odd primes, then, letting [formula], the principal ideal (q) in the pth cyclotomic field splits into a product of (p - 1) / f pairwise distinct prime ideals, all of which are fixed by the order-f subgroup of the corresponding Galois group;

Kronecker's theorem: an algebraic integer all of whose algebraic conjugates lie on the unit circle is a root of unity; consequently, any cyclotomic integer of modulus 1 is a root of unity;

if m is odd, then the only roots of unity of the mth cyclotomic field are the roots of degree 2m.

The proofs can be found in any standard algebraic number theory textbook, as [\cite=b:ir] or [\cite=b:m].

Suppose that p is a prime and [formula] satisfies [formula]. Write n: = |A|, so that p = 2n(n - 1) + 1. Let ζ be a primitive root of unity of degree p, and denote by [formula] the p th cyclotomic field (thus, [formula]), and by O the ring of integers of [formula]. As in the proof of Claim [\ref=m:diff], write [formula], so that α∈O and

[formula]

with

[formula]

It is well known that every rational prime q  ≠  p splits in O into a product of [formula] pairwise distinct prime ideals, all of which are fixed by the subgroup of [formula] of order [formula]. The intersection of these subgroups over all primes [formula] is the subgroup [formula] of order |H| = Gp, and since, by [\eqref=e:abs^2-2], α is a divisor of n + ρ, which in turn is a divisor of [formula], we conclude that the ideal generated by α is fixed by H. Hence, for every automorphism φ∈H there exists a unit u∈O (depending on φ) such that

[formula]

Since p is a quadratic residue modulo every odd prime q dividing p - 1, by quadratic reciprocity, q is a quadratic residue modulo p; that is, [formula]. This shows that [formula] is a divisor of (p - 1) / 2. As a result, Gp divides (p - 1) / 2; that is, H is contained in the subgroup of order (p - 1) / 2, which is easily seen to have [formula] as its fixed field. Therefore, re-using equality [\eqref=e:alpsquared] from the proof of Claim [\ref=m:diff] and in view of [\eqref=e:abs^2-2], for every automorphism φ∈H we have

[formula]

Comparing this with [\eqref=e:ast], we conclude that |u| = 1. From the fact that [formula] is abelian it follows then that all algebraic conjugates of u have modulus 1, and by Kronecker's theorem u is a root of unity; thus, either u = ζv, or u =  - ζv with some [formula] depending on φ. The latter option is ruled out by considering traces from [formula] to [formula]: we have [formula] and [formula], while [formula]. Therefore,

[formula]

Recalling the definition of α and identifying [formula] with [formula], we can interpret [\eqref=e:ast-refined] as saying that for every [formula], there exists [formula] such that the dilate φA = {φa:a∈A} satisfies φA = A + v; that is, φ is a multiplier of A.

Appendix: An algebraic number theory restatement

We aim here to pursue a little further the algebraic approach that was employed in the proofs of Claim [\ref=m:diff] and Theorem [\ref=t:gcdtest], in the hope that it can ultimately give more insights into the problem. We keep using the notation introduced in these proofs: namely, given a prime p, we denote by ζ a fixed primitive root of unity of degree p, by [formula] the p th cyclotomic field, by O the ring of integers of [formula], and we let [formula]. By [formula] we denote the trace function from [formula] to [formula]. Our goal is to prove the two following results.

Let p be a prime number. For a subset [formula] with [formula] to exist, it is necessary and sufficient that p = 2n(n - 1) + 1 with an integer n, and that there is an algebraic integer α∈O such that |α|2 = n + ρ and [formula] for every integer k.

Let p be a prime of the form p = 2n(n - 1) + 1 with n an integer. For an algebraic integer α∈O with |α|2 = n + ρ to exist, it is necessary and sufficient that for every prime q dividing p - 1 to an odd power, the order [formula] is odd.

To prove Proposition [\ref=p:restatement], we need

Let p be a prime and n∈[1,p  -  1] an integer. In order for α∈O to satisfy [formula] for every integer k, it is necessary and sufficient that [formula], where A is an n-element subset of [formula].

It is readily seen that the condition is sufficient: if [formula] with [formula] and |A| = n, then

[formula]

To prove necessity, write [formula] with integer coefficients ax. For every [formula] we have then

[formula]

(where k in the right-hand side is identified with its canonical image in [formula]), and the assumption [formula] implies that the coefficients ax attain at most two distinct integer values. Since adding simultaneously the same integer to all ax does not affect the value of the sum [formula], we can assume without loss of generality that actually at most one value assumed by ax is distinct from 0; hence, writing [formula], there is an integer c such that

[formula]

In fact, the subset [formula] is proper and non-empty and c  ≠  0, as otherwise we would have α = 0 which is inconsistent with [formula]. Consequently, [\eqref=e:ast26] implies that [formula] assumes exactly two distinct values, both divisible by c. Observing, on the other hand, that gcd ( - n,p - n) =  gcd (n,p) = 1, we conclude that c∈{ - 1,1}. Replacing now A with its complement in [formula], if necessary, we can assume that, indeed, c = 1 holds. Thus, [formula], and it remains to notice that this yields [formula], whence |A| = n.

We know from Lemma [\ref=l:indcond] (see also the proofs of Claim [\ref=m:diff] and Theorem [\ref=t:gcdtest]) that if [formula] for a subset [formula] then, writing n: = |A| and [formula], we have p = 2n(n - 1) + 1, |α|2 = n + ρ, and [formula] for every integer k.

Conversely, suppose that p = 2n(n - 1) + 1 and that for some α∈O we have |α|2 = n + ρ and [formula] for every integer k. By Lemma [\ref=l:indcond], there is an n-element subset [formula] such that [formula]. Hence,

[formula]

implying [formula].

Consider a prime divisor q of p - 1 and denote by v the power to which q divides (p - 1) / 4; thus, v is either equal, or smaller by 2 than the power to which q divides p - 1. Since [formula] and, consequently, p is a square mod q, if q is odd, then it splits into two ideal primes in [formula]. This conclusion stays true also if q = 2 and v > 0: for, in this case [formula] (see, for instance, [\cite=b:ir] or [\cite=b:m]). Now the decomposition

[formula]

and the fact that n + ρ and n - 1 - ρ are co-prime elements of [formula] show that the v  th power of one of the two ideal primes into which q splits divides n + ρ, while the v th power of another one divides n - 1 - ρ. Denote by [formula] the prime whose v th power divides n + ρ; we thus have [formula], where [formula] is an ideal co-prime with q.

Write [formula], so that q splits into (p - 1) / f pairwise distinct ideal primes in O and, accordingly, [formula] splits into k: = (p - 1) / (2f) pairwise distinct ideal primes: [formula], where each [formula] is stable under the subgroup [formula] of order f. Assuming |α|2 = n + ρ and observing that |α|2  =  ατ(α), where τ is the complex conjugation automorphism of [formula], we thus have

[formula]

Suppose now that f is even, so that τ∈H and, consequently, [formula] for each i∈[1,k]. Comparing this with [\eqref=e:qI] we conclude that the factor [formula] in its right-hand side must split evenly between the two factors (α) and τ((α)); therefore, v must be even. This proves necessity.

To prove sufficiency we invoke the Hasse norm theorem [\cite=b:j] which says that if K is a cyclic extension of a number field L, then an element of L is the norm (from K to L) of an element of K if and only if it is a norm locally everywhere. The reader will see that, in fact, the theorem also gives necessity; however, we prefer to keep the simple "elementary" argument presented above.

Specified to our situation, Hasse's theorem gives the following. Let [formula] be the real subfield of [formula]. For a prime ideal [formula], denote by [formula] the completion of [formula] at [formula], and by [formula] the corresponding completion of [formula]; thus, [formula]. Then, according to the Hasse theorem, n + ρ is a norm from [formula] to [formula] if and only if it is a norm from [formula] to [formula] for every prime [formula] of [formula], including the infinite primes.

Accordingly, let [formula] be a prime. We first show that n + ρ is always a norm from [formula] to [formula] whenever [formula]. For notational convenience, we write below [formula].

If [formula] is an infinite prime, then it is a real prime and [formula] is the field [formula] of real numbers, as [formula] is totally real. Furthermore, every real square, hence every positive real number, and in particular n + ρ, is a norm from the quadratic extension [formula].

If [formula] is a finite prime dividing p, then it is unique with this property, and p is totally and tamely ramified in [formula]. Thus the extension [formula] is a tamely ramified quadratic extension. Since n + ρ is not divisible by [formula], it is a unit in [formula], so by [\cite=b:se] is a norm from [formula] if and only if it is a square modulo [formula]. As the residue field of [formula] modulo [formula] is [formula], this is equivalent to n + ρ being a square modulo the uniformizer [formula] of [formula], where [formula] is the field of p-adic rationals, i.e. the completion of [formula] at p. Now [formula], with the congruence in (a localization of) the ring of integers of [formula]. At the same time, p = 2n(n - 1) + 1 implies [formula]. It follows that [formula], hence [formula], and so [formula].

Finally, if [formula] is a finite prime not dividing p (and also not dividing [formula]), then the extension [formula] is unramified, in which case every unit of [formula] is a norm from [formula] [\cite=b:se]. But n + ρ is a unit of [formula], as follows from the observation that [formula] is not divisible by [formula].

We have thus shown that n + ρ is always a norm from [formula] to [formula] whenever [formula], and it remains to determine when n + ρ is a norm for the primes [formula]. Fix such a prime [formula], and let [formula] be the prime in [formula] lying below [formula], and q be the rational prime lying below [formula] and [formula]. Also, let [formula] be the conjugate of [formula] over [formula]; since q splits into two primes in [formula] (see the very beginning of the proof for the explanation), we have the prime factorization [formula].

Let [formula], and vq be the valuations on [formula], and [formula], corresponding to [formula], and q, respectively. Since q is unramified in [formula] (the only ramified prime in [formula] is p), we may assume that all these valuations are normalized; that is, their value groups are [formula].

Trivially, n + ρ is a norm from [formula] to [formula] if [formula]. This happens if and only if [formula] splits completely in [formula]; that is, if and only if the complex conjugation automorphism τ does not lie in the decomposition group of a prime [formula] lying above [formula]. Since the Galois group [formula] is cyclic, τ is its unique involution. Hence for [formula] to hold it is necessary and sufficient that the decomposition group of [formula] has odd order; equivalently, the inertia degree of q in [formula] is odd; that is, the order [formula] is odd. Thus, if [formula] is odd, then n + ρ is a norm from [formula] to [formula].

To complete the proof, we show that for [formula] even, n + ρ is a norm from [formula] to [formula] if and only if [formula] is also even. So assume now that [formula] is even. Since [formula] is an unramified quadratic extension, by [\cite=b:se], the group of norms from [formula] to [formula] inside [formula] is [formula], where [formula] is a uniformizer of [formula] (i.e. [formula]) and [formula] is the unit group of [formula]. Thus, n + ρ is a norm from [formula] to [formula] if and only if [formula] is even. Let [formula] be the conjugate of ρ over [formula]. Observe that

[formula]

implies

[formula]

and also that

[formula]

If [formula] is odd, then either [formula] is odd, or [formula] is odd; hence, either n + ρ is not a norm from [formula] to [formula], or it is not a norm from [formula] to [formula] for some prime [formula] of [formula] lying above [formula]. It follows that if [formula] is odd, then n + ρ is not a norm from [formula] to [formula]. On the other hand, if [formula] is even, then by [\eqref=e:Hasse1] and [\eqref=e:Hasse2], [formula] is also even and, similarly, [formula] is even. Therefore if [formula] is even, then n + ρ is a norm from [formula] to [formula] for all [formula] lying above q.

This completes the proof.