Lemma Corollary Proposition Definition Conjecture Observation Problem

Finite Element Formulation of the Bloch Equations with Dipolar Field Effects

Introduction

In many modern nuclear magnetic resonance (NMR) and imaging (MRI) experiments, the Bloch equations with dipolar field are required to describe the observation of subtle phenomena  [\cite=bib:bouchardenc2003] [\cite=bib:bouchardjmr] [\cite=bib:bouchardbone] [\cite=bib:bouchardxenon] [\cite=bib:bouchardmrm] [\cite=bib:warrenscience93] [\cite=bib:warrenjcp96] [\cite=bib:warrenscience98] [\cite=bib:warrenscience96] [\cite=bib:bowtelljmr92] [\cite=bib:deville] [\cite=bib:warrenjcp93] [\cite=bib:bowtellimaging] [\cite=bib:bowtellprl96]. For example, in EDM experiments, dynamic instabilities in highly polarized liquid xenon have been modeled in this manner [\cite=bib:bouchardxenon]. Structural imaging at sub-voxel resolutions in MRI is possible using the long-range magnetic dipole field [\cite=bib:bouchardjmr] [\cite=bib:bowtellimaging] [\cite=bib:bowtellprl96] [\cite=bib:warrenscience98] [\cite=bib:warrenscience96]. In all those cases, considerable insight in understanding the spin dynamics has been obtained from numerical simulations [\cite=bib:bouchardxenon] [\cite=bib:tilman] [\cite=bib:bouchardjmr].

The calculations generally involve the integration of the Bloch equations with a dipolar field. These are a set of nonlinear first-order partial differential equations that contain non-local integral operators in the calculation of the derivative. The dipolar field integral introduces an O(N6) operation when calculated at each point in space, making the calculations very computationally intensive. For this purpose, Enss and Warren introduced a dramatic speed-up by calculation of the dipolar field in k-space [\cite=bib:tilman]. Any such simplification, tends to introduce global truncation errors into the numerical integration, because the dipolar field must be calculated at every time step using solutions that contain errors accumulated from each of the previous steps. The cumulation of global truncation may explain the inability to obtain numerical solutions at long evolution times.

We introduce a finite element (FEM) formulation which may alleviate these problems, because the dipolar field need not be recalculated at each time step. This Galerkin formulation of the Bloch equations with dipolar field was first presented in reference [\cite=bib:bouchardphdthesis].

Bloch equations with dipolar field

The secular part of the dipolar field is [\cite=bib:deville] [\cite=bib:bouchardjmr]:

Although we use the secular approximation, which is valid in high magnetic fields, the calculation herein may also be done for the low field case using the complete dipolar field including all non-secular terms [\cite=bib:bouchardphdthesis] [\cite=bib:deville]:

[formula]

The exact form of the dipolar field is unimportant here. Chemical shift offsets or radiation damping effects may also be readily added.

In addition to DDF, diffusion and relaxation, flow effects can also be accounted for (in this section we write [formula] and [formula] for the dipolar field):

[formula]

This is the set of partial differential equations that is normally integrated by quadratures to provide numerical solutions [\cite=bib:tilman] [\cite=bib:bouchardxenon].

The diffusion term [formula] requires the existence of the second derivative. This is a rather strong requirement which is not usually needed. In the theory of heat conduction, weak solutions to the heat diffusion equation [formula] often model physical situations well. In the next section, we investigate the existence of weak solutions.

Weak solutions

Let [formula] be the diffusion region and ∂Ω be its boundary. The Bloch equations with dipolar field [formula] and magnetic field offset [formula] (to allow for magnetic field inhomogeneities) are:

[formula]

are defined for [formula] and supplemented by appropriate boundary conditions on ∂Ω, for example [formula] on ∂Ω in the case of reflective boundaries. As usual, [formula] is the dipolar field. In component form (component i) this reads:

[formula]

Let V be the vector space of test functions on Ω, i.e. all functions that are continuous, satisfy the boundary conditions on ∂Ω and whose first derivative is piecewise continuous on Ω (see Quarteroni [\cite=bib:quarteroni] for details). Take a test function [formula], multiply Eq. ([\ref=eq:bloch_componform]) by vi and integrate over Ω:

[formula]

We proceed to eliminate the second derivative in the diffusion term. This is done by using the vector identity [formula] with f = vi and [formula]. The diffusion term becomes:

[formula]

where in the second line we made use of the divergence theorem. The surface integral vanishes by virtue of the boundary conditions [formula] on ∂Ω. Thus, the diffusion term reduces to

[formula]

We have derived the following useful result:

The weak form of the Bloch equations--with distant dipolar field, arbitrary distributions of resonance frequency offsets, and diffusion within reflective boundaries--is given by (no summation on i):

[formula]

where vi is any test function. Any function Mi which satisfies this equation is called a weak solution.

We note that the degree of differentiability of Mi has been reduced by half. For the purpose of solving this problem numerically, the Galerkin method can be introduced.

Let Vh be a finite dimensional subspace of V of dimension Nh. The Galerkin finite element method consists of finding three functions [formula] (i = 1,2,3) such that:

[formula]

(There is no summation on the index i.) The Galerkin formulation is the matrix form of this problem.

Remarks.

The Galerkin method is only an approximation because the solution is expanded in terms of a finite-dimensional basis of functions.

The uhi are the best approximations to Mi (in the L2 sense) that the finite-dimensional vector space Vh allows, i.e. uhi is the orthogonal projection of Mi on the subspace Vh.

Next, we pick a set of basis functions [formula] for the vector space Vh and expand the solution in terms of this basis:

[formula]

where the functions win(t) are the unknown coefficients we must solve for. Taking vi  =  φm yields:

[formula]

In this basis, the dipolar field Bk approximates to:

[formula]

where ak  =   - 1 if k = 1,2 or ak = 2 when k = 3. Letting [formula] be the matrix whose elements are [formula], and assuming it is non-singular, we denote the inverse of [formula] by [formula]. Substitution of Bk and multiplication of the expression by the matrix [formula] allows us to solve for the time derivatives:

Then, with the following abbreviations,

[formula]

the expression takes a particularly simple form,

[formula]

This is a set of coupled ODEs, involving linear and bilinear forms in the unknowns wij, with constant coefficients Rknm, Cpm, Anm, Hm, Gnm and Tknmq. These constants can be calculated a priori using the choice of basis functions [formula]. One may then solve for the time-dependent coefficients wip (there are 3  ×  Nh of them) using conventional ODE methods (see, for example, Quarteroni [\cite=bib:quarteroni]).

Conclusion

We have shown how to derive the Galerkin formulation of the Bloch equation. The main advantage to this approach is in calculating time-evolution of magnetic moments in the presence of a strong dipolar field, in which case, we believe that error propagation from repeated dipolar field calculations should be mitigated [\cite=bib:bouchardphdthesis] [\cite=bib:tilman] [\cite=bib:bouchardxenon]. In contrast with the direct integration of the Bloch equations using the Fourier method [\cite=bib:tilman] [\cite=bib:bouchardxenon], there is no need to calculate a dipolar field at every point in time; hence, there is no propagation of global truncation errors associated with the Fourier approximation of the dipolar field. This set of equations, while still non-linear, does not involve a non-local integral operator in the calculation of the derivative at each time step.