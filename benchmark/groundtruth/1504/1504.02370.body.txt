Maximum Throughput Problem in Dissipative Flow Networks with Application to Natural Gas Systems

Primal Energy Function and Uniqueness of the Network Flow Solution

Let Fij(x) be the anti-derivative of fij(x), i.e, [formula]. The following useful remark follows immediately from the fact that fij(x) is monotonically increasing.

The function Fij(x) is convex.

The set of NF equations ([\ref=flow_conservation]) and ([\ref=potential_flow_relation]) can be rewritten in the variational form as the optimal solution of the following convex optimization problem [\cite=77Nau] [\cite=12BNV]:

[formula]

The optimization problem in ([\ref=primal_objective])-([\ref=primal_constraint]) is clearly convex, since by Remark [\ref=convexity] the cost function is convex, and the constraints are linear. To see why the solution to ([\ref=primal_objective])-([\ref=primal_constraint]) yields the NF equations, we can first form the Lagrangian as

[formula]

where πi are the dual variables corresponding to the constraints ([\ref=primal_constraint]). To minimize the Lagrangian, we take its derivative w.r.t. φ to zero to get

[formula]

which means that the dual variables serve the role of the node potentials. Since the optimization problem in ([\ref=primal_objective])-([\ref=primal_constraint]) is strictly convex, we also conclude that the NF Eqs. ([\ref=flow_conservation]) and ([\ref=potential_flow_relation]) have a unique solution.

Dual Energy Function Representation

We now present another variational formulation of the NF equations via the dual of the optimization problem in ([\ref=primal_objective])-([\ref=primal_constraint]). Since fij(x) is monotonically increasing, it is invertible. Let [formula] denote the inverse of fij(x). Let Gij(y)  =  F(f- 1ij(y))  -  yf- 1ij(y) be the anti-derivative of gij(y). The dual of ([\ref=primal_objective])-([\ref=primal_constraint]) can be expressed in terms of the node potential variables πi as:

[formula]

The above problem, when stated as a minimization, is a convex optimization problem. Since the Slater's condition [\cite=BoydCO] always holds for an underdetermined system of linear equality constraints, we have strong duality and the optimal value of ([\ref=primal_objective])-([\ref=primal_constraint]) and ([\ref=dual_objective]) are the same.

Properties of the energy functions

Define the following convex function given by

[formula]

and let

[formula]

The function E*(x,b) is the convex conjugate of E(π,b) with respect to π. Analogously, define

[formula]

and

[formula]

The following remark follows directly from the definitions above.

The function E*(q,b) is equal to the optimal value of the primal-dual pair in ([\ref=primal_objective])-([\ref=primal_constraint]) and ([\ref=dual_objective]). Additionally F*(b,q)  =    -  E*(q,b).

The following statements follow from standard results of the convex conjugate and the duality theory [\cite=Rockafellar70].

Let φ* be the unique optimum of Eqs. ([\ref=primal_objective])-([\ref=primal_constraint]) and let π* be the unique optimum of the Eq. ([\ref=dual_objective]). Then,

[formula]

The Hessian of E*(x,b) can be computed with respect to x as follows

[formula]

where

[formula]

The inequality

[formula]

has exactly one solution given by [formula].

The statement in Eq. ([\ref=pistar]) follows directly from the theory of convex conjugates. The proof of ([\ref=phistar]) is similar, but we include it here for completeness. Recall that E*(x,b)  =   - F*(b,x). So, it is enough to prove that [formula]. By definition of φ*, we have

[formula]

So,

[formula]

Using Eq. ([\ref=lagrangian_optimum]), one derives

[formula]

Since [formula], we have that [formula]. The proof is complete by substituting this result in Eq. ([\ref=proof_final_line]).

Follows from standard properties of convex conjugates and direct computations.

By definition - E*(x,b) is the minimum of E(π,b) w.r.t. π. Since E(π,b) is strictly convex, only its unique minima π* can satisfy ([\ref=efunc_inequality]).

For the statement in Lemma [\ref=duality_results] (b) to be well-defined, we need that the matrix [formula] is invertible. Note that since the pressure at node 0 is fixed at π0  =  c, indices in Eq. ([\ref=hessian_off_diag]) and Eq. ([\ref=hessian_diag]) run from 1 to n - 1. From the expressions for the elements of the hessian, we derive that [formula] is a (n - 1)  ×  (n - 1) sub-matrix of a weighted graph Laplacian matrix with edge weights given by wij  =  g'(πi  -  πj  +  bij). Since the graph G is assumed to be connected, it follows that [formula] has full rank and hence is invertible [\cite=Merris94], [\cite=Chaiken78].

Let us now take a slight detour from the main goal (reformulation of the maximum throughput problem) and state a certain "monotonicity property" that holds for dissipative FN. For a more general statement and proof of the monotonicity property without assuming the differentiability of the dissipation function fij(φij) as well as its implication on robust optimization on dissipative flow networks, we refer to [\cite=Vuffray15].

(Monotonicity Property) Consider a dissipative flow network where the parameters bij and the potential π0 are fixed. Let [formula] and [formula] be two sets of injections. The injection at node 0 is automatically determined by the total flow balance Eq. ([\ref=total_flow_balance]). Assume that for all 1  ≤  i  ≤  n - 1 one has qi  ≤  ri. Let [formula] and [formula] be the corresponding potentials resulting from the two injection profiles. Then one arrives at π(1)i  ≤  π(2)i for all 1  ≤  i  ≤  n - 1.

Equivalent formulation of the maximum throughput problem

Equipped with Lemma [\ref=duality_results], one restates the maximum throughput problem ([\ref=max_throughput_objective])-([\ref=max_throughput_box]) as

[formula]

This formulation is exactly equivalent to the original maximum throughput formulation. Let us present two other alternative formulations, which (as we see below) may have some practical advantages.

Energy function formulation 1:

[formula]

Energy function formulation 2:

[formula]

In ([\ref=reform_objective_practical1]) ε  >  0 is a small constant. In ([\ref=reform_objective_practical2]) M is a large positive constant that helps to enforce the constraint ([\ref=efunc_constraint]).

Eq. ([\ref=reform_objective_practical1]) and Eq. ([\ref=reform_objective_practical2]) are useful because, first, the two expressions are twice differentiable and hence allow application of second order gradient descent methods for local optimization. Second, when b is not an optimization variable, the expressions are biconvex in π and x which means that we can use here standard heuristics, such as alternating minimization over π and x. Moreover, solvers using second order methods can be provided with first and second derivative information by using Eqs. ([\ref=pistar])-([\ref=phistar]) and Eqs. ([\ref=hessian_off_diag])-([\ref=hessian_diag]). The biconvexity is lost when b is also subject to optimization, but the twice differentiability remains.

Energy function representation for maximum throughput in natural gas networks

In this Section, we adopt the reformulation of the maximum throughput problem from Section to the case of the natural gas networks. The expressions for functions E and F in Eqs. ([\ref=E],[\ref=F]) for gas networks are given by

[formula]

The inverse gij(y)  =  f- 1ij(y) is given by

[formula]

and the hessian matrix [formula] is given by

[formula]

The energy function formulation of the maximum throughput problem for the gas networks can be obtained substituting the expressions above to Eqs. ([\ref=reform_objective]-[\ref=reform_box]).

Mixed Integer Quadratic Programming (MIQP) relaxation of the maximum throughput in the natural gas networks

The gas network dissipation function ([\ref=pressure_flow_relation]) follows a power law with α  =  2. So the Mixed Integer Convex relaxation of Section [\ref=MICP] is now a Mixed Integer Quadratic Program (MIQP). We write the full program below for completeness.

MIQP for Maximum Throughput in natural gas networks

[formula]

As remarked before, the only relaxation in the above program is the conversion of equality into inequality in Eqs. ([\ref=MIQC1],[\ref=MIQC2]). This corresponds to allowing "decompression", i.e., the pressure drop is now allowed to be larger than that implied by the flow. A similar relaxation was used in the Geometric Programming approach in [\cite=Misra13] to preserve convexity, and was observed to perform well in numerical experiments.

Conclusions and Path Forward

We developed a strictly convex variational representation of dissipative network flow equations that proves the uniqueness of the solution and provides an efficient algorithm to find it numerically. For the maximum throughput problem, we presented a twice differentiable optimization formulation using energy functions as a method to obtain a solution, and a mixed integer convex relaxation to test the optimality (or degree of sub-optimality) of the solution. We test both methods on a model of natural gas networks and observe that they were successful in producing solutions close to global optimality.

For future work, it would be useful to extend these techniques to dynamic optimization problems on dissipative flow networks (such as transient gas networks). The optimization formulations could also be used as subroutines in multi-level programs associated with network planning and expansion. Coupled with the monotonicity property, it also provides scope for extension to network optimization problems accounting for uncertainty such as the robust maximum throughput problem [\cite=Vuffray15] and the problem of finding the most probable fluctuations that cause violation of bounds known as the instanton problem (see e.g. a similar setting discussed in the context of power systems [\cite=11CPS]).

Acknowledgements

The authors thank S. Backhaus for multiple discussions and advice, and A. Zlotnik for providing examplary model of the gas network he designed. The work at LANL was carried out under the auspices of the National Nuclear Security Administration of the U.S. Department of Energy at Los Alamos National Laboratory under Contract No. DE-AC52-06NA25396 and it was partially supported by DTRA Basic Research Project #  10027 - 13399. The authors also acknowledge partial support of the Advanced Grid Modeling Program in the US Department of Energy Office of Electricity.

{Proof of Monotonicity Property (Corollary [\ref=monotonicity_property]): By Lemma [\ref=duality_results](a), [formula], which means [formula]. By Lemma [\ref=duality_results](b), we have the [formula]. From ([\ref=hessian_off_diag]) and ([\ref=hessian_diag]) we observe that the Hessian [formula] is a diagonally dominant invertible matrix with positive diagonal entries and non-positive off-diagonal entries. From a standard result in linear algebra we have that all entrees in [formula] are non-negative.