A Hierarchical NeuroBayes-based Algorithm for Full Reconstruction of B Mesons at B Factories

Full B Meson Reconstruction at B Factories

The Experimental Setup

One of the biggest advantages of lepton colliders like the KEKB or PEP-II accelerator compared to hadron accelerators like the Tevatron or the LHC is the precise knowledge of the initial state and the process of B meson production. The colliding particles are electrons and positrons. This feature allows for collisions with well-known energy in the initial state. As the KEKB accelerator[\cite=KEKB] and the Belle detector[\cite=Belle_detector] were designed to study B meson decays, the center of mass energy of the collisions was chosen as [formula] GeV, which corresponds to the [formula] resonance. The decay properties of this resonance are very important for the full reconstruction:

The [formula] resonance decays into a B+B- or B0 pair respectively in over 96% of all cases[\cite=PDG] without any additional particles.

For the B+B- or B0 pairs produced in this two-body decay, the four-momenta are related by

[formula]

The two B mesons are almost at rest in the center of mass frame of the [formula]

[formula]

compared to the lighter Mesons and therefore produce a spherical event topology.

There are, however, events where no [formula], but pairs of light quarks (uū, d, ss̄, or c) are produced. These events form a continuum background to B meson pair production and ideally are rejected by the analysis.

The full reconstruction described in this paper was developed for the Belle detector[\cite=Belle_detector] a large solid angle magnetic Spectrometer located at the KEKB collider[\cite=KEKB]. It consists of a silicon vertex detector (SVD), a 50-layer central drift chamber (CDC), an array of aerogel threshold Cerenkov counters (ACC), a time-of-flight scintillation counter (TOF) and an electromagnetic calorimeter composed of Cs(Tl) crystals (ECL). All these detectors are surrounded by a superconducting solenoid, providing a 1.5 T magnetic field and an iron flux-return which is instrumented to detect K0L mesons and to identify muons (KLM).

The Full Reconstruction

The main goal and also the main difficulty of the full reconstruction is to take any event and try to reconstruct one of the B mesons in one of many different decay channels. Should this attempt succeed, it is possible to assign all the tracks and electromagnetic clusters used in the reconstruction to this one B meson. As it is completely reconstructed, its 4-momentum is known. We call the fully reconstructed B meson, the Btag. After reconstruction of the tag side, it is possible to assign all the remaining tracks and electromagnetic clusters within the detector to the other B meson, which we call the Bsig (see figure [\ref=fig:fullrecon]). This Bsig meson actually is the object of interest for physics analyses, as explained below.

We can be sure that there are no additional particles produced by the e+e- collision within the detector, as the [formula] resonance decays into two B mesons only. In this two-body decay, we can obtain the momentum of the Bsig without any additional analysis once the Btag is known. This follows by applying 4-momentum conservation as given by equation [\ref=equ:conservation].

This procedure might seem rather involved at first glance, but has the benefit that it yields information, otherwise inaccessible, about a hard or impossible to reconstruct B decay on the signal side. A prominent example for the application of the full reconstruction is a B meson decay including neutrinos where the decay kinematics can otherwise not be fully constrained or a decay with very large non-B background. Many of these decays are very sensitive to small contributions from new physics and thus it is important to adopt powerful reconstruction algorithms for them. Examples for the application of the full reconstruction include:

[formula]

One possible topology of the first decay is given in figure [\ref=fig:fullrecon], where the τ lepton decays into an electron and two neutrinos.

The most important practical difference between the full reconstruction method and most analyses is just the sheer number of decay channels for the tag side. As there are several hundreds of known B decay channels, the task of reconstructing one of the two B mesons in the event cannot always succeed. Additionally, most of those decay channels include other unstable particles, mostly D* and D mesons, which also decay in a vast spectrum of decay channels that also have to be reconstructed.

The quantity that has to be maximized by the full reconstruction method is the total B reconstruction efficiency

[formula]

where N is the number of reconstructed B decay channels, εi is the reconstruction efficiency of the decay channel i and Bi is the branching fraction of the decay channel i. The typical scale for Bi is 10- 3 to 10- 5 and typically εi is of the order of 10%. As the Bi is fixed by nature, we can maximize εtot only by increasing εi and the number of reconstructed decay channels N. In order to increase εi, multivariate techniques are used (see chapter [\ref=chap:multivariate_techniques]). The main challenge is to keep track of all the used variables in these multivariate methods, particularly because we want to reconstruct as many decay channels as possible. For this we had to develop a software framework which gives us the possibility to automatically manage hundreds of decay channels with extensive usage of multivariate methods. The automatic handling of many steps allows to minimize human errors.

Multivariate Techniques

A common technique to achieve more sophisticated selections is to combine all significant variables available into a single scalar variable, for example a likelihood ratio, and to perform a cut on this new variable. These multivariate techniques are in principle capable of taking correlations of the variables into account. The application of these techniques can, however, be rather involved. Simplified models can deliver quite good results when correlations between the different variables are small.

Another example of a multivariate technique is the NeuroBayes package [\cite=neurobayes] that was used extensively for the new full reconstruction tool. The idea of the NeuroBayes package is to pass all of the relevant variables, through a preprocessing algorithm, to a neural network. For a classification task, to decide if a candidate is signal or background, the network maps the input variables to a single output variable while taking into account the correlations of the input variables. An example of the separation power of this output variable for one of the classification task used can be seen in figure [\ref=fig:nbout].

NeuroBayes Output as a Probability

As shown in figure [\ref=fig:purity_nbout], the purity, defined as the number of signal events divided by the total number of events in a network output bin, is a linear function of the NeuroBayes output. This indicates that the produced output is a good measure of probability for the candidate to be signal.

If a NeuroBayes training is performed with the same signal to background ratio as found on data, the output of the classification can directly be interpreted as a Bayesian probability for signal. While it would be better to train the neural network with the same signal to background ratio as expected on data, it is sometimes not possible. If, for example, the desired signal is very rare in nature, a training would not learn to distinguish the few signal events from the millions of background events, but rather try to learn something from statistical fluctuations of the background that swamp the signal and therefore also dominate the loss function that is minimized during the network training. Therefore, a training with a higher signal fraction is the only way, in which the selection of such rare signals can be optimized. On the other hand, if we artificially increase the signal to background ratio, the network output cannot be interpreted as a Bayesian probability any more on the real dataset, because the a priori probabilities of being signal or background differ from the training dataset. Nevertheless, one can correct the network output in a way that is interpretable as a probability again. For this, we need to know the signal to background ratio in the training dataset and in the dataset where the network should give the prediction. To calculate this correction, we need Bayes' theorem, which is defined for two types of events, X and Y, as

[formula]

For our purposes, it is preferable to use Bayes' theorem in terms of the likelihood ratio

[formula]

which leads to prior odds of

[formula]

and posterior odds given by

[formula]

In our example X and [formula] are signal events (S) and background events (B) and Y is the output (ot) from a network trained with the training dataset (denoted with the subscript t). The likelihood ratio is

[formula]

where P(ot|S) is the likelihood to get a network output, ot, given a signal event S and P(ot|B) is the same for a background event. Given a network output ot the conditional probability of being a signal event S, is

[formula]

and the corresponding probability of being a background event B is given by

[formula]

By applying Bayes theorem as follows

[formula]

we can write the likelihood ratio as

[formula]

This likelihood ratio does not depend on the signal to background ratio because it only contains measured information of one given event. We can now calculate, for any other signal to background ratio in the prediction dataset (denoted with the subscript p), the posterior odds with Bayes theorem:

[formula]

Because the transformed probability op has to satisfy

[formula]

to be the correct probability, we get:

[formula]

This formula is used in the full reconstruction algorithm described in the next section to calculate the signal probability for modes with low purity so that the signal fraction had to be increased for the network training.

Selection and Reconstruction

In order to reconstruct as many B meson decays as possible, it is not possible to take care of the thousands of exclusive decay channels individually. Instead a hierarchical approach was chosen. We divide the reconstruction into 4 stages, as shown in table [\ref=tab:stages] and illustrated in figure [\ref=fig:the_4_stages].

One aim of the full reconstruction is to achieve high efficiency. This could in theory be done by always reconstructing every possible candidate at all stages in an event and then finally taking the best B meson candidate. In practice however, the computing power needed to pursue this maximum efficiency strategy is not available and it is necessary to perform cuts during the selection and reconstruction process. A main principle of this ansatz is to calculate the signal probabilities at each stage of the hierarchical system, while cuts on these probabilities occur only at a later stage.

Data Samples

For the training we used a Monte-Carlo generated data sample with a full detector simulation based on GEANT[\cite=GEANT]. It includes e+e- annihilation to non-b quarks (u, d, s, c) generated with PYTHIA[\cite=PYTHIA] and to the Υ(4S) resonance generated with the EvtGen package [\cite=Lange:2001]. The produced mesons then decay inclusively to any possible final state governed by the b  →  c transition.

The First Stage

In the first stage, NeuroBayes networks are trained on Monte-Carlo samples for charged, long-lived particle type hypotheses (kaon, pion, electron, muon) for the measured charged tracks and for the photon hypothesis for each cluster in the electromagnetic calorimeter not matched geometrically to a charged track. Neutral pion candidates are formed out of two electromagnetic clusters whose invariant mass lies within the window 115 MeV/ c2 < M(π0) < 153 MeV/ c2. Additionally, the energy of the photons that are used to construct the π0 candidate has to lie above 30 MeV. Candidate KS particles are formed from two charged tracks whose invariant mass lies within 30 MeV of the nominal K0S mass. Only very loose preselection criteria on the impact parameter of all tracks and the particle identification variable [\cite=Belle_detector] for K+ candidates are applied. As an example in the decay D0  →  K-π+, a signal efficiency of 96% and a background reduction factor of 3.5 could be observed. After these pre-cuts, NeuroBayes networks are trained for all particle hypotheses. As an input for the trainings of the charged particles, measurements of the time-of-flight, the energy loss in the CDC and Cherenkov light in the ACC are used. For the photon hypothesis, several variables to describe the shower shape in the calorimeter are used.

The Second Stage

In the second stage, combinations of two to five candidates from the first stage were used to reconstruct D±, D0, D±s and J / ψ mesons. A list of the decay channels used for the reconstruction of these mesons and their respective branching fractions can be found in table [\ref=table:channels_s2].

As these trainings were performed on inclusive simulated samples, a large fraction of the true D mesons did not come from B meson decays. Since only the D mesons from B decays are of interest, a momentum cut in the Υ(4S) rest frame was performed:

[formula]

This cut excludes the majority of D mesons not stemming from B decays, i.e. from c-fragmentation.

Selection Criteria

In order to retain reasonable computing time, soft pre-cuts are applied at this stage. We define the quantity

[formula]

where N is the number of daughters in a given decay and [formula] is the neural network output of i-th daughter, which we use to suppress obvious background.

The cuts for all decay modes of a particle type were determined simultaneously to optimally use the CPU resources. To explain the determination of the cuts, let us focus on D0 mesons: The cuts were determined for all D0 modes simultaneously. It was required that the additional amount of background that would have to be taken into the sample to gain one additional signal event was the same for all D0 modes. This means that very clean channels will get a very soft cut and at the same time, more complicated channels will get slightly harder cuts so that the consumed computing power is minimized. To determine these cuts, for each D0 mode the number of signal events in the sample was plotted against the number of background events for the different possible cuts on the product of the NeuroBayes outputs of the children. If we now look at the slopes of the tangents of these different plots, the same tangent slope indicates the same additional number of background events for one additional signal. The cut is set at that value where this condition is met. Figure [\ref=fig:prodchildnb_cut_D0] shows a possible choice for the slope.

The steeper this slope is, the higher the efficiency is, but also the higher computational effort is needed in these modes. The final choice of the exact value of each slope is obviously an arbitrary matter. Our decision for the slopes of D±, D0, D±s and also those of D* modes in stage 3 were made from the point of view of combining these particles to a B meson and then getting on average much less than one candidate per event. All of the remaining candidates for D±, D0, D±s and J / ψ mesons were again classified using NeuroBayes. The networks comprise a large number of variables. The variables with the largest separation power are the product of the NeuroBayes outputs of the children, the invariant mass of children pairs and the angle between them, the angle between the momentum of the D meson and the line connecting the D decay vertex to the interaction point and the significance of the distance of the D meson decay vertex to the interaction point.

Special attention was paid to not include any mass-dependent variable in these trainings, so that, if necessary, a check of our D and J / ψ-meson sample could be performed by looking at the unbiased mass distributions. Examples of few intermediate results for a few stage 2 channels are shown in figures [\ref=fig:dp_intermediate] and [\ref=fig:d0_intermediate].

In the hierarchical system, it is very important that all the outputs of the NeuroBayes trainings actually represent their signal probabilities, so that the cuts performed, and later on the ranking of candidates from different decay channels, are meaningful and correct. Had we used the original signal to background ratio during the trainings, this would have been automatically correct. Because of a too high background level, this was not possible for some channel trainings, so that we artificially increased the signal component to reach at least 10%. This resulted in the need to recalculate the NeuroBayes output after the classification to account for the artificially enhanced signal component during training as explained in section [\ref=sec:nb_probability].

The Third and Fourth Stage

The same procedure of preselection, training and recalculating was then repeated for D*    ±(s) and D* 0 mesons in stage 3 (for the channels and their branching ratios, see table [\ref=table:channels_s3]) and finally for B± and B0 mesons in stage 4. Variables with good discrimination power were again the product of the NeuroBayes outputs of the children, the mass of the D meson, the mass difference of the D and [formula] meson and for B meson decays the energy-difference ΔE, the angle between the B meson and the thrust axis and angles between pairs of children. A list of all used B meson decay modes and the corresponding branching ratios can be seen in table [\ref=table:channels_s4]. The results of the B± and B0 meson trainings were used to rank the candidates in each event according to their NeuroBayes outputs. The best candidate selection is now simply a matter of choosing only the first rank.

Suppression of non B Background

Non B events differ from B events in the event shape. As there is hardly any kinetic energy in B events left, the decay particles are much more spherically distributed in contrast to the jet-like structure of non-B events. There are numerous variables to quantify the different event shapes. The reduced second Fox-Wolfram Moment R2 [\cite=PhysRevLett.41.1581] gives non-candidate-specific information about the event shape, the thrust angle and cos ΘB provide information for each individual candidate. The Super Fox-Wolfram Moments (SFWM) [\cite=PhysRevLett.91.261801] contain additional information about the tag- and signal-side.

In the default mode of the full reconstruction, no event shape variables are used, as this might introduce some bias for certain analyses. There is, however, an additional algorithm that can be used after the full reconstruction. This algorithm recalculates the NeuroBayes output of all of the B candidates and determines the best candidate again, based on the new output. The algorithm incorporates two continuum suppression networks. The first network uses the reduced second Fox-Wolfram Moment, the thrust angle and cos ΘB. It therefore only depends on Btag. The second network additionally contains the Super Fox-Wolfram Moments, depending also on Bsig. As these networks take more information into account, there is a significant improvement in the quality of the NeuroBayes output and also in the best candidate selection. The results can be found in figures [\ref=fig:pur_eff_bp] and [\ref=fig:pur_eff_b0].

Performance of the new Algorithm

Efficiency Estimation

There is an existing full reconstruction algorithm at Belle (see e.g. [\cite=PhysRevD.77.091503] [\cite=PhysRevLett.99.221802] [\cite=PhysRevLett.97.251802] [\cite=PhysRevD.72.051109] [\cite=PhysRevLett.95.241801]), using a classical, cut-based reconstruction method without taking probabilistic information into account. We compare the performance of the new and the classical algorithm by estimating the numbers of correctly reconstructed Btag candidates using the final Belle data sample collected at the Υ(4S) resonance.

The sample contains 771.6  ×  106 B pairs. The kinematic consistency of a Btag candidate with a B meson decay is checked using the beam-energy constrained mass [formula], where Ebeam is the measured beam energy and pB is the reconstructed four-momentum of the B meson in the center-of-mass rest frame. None of the variables used in the network trainings are correlated with Mbc, which can therefore be used to estimate the number of correctly reconstructed Btag candidates from fits to the Mbc distribution.

Since this paper focuses on the description of the new full reconstruction method and its improvements, we do not evaluate systematic uncertainties on the fitted signal yields as would be required for physics analyses. Typically any full reconstruction tool is used in conjunction with a signal side analysis. For most signal side analyses, only the largest possible efficiency of the tag side sample is important, as the background is reduced dramatically by the signal side selection. When we want to compare two full reconstruction methods by themselves, without any signal side selection, we have to perform a fit to the inclusive tag side Mbc distribution. Especially for the new full reconstruction, this distribution contains large amounts of background, which are irrelevant for most analyses, but make the fit results less reliable. Therefore it is only possible to give a quite raw estimate for the signal gain and therefore for the improvement compared to the classical full reconstruction for maximum efficiency. This is usually not a problem for physics analyses because of the applied selection criteria.

The number of correctly reconstructed B mesons are estimated from the fit to be 2.1 million B± and 1.4 million B0 for the maximum efficiency case. This corresponds to an efficiency of roughly 0.18% for B0 and 0.28% for B±. This efficiency is defined as the number of correct reconstructed B mesons divided by the number of produced B pairs, which is the same as the number of produced B0 and B± mesons respectively. Note that in other publications a different definition might be used, which takes the number of produced charged or neutral B meson pairs as normalization, resulting in twice the value for the single B meson reconstruction efficiency.

In order to get more reliable fit results, we can introduce cuts on the NeuroBayes outputs of the B± and B0 meson networks, and thereby choose efficiency and purity freely. Figures [\ref=fig:pur_eff_bp] and [\ref=fig:pur_eff_b0] show the resulting purity-efficiency plots for the three modes explained in chapter [\ref=chap:continuum_suppression]. Purity is defined as the ratio of the signal component of the fit to the entire fit result integrated over the region Mbc  >  5.27GeV/ c2.

If no cut is performed, the standard selection that gives maximum efficiency is used. One can also choose a cut, corresponding to the same purity as in the classical full reconstruction tool, which results in an increase of efficiency by approximately a factor of 2 , as shown in figure [\ref=fig:bp_same_purity]. A cut, corresponding to the same background level is shown in figure [\ref=fig:bp_same_background]. One is also free to choose the same efficiency as in the classical full reconstruction. This results in an increase in the purity from about 25% to nearly 90% as shown in figures [\ref=fig:bp_same_efficiency] and [\ref=fig:b0_same_efficiency]. Any working point between and even beyond these three examples can be chosen in a very simple manner (cutting on the output of of the stage 4 networks) by the user.

Without new Channels

If we exclude the newly added D and B decay channels from the full reconstruction and choose a network output cut to achieve the same background level as in the classical full reconstruction, the efficiency is increased by approximately 50% for B0 mesons and 60% for B+ mesons. A comparison of the individual B decay channels revealed that the largest improvement was achieved in modes with two or more light mesons, where the new full reconstruction does not impose any phase-space limits. The newly added channels make a valuable contribution of approximately 20% of the entire signal sample for both B0 and B+ mesons.

Applied Example: Missing Mass Reconstruction

In order to test the results of the full reconstruction and also to compare the performance to its predecessor, a quick benchmark analysis was performed. This was the search for the decay

[formula]

on the signal side. A kinematic variable used to distinguish correctly reconstructed signal candidates from background candidates is the missing mass, defined as

[formula]

where pΥ(4S) denotes the four-momentum of the Υ(4s) resonance, pBtag is the four-momentum of the Btag and [formula] is the sum of the four-momenta of the reconstructed particles on the signal side. Because the neutrino is the only missing particle in this decay, we expect the missing mass to be zero for signal events. The result can be seen in figure [\ref=fig:b0_dstlnu_mm2_new] for the new full reconstruction algorithm and as an comparison in figure [\ref=fig:b0_dstlnu_mm2_old] the result for the classical full reconstruction algorithm. A clear peak is observed at the expected position with similar resolutions for new and classical full reconstruction. Thus despite the addition of less clean decay modes, the momentum resolution of the fully reconstructed B meson is preserved. As expected we also observe in this applied example a significant increase of efficiency.

Conclusion

We have developed an improved full reconstruction algorithm for the Belle experiment by introducing a hierarchical selection procedure. Instead of cutting away candidates in the early stages, we postpone the decision to later stages by very soft selections on the product of their Bayesian signal probability and giving this probability as an input for the higher stages networks. Together with a higher separation power of the neural networks compared to a cut based selection, this enabled us to reconstruct more decay channels with an acceptable computation time. Depending on the analysis, we expect an overall improvement of the effective luminosity of roughly a factor of 2 for a large number of analyses relying on the full reconstruction.

Acknowledgments

We thank Toru Iijima, Karim Trabelsi and Gary Barker for their careful reading of this article.