New algorithms for modular inversion and representation by binary quadratic forms arising from structure in the Euclidean algorithm

The algorithms

Intuitively, the iterative nature of the Euclidean algorithm makes the sequences of quotients and remainders "sensitive to initial conditions". A small perturbation to the inputs can induce a chain reaction of increasingly large perturbations in the sequence of quotients and remainders, leading to considerable alterations to both the lengths of the sequences and their entries. Later entries are especially prone to change because of cumulative effects.

Our first result, Theorem [\ref=T:twoEAs], provides a surprising example of regularity under perturbation. When v is a solution of the congruence [formula], we show that the Euclidean algorithm with u and v - 1 always takes one step fewer than the Euclidean algorithm with u and v. The sequences of quotients in both cases are almost identical, differing only in their middle one or two entries. (They are also symmetric outside of those middle entries.) We also obtain explicit formulas for the remainders of the Euclidean algorithm with u and v - 1 in terms of the remainders produced by u and v.

From these formulas we obtain a new algorithm for representing prime numbers by the indefinite quadratic form x2  +  3xy  +  y2. When such a representation exists, the algorithm produces one with x  >  y  >  0. Lemma [\ref=L:representation] at the end of this section shows this representation is unique.

This algorithm is similar to earlier algorithms that use the Euclidean algorithm to produce representations by binary quadratic forms [\cite=jB1972] [\cite=gC1908] [\cite=HMW1990] [\cite=HMW1990b] [\cite=kM2002] [\cite=pW1980]. Matthew's [\cite=kM2002] is the only of these to produce representations by forms with positive discriminant, namely, the forms x2  -  wy2 with w  =  2, 3, 5, 6, or 7. The algorithm we present is a new contribution to this body of work.

We study a second family of inputs to the Euclidean algorithm, pairs u  >  v for which [formula]. This condition implies that there must exist a, b, and c with u  =  ab2 and v  =  abc  ±  1. Theorem [\ref=T:theorem1] and Theorem [\ref=T:theorem4] give an explicit description of the quotients and remainders of the Euclidean algorithm with u and v in terms of the quotients and remainders of the Euclidean algorithm with b and c.

The relationship between the quotients of the Euclidean algorithm with b and c and with ab2 and abc  ±  1 is essentially the "folding lemma" for continued fractions, first explicated independently in [\cite=mF1973] and [\cite=jS1979]. This lemma has inspired a significant body of work concerning the quotients of continued fractions. These works give attention only to continued fractions - the remainders in the Euclidean algorithm are never explicitly considered. The description of the entire Euclidean algorithm with ab2 and abc  ±  1 in Theorems [\ref=T:theorem1] and [\ref=T:theorem4] is new. They are unified by Theorem [\ref=T:degenerate], which arithmetically characterizes the quotient pattern that will appear in the Euclidean algorithm with u and v when [formula].

Analysis of the remainders leads to another new algorithm, this time for modular inversion.

A similar algorithm was obtained by Seysen [\cite=mS2005]. In his algorithm, an integer f is arbitrarily chosen with f  >  2n, and the Euclidean algorithm is run with fn and fm + 1. The algorithm is stopped at the first remainder r less than f + n, and the modular inverse of m modulo n is then r - f (which can be negative). If f were allowed to equal n, then this would be similar indeed to the algorithm above. However, Seysen's algorithm does not work generally in this case. For instance, with n = 12 and m = 5, Seysen's algorithm with f = 12 would say to run the Euclidean algorithm with 144 and 61, stopping at the first remainder less than 24. This remainder is 22, and Seysen's algorithm would output 10, which is not an inverse for 5 modulo 12. Our algorithm above instead produces the inverse 5.

The inputs to Algorithm [\ref=A:inverse] are less than half the size of the inputs to Seysen's. But Seysen's algorithm has the flexibility arising from choosing the factor f. It would be interesting to see if both algorithms can fit in a common framework.

Our results are a new contribution to the literature on algorithmic number theory, but we believe the modular inversion algorithm also has pedagogical value. Students are less prone to mistakes working by hand with the new algorithm rather than the extended Euclidean algorithm or Blankinship's matrix algorithm [\cite=wB1963]. The new algorithm might seem non-intuitive, but our proof is elementary and is an amalgam of topics encountered by a student learning formal reasoning: the Euclidean algorithm, congruences, and mathematical induction.

We conclude this section with the result guaranteeing the uniqueness of the representation produced by Algorithm [\ref=A:BQFalgorithm].

If p is a prime number congruent to 1 or 4 modulo 5, then there is a unique pair of positive integers b  >  c satisfying

We work in the field [formula]. The algebraic integers in this field are Denote by τ the nontrivial automorphism of [formula] and by N the norm map Nγ  =  γγτ. The unit [formula] generates the group of units of norm 1 in [formula]. The map gives a bijection between all pairs of integers (b,c) with b2  +  3bc  +  c2  =  p and all elements of O of norm p. The condition b  >  c  >  0 for a pair with b2  +  3bc  +  c2  =  p is equivalent to the corresponding element [formula] of O satisfying x  >  5y  >  0.

By quadratic reciprocity, p splits in [formula]. The ring O is a principal ideal domain, so we may pick a generator γ of one of the prime ideals dividing p. Multiplying γ by [formula] if necessary, we may assume γ has norm p.

There is therefore at least one algebraic integer with norm p of the form [formula]. Among all such elements, let α be one for which x is positive and is as small as possible (i.e., α has minimal positive trace). Replacing α by ατ if necessary, we may assume also that y is positive. The lemma will be proved by showing that α is the unique element [formula] in O with norm p and x  >  5y  >  0.

Define an, bn as the integers for which

[formula]

Then

If we suppose a0  -  3b0  <  0, then [formula]. If 5b0  -  3a0 were negative, then [formula] would have norm p and smaller positive trace than α, a contradiction. Thus, again by our choice of α, we have [formula], hence a0  ≤  b0. But then which contradicts the assumption that α has norm p.

It must be then that a0  -  3b0  >  0, and thus, 3a0  -  5b0  >  0. Again using our assumption on α, we have [formula]. It follows that a0  ≥  5b0  >  0 (and, in fact, a0  >  5b0 since p  ≠  5).

It remains to show that α is the unique algebraic integer [formula] with norm p satisfying x  >  5y  >  0. Suppose x and y are integers and set [formula]. It is readily checked that if x  >  0 and y  >  0, then w  >  0 and z  >  0 and w  <  5z. It follows that all for all n  ≥  0, we have an  >  0 and bn  >  0, but an  >  5bn only when n = 0. Recall that [formula]. From the above two paragraphs, we have a- 1  >  0 and b- 1  <  0. If we set [formula] and if x  >  0 and y  <  0, then w'  >  0 and y'  <  0. Thus, an  >  0 and bn  <  0 for all n  ≤   - 1.

The numbers in O of norm p are exactly [formula] for n in [formula]. It follows that the only possible element [formula] with norm p and x  >  5y  >  0 other than α is [formula]. But 3a0  -  5b0  >  5(a0  -  3b0) implies that a0  <  5b0, which we know is not true. The uniqueness is proved.

Euclidean algorithm background

For positive integers u  >  v, the sequence of equations of the Euclidean algorithm when commenced by dividing v into u has the form

[formula]

with rs - 1  =   gcd (u,v) and rs  =  0. We define Because rs - 1  <  rs - 2, it follows that qs  ≥  2.

Our study of the Euclidean algorithm is streamlined by allowing it to unfold in two different ways. These parallel the two continued fraction expansions of a rational number. The expansion of u / v with final quotient ≥  2 is the sequence of quotients of the Euclidean algorithm with u and v. We will modify the Euclidean algorithm to make it produce the other expansion. If the Euclidean algorithm with u and v is written as [\eqref=E:EucAlg], we replace the final equation by the two equations

[formula]

This modification changes the parities of the sequences of quotients and remainders.

If u and v are positive integers and δ = 0 or 1, we denote by [formula] the sequence of equations of the Euclidean algorithm when commenced with u and v. When δ  =  0, we use whichever of the standard or modified Euclidean algorithms takes an even number of steps, and when δ  =  1, whichever takes an odd number. When considering only the standard algorithm, we write simply [formula]. We denote the ith equation by [formula] or [formula] and call the associated sequences (qi) and (ri) the sequence of quotients and sequence of remainders.

Reasoning about the Euclidean algorithm is facilitated by continuants. Properties of continuants can be found in Section 6.7 of the book by Graham, Knuth, and Patashnik [\cite=GKP1989].

Associated with a sequence [formula] of integers, we define a doubly indexed sequence of continuants

[formula]

for 1  ≤  i  ≤  j + 2  ≤  s + 2. When a more explicit description of the [formula]'s is required, we will use the alternate notation (for i  ≤  j):

The properties of continuants that we will need are the recursion [\eqref=E:continuantdef] and the surprising which can be proved by induction. An illuminating combinatorical proof is in [\cite=BQ2000]. From the symmetry of continuants and recurrence [\eqref=E:continuantdef] we obtain the alternate recurrence

[formula]

Let u and v be relatively prime integers. If (qi)si = 1 and (ri)si =  - 1 are the sequences of quotients and remainders of [formula] and [formula] are the continuants corresponding to the sequence of quotients, then for i =  - 1, , s. In particular, [formula] and [formula].

Because u and v are relatively prime, we have [formula] and [formula]. The formula [formula] follows from the observation that the recurrence [\eqref=E:continuantdef] with j = s is the same recurrence satisfied by the remainders.

The continuants [formula] have a prominant role in studying the Euclidean algorithm. They are the numerators of the convergents of the simple continued fraction expansion of u / v, and they are the absolute values of coefficients commonly computed as part of the extended Euclidean algorithm. We therefore make the following definition.

Let q1, q2, , qs be the sequence of quotients of [formula] with associated continuants [formula]. We define the Bezout coefficients of u and v by for - 1  ≤  i  ≤  s.

The following lemmas reveal a close connection between the sequence of remainders of [formula] and the corresponding Bezout coefficients. Each makes a fine exercise in mathematical induction.

If (qi)si = 1 and (ri)si =  - 1 are the sequences of quotients and remainders of [formula] and (βi)si =  - 1 are the Bezout coefficients, then

The cases i =  - 1 and i = 0 simply say that [formula] and [formula]. Further, if the congruence holds for i - 1 and i with 0  ≤  i  ≤  s - 1, then

[formula]

The lemma follows by induction.

If (qi)si = 1 and (ri)si =  - 1 are the sequences of quotients and remainders of [formula] and [formula] are the Bezout coefficients, then u = βiri - 1  +  βi - 1ri for 0  ≤  i  ≤  s.

For i = 0, the equation is just u = u. Assume that u = βiri - 1  +  βi - 1ri for some i with 0  ≤  i  ≤  s - 1. Then using [\eqref=E:altrecurrence], The lemma follows by induction.

We now discuss background for studying structure in the Euclidean algorithm quotients. Fix a positive integer k. In recent work [\cite=bS2015], the third author proved that if v with 0  <  v  <  u satisfies the congruence then the sequence of quotients of [formula] (with δ = 0 if the plus sign is used in the above congruence and δ =  - 1 otherwise) fits one of a finite list of "end-symmetric" patterns. The list of patterns depends only on k. We will use this result only when k = 1, 2, or 3.

The sequence of quotients of [formula] when [formula] has the form for some positive integers q1, , qs.

When [formula], then [formula] has quotient sequence of the form for some positive integers q1, , qs.

When [formula], that is, when

[formula]

then [formula] has quotient sequence fitting one of the patterns

[formula]

for some positive integers q1, , qs and x.

The patterns [\eqref=E:evenpatterns] are well known, being related to paper-folding sequences and folded continued fractions [\cite=jS1979] [\cite=aV2001]. What seems to be new is their appearance the quotients of the Euclidean algorithm with u and v when v satisfies [\eqref=E:squarecongruence]. Theorem [\ref=T:degenerate] gives an arithmetical criteria for deciding which of the patterns [\eqref=E:evenpatterns] describes the simple continued fraction expansion of u / v.

Explicating the Euclidean algorithm

Suppose u and v are positive integers with u  >  v and [formula]. Then v - 1 satisfies the congruence [formula]. According to Lemma [\ref=L:patterns], [formula] has sequence of quotients of the form q1, , qs  +  δ1, 1, qs  +  δ0, , q1, while [formula] has sequence of quotients of the form 1, , s  +  δ1  ·  3, s  +  δ0  ·  3, , 1. In both cases, δ1  =  1 if s is odd and 0 if s is even, while δ0  =  1 if s is even and 0 if s is odd. There is no a priori reason for the sequence of qi's to equal the sequence of i's. Nevertheless, that is the conclusion of the following theorem, which also gives explicit formulas for the remainders of [formula] in terms of the remainders of [formula].

Let u and v be positive integers u  >  v, with [formula]. Write the sequence of quotients of [formula] as Let (ri)2s + 1i =  - 1 be the sequence of remainders, and for i =  - 1, , s - 1, set ti  =  ri  +  ( - 1)i + 1r2s - i. Then EA(u,v - 1,0) is the sequence of 2s equations

A quick check verifies that t- 1  =  u and t0  =  v - 1, which begin the remainder sequence of [formula]. Because the sequence (ri)2s + 1i = 1 is decreasing, it is clear that the purported quotients and remainders are all positive. We check that the purported remainders form a strictly decreasing sequence (except that the final two may be equal when [formula] is computed using the modification [\eqref=E:EAmodified] of the Euclidean algorithm.) This is apparent for rs + 1, , r2s + 1. Also, ts - 1  ≥  rs - 1  -  rs + 1  =  rs  >  rs + 1. (The equality is because the middle quotient of [formula] is 1.)

We must show ti  >  ti + 1 for 1  ≤  i  ≤  s - 2. From the division algorithm, we have ri  ≥  ri + 1  +  ri + 2 for - 1  ≤  i  ≤  2s - 1. Thus, for - 1  ≤  i  ≤  s - 3, we have

[formula]

It follows that ti  >  ti + 1 for 1  ≤  i  ≤  s - 3. The above chain of inequalities also holds with the final inequality replaced by an equality when i = s - 2. The second inequality is strict when i = s - 2 unless qs  +  δ0  =  1, which only happens if s is odd. But in that case, ts - 2  =  rs - 2  +  rs + 2  >  rs - 1  -  rs + 1  =  ts - 1 holds anyway.

To ensure the equations in the theorem are the steps of [formula], it remains to check the algebraic validity of each step. The theorem will then follow from the uniqueness of the quotients and remainders.

The equation ti - 2  =  qi  ·  ti - 1  +  ti is equivalent to The expression on the left is 0. Also, examining the pattern of the sequence of quotients of [formula], we see that q2s + 2 - i  =  qi for i = 1, , s - 1. Thus, the 2s - i + 1th step of [formula] is

[formula]

and the right side is also 0. Substituting 2s + 1 - i for i in [\eqref=E:algebracheck], we find as well that ri - 1  =  q2s + 1 - iri  +  ri + 1 for s + 2  ≤  i  ≤  2s, which verifies steps i = s + 2 through i = 2s in the theorem.

We now check the middle pair of equations. We know that the sth through s + 2nd equations of [formula] are Assume first that s is odd so that δ1  =  1 and δ0  =  0. The equation [formula] is equivalent to Substituting in turn rs + 2  =  rs  -  qsrs + 1 and rs + 1  =  rs - 1  -  rs from [\eqref=E:middle], this is equivalent to

[formula]

which is the first of equations [\eqref=E:middle].

If, instead, s is even, so δ1  =  0 and δ0  =  1, then ts - 2  =  (qs  +  δ1  ·  3)ts - 1  +  rs + 1 is equivalent to Substituting in turn rs + 2  =  rs  -  qsrs + 1  -  rs + 1 and rs + 1  =  rs - 1  -  rs, this is equivalent to

[formula]

which is the first of equations [\eqref=E:middle].

The verification that ts - 1  =  (qs  +  δ0  ·  3)  ·  rs + 1  +  rs + 2 is entirely similar, using the latter two equations of [\eqref=E:middle].

Let the quotients and remainders of [formula] be written as in Theorem [\ref=T:twoEAs]. Suppose first that s is odd. Applying Lemma [\ref=L:linearcombination] with i = s to [formula], we have [formula]. By the symmetry of continuants and recurrence [\eqref=E:altrecurrence], it follows that

[formula]

Now use the "end-symmetric" form of the quotient sequence of [formula] and Lemma [\ref=L:endofEA] to obtain Substituting out rs - 1 using the middle of equations [\eqref=E:middle] gives

Suppose now that s is even. Applying Lemma [\ref=L:linearcombination] with i = s to [formula] in this case gives [formula]. Again using the recurrence [\eqref=E:altrecurrence], it follows that and Lemma [\ref=L:endofEA] shows Substituting with [\eqref=E:middle] once more gives Thus, in either case, rs + 1  =  c in the unique representation p  =  b2  +  3bc  +  c2 with b > c  >  0. If s is odd, then rs  =  b, and if s is even, then rs  =  b + c. The inequalities 5b2  >  b2  +  3bc  +  c2  >  5c2 show that Thus, regardless of whether s is odd or even, c is the first remainder smaller than [formula].

Fix anew positive integers b and c with gcd (b,c) = 1. We next give an explicit description of the quotients and remainders of [formula] in terms of the quotients, remainders, and Bezout coefficients of [formula]. The algorithm for computing inverses in modular arithmetic falls out of this description.

Let b  >  c  >  1 be integers with gcd (b,c) = 1. Let (qi)si = 1 and (ri)si =  - 1 be the sequences of quotients and remainders of the standard (i.e., unmodified) Euclidean algorithm with b and c, let (βi)si =  - 1 be the corresponding continuants, and set ti = rib  ±  ( - 1)iβi for - 1  ≤  i  ≤  s - 1. Then [formula] is the sequence of 2s equations

[formula]

The proof can be conducted in an analogous manner to the proof of Theorem [\ref=T:twoEAs]. One readily checks that the first two remainders are t- 1  =  b2 and t0  =  bc  ±  1. The observation qs  ≥  2 was made in the first paragraph of Section [\ref=S:background], so the purported quotients are all positive. So are the remainders since b  ≥  βi for - 1  ≤  i  ≤  s - 1.

For s + 2  ≤  i  ≤  2s, the equation β2s + 1 - i  =  q2s + 1 - i    ·  β2s - i  +  β2s - 1 - i follows from [\eqref=E:altrecurrence]. For 1  ≤  i  ≤  s - 1, the equality ti - 2  =  qiti - 1  +  ti can be deduced from the equation [formula] and [\eqref=E:altrecurrence]. To verify the middle two equations, we first note that because b and c are relatively prime, we have rs - 1  =  1, ts - 1  =  b  ±  ( - 1)s - 1βs - 1, and qs  =  rs - 2. The equations can then be verified using Lemma [\ref=L:linearcombination] with u = b, v = c, and i = s - 1:

[formula]

and

[formula]

Finally, the remainders form a decreasing sequence. For - 1  <  i  <  s - 1, the inequality [formula] follows from Lemma [\ref=L:linearcombination] and implies that ti  >  ti + 1. The inequality βs - 1  <  ts - 1 follows from the equation [formula] verified in the last paragraph. And βi - 1  <  βi for 0  ≤  i  ≤  s follows from the recurrence [\eqref=E:altrecurrence].

When m = 1, the algorithm is easily validated. If m  >  n, then the third step of [formula] will be division of rn  +  1 into n2, where r is the remainder when m is divided by n. Thus, it suffices to assume n  >  m  >  1, so also s  >  1.

Theorem [\ref=T:theorem1] implies the first remainder less than n in [formula] is βs - 1 when s is odd and ts - 1 when s is even. We apply Lemma [\ref=L:congruence] to [formula] to find [formula]. Thus when s is odd, the product of m and the first remainder less than n is When s is even, the product is

We now give a complete description of [formula] for positive integers a  ≥  2, b, and c and gcd (b,c)  =  1.

Let a, b, c, and k be integers with b  >  c  >  1, gcd (b,c) = 1, and a  ≥  2. Let (qi)si = 1 and (ri)si =  - 1 be the sequences of quotients and remainders in [formula], let (βi)si =  - 1 be the corresponding Bezout coefficients, and set ti = abri  +  ( - 1)i + kβi for - 1  ≤  i  ≤  s - 1. If ( - 1)s + k =  - 1, then EA(ab2,abc  +  ( - 1)k,0) is the sequence of 2s + 2 equations

[formula]

When ( - 1)s + k = 1, steps s through s + 3 change to:

[formula]

It follows as in the proof of Theorem [\ref=T:theorem1] that the purported quotients and remainders are positive (excluding the final remainder). The equations β2s + 3 - i  =  q2s + 3 - i    ·  β2s + 2 - i  +  β2s + 1 - i and ti - 2  =  qiti - 1  +  ti can be deduced as in the proof of Theorem [\ref=T:theorem1]. The equations [formula] and b = 1  ·  (b  -  βs - 1)  +  βs - 1 are clearly true. Lemma [\ref=L:endofEA] shows that βs  =  b. Thus, the equations b  =  qs  ·  βs - 1  +  βs - 2 and b  -  βs - 1  =  (qs  -  1)βs - 1  +  βs - 2 are consequences of [\eqref=E:altrecurrence].

Since gcd (b,c)  =  1, we have rs - 1  =  1, ts - 1  =  ab  -  ( - 1)s + kβs - 1, and qs  =  rs - 2. From this, we obtain the equations ts - 1  -  b  =  (a - 1)b  +  βs - 1 when ( - 1)s + k =  - 1 and ts - 1  =  (a - 1)b  +  (b  -  βs - 1) when ( - 1)s + k = 1.

When ( - 1)s + k  =   - 1, the sth equation is valid since

[formula]

Similarly, when ( - 1)s + k = 1,

[formula]

When ( - 1)s + k  =   - 1, the inequality ts - 1  -  b  <  ts - 1 is clear and the inequality b  <  ts - 1  -  b follows from the assumption that a  ≥  2. When ( - 1)s + k  =  1, the inequality b  <  ts - 1 follows from the assumption that a  ≥  2 and from b  =  βs  >  βs - 1. The inequality b - βs - 1  <  b is clear, and the inequality βs - 1  <  b  -  βs - 1 follows from b  =  qsβs - 1  +  βs - 2 and qs  ≥  2. That ti  <  ti - 1 and βi  >  βi - 1 for 1  ≤  i  ≤  s - 1 follows as in the proof of Theorem [\ref=T:theorem1].

To conclude, we provide an arithmetical characterization of which quotient pattern will appear when performing the Euclidean algorithm with u and v with [formula].

Let u be a positive integer and write u = ab2, where a is the square free part of u. Assume v with 0  <  v  <  u satisfies [formula]. Then there is an integer c such that The continued fraction expansion of u / v with even length has quotient sequence fitting the first of the patterns [\eqref=E:evenpatterns] if and only if gcd (b,c)  =  a  =  1. Otherwise, it fits one of the other patterns with x  =   gcd (b,c)2  ·  a  -  1. The second pattern appears if s + δ is even, and the third if s + δ is odd. In all cases, q0, , qs is the quotient sequence of the continued fraction expansion of b / c

By assumption, there exists some integer w such that (v  +  ( - 1)δ)2  =  uw. Consideration of prime factorizations shows that a is also the square free part of w, say w  =  ac2. Then v  =  abc  +  ( - 1)δ + 1.

If gcd (b,c) = d and we set ã  =  ad2, [formula], and [formula], then Theorem [\ref=T:degenerate] now follows from Theorem [\ref=T:theorem1] and Theorem [\ref=T:theorem4].