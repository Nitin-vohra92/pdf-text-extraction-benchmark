=1

The Gemini NICI Planet-Finding Campaign: The Companion Detection Pipeline.

Based on observations obtained at the Gemini Observatory, which is operated by the Association of Universities for Research in Astronomy, Inc., under a cooperative agreement with the NSF on behalf of the Gemini partnership: the National Science Foundation (United States), the Science and Technology Facilities Council (United Kingdom), the National Research Council (Canada), CONICYT (Chile), the Australian Research Council (Australia), Ministério da Ciência e Tecnologia (Brazil) and Ministerio de Ciencia, Tecnologa e Innovación Productiva (Argentina).

INTRODUCTION

The study of exoplanets has advanced admirably in the last two decades, through the application of radial velocity, transit and microlensing techniques [\citep=2008PhST..130a4001M] [\citep=2010Sci...327..977B] [\citep=2010ApJ...720.1073G]. Over exoplanet detections have placed significant constraints on the mass and separation distribution of exoplanets for separations [formula]3 AU from stars [\citep=2008PASP..120..531C] [\citep=2010Sci...330..653H].

In comparison, direct imaging techniques can detect Jupiter-mass planets at separations beyond ~  10 AU from the host star. Moreover, detecting photons from exoplanets allows us to study their atmospheres spectroscopically . Several extrasolar planets have been directly imaged, including (1) HR 8799 bcde, a system with 4 massive (4-10 MJup) planets [\citep=2008Sci...322.1348M] [\citep=2010Natur.468.1080M]; (2) β Pictoris b, a 8+ 5- 2 MJup planet first detected at only 3 AU separation from its primary star [\citep=2009A&A...493L..21L] [\citep=2010Sci...329...57L]; (3) Fomalhaut b, a planet with a possible circum-planetary disk detected at 115 AU from the host star [\citep=2008Sci...322.1345K] [\citep=2013ApJ...775...56K]; (4)  1RXS J1609-  2105 b, an 8MJup planet around a 5 Myr old star in the Upper Scorpius Association [\citep=2008ApJ...689L.153L] [\citep=2010ApJ...719..497L]; (5) HD 95086 b, a 4-5MJup planet around 10-17 Myr old A8 star [\citep=2013ApJ...772L..15R] [\citep=2013ApJ...775L..40M]; (6) GJ 504 b, a 4-9MJup planet around a 100-500 Myr old Sun-like star [\citep=2013ApJ...774...11K] [\citep=2013arXiv1310.4183J].

In recent years, several challenges have been overcome in the field of direct imaging. To achieve high sensitivity to point sources at sub-arcsecond separations, the intensity of the stellar halo can now be significantly reduced using adaptive optics (AO) and a coronagraph. In addition, an impressive variety of instrumental and post-processing techniques have been developed to reduce the effect of these speckles. For example, angular differential imaging [\citep=2004Sci...305.1442L] [\citep=2005JRASC..99..130M] decouples the sky rotation of the planet from the speckles. Spectral differencing imaging [\citep=1999PASP..111..587R] and spectral deconvolution [\citep=2002ApJ...578..543S] [\citep=2007MNRAS.378.1229T] help distinguish between the star and planet, taking advantage of the different ways their fluxes change wavelength. Finally, the study of speckle statistics over time can help to distinguish planets from speckles over multiple exposures [\citep=2009ApJ...698...28G].

Several direct imaging AO surveys of young ([formula]100 Myr old) stars have been completed decade. These have placed increasingly stronger constraints on the population of substellar companions and giant planets around nearby stars. Null results from these large surveys demonstrate that giant planets are rare at large [\citep=2010ApJ...717..878N]. The SDI survey [\citep=2007ApJS..173..143B] [\citep=2008ApJ...674..466N] targeted 45 nearby young stars, looking for the 1.6μm methane signature expected in cool (Teff  <   1400 K) substellar atmospheres [\citep=1997ApJ...491..856B] [\citep=2003A&A...402..701B]. The GDPS survey targeted 85 stars, using 6% methane filters in the H-band with ADI [\citep=2007ApJ...670.1367L]. [\citet=2010ApJ...716.1551L] also completed a 58-star survey with the 3.6-m Advanced Electro-Optical System telescope in Maui.

From December 2008 to April 2012, the Campaign at the Gemini-South 8.1-m Telescope targeted a carefully chosen sample of over 200 young nearby stars. The Campaign instrument, NICI (Near-Infrared Coronagraphic Imager), was specifically designed for imaging exoplanets [\citep=2003IAUS..211..521F] [\citep=2008spie.7015E..49C]. It is equipped with an 85-element curvature adaptive optics system, a Lyot coronagraph, and a dual-camera system capable of simultaneous spectral difference imaging around the 1.6 μm methane feature. NICI can also be used in fixed Cassegrain rotator mode for ADI.

As part of our Campaign observations, we have already discovered cool brown dwarf (~  30-60 MJup) companions to 4 nearby young stars. PZ Tel B is one of very few young (~  10  Myr old) brown dwarf companions directly imaged at orbital separations similar to those of giant planets in our own solar system [\citep=2010ApJ...720L..82B]. We have also discovered CD-  35 2722 B , one of the coolest (L4 spectral type) young (~   100 Myr) brown dwarf companions directly imaged to date [\citep=2011ApJ...729..139W]. We have found a substellar companion in a hierachical triple system, HD 1160 ABC. HD 1160 A is a young (~   50 Myr old) A star and C is a low-mass M3.5 star, and B is the brown dwarf companion [\citep=2012ApJ...750...53N]. Constraints on the giant planet populations around A stars, young moving group stars and debris disk stars have also been established [\citep=2013ApJ...776....4N] [\citep=2013arXiv1309.1462B] [\citep=2013ApJ...773..179W].

In this paper, we (1) describe the NICI Campaign data pipeline that was used to achieve unprecedented contrasts at sub-arcsecond separations from our target stars ; (2) present contrast curves for a set of 45 stars from the early part of the Campaign; (3) present a novel technique to compare the results from different pipelines; (4) compare the NICI Campaign pipeline to alternate reduction methods; and (5) estimate the astrometric and photometric precision of NICI Campaign observations.

CAMPAIGN OBSERVING MODES

Our observing modes have been described in detail in [\citet=2011ApJ...729..139W]. To summarize, we use two modes, ADI and ASDI , for each target in order to optimize sensitivity to both methane-bearing and non-methane bearing companions. In the ASDI mode, we observe simultaneously in two medium-band (Δλ  /  λ  =  4%) methane filters, CH4S (λ  =  1.578 μm) and CH4L (λ=1.652 μm), using NICI's dual camera (Figure [\ref=fig:ch4_ls]). In ADI mode, we only image in the H-band. In both observing modes, the primary star is placed behind a partially transmissive coronagraphic mask with a half-power radius of 0.32''.

The ADI mode

When using the ADI technique, the telescope rotator is turned off, and the FOV rotates with respect to the instrument detectors. This is done so that the instrument and the telescope optics stay aligned with each other and fixed with respect to the detector. The respective speckle patterns caused by imperfections in the telescope and instrument optics are thus decoupled from any astronomical companions. In the de-rotated stack of images, the sky rotations of individual images are aligned. Thus, the speckle pattern is therefore azimuthally averaged, allowing the signal-to-noise of any point source in the field to improve as the square-root of integration time. This rate of improvement will only be achieved if the rotational offset between adjacent images is greater than the FWHM (Full Width at Half Maximum) of the PSF. Otherwise, the speckle-dominated regions in neighbouring images in the stack will be correlated and to some extent, the speckles will add as if they were signal. Finally, a reference PSF made by stacking the speckle-aligned images is subtracted from the individual images, so that some fraction of the speckle pattern is removed before it is azimuthally averaged. Thus the noise in the final stacked image is further reduced.

At large separations from the target star ([formula] 1.5arcsec), our sensitivity is limited by throughput, not by residual speckle structure. Thus the benefit of the ADI-only mode is that all the light is sent to one camera, to achieve maximum sensitivity. 20 1-minute images using the standard H-band filter, which is about four times wider than the 4% methane filters.

The ASDI mode

To search for close-in planets, we combine NICI's angular and spectral difference imaging modes into a single unified sequence that we call "ASDI". In this observing mode, a 50-50 beam splitter in NICI divides the incoming light between the CH4S and CH4L filters which pass the light into the two imaging cameras, henceforth designated the "blue" and "red" channels respectively. The two cameras are read out simultaneously for each exposure and thus the corresponding images have nearly identical speckle patterns. In effect, we have captured the rapidly changing atmospheric component of the speckles. However, because of the red channel PSF is not a perfect match to the blue channel PSF. The long-lived components of the speckle patterns in both channels are better captured in the remaining images of the full ASDI sequence, from which we can construct a reference PSF for further subtraction. 45 1-minute frames.

Observing constraints

Exposure times per frame are kept around 1 minute so that the time spent on detector readouts during an observing sequence is small. The hour angles when we observe our targets are chosen such that the rotation rate of the sky is less than 1 degree per minute to avoid excessive smearing during an individual exposure. The total sky rotation over the observing sequence is also required to be greater than 15 degrees, to minimize self-subtraction of companions at small separations [\citep=2009AIPC.1094..425B].

For most targets, the exposure time per coadd in the ASDI mode is set small enough so that the star's image behind the focal plane mask does not saturate. However, if this time is too small (≤  4 secs), a striping pattern resulting from electronic interference between the detectors during readout become prominent in the images. Thus for stars with H < 4 mag, the star behind the mask and some part of its halo are allowed to saturate. For these data sets, we obtain short-exposure (unsaturated) images of the star behind the mask before and after the regular sequence. For faint stars, in individual images of 1-minute integrations, the final noise contribution from the speckles is smaller than the photon noise in the halo. So the ASDI mode ceases to yield an advantage. Thus, For stars with H > 7 mag, we observe only in the ADI mode, but obtain 45 images instead of the usual 20.

DATA REDUCTION

In our standard ASDI reduction, we reduce the images in six steps (see Figure [\ref=fig:reduc_steps]):

Flatfield images were obtained during most NICI Campaign observing runs, and thus most datasets have corresponding flatfields obtained within a few days of their observing date. The images are divided by the flatfield. We estimate pixel-scale uncertainties of 0.1%, the fractional difference between two halves of a set of flatfield images. Bad pixels and cosmic ray hits are replaced by the median of the nearest eight good pixels. The distortion corrections used for the NICI data sets are available on the Gemini South NICI website. The correction is calculated from images of a rectangular grid mask, upstream of the AO system, which captures the distortion introduced by both the AO system and the camera optics. 4 mas and 6 mas at separations of 3'' and 6'' from the center of the detector, respectively (see § [\ref=section:photast]). This distortion correction is an improvement over that used in [\citet=2011ApJ...729..139W].

When using ADI, the position angle (PA) of North in the individual NICI images are recorded in the FITS image headers at the beginning of the integrations. However, since the instrument rotator is turned off, over the course of an individual integration (1 min), the PA changes. We compute the PA value corresponding to the middle of the integration and add it to the FITS headers. This corrected PA is used later when de-rotating the individual images to a common orientation.

In NICI Campaign datasets, the primary star is usually unsaturated as it is imaged a through a coronagraphic mask which is highly attenuating [\citep=2011ApJ...729..139W]. Thus the location of the primary star in these images is easily determined and then recorded in the FITS headers, to be used later for image registration. The centroiding accuracy for unsaturated peaks or peaks in the non-linear regime is 0.2 mas (see §[\ref=section:photast]). In ASDI datasets for bright stars (H <   3.5 mag) and in most ADI datasets, the primary is saturated. In these images, the peak of the primary is still discernible as a negative image. We have estimated that the centroiding accuracy of the saturated images is 9 mas by comparing these to the centroids of unsaturated short-exposure images obtained right before and after the long exposures.

Each red and blue channel image in a NICI dataset is processed by a software filter to isolate the contribution from point sources (quasi-static speckles and real objects) from the more diffuse light of the stellar halo. We describe how we chose the best filter in § 4. In the end, we use the following procedure: (1) convolve the image with a Gaussian of 8 pixel FWHM, (2) subtract the convolved image from the original image to remove the diffuse PSF light and (3) convolve the resulting difference image with a Gaussian of 2 pixel FWHM to suppress the noise on the scale of individual pixels. This approach is quite effective at isolating the flux from point sources which have typical FWHM of 3 pixels.

We shift, rotate and the red channel images to match the speckles on the corresponding blue channel images. The speckles are matched over a 10 pixel wide annulus centered on the primary, with inner and outer radii of 0.65'' and 0.83'', respectively. This region is outside the coronagraphic mask, which is completely transparent at separations greater than 0.55''. Five parameters are to find the best match between the two images: (1) shift in the horizontal direction; (2) shift in the vertical direction; (3) angular rotation offset; (4) radial demagnification; (5) intensity scaling. The match is determined by minimizing the RMS of the pixel values in the annular region in the difference image, using a simplex downhill routine [\citep=1992nrca.book.....P]. We use cubic interpolation to estimate the pixel values when rotating and shifting images. The relative rotation between the two channels is now known to a precision of 0.1[formula], . However, to be cautious, we still fit for the best angular offset between the two channels.

Using the pre-computed centroids, all the difference images are registered. Then a reference PSF image is created by taking a median combination of the registered images. We caution here that a reference PSF subtraction may not only reduce the background RMS, but also remove some of the signal of a real object. However, such signal loss is significant only when the total sky rotation in an observation sequence results in an offset less than about twice the FWHM of the PSF at the angular separation of the object.

The double-differenced images (post-SDI and ADI subtraction) are now registered using the pre-computed centroids. At this step we are interested in aligning astronomical objects, not speckles. Also, using the previously computed PAs of the sky orientation, the images are de-rotated to orient North up. We compute the median of the stack of images to produce the final reduced image. At the edges of the field, only a subset of images contribute to the final image, since the square images have different sky orientations and thus non-overlapping regions.

The contrast achieved after each of the reduction steps for the NICI observation of HD 27290 is shown in the left panel of Figure [\ref=fig:rcompcon].

MEASUREMENT OF ACHIEVED CONTRAST VIA SIMULATED COMPANION RECOVERY

In this section, we describe a method to measure the contrast limit of NICI Campaign observations using simulated companions. We use scaled versions of the primary as seen through the focal plane mask to create these simulated companions. We have two goals for such work. The first goal is to measure the contrast at which 95% of the companions are recovered by different reduction pipelines (see § 5 & 6), and thereby identify the superior pipelines. The method to do this is conceptually described below and then in greater detail in subsequent subsections.

Our method is to reprocess each data set with two reductions. The first reduction is to purposefully mis-rotate the frames so that the result does not contain any companions (a source-free reduction). This allows us to Finally, the recovered companions are reinserted into the source-free reduction at several locations, and scaled up in intensity (starting from zero flux) until they meet our detection criteria.

Making a source-free image to determine the false-positive threshold

To remove any real objects in a dataset from the final reduced image, in step 6 of the reduction procedure, we artificially set the orientation of the images to thirty times their actual sky PA values. Since the the directions of North on the images are now , when the stack of images median-combined any real objects disappear. Moreover, we can now that any point-source detection in this reduction is a false positive and that valid detections must be at a higher sigma level than the strongest false-positive.

1σ contrast curve measurement

Since the focal plane mask attenuation is measured using a photometry aperture of 3 pixel radius [\citep=2011ApJ...729..139W], the contrast curve is also measured using apertures of the same radius. We create an image from the final source-free reduced image, replacing each pixel value by the aperture (radius = 3 pixels) flux centered on that pixel. We then calculate the noise as a function of radius in this aperture flux map from the standard deviation of all pixel values in an annulus. Thus, the 1σ contrast curve is the product of: (1) the inverse of the noise curve, (2) the flux of the primary (seen through the mask) and (3) the mask attenuation.

Detection criteria

To extract sources from the reduced image, we create a signal-to-noise map. To do this, we divide each pixel in the reduced image by the standard deviation of all the pixel values in a narrow annulus containing the chosen pixel. Since there are no real sources in the signal-to-noise map of the source-free image, the counts in the brightest spurious detection set the threshold for believable detections. To detect the spurious point sources, we first convolve the signal-to-noise map by the star spot (a circular region of radius 5 pixels centered on the star). This is done so that realistically shaped point sources, as opposed to single bright pixels or an accidental cluster of bright pixels, are preferentially amplified in the signal-to-noise map. As an initial sample of possible detections, we then take all the pixels brighter than three times the pixel-to-pixel standard deviation of the signal-to-noise image. Next, we shift the star spot to the same center as each of the putative detections and scale its flux to match the peak pixel values . We then calculate a detection-strength metric given by flux / χ2ν, where flux is the aperture (3 pixel radius) "flux" of the putative detection in the S/N map, and χ2ν is the reduced χ2 from the comparison between the detection and the star spot within the aperture. The flux is included in this metric to distinguish strong detections from faint point sources at the 1σ level which can also have χ2ν close to unity. The error in the pixel values is assumed to be one, since this is a signal-to-noise map. We find that point sources with a detection-strength of ≥  0.25 look credible to the eye. This is satisfactory because Gaussian PSFs with peak intensity 5 times greater than the RMS of a Gaussian background also give a detection strength of 0.25. Finally, for a detection to be considered real, it must satisfy both this detection-strength criteria and be above the no-false-positive threshold.

Insertion of simulated 20σ companions

We insert simulated companions at the 20σ level to estimate the random and systematic effects of the pipeline and also to measure recovery completeness. After basic reduction of the individual images (step 1 of the pipeline), we embed 20σ simulated companions into the individual blue channel images, using our 1σ contrast curve as reference. The simulated companions are assumed to be methane-rich, such that they have negligible flux in the red channel. Note that our final contrast curves will be adjusted later to account for the methane channel brightnesses for companions as a function of spectral types (§[\ref=section:contrast_adjust]).

The assumed sky PAs for the red and blue channel images are set to the same artificial values as in the source-free reduction, so that this final reduced image will be same, except for the embedded companions. The 20σ companions are placed in each image at separations of 0.36'' to 6.3'' (20 to 350 pixels), with the first companion at 0.36'' separation and zero PA. Each subsequent companion is placed farther out by 0.09'' (5 pixels) and at a PA increased by 50 degrees (Figure [\ref=fig:sim-comp-pattern]). After the standard ASDI or ADI reduction procedure is applied and the signal-to-noise map is constructed, we easily recover all the simulated companions as roughly 20σ detections. However, all the companions are recovered at different slightly contrasts than their original values and possibly have different fluxes depending upon the local effects of the reduction process. Our approach of generating the contrast (described below) naturally incorporates these effects.

Derivation of the 95% completeness contrast

The 20σ companions in the signal-to-noise map at each separation (67 in total) are then cut out and inserted into the signal-to-noise map of the source-free reduction at 20 different PAs. At each location, we decrease the flux of the companion until it fails to satisfy our detection criteria. The resulting curve represents the 95% completeness contrast. The right panel of Figure [\ref=fig:sim-comp-pattern] shows the locations at which the recovered 20σ companions were reinserted, i.e., where the contrast limits were determined. The standard contrast curve throws away information about the azimuthal variation of the contrast achieved. Figure [\ref=fig:sim-comp-pattern] shows how much azimuthal variation there is in a typical reduction. The images shown are from the UY Pic ASDI data set obtained on 2009 December 4 UT.

OPTIMIZING IMAGE FILTERING VIA SIMULATED COMPANION RECOVERY

Description of the image filters

A better reduction should yield a better 95% completeness curve. Thus we use the 95% completeness curves to judge the effectiveness of different image filters in step 2 of the standard reduction procedure. The image filters we applied were different combinations of the following basic processes: "u' unsharp-masking; "c" 'catch' filtering (unsharp masking + smoothing); "a" removal of azimuthal profile and "d" de-striping. Unsharp masking is done by convolving an image with a Gaussian of 8-pixel FWHM and subtracting this convolved image from the original. Catch filtering entails a further smoothing with a Gaussian of 2-pixel FWHM in order to suppress pixel-to-pixel noise. Azimuthal profiles were removed by a procedure described in [\citet=2011ApJ...729..139W]. The procedure is very effective at removing PSF features which are extended azimuthally. De-striping is used to remove the striping pattern caused by detector electronics which usually occurs in short exposures. It is only applied to the region where the flux from the primary is fainter than twice the local pixel-to-pixel RMS. In this exterior region of the images, we subtract from each pixel the median of the closest 30 closest pixels in the same row, and then in the same column.

Comparison of the image filters

Figure [\ref=fig:concurve] shows the 95% completeness contrasts for different combinations of image filters used in the reduction of our UY Pic 2009 dataset. The filter 'cd' indicates catch filtering followed by de-striping. We can see that the 'c' filter yields the highest contrast close to the star, while at larger separations it yields one of the highest contrasts and also yields a smoother curve. The roughness of the other curves suggests that the other filters may be responsible for residual structures which are resulting in a patchy noise floor. The filter combinations that involve catch filtering yield better contrasts even at large separations where striping or sky noise dominates. It seems likely that the small-scale smoothing involved in catch filtering mitigates the problem of residual structures forming patterns in the de-rotated reduced stack. At smaller separations, catch filtering leads to better fitting of the speckle pattern during the subtraction process. As expected, we found that the de-striping filter is more useful for datasets where the integration time per coadd is short, because the striping is more severe in these cases. We also make the following observations: (1) the best filters are 'c', 'ca', 'cd' and 'cad', and they are more or less equivalent; (2) the 'a' and the 'd' filters can slightly worsen performance when used together and (3) the catch filter generally improves performance. We choose the 'cad' filter for the pipeline, as insurance against cases where the striping pattern or azimuthal variation across images is unusually severe. In Figure 5, we see that the 95% completeness curve agrees well with the nominal 5σ noise curve for the UY Pic dataset.

COMPARISON WITH THE LOCI ALGORITHM

Algorithms for processing have steadily improved at removing starlight while preserving the planet's flux. Currently, the LOCI (Locally Optimized Combination of Images) algorithm is among the most commonly used post-processing method [\citep=2007ApJ...660..770L]. It was originally used to process ADI data from the Gemini Deep Planet Survey [\citep=2007ApJ...670.1367L]. LOCI builds the optimal PSF for any given sub-region of the science image, science images where the PSF is very similar. This algorithm has undergone several improvements. For example, the subtraction region can be masked so as not to bias the construction of a reference PSF by real companions [\citep=2010SPIE.7736E..52M]. Moreover, the subtraction region can reduced to one pixel, and LOCI choices tuned to improve point-source sensitivity [\citep=2011ApJ...741...55S]. Lastly, LOCI to integral field spectroscopy observations, where the reference PSF can be built from images of the star over an entire spectral and temporal range . [\citet=2012ApJS..199....6P] have added the innovation that LOCI is programmed not just to minimize the local noise in the images but also to preserve the local flux. In other words, the algorithm tries to maximize the local signal-to-noise.

We can now compare the effectiveness of the original LOCI algorithm to that of our standard pipeline using their respective 95% completeness contrast curves. The more sophisticated versions [\citep=2011ApJ...741...55S] [\citep=2012ApJS..199....6P] designed for improved flux conservation are quite computationally intensive, and we do not test with them in this paper.

The LOCI algorithm is applied in step 5 of our pipeline, after we subtract the red channel images from the blue channel images. In short, the algorithm works likes this. When processing each science image, instead of subtracting the median combination of the other images in the dataset, we subtract a linear combination of the images optimized for each region of the image. These regions are configured as segmented concentric annuli around the primary star (Figure [\ref=fig:loci_sectors]). For each region that we want to optimally subtract speckles from, we define a reference region which extends outward radially from the subtraction region by an extra 15-30 pixels. The linear combination of images is optimized over the larger reference region to minimize the RMS of the subtraction.

The LOCI algorithm by the following parameters: Nδ, NA, dr, g and dw. Nδ represents the minimum offset required when selecting reference frames, measured as arclength traced by the sky rotation divided by the PSF FWHM. NA is the of the reference region in units of the PSF FWHM, and dr is the radial width of the subtraction region in units of PSF FWHM. The parameter, g, is the ratio of the radial extent to the angular extent of the reference region, and dw is the extra radial width of the reference region beyond that of the subtraction region.

Instead of setting NA and g directly, we set it through two alternate parameters which are easier to conceptualize. We set the number of sectors in the annulus at r = 7'' using by the parameter, Nsec. We choose the number of sectors per annulus to decrease linearly with decreasing radius, . We increase the radial width of the subtraction regions geometrically going outwards by the factor drfac with each annular increment. The NA and g values corresponding to some of the Nsec and drfac values we used are given in Table [\ref=tab:loci_prams]. Our choice of sectors for an example set of LOCI parameters is shown in Figure [\ref=fig:loci_sectors].

We tested the performance of several sets of parameters in the LOCI algorithm for our December 2009 UY Pic ASDI data set (45 images, each of 60 sec exposure time; total sky rotation of 34[formula]). All combinations of parameters for Nsec  =  {8,16,32}, dw = {16,32}, dr = {2,4,6} and Nδ  =  {0.5,1} were evaluated. However, no LOCI reduction yielded a noticeable improvement over the standard ASDI reduction, when comparing the 95% completeness curves. At the same time, we found that the LOCI reductions can produce final images with less noise. In the left panel of Figure [\ref=fig:loci_asdi_95p_uypic], we demonstrate the effect of changing each LOCI parameter from a base set of values. Although none of the LOCI 95% completeness curves improve on the standard ASDI curve, in the right panel of Figure [\ref=fig:loci_asdi_95p_uypic] we see that the LOCI reductions yield better nominal 5σ contrast curves. In the fact, the more aggressive LOCI reductions (smaller subtraction regions, etc.) yielded better nominal 5σ contrast curves but worse 95% completeness curves. Even for the plain ADI UY Pic data set, the LOCI 95% completeness curves showed no improvements over the standard reduction (Figure [\ref=fig:loci_adi_95p_uypic]). This result was confirmed when we took 45 ADI Campaign datasets from 2009 (see § 7) and compared their 95% completeness contrasts from LOCI and our standard ADI pipeline (Figure 11).

Our results differ from those of [\citet=2007ApJ...660..770L] perhaps because we use a detection criteria our completeness curve, . In their work, [\citet=2007ApJ...660..770L] compare the signal-to-noise of recovered simulated companions for LOCI and non-LOCI algorithms but do not set a criteria for what counts as a detection, or consider the false-positive threshold. Another possible explanation for the different results is that the higher Strehl ratios achieved with NICI (Chun et al. 2008) have yielded more stable quasi-static speckle patterns than obtained with the Gemini/ALTAIR AO system for GDPS. In this case, the special selection of reference frames with LOCI would not be very effective, because the reference frames are all comparably good matches. Experimentation with NICI data sets , where the quasi-static pattern changes significantly over the course of the observation, might show that in these cases, LOCI performs better. However, that experiment is beyond the scope of this paper.

[\citet=2007ApJ...660..770L] have already explained that LOCI can remove signal from real objects in the field if applied too aggressively. When the reference regions are too small or the reference images too numerous, the application of LOCI is too aggressive. In practice, even when reference images are bad matches to the science image, as the number of images is increased, LOCI keeps reducing the noise in the output image. Thus it is advisable to check that simulated companions that are brighter than the contrast limits are not lost in the reduction process. Using the same method, one can also check that the contrast of the simulated companions are correctly recovered [\citep=2010SPIE.7736E..52M].

ANALYSIS OF NICI CAMPAIGN DATA FROM 2009A

, we have obtained 172 ASDI data sets and 241 ADI data sets as of August 2012. Since performing the simulated companion tests on all the Campaign data is time-consuming, we limit our analysis to obtained in the beginning of 2009. Some NICI targets have either only an ASDI or only an ADI observation, and so some of the targets in our ASDI and ADI sample data sets are different. We chose the standard ASDI reduction method over LOCI, since we noticed no improvement with the latter method (). As before, we generate the 95% completeness contrasts for all our data sets.

Achieved raw contrasts

Figure [\ref=fig:2009_95p] shows all the 95% completeness curves and also the median curve and the 1σ dispersion. , we should have recovered 95% of companions with a median ASDI contrast less than 12.6 mags at 0.5'' and less than 14.4 mags at 1.0''. The difference between the 95% completeness curves and the nominal 5σ curve for each dataset is displayed in Figure [\ref=fig:2009_diff] for comparison. The median 95% curve is poorer than the median 5σ curve by 0.1 and 0.3 mag at 0.5'' and 3'', respectively, varying slowly with separation. The difference is smallest at separations dominated by the stellar halo, increases with separation, and is roughly flat at separations beyond 2''.

At low temperatures (<  1400 K), substellar objects with spectral type T [\citep=2003A&A...402..701B], exhibit methane absorption in their spectra, such that their red channel flux would be suppressed relative to their blue channel these considerations only become important when we are trying to calculate companion mass sensitivities. So, we defer such a discussion to §[\ref=section:contrast_adjust_sdi]. Here, we just note that even for an object with no methane, there is little self-subtraction from the red channel beyond separations of 1'', since we radially stretch the red channel image before SDI subtraction. Inside of 1'', for objects without any methane, the reduction of the ADI-mode dataset or the separate ADI reductions of the red and the blue channels should yield better sensitivities as the red channel flux is not subtracted in these.

Beyond a separation of 1.5'', the ADI H-band contrast curves are more sensitive, with 95% completeness contrasts of 15.0 and 15.5 mag at 1.5'' and 3'', respectively. Beyond 3'', the ADI median completeness curve flattens out, as the noise from the sky background and detector readout begin to dominate that from the halo. Note that at large separations the ADI contrast distribution in Figure 9 is bimodal. This is because for faint stars, we reach the background limit at smaller angular separations than for bright stars, and the brightness distribution of our primary stars is also roughly bimodal. The distribution of contrasts at large separations is also skewed such that the mean contrast (16.0 mag) is greater than the median contrast (15.5 mag).

Contrast curve adjustments

The simulated companions used to estimate the contrast curves same alterations to their flux that real objects in the field . To adjust the contrast curves for these alterations, we take into account three effects: (1) smearing of an object's flux as the field rotates during each individual exposure; (2) the non-zero mask opacity from 0'' to 0.55'' separation from the primary; and (3) the flux loss from the red and blue channel differencing for objects that do not have photospheric methane absorption.

Note that another important effect, the contrast alteration due to ADI self-subtraction, is already accounted for in the 95% completeness curves, since the simulated companions used to construct the curve undergo the same alteration as any real object.

Smearing correction

The representative area of a PSF core is πa2, where a is the half at half of the PSF, or about 1.5 NICI pixels. Due to sky rotation during an individual exposure, the flux in the PSF core is spread over an area πa2  +  2aL [\citep=2007ApJ...670.1367L]. Here, L (  =  RωΔt) is the arclength , Δt ( typically 1 minute for NICI observation). The separation from the primary and the rotation rate in radians per minute are R and ω, respectively. Thus, there is a fractional flux loss of in the PSF core. We convert this loss into magnitudes as a function of separation and subtract it from the 95% completeness contrasts. Out of 413 NICI observations obtained up to August 2012, 382 (93%) of NICI observations have an average rotation rate of less than 2 degrees per minute. Thus, 93% of the time the contrast is degraded by less than 0.015 and 0.08 magnitudes at 1'' and 5'', respectively.

To check the reliability of the flux correction, we simulated the smearing of Gaussian PSFs (FWHM= 3 pixels) for the declinations and observing hour angles that yield very fast and non-uniform rotation rates. We tested declinations from -24[formula] to -36[formula] (Gemini South latitude=  - 30.24[formula]) in steps of 2[formula] and starting hour angles of +  10 and -  10 minutes. These choices yielded average rotation rates of 1 to 3.5[formula] per minute. We placed the PSF at a separation of 3'' from the rotation center. We then measured the 3-pixel (radius) aperture flux of the median-combined 45 frames of smeared PSFs from the varying sky rotations. This aperture flux was adjusted for the flux loss fraction we computed earlier and compared to the true aperture flux of the Gaussian PSF. We found in all cases that the fractional difference was less than 1.5%. This precision is high enough for our purposes.

Mask opacity correction

As described in [\citet=2011ApJ...729..139W], we observed a pair of stars, (2MASS J06180157-1412573 and 2MASS J06180179-1412599) separated by only a few arcseconds, to measure the opacity of the coronagraphic mask in the CH4 4% short and long filters. The two stars were observed simultaneously without the mask and then observed with the brighter object at different displacements along a straight line from the center of the mask. We measured the contrast between the stellar pair in the off-mask images and in the mask-occulted images, using an aperture radius of 3 pixels. The difference between the on and off-mask contrasts (in magnitudes) gives us the mask opacity 0'' to 0.55'' from the center of the mask. The measured opacities of the 0.32'' (radius) mask as a function of separation are given in Table [\ref=tab:mask_opacity]. At the center of the mask, the opacity is 6.39.03 mag, while at a separation of 0.55'' the mask becomes completely transparent.

SDI self-subtraction correction

In the ASDI reduction, when the red channel image is demagnified to matched the speckles in the blue channel image, at large enough separations (>  1.2'') the red channel counterpart of a real object will almost completely shift off the blue channel counterpart. However, at small separations the red and blue channel counterparts will still overlap. Thus during image differencing, some flux from the blue channel will be removed and this has to be adjusted for. Of course, this SDI self-subtraction correction does not affect the ADI contrast curves. We do not apply this correction to the ASDI contrast curves for the Campaign. Instead, we apply the correction when converting the ASDI contrast curves into companion-mass sensitivity curves, for which we have to assume a spectral type (e.g., T dwarf). Monte Carlo simulations are used to determine the planet detection probability of each NICI observation [\citep=2013ApJ...776....4N]. In these simulations thousands of companions of are drawn from a power-law distribution in mass. Using evolutionary models [\citep=2003A&A...402..701B], the temperatures corresponding to the masses of the simulated companions are computed, given the age of the host star. Next, we calculate the red to blue channel flux ratio given the temperatures of the companions . Thus, we can estimate the ASDI contrasts of the companions and what fraction of them are expected to be detected . In other words, the SDI correction is not applied to the contrast curves themselves but to the model-derived contrasts of simulated companions.

The fractional flux loss due to SDI subtraction is a function of separation. We estimate this loss by subtracting a Gaussian PSF of width 3 pixels from itself after shifting it radially by 4.6% of the separation (which corresponds to red image demagnification) and taking the ratio of its fluxes before and after the subtraction. This maximum fractional loss is for objects without methane absorption.

We find that even with significant self-subtraction, the ASDI reduction can yield superior contrasts to the ADI reductions. For example, for a companion with no methane, the ASDI contrasts at 0.5'', 0.75'' and 1.0'' separation are reduced by 0.58, 0.49 and 0.2 mags, respectively, relative to its blue channel contrasts. Comparing the median contrast curves in Figure [\ref=fig:2009_95p], we note that the ASDI curve is more sensitive than the ADI curve by 1.5, 1.35 and 0.9 mags at the same separations, respectively. Thus at small separations, the ASDI contrast curves are sensitive, whether the companions are methane-bearing or not.

Photometric accuracy

Here, we estimate there errors by studying the recovered simulated companions. The original simulated companions were inserted into the individual frames as 20σ sources relative to the 1σ contrast curve (§ 4.3). When these are recovered after the reduction procedure, their contrast with respect to the primary is . The differences between the input contrasts and the recovered contrasts for the 2009 ASDI data sets are plotted against separation in Figure [\ref=fig:phot_ast_acc]. At each separation, we plot the median of the contrast as a solid line and indicate the standard deviation by two dashed lines. The contrast increases from 0.05 to 0.3 mags between 0.5 and 2'' and settles to 0.25 mags at 6''. The standard deviation suggests a uniform photometric uncertainty of 0.07 mags between 0.5 and 6''.

Astrometric accuracy

The reduction procedure also introduces some astrometric uncertainty in the location of companions with respect to the primary. We see that the astrometric uncertainty is roughly uniform (≈   10 mas) as a function of separation. However, we must also include the uncertainties introduced by centroiding, residual distortions and the plate scale estimate.

The astrometric uncertainty due to the precision limit of our centroiding algorithm, given the finite size of the NICI pixels, is 0.011 pixels (0.2 mas). We estimate this by testing our centroiding algorithm on Gaussian point sources with different sub-pixel offsets relative to the pixel center. The standard deviation of the difference between the known positions and the measured positions of the point sources gives the uncertainty of the centroiding algorithm.

For saturated datasets, we compare the centroids of the short exposure unsaturated images, taken just prior to the science data, to the centroid estimate of the first saturated image. The movement of the star relative to the mask should be very small for the minute of elapsed time between the exposures. From analyzing several saturated datasets, we estimate that the centroiding uncertainty for saturated images is 0.5 pixels or 9 mas.

The astrometric uncertainty due to imperfect distortion correction was found to be 0.017+0.049ρ pixels, where ρ is the projected separation in arcseconds. This was measured by comparing the detections in the Proxima Centauri field from two NICI epochs obtained on 2009 April 8 and April 26 UT. Out of 73 background sources, the differences in the positions of 57 sources with S/N>  30 were fitted robustly with a line (Figure [\ref=fig:astrom_parts]), which resulted in the solution above.

The red and blue channel plate scales were measured from NICI observations the Large Megallanic Cloud. This field has been observed with Hubble Space Telescope Advanced Camera for Surveys to an astrometric precision of 1 mas (Diaz-Miller 2007). The astrometric uncertainty in the plate scale measurement is estimated to be 0.2%. From these observations, we also estimated that the uncertainty in the direction of North is 0.1 degrees.

The total astrometric error is all these contributions added in quadrature. Figure [\ref=fig:astrom_parts] shows all the contributions as a function of separation. The total astrometric uncertainty for a 20σ source detection around an unsaturated star is 2.2 and 11 mas at 1'' and 5'', respectively. The total astrometric uncertainty for a 5σ source detection around a saturated star is 10 and 15 mas at 1'' and 5'', respectively.

CONCLUSIONS

We have presented the image processing techniques used to detect companions to target stars in the Gemini NICI Planet-Finding Campaign. median contrasts of 12.6 magnitudes at 0.5'' and 14.4 magnitudes at 1'' separation, for a sample of 45 stars from the early part of our campaign. We have also We have demonstrated how this technique can be used to determine which image-processing pipelines are more successful at recovering faint simulated point sources. Specifically, we analyzed the effect of different image filters on the final contrast curves. We have compared our pipeline to the performance of the LOCI algorithm on NICI data, and found that LOCI is not more effective than our standard pipeline.

Our processing technique is conceptually similar to previous techniques, we use special image filters and fit speckle patterns prior to reference PSF subtraction. The next-generation exoplanet finders, SPHERE [\citep=2010ASPC..430..231B] and the Gemini Planet Imager [\citep=2008SPIE.7015E..31M], will both be equipped with integral field spectrographs and will thus require more complex algorithms to isolate the exoplanet signals [\citep=2012ApJS..199....6P]. However, for the faintest planets, some version of the ASDI method discussed here will probably have to be used as the signal will be too weak to obtain resolved spectra. Thus, the techniques demonstrated here may be instrumental in addressing exoplanet detection challenges of the future.