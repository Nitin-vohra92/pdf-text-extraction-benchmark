Fully Convolutional Multi-Class Multiple Instance Learning

Introduction

Convolutional networks (convnets) are achieving state-of-the-art performance on many computer vision tasks but require costly supervision. Following the ILSVRC12-winning image classifier of [\cite=alexnet], progress on detection [\citep=rcnn] and segmentation [\citep=arxiv14_jonEvan] demonstrates that convnets can likewise address local tasks with structured output.

Most deep learning methods for these tasks rely on strongly annotated data that is highly time-consuming to collect. Learning from weak supervision, though hard, would sidestep the annotation cost to scale up learning to available image-level labels.

In this work, we propose a novel framework for multiple instance learning (MIL) with a fully convolutional network (FCN). The task is to learn pixel-level semantic segmentation from weak image-level labels that only signal the presence or absence of an object. Images that are not centered on the labeled object or contain multiple objects make the problem more difficult. The insight of this work is to drive the joint learning of the convnet representation and pixel classifier by multiple instance learning. Fully convolutional training learns the model end-to-end at each pixel. To learn the segmentation model from image labels, we cast each image as a bag of pixel-level-instances and define a pixelwise, multi-class adaptation of MIL for the loss.

MIL can reduce the need for bounding box annotations [\citep=verbeek2014_cvpr] [\citep=song2014weakly], but it is rarely attempted for segmentation. [\citet=oquab2014weakly] improve image classification by inferring latent object location, but do not evaluate the localization. [\citet=lsdaMIL] train by MIL fine-tuning but rely on bounding box supervision and proposals for representation learning. Most MIL problems are framed as max-margin learning [\citep=andrews2002_nips] [\citep=felzenszwalb2010_pami], while other approaches use boosting [\citep=ali_cvpr14] or Noisy-OR models [\citep=heckerman2013tractable]. These approaches are limited by (1) fixed representations and (2) sensitivity to initial hypotheses of the latent instance-level labels. We aim to counter both shortcomings by simultaneously learning the representation to maximize the most confident inferred instances. We incorporate multi-class annotations by making multi-class inferences for each image. When an image / bag contains multiple classes the competition of pixelwise models help to better infer the latent instance-level classes.

We investigate the following ideas and carry out preliminary experiments to these ends:

We perform MIL jointly with end-to-end representation learning in a fully convolutional network. This eliminates the need to instantiate instance-label hypotheses. FCN learning and inference can process images of different sizes without warping or object proposal pre-processing. This makes training simple and fast.

We propose a multi-class pixel-level loss inspired by the binary MIL scenario. This tries to maximize the classification score based on each pixel-instance, while simultaneously taking advantage of inter-class competition in narrowing down the instance hypotheses.

We target the under-studied problem of weakly supervised image segmentation. Our belief is that pixel-level consistency cues are helpful in disambiguating object presence. In this way weak segmentation can incorporate more image structure than bounding boxes.

Fully Convolutional MIL

A fully convolutional network (FCN) is a model designed for spatial prediction problems. Every layer in an FCN computes a local operation on relative spatial coordinates. In this way, an FCN can take an input of any size and produce an output of corresponding dimensions.

For weakly supervised MIL learning, the FCN allows for the efficient selection of training instances. The FCN predicts an output map for all pixels, and has a corresponding loss map for all pixels. This loss map can be masked, re-weighted, or otherwise manipulated to choose and select instances for computing the loss and back-propagation for learning.

We use the VGG 16-layer net [\citep=simonyan2014very] and cast it into fully convolutional form as suggested in [\citet=arxiv14_jonEvan] for semantic segmentation by replacing fully connected layers with corresponding convolutions. The network is fine-tuned from the pre-trained ILSVRC classifier weights i.e. pre-trained to predict image-level labels. We then experiment with and without initializing the last layer weights i.e. the classifier layer. These initializations, without MIL fine-tuning, act as the baselines (row 1 and 2 in Table). If there is no image-level pretraining, the model quickly converges to all background. Semantic segmentation requires a background class but the classification task has none; we simply zero initialize the background classifier weights.

Multi-Class MIL Loss

We define a multi-class MIL loss as the multi-class logistic loss computed at maximum predictions. This selection is enabled by the output map produced by FCN i.e. for an image of any size, the FCN outputs a heat-map for each class (including background) of corresponding size. We identify the max scoring pixel in the coarse heat-maps of classes present in image and background. The loss is then only computed on these coarse points, and is back propagated through the network. The alternating optimization in the binary MIL problem inspires this ignoring of the loss at non-maximally scoring points. The background class is analogous to the negative instances by competing against the positive object classes. Let the input image be I, its label set be LI (including background label) and p̂l(x,y) be the output heat-map for the lth label at location (x,y). The loss is defined as:

[formula]

Ignoring the loss at all non-maximally scoring points is key to avoid biasing the learning of the FCN to the background. Simultaneous training exploits multi-label images through inter-class confusion to help refine the intra-class pixel accuracy. At inference time, the MIL-FCN takes the top class prediction at every point in the coarse prediction and bilinearly interpolates to image resolution to obtain a pixelwise segmentation.

Experiments

All results are on the PASCAL VOC segmentation challenge. We train and validate on the VOC 2011 train augmented by [\cite=hariharan2011semantic] and val sets then evaluate on the completely held-out VOC 2012 test set. The evaluation metric is intersection over union (IU), and is defined per class as the percentage of pixels in the intersection of ground truth segmentation mask, and the predicted mask out of the number of pixels in their union. The MIL-FCN model is initialized from the 16-layer VGG ILSVRC14 classifier [\citep=simonyan2014very] then fine-tuned by the MIL loss. [\cite=arxiv14_jonEvan] fine-tune from all but the output layer, as they have access to complete supervision. In our setting however, transferring the output layer parameters for the classes common to both PASCAL and ILSVRC improves results. Including these classifier parameters helps prevent degenerate solutions of predicting all background. We train our model with a learning rate 0.0001 , momentum 0.9 and weight decay 0.0005. The training is quick and the network converges in less than 10,000 iterations.

Table [\ref=table:result] shows quantitative intersection-over-union (IU) scores while example outputs from MIL-FCN are shown in Figure [\ref=fig:examples]. MIL-FCN achieves 96% relative improvement over the baseline results when the classifier is fine-tuned from the common classes. These are preliminary but encouraging results.

Discussion

We propose a novel model of joint multiple instance and representation learning with a multi-class pixelwise loss inspired by binary MIL. This model is learned end-to-end as a fully convolutional network for the task of weakly supervised semantic segmentation. It precludes the need for any kind of proposal or instance hypothesis mechanisms. Inference is fast (≈   sec).

These results are encouraging, and can be improved further. Currently, the coarse output is merely interpolated; conditional random field regularization or super-pixel [\citep=achanta2012slic] projection could refine the predictions. These grouping methods could likewise drive learning by selecting whole segments instead of single points for MIL training. Moreover, controlling convnet learning by manipulating the loss map could have further uses such as encouraging consistency across images for co-segmentation or hard negative mining.