nIFTY galaxy cluster simulations III: The Similarity & Diversity of Galaxies & Subhaloes

, Alexander Knebe2,3, Frazer R. Pearce4, Chris Power5,6, Gustavo Yepes2, Weiguang Cui5,6, Daniel Cunnama7, Scott T. Kay8, Federico Sembolini2,9, Alexander M. Beck10, Romeel Davé11,12,13,14, Sean February15, Shuiyao Huang16, Neal Katz16, Ian G. McCarthy17, Giuseppe Murante18, Valentin Perret19, Ewald Puchwein20, Alexandro Saro21, Romain Teyssier22 1Sydney Institute for Astronomy, A28, School of Physics, The University of Sydney, NSW 2006, Australia 2Departamento de Fsica Teórica, Módulo 8, Facultad de Ciencias, Universidad Autónoma de Madrid, 28049 Madrid, Spain 3Astro-UAM, UAM, Unidad Asociada CSIC 4School of Physics & Astronomy, University of Nottingham, Nottingham NG7 2RD, UK 5International Centre for Radio Astronomy Research, University of Western Australia, 35 Stirling Highway, Crawley, Western Australia 6009, Australia 6ARC Centre of Excellence for All-Sky Astrophysics (CAASTRO) 7Physics Department, University of the Western Cape, Cape Town 7535, South Africa 9Jodrell Bank Centre for Astrophysics, School of Physics and Astronomy, The University of Manchester, Manchester M13 9PL, UK 9Dipartimento di Fisica, Sapienza Università di Roma, Piazzale Aldo Moro 5, I-00185 Roma, Italy 10University Observatory Munich, Scheinerstr. 1, D-81679 Munich, Germany 11Physics Department, University of Western Cape, Bellville, Cape Town 7535, South Africa 12South African Astronomical Observatory, PO Box 9, Observatory, Cape Town 7935, South Africa 13African Institute of Mathematical Sciences, Muizenberg, Cape Town 7945, South Africa 14Astronomy Department and CCAPP, Ohio State University, Columbus, OH 43210, USA 15Center for High Performance Computing, CSIR Campus, 15 Lower Hope Street, Rosebank, Cape Town 7701, South Africa 16Astronomy Department, University of Massachusetts, Amherst, MA 01003, USA 17Astrophysics Research Institute, Liverpool John Moores University, 146 Brownlow Hill, Liverpool L3 5RF, UK 18INAF, Osservatorio Astronomico di Trieste, via G.B. Tiepolo 11, I-34143 Trieste, Italy 18Institute for Computational Science, ETH Zurich, Wolfgang-Pauli-Strasse 16, CH-8093, Zurich, Switzerland 20Institute of Astronomy and Kavli Institute for Cosmology, University of Cambridge, Madingley Road, Cambridge CB3 0HA, UK 21Department of Physics, Ludwig-Maximilians-Universitat, Scheinerstr. 1, 81679 Munchen, Germany 22Institute of Theoretical Physics, Universität Zürich, Winterthurerstrasse 190, CH-8057 Zürich, Switzerland

Introduction

The complex environment of galaxy clusters provides a challenging and unique astrophysical laboratory with which to test our theories of cosmic structure formation and the processes that govern galaxy formation. The progenitors of these massive structures collapsed at high redshift, and so their present day properties probe cosmic structure formation over a large fraction of the Universe's lifetime. A cluster's galaxy population is comprised of both those that have orbited within the dense, violent environment for several dynamical times and newly accreted field galaxies. Modelling these systems has been a great challenge given the enormous range in both spatial and temporal scales probed: from the local cooling of gas; conversion of gas to stars; and injection of energy into the surrounding galactic medium from supernovae; to merger driven star bursts and the powerful AGN outflows from massive galaxies that affect the large-scale intra-cluster medium.

Hydrodynamical simulations traditionally used either Lagrangian Smoothed-Particle-Hydrodynamics (SPH) techniques (e.g. [\citealp=gingold1977] [\citealp=lucy1977] [\citealp=monaghan1992] [\citealp=katz1996]; and see [\citealp=springel2010b] for a review) or Eulerian grid-based solvers sometimes aided by Adaptive Mesh Refinement (AMR) techniques [\cite=cen1992] [\cite=bryan1995] [\cite=art]. Ideally, synthetic galaxies should be similar regardless of code or technique used. However, early comparisons of hydrodynamical N-body codes showed worrying differences between numerical approaches and even codes. The classic Santa Barbara Cluster Comparison Project, [\cite=frenk1999a], compared the properties of a galaxy cluster formed in a non-radiative cosmological simulation using 12 then state-of-the-art mesh- and particle-based codes and found a large scatter in almost all bulk properties. The key difference confirmed in many other studies was the presence of a core in the radial entropy profile in mesh based codes that was absent in SPH codes [\cite=dolag2005a] [\cite=voit2005] [\cite=mitchell2009].

Some of these differences can be attributed to the underlying technique used, whether SPH or mesh based. By its very nature of SPH can smooth out shocks, dampen subsonic turbulence, and suppress fluid instabilities, at least for vanilla SPH [\cite=okamoto2003] [\cite=agertz2007] [\cite=tasker2008]. Mesh codes by construction are not Galilean invariant, consequently results are sensitive to the presence of bulk velocities and significant advection errors can occur when fluids with sharp gradients move across cells in a manner un-aligned with the grid, generating entropy spuriously through artificially enhanced mixing [\cite=wadsley2008] [\cite=tasker2008]. AMR codes, which use flexible but necessarily ad-hoc refinement criteria, have artefacts arising from the loss of accuracy at refinement boundaries. When coupled to gravity, this loss of accuracy leads to suppression of low amplitude gravitational instabilities, which are seeds for cosmological structure formation, and violate energy and momentum conservation in the long-range forces whenever cells are refined or de-refined [\cite=oshea2005] [\cite=heitmann2008]. Consequently, even for some simple non-radiative problems, classic Lagrangian and Eulerian codes will not converge to the same solution [\cite=tasker2008] [\cite=hubber2013]. Modern codes have attempted to address some of the inherent issues with each method by the inclusion of higher order dissipative switches [\cite=read2010], new SPH kernels, different SPH formulations [\cite=hopkins2013], sub-grid physics in mesh codes [\cite=maier2009], and hybrid methods [\cite=arepo] [\cite=gizmo].

Comparisons are further complicated by the inclusion of uncertain baryonic physics governing galaxy formation. Though most codes attempt to reproduce the observed galaxy population, implementations of radiative physics vary and typically increases the code-to-code scatter. For instance, [\cite=scannapieco2012] found that different star formation and stellar feedback implementations lead to significant differences in the morphology, angular momentum and stellar mass of an isolated individual galaxy. Some of the differences are a simple result of different subgrid physics. Several studies have investigated tuning parameters using in subgrid models, clearly showing the need for some tuning [\cite=haas2013a] [\cite=haas2013b] [\cite=lebrun2014a] [\cite=crain2015a], although typically these models focus on varying parameters and not necessarily changing the subgrid implementation. Using the same SPH code, [\cite=duffy2010] showed different subgrid models produced different baryonic distributions. However, different models need not necessarily produce different galaxy populations. [\cite=durier2012] showed that two significantly different implementations of supernova feedback in SPH codes, thermal and kinetic, do converge. In [\cite=scannapieco2012], the resulting disc galaxy was typically too concentrated but recent developments have shown that there are codes capable of producing more realistic disc galaxies [\cite=vogelsberger2014a] [\cite=feldmann2015a] [\cite=schaye2015a] [\cite=wang2015a] [\cite=murante2015a].

The appearance of numerous modern SPH and mesh methods and significant developments in modelling the processes governing galaxy formation warrants a second look at synthetic clusters. Hence, sixteen years later, the nIFTy comparison project aims to revisit the Santa Barbara comparison with new state-of-the-art hydrodynamical codes. The first paper in this series of comparisons, [\cite=nifty1], studied the bulk properties of the cluster environment using a single well-resolved cluster with twelve modern codes in pure N-body and adiabatic runs. This comparison clearly demonstrated that:

The dark matter distribution in pure Dark Matter (DM) only simulations show [formula] variation in the dark matter density profile.

In non-radiative runs, the variation in the dark matter density profile remains at [formula], but the gas distribution shows variations of up to [formula].

Newer SPH codes that use higher order kernels and more complex methods for modelling dissipative physics are in close agreement with mesh codes, with variations of [formula], and more significantly these codes reproduce the entropy core seen in numerous mesh codes.

Clearly, the latest SPH codes have removed the long standing problem of falling entropy profiles seen in [\cite=frenk1999a].

In paper II, [\cite=nifty2], we examined the bulk properties of this same cluster in full physics runs. The inclusion of cooling, star formation and feedback significantly increases the scatter between codes, with baryon and stellar fractions varying by 30%. Furthermore, full physics removes between classic and modern SPH codes in regards to entropy profiles, i.e., full physics + classic SPH can produce entropy cores. Intriguingly, the dividing line in properties like the temperature profile between codes is not the inclusion/absence of AGN, although AGN play an important role in limiting the effect of overcooling.

The next question, which we examine here, is whether codes reproduce not just the same overall cluster environment but also individual subhaloes & galaxies. Here we examine multiple subhaloes/galaxies, and the change in the differences between codes with the inclusion of more complex physics, going from pure dark matter simulations to fully radiative simulations. The goal is to identify the origins of any differences and determine relative "error" bars for predictions from hydrodynamical simulations. This paper is organised as follows: we briefly describe the numerical methods in §[\ref=sec:methods], highlighting the differences between the codes in §[\ref=sec:codes]. Our findings are presented in sections [\ref=sec:subhalopop]-[\ref=sec:crosscomp], where we compare the subhalo/galaxy population as a whole and compare individual objects respectively. We end with discussion in §[\ref=sec:discussion].

Numerical Methods

Codes

The initial nIFTy comparison project, as presented in [\citet=nifty1], included 13 codes - the variant of , ramses, Arepo, and 9 variants of the Gadget code. In this study as in [\cite=nifty2], we consider the subset of these codes in which full radiative subgrid physics has been included: one Adaptive Mesh Refinement (AMR) code, ramses, the moving mesh code, Arepo and 9 variants of the SPH Gadget code. The subgrid physics included span the range from codes only including Cooling and Star Formation (CSF) to those that also include supermassive black hole formation and associated Active Galactic Nuclei (AGN). Two codes, Arepo & G3-Music, have been run with variant subgrid physics. The salient features of each code are summarised in Table [\ref=tab:codes:summary]. A comprehensive summary of the approach taken to solving the hydrodynamic equations in each of these codes can be found in [\cite=nifty1] and description of subgrid models in [\cite=nifty2] (and Appendix [\ref=sec:app:codes]).

We note that there are several unique combinations of subgrid physics modules: ramses has AGN feedback but NO supernova feedback; G3-PESPH does not explicitly include AGN feedback but does have additional quenching for massive galaxies. Some codes also have full physics variants, most notably Arepo, which has a model without AGN physics.

Data

The cluster we have used for the nIFTy comparison was drawn from the [\cite=sembolini2013a] [\cite=sembolini2014a] [\cite=biffi2014a], which consists of a mass limited sample of re-simulated haloes selected from the MultiDark cosmological simulation [\cite=riebe2013]. The MultiDark run simulated a 1 Gpc/ h volume with 20483 dark matter particles in a (h,Ωm,Ωb,ΩΛ,σ8,ns) = (0.7,0.27,0.0469,0.73,0.82,0.95) cosmology based on the best-fit parameters to WMAP7+BAO+SNI data [\cite=jarosik2011] using ART [\cite=art] and the data is accessible online via the .

The G3-Music-2 cluster catalogue was constructed by selecting all the objects with masses [formula] at z = 0. These objects were then resimulated with 8 times better mass resolution using the zooming technique described in [\cite=klypin2001]. We focus on one cluster in particular, a moderately unrelaxed object with a mass of [formula]. The mass resolution of the nIFTy cluster in the pure dark matter simulations is [formula], and in the gas physics runs, [formula] & [formula]. Several sets of these simulations were produced by each code. Here we focus on the so-called aligned runs, which is the set of simulations that result in approximately the same gravitational accuracy for those codes that have produced full physics runs, i.e., radiative subgrid physics modelling the formation of stars (and possibly black holes).

Analysis

The output produced by the codes was all analysed using a unified pipeline. Haloes and subhaloes were identified and their properties calculated using VELOCIraptor [\cite=elahi2011]. This code first identifies haloes using a 3DFOF algorithm [\cite=fof] and then identifies substructures using a phase-space FOF algorithm on particles that appear to be dynamically distinct from the mean halo background, i.e. particles which have a local velocity distribution that differs significantly from the mean, i.e. smooth background halo. Since this approach is capable of not only finding subhaloes, but also tidal streams surrounding subhaloes as well as tidal streams from completely disrupted subhaloes [\cite=elahi2013a], for this analysis we also ensure that a group is self-bound. Bound baryonic content of dark matter subhaloes is determined by associating gas and star particles with the closest dark matter particle in phase space belonging to a (sub)halo [\cite=knebe2013a]. The internal self-energy of the gas is take into account when determining whether these particles are bound. If we were interested in identifying gas outflows from galaxies, we could relax this condition but for the purposes of this study, we require particles to be strictly bound. Galaxies are defined as any self-bound structure that contains 10 or more star particles, although for the purposes of this study we are generally interested in galaxies containing more than 100 star particles. We have not searched for self-bound star particle groups containing no dark matter, which are generally not produced by any of the codes, nor have we decomposed the stellar structures to search for bulges and discs.

To match (sub)haloes across codes, we used the halo merger tree code which is part of the VELOCIraptor package [\cite=srisawat2013]. This code is a particle correlator and relies on particle IDs being continuous across the simulations and time. As continuity of particle IDs is only guaranteed for dark matter N-body particles, we limit our cross-matching to only these particles. This means that in principle it is possible to have a gas or stellar "galaxy", whose dark matter halo has been mostly stripped away, i.e., baryon dominated, appear to have no analogue in another catalogue. However, the likelihood of such a circumstance for a well resolved self-bound object is negligible. The cross-matching between catalogue A & B is done by identifying for each object in catalogue A the object in catalogue B that maximises the merit function:

[formula]

where [formula] is the number of particles shared between objects i and j and NAi and NBj are the total number of particles in the corresponding object in catalogues A and B, respectively. Here we use [formula], which has been shown to be a reasonable threshold in previous studies [\cite=libeskind2011]. We arbitrarily use G3-Music as our reference catalogue.

The subhalo/galaxy population

We begin with the simplest comparison, the total number of (sub)haloes/galaxies within 2 ~  h- 1Mpc of the cluster's centre is listed in Table [\ref=tab:nsubs] for each type of simulation, dark matter only (DM), non-radiative (NR) and full physics (FP) runs. When comparing the number of subhaloes, we could of course use the virial radius, Rc200, which is [formula] for all the simulations ( G3-Music has Rc200 = 1.69 h- 1Mpc). However, since this radius does change from one simulation to the next by a few percent, for simplicity we fix the radial cut to 2 ~  h- 1Mpc.

We see that for the DM run, most codes have the same number of subhaloes, within the Poisson errors. This pattern is also observed in the non-radiative simulations. Arepo, the moving mesh code, is a moderate outlier. The main outlier is the sole adaptive mesh code, ramses, which has 20% fewer dark matter subhaloes in the DM run. This number drops by [formula] going from DM→  NR for ramses ( Arepo), whereas in most SPH codes it decreases by only [formula]. The SPH outlier is G2-X, a classic SPH code, where the number of subhaloes decreases by 25%.

The picture as always is more complex with the addition of radiative physics. Recall that certain codes, G3-Music, Arepo, and G2-X have more than one flavour of full physics runs. In almost all cases, going from NR→  FP, i.e., including cooling and feedback processes, increases the number of subhaloes. Most SPH codes have even more in the FP runs than in the DM, the notable exception being G3-Magneticum and G2-X, which behave similarly to Arepo and ramses.

The diversity in the number of subhaloes in the full physics runs is mirrored by the galaxy population. Most codes result in the cluster containing on the order of 200 galaxies, though this number ranges from 16 to 325. As our synthetic cluster is of similar to the Virgo cluster one would expect [formula] massive galaxies (stellar masses [formula]), although the total number of cluster members is [formula] [\cite=boselli2014a]. Caution should be used when directly comparing numbers is given the likely differences in merger histories between Virgo and our synthetic cluster and the complexity of estimating stellar masses from observations but we should expect similar numbers of galaxies. Typically most codes produce more galaxies than one might naively expect. The two codes that stand out are the mesh codes, which have far fewer galaxies (and subhaloes) than the SPH codes. ramses has the fewest subhaloes and startlingly few galaxies, by far the lowest of any of the codes. Arepo (Illustris physics) also has few galaxies, similar to that observed in Virgo, and a low fraction of subhaloes hosting galaxies. Its variant, Arepo-SH has numbers similar to the SPH codes. Amongst the SPH codes, G3-Magneticum has the smallest galaxy population and a low galaxy occupation fraction of [formula]. Other codes, like G3-Music & G3-OWLS have occupation fractions of [formula] and between [formula] galaxies.

Perhaps the most relevant change to note is that due to different flavours of subgrid physics. The Arepo-SH simulation, which has the same subgrid physics as G3-Music, has a moderate change in the number of subhaloes but an enormous change in the galaxy population compared to Arepo. The G3-Music variant shows little change in the number.

Subhaloes

We next examine the cumulative mass and maximum circular velocity distributions shown in Fig. [\ref=fig:massdistrib] & [\ref=fig:vmaxdistrib], with the lower panels showing the ratio of distributions relative to the reference G3-Music catalogue. The mass distribution shows all codes produce similar DM results. The only noticeable feature is the lack of small subhaloes in ramses, which matches the other codes reasonably well for subhaloes composed of [formula] particles. The overall scatter for all codes using the Gadget Tree-PM gravity solver is [formula]. The excess at [formula] is due to our reference catalogue and our radial cut. These "missing" (sub)haloes causing this bump lie outside our radial cut in the G3-Music catalogue and happen to have slightly higher masses in ramses.

The general picture becomes worse with the inclusion of gas, although not significantly so despite the variety of approaches modelling gas. The scatter is typically [formula]. The key feature is that mesh codes, particularly ramses, have fewer objects. However, these codes do not exhibit the precisely the same behaviour: Arepo has fewer low mass, poorly resolved objects, whereas ramses actually has a slightly flatter mass distribution across a wide range of masses. This lack of subhaloes in ramses is likely related to the known issue of lower small-scale power found in ramses compared to Gadget at z > 1 where these objects should form [\cite=schneider2015a].

Including radiative physics increases the scatter to [formula] for masses [formula], although the form of the mass function is generally unchanged. The codes that bracket the overall variation are the G3-Music variant and ramses.

The maximum circular velocity is less affected by tidal forces and differences in the position of a given subhalo relative to the host but is sensitive to changes in the central concentration of subhaloes [\cite=onions2013a]. Therefore, we might expect less scatter arising from differences in the position of a subhalo and see biases in the central concentration that would not be evident in the mass distribution for well resolved haloes where V max can be accurately measured. Like the mass distribution, the DM simulations agree with one another if one accounts for the difference in normalisation, i.e., the residuals are flat. The non-radiative simulations also have little code-to-code scatter, with two exceptions. Both ramses & Arepo have fewer subhaloes low V max subhaloes and ramses has also flatter slopes (the residuals have a slight tilt).

Feedback physics causes the V max variation to be more pronounced than that seen in the mass. This variation is a result of appreciable amounts of baryons being moved around by the different cooling and feedback physics included by each code. G3-Music subhaloes have higher circular velocities, whereas most other codes have steeper slopes with more low V max subhaloes. It is worth noting that Arepo-SH, the variant not including AGN feedback (dashed lines), not only contains many more galaxies (see Table [\ref=tab:nsubs]) but also contains subhaloes with high V max.

We examine the radial distribution via the enclosed number density n(rS < R) in Fig. [\ref=fig:raddistrib], where rS is the radial distance a subhalo is from the cluster centre and R is the radial distance cut. For all simulation types, almost all codes produce the same overall shape, i.e., the residuals are flat though the normalisation varies. Only in the very outskirts are differences apparent, with G3-Music having the highest n(rS < R) in the DM run. This is not unexpected given that the DM profiles of the overall cluster agree to within [formula]. The major jumps in the residuals seen in the core region are a result of differences in the positions of the few subhaloes identified deep within the host. The exception is ramses, which only has relatively flat residuals in the DM run and only within 0.75 h- 1Mpc of the centre.

Baryons

Here we focus on the baryonic component and the changes in the subhalo population resulting from the inclusion of adiabatic and full physics. Gas cooling can contract the core of a field dark matter halo [\cite=gnedin2004], though the effect on a subhalo in the hot cluster environment is not as clear cut. Stripping of cold, low entropy gas contained in a subhalo as it falls into the cluster environment can counter adiabatic contraction. Codes treat mixing of low entropy gas differently, and consequently, the concentration of subhaloes should differ.

We highlight the differences in the V max distribution between the runs in Fig. [\ref=fig:vmaxcompdistrib]. The ratio between NR & DM has a noticeable tilt for haloes with [formula] km/s for the SPH simulations, with the two mesh codes, ramses & Arepo, having less pronounced tilts. Adiabatic physics results in fewer subhaloes, less centrally concentrated subhaloes, increasing the number of low V max subhaloes over high V max subhaloes due to the efficient stripping of gas from small subhaloes.

Radiative physics allows gas to cool and contract, centrally concentrating material and forming galaxies, although this can be completely counteracted by feedback physics [\cite=abadi2010] [\cite=dicintio2011]. The middle and bottom panels of Fig. [\ref=fig:vmaxcompdistrib], show that, for SPH codes, cooling and feedback physics has counteracted the expansion of subhaloes arising in the adiabatic runs, with G3-Magneticum and both G3-Music variants experiencing the largest change. Interestingly, the residual for ramses & Arepo with AGN feedback are flat, i.e., feedback processes have balanced the contraction due to cooling, leaving haloes relatively unchanged from how they appear in pure DM simulations. Without AGN feedback, Arepo-SH, produces more high-V max subhaloes in line with the changes seen in G3-Music.

The radial distribution shown in Fig. [\ref=fig:radcompdistrib] is not significantly affected by additional physics except in the very centre. The inclusion of gas increases the number density within 500 ~  h- 1kpc. This very central concentration is removed going from NR to FP, although full physics runs are still centrally biased compared to pure DM simulations, in agreement with [\cite=libeskind2010]. Only ramses appears to have flat residuals.

We next examine baryon fractions in Fig. [\ref=fig:baryonfracdistrib], where we show fb of all objects containing some amount of bound gas or stars. Focusing on the non-radiative simulations, the first notable feature is that the peak of the fb distribution is significantly less that Ωb  /  Ωm, the cosmic baryon fraction (solid vertical line). The hot cluster environment efficiently strips baryons away from subhaloes. Most codes have the same overall shape, a lognormal centred on [formula]. ramses may be an exception as it is not as strongly peaked as the other codes. There is also the suggestion of a second peak around the cosmic baryon fraction. These two distributions arise from galaxies that have resided in the cluster environment and newly infalling galaxies that have yet to be stripped, of which there are few within 2 h- 1Mpc.

The bottom two panels of Fig. [\ref=fig:baryonfracdistrib] shows that gas cooling and star formation allows subhaloes to retain significantly higher baryon fractions in the cluster environment. There are even a few subhaloes with fb  >  Ωb  /  Ωm. These are typically undergoing some tidal disruption, which has momentarily increased fb. Key is the increase in the code-to-code scatter. Arepo peaks and plateaus at [formula], whereas most SPH codes have peaks at Ωb  /  Ωm, indicating Arepo's feedback processes are stronger and/or more efficient in moving material out of host subhalo. ramses is even more extreme, containing no subhaloes with fb close to the cosmic baryon fraction. Interestingly, G2-X has a broad baryon fraction distribution, with a less noticeable peak at Ωb  /  Ωm.

Figure [\ref=fig:baryonfracdistrib] showed that in non-radiative simulations, regardless of code, few subhaloes retain their gas (baryons) in the cluster environment. In Fig. [\ref=fig:gasfracmass] we show the gas fraction, fg, versus subhalo mass of all objects with non-negligible amounts in the upper subpanel and in the lower subpanel the probability that a subhalo of a given mass retains negligible amounts of gas (here we use fb < 10- 2 based on Fig. [\ref=fig:baryonfracdistrib]). Reassuringly, most NR simulations produce similar distributions in the mass of subhaloes which are unable to retain significant gas fractions. Only subhaloes with [formula] or [formula] times the host cluster mass retain some gas. Note that both mesh codes are more likely to have massive gas poor subhaloes than SPH codes with ramses again being an outlier.

Code variations are also seen on an individual object basis. The most massive subhalo shown here has recently entered the cluster environment and consequently has fb  ≈  Ωb  /  Ωm in all NR runs. However, the second largest subhalo, which lies closer to the cluster centre, has been completely stripped in the mesh or new SPH codes (open points), but retains some gas in the more classic SPH codes. This hint of bimodality between codes is not too surprising considering studies of mesh and SPH codes using the blob test show that SPH codes increase the survival time of dense gas clumps exposed to a shock front or hot environment as a result of the artificially suppressed mixing present in the classic SPH formalism [\cite=tasker2008]. Generally ramses & Arepo have smaller fb than classic SPH codes, which is consistent with the quicker gas depletion of substructures found in Arepo compared to Gadget [\cite=sijacki2012a].

We should note that ramses has a few very low mass subhaloes with non-negligible gas fractions. These subhaloes reside at radii of [formula] outside the hot cluster environment. The reason for this population is partially due to ramses's adaptive mesh, which is able to follow much smaller parcels of gas.

The lower two panels of Fig. [\ref=fig:gasfracmass] show that radiative physics changes the picture. Across all codes, only objects with [formula] are now devoid of gas, stripped by the combination of the cluster environment and internal feedback processes. The notable exception is ramses, which has a peak at much higher masses. This peak is partially a statistical fluke, there are only three subhaloes in this mass range and they have all been stripped of gas. In general, the probability of being gas poor monotonically decreases with increasing mass, with Arepo and particularly ramses having higher likelihoods than the other codes and G3-Magneticum and G3-X-Art having the lowest.

Galaxies

Hydrodynamical codes typically seek to reproduce the observed galaxy population, hence the first comparison to be made is the resulting stellar mass function of galaxies. However, as is evident from Table [\ref=tab:nsubs], different codes result in significantly different number of galaxies. Therefore we examine both the galaxy stellar mass function (GSMF) and the normalised one, i.e., the probability of a galaxy having a stellar mass within a specific range, in Fig. [\ref=fig:stellarmassfunction]. Note that we do not compare our GSMF to observations as there appears to be significant cluster-to-cluster variation [\cite=boselli2011a].

The stellar mass function shows large code-to-code scatter both for small and large galaxies, even when the differences in normalisation are removed. Even the brightest central galaxy (BCG, including the intracluster light) differs by a factor of [formula]. The two mesh codes with AGN feedback, ramses & Arepo, produce the smallest BCG and Arepo-SH  without AGN feedback produces the largest BCG. In fact, ramses severely stunts the growth to [formula], a factor of 10 times less massive than the next smallest BCG. Amongst the SPH codes, G3-Music and G3-OWLS produce the largest, G3-X-Art and G3-PESPH the smallest, differing by a factor of [formula].

This diversity is not simply due to different formulations of SPH or mesh codes evolving gas, the building blocks of stars, differently. For instance, the probability and number of low mass galaxies in G2-X & G3-Music differ by [formula] for [formula], with G2-X having more. G3-Music has much larger galaxies than G2-X. This is in spite of the fact that both use standard SPH; the differences lie in the subgrid physics. That is not to say that all codes disagree. G3-Music and G2-X have monotonically decreasing stellar mass functions above masses of [formula]. Other codes typically produce stellar mass functions that are strongly suppressed for [formula], with G3-Magneticum showing the strongest suppression. However, this turn over likely arises partially due to resolution effects and not solely due to SN feedback, as indicated by the fact that it occurs for masses corresponding to less than 100 star particles.

We can see the effects of different subgrid physics by looking at Arepo and Arepo-SH, that is galaxies produced including/ignoring AGN physics. With the modified subgrid physics (specifically the lack of AGN feedback), Arepo-SH is able to reproduce the BCG seen in G3-Music and also has similar numbers of massive galaxies. In fact, it is more biased towards massive galaxies than G3-Music. AGN physics is, however, not a precise dividing line between codes. G3-PESPH, which does not included AGN feedback but has a modified SN feedback, has a BCG similar to G2-X and GSMF similar to G3-OWLS, AGN SPH codes.

The interplay between gas cooling and feedback is what transforms the (sub)halo mass function (Fig. [\ref=fig:massdistrib]) to the GSMF (Fig. [\ref=fig:stellarmassfunction]). In small haloes, supernova (SN) feedback should blow out gas from small haloes, whereas star formation is suppressed in larger haloes by the energy injected into the surroundings by the supermassive black hole (AGN) residing in the (sub)halo centre. Despite the fact that subgrid physics in each code attempts to model these processes, the stellar mass to host halo mass relation, seen in Fig. [\ref=fig:stellarhalorelation], has large code-to-code scatter. Most codes have the same overall shape: M* / Mh decreases with increasing halo mass, with plateaus for [formula] and [formula]. However, G3-Music (and G3-MusicPi & Arepo-SH) has an almost constant average M* / Mh relation and the efficiency of star formation only seems to gradually decrease for much larger host haloes. Even for codes with similar M* / Mh shapes, the actual average M* / Mh for a given halo mass can vary by a factor of [formula]. For instance, galaxies in G2-X are far more dark matter dominated that those in G3-OWLS.

Finally we examine how well a common observational relation is reproduced, the Tully-Fisher/Faber-Jackson relations in Fig. [\ref=fig:tullyfisher]. Here we limit ourselves to a simple comparison, the maximum circular velocity as a function of stellar mass. We find that in contrast to the diversity seen in the other relations, there is little code-to-code scatter in the average relation. A galaxy with a mass M* will on average reside in a similar potential well [formula] regardless of code but the total mass associated with and size of that potential will vary from code-to-code. The only code that truly not follow the same slope and amplitude is ramses, where galaxies reside in far more massive subhaloes. G3-Magneticum and Arepo also have low mass galaxies residing in larger hosts than other codes, although to a lesser extent than ramses.

The relation produced by hydrodynamical codes differs from the observed relations shown in this figure, however, this is not completely unexpected given the environment probed here, a high density cluster. Observations typically stack galaxies from a wide variety of environments. Furthermore, we have not split our galaxies into morphological types and estimated rotational or dispersive velocities from line-of-sight measurements within some radius, necessary if we wish to compare directly to observations. Overall, codes only differ from the observed relation significantly at high stellar masses. Only the BCGs lie off the observed trend, however, as these galaxies lie at the centre of the cluster, V max no longer probes the central galaxy but the overall cluster potential.

One-to-one comparisons

Section [\ref=sec:subhalopop] shows most codes reproduce the same bulk distribution when running DM or NR simulations. The question is whether this agreement masks a variation in an individual object's properties. The properties of an individual object that has experienced the same mass accretion history and dynamical environment should be the same. A quick glance at the previous section shows that all the codes reproduce the same large subhalo in terms of total mass. This subhalo is somewhat unique in that is has only been recently accreted around [formula] and lies at the outer edge of the cluster environment. The second most massive subhalo, which has resided for a longer period of time in the cluster environment, shows larger code-to-code variation. Here we expand this line of comparison and search for counterparts between the subhalo catalogues produced by different simulation codes and compare their properties. To simplify matters, we again use the G3-Music catalogue as our reference, though any one could be used.

Before we compare properties, it is important to check whether this is a viable exercise by identifying subhaloes for which no counterpart is found. Recall that a counterpart is one which satisfies Eq. ([\ref=eqn:merit]) with a merit of 0.2. If there are numerous missing subhaloes, then comparing individual objects is not informative as the codes have produced clusters with wildly different internal structures. We compare catalogues in Fig. [\ref=fig:crosscat], where we plot for every subhalo identified in the G3-Music catalogue, the number of particles in a subhalo, its radial distance from the cluster centre, and the fraction of other catalogues this subhalo exists in. Gray diamonds are subhaloes identified in all catalogues, black circles missing in all other catalogues, and coloured squares for subhaloes identified in some catalogues.

If we pay particular attention to the subhaloes for which no counterpart is found, it is reassuring to know that most are composed of significantly less than 100 particles. Most large subhaloes, those composed of [formula] particles, are present in all simulations, with a few interesting exceptions. The large subhalo identified in the DM- G3-Music catalogue composed of [formula] particles at a radius of 1500 ~  h- 1kpc is merging with the largest subhalo, also at 1500 ~  h- 1kpc. Matches are identified in other catalogues but are not above the merit threshold used. This also applies for the object in the FP- G3-Music catalogue. Similarly, the subhaloes in the NR- G3-Music catalogue located at very small radii have matches but these less than ideal matches are due to the difficulty of identifying subhaloes residing within the central regions of the halo hosts. Small differences in orbits will mean in some codes, different portions of the subhalo remain self-bound and are identified.

Given that [formula] of the subhalo population is "missing" in the three types of simulations, one-to-one comparison of well-resolved subhaloes is meaningful. From here on, we will restrain our comparison to subhaloes composed of [formula] particles in both catalogues. This limits our comparison to [formula], [formula], and [formula] objects in the DM, NR & FP simulations respectively.

Mass Proxies

Figure [\ref=fig:massvmaxcomp] shows the distribution of the ratio of a subhalo's bound mass and maximum circular velocity in one simulation to its counterpart in the G3-Music catalogue for all well resolved ([formula]) subhaloes. For almost all codes, the DM & NR runs have a ratio that follows a lognormal distribution. The typical variation is [formula]. The V max distribution has a smaller scatter, [formula], not surprising since the central region usually defining V max is less effected by the tidal field of the cluster. The fact that all catalogues have similar variation suggests that this scatter is probably dominated by the differences in the exact orbits these subhaloes have taken in the highly nonlinear cluster environment, rather than different hydrodynamical implementations. The main outlier is ramses, which primarily differs in the NR simulations. ramses produces smaller, less centrally concentrated subhaloes which are more susceptible to tidal disruption, hence the reason it has fewer subhaloes (see Table [\ref=tab:nsubs]).

Given the differences seen in Fig. [\ref=fig:vmaxdistrib] for the FP simulations, it is not surprising that even for subhaloes with a well defined counterpart in the G3-Music simulation, the ratio of V max shows systematic differences and vary greatly between codes. Feedback physics moves material out of cores of subhaloes, changing their circular velocity profiles significantly. What is somewhat unexpected is the variation in the mass. G3-Music typically has more massive subhaloes than the other codes and there is a great deal of variation which is not that readily apparent from Fig. [\ref=fig:massdistrib].

Baryons

We compare baryon fractions in Fig. [\ref=fig:baryoncomp]. When comparing the baryonic content of individual objects we must account for the possibility that either the subhalo or its counterpart has been completely stripped of baryonic material, resulting in a ratio fb,i / fb,ref that spans (0,  ∞  ). Therefore, we have binned objects where fb,i  ≤  0.1fb,ref and fb,i  ≥  10fb,ref separately in this figure. The non-radiative simulations have another issue: few objects contain non-negligible baryon fractions. For all the codes, [formula] of the cross matched subhaloes have [formula] in both catalogue. We ignore these stripped objects when comparing the ratio of the baryon fraction in Fig. [\ref=fig:baryoncomp].

The first noticeable feature in the NR simulations is that for most codes there are two significant populations, the largest centred at [formula]. The major difference between codes lie which outlying bin contains a significant population. Subhaloes in Arepo are more likely to have been stripped of their gas relative to G3-Music. Conversely, most other codes are systematically less stripped, with G2-X and G3-X-Art, a classic SPH and modern SPH code, having the largest systematic offset. Interestingly, ramses shows little bias in either direction.

In the FP runs, it appears that G3-Music (and G3-MusicPi) is the outlier, with subhaloes having higher baryon fractions. Arepo-SH is the only other code with counterparts having similar baryon fractions. ramses, Arepo and G2-X (both variants) have subhaloes biased to low fb. The question is whether G3-Music's high baryon fractions are a consequence of it efficiently converting gas into stars, which are not subject to ram pressure or shocks, or whether these baryon rich objects have simply managed to retain gas in instances where other codes have been stripped. Or perhaps the counterpart is more massive and therefore able to better hold onto its baryons. A closer examination of these objects reveal that their G3-Music counterparts typically have the same mass (within 20%) and contain both galaxies that have been stripped of or blown out all their gas and those that still have large reservoirs of fuel with which to form stars. Some of these galaxies even have gas fractions as high as [formula].

If we then focus on galaxies and their counterparts, we see in Fig. [\ref=fig:stellarmasscomp] significant systematic differences between codes in the stellar mass. Arepo typically not only has galaxies that are an order of magnitude less massive, it has a significant population of empty subhaloes whose G3-Music counterparts do host a galaxy. ramses is even more extreme. However, these are exceptions. Clearly for well resolved subhaloes composed of [formula] particles, if a galaxy is present in one code, it is present in another. The difference lies in the size. Typically codes have less massive galaxies than G3-Music, the exception being Arepo-SH, which lacks AGN, and G3-MusicPi. AGN feedback is not the sole reason for the difference as G3-PESPH (no AGN) has smaller galaxies than G3-OWLS, which does have AGN feedback.

Galaxy/Subhalo Diversity

We summarise the differences between subhaloes in a given simulation and their G3-Music counterparts in Fig. [\ref=fig:summarycomp]. The logarithmic ratio, log (xi / xMUSIC), is typically well characterised by a normal distribution in the DM & NR runs but the distribution can have significant tails in the FP runs (see Fig. [\ref=fig:massvmaxcomp]). Thus, we determine the median (μ) and 0.16 & 0.84 quantiles to calculate an effective standard deviation. Note that here when comparing baryonic masses (and related quantities) we require that either the object or its reference counterpart have non-negligible amounts of gas/stars (depending on the comparison being made). For more complex properties such as spin, both must have non-negligible amounts.

First, examining the bulk subhalo properties in the DM runs, we see here that the mass and V max are well reproduced so long as radiative physics is not included. There is not significant systematic difference between codes and little scatter, with V max varying by [formula]. The velocity dispersion and RV max are numerically converged for the non-full physics runs, with SD[formula] dex. Angular momentum based quantities show large variations of up to 1 ~ dex, primarily as j is affected by distant, marginally bound particles, and small differences in the exact position of a subhalo in one simulation to another will significantly contribute to the scatter. ramses is the only code to show some systematic offset, having subhaloes with marginally high spins.

We next present the NR runs. The subhalo properties are almost as well converged as those in the DM runs, with ramses the only code with some systematic differences, producing smaller, less concentrated subhaloes. The NR-gas panel of Fig. [\ref=fig:summarycomp] shows that the gas distribution is less numerically converged, particularly the amount of gas, with an average variation of 0.25 dex. Some codes show greater code-to-code scatter of [formula] dex ( G3-X-Art, G2-X, G3-OWLS). Most codes typically have more gas than G3-Music. Interestingly, the gas temperature shows less scatter than the mass but the systematic differences between codes are more pronounced. The temperature bias does not appear to depend purely on numerical implementation as ramses & G3-X-Art, two very different codes have higher temperatures. However, we do find that both mesh codes have higher angular momentum gas than SPH codes.

However, it is important to recall that the number of subhaloes with gas is small, so the μ and SD estimators suffer from small number statistics. Additionally, the Mg & fg ratios have a bimodal distribution since a subhalo can retain gas in one code but have been completely stripped in another. As we have used quantiles to estimate the mean and standard deviation, these subhaloes do not drastically skew these estimates (we treat them as containing one gas particle for the purposes of mass comparisons) and excluded when comparing other properties. Generally, [formula] of subhaloes fall into this category, therefore the systematic differences and variance presented here are underestimates but the general features will not change.

In the full physics runs seen in Fig. [\ref=fig:summarycomp2], the scatter in the bulk properties of the galaxy/(sub)halo host have increased by [formula] dex for V max and M respectively. However, systematic differences are becoming noticeable, with V max in ramses & Arepo being lower by [formula] dex. The amount of gas has similarly increased scatter along with systematic differences. Both mesh codes differ significantly from the SPH results, being more gas poor by a factor of 2 for Arepo and up to an order of magnitude for ramses. The scatter is also very high at [formula] dex, whereas the SPH codes show [formula] dex scatter.

The galaxies stellar content shows a minimum of [formula] dex scatter. More importantly, codes typically produce less massive galaxies than G3-Music, with the two mesh codes with AGN being the most extreme. Arepo's galaxies are 1 dex smaller. ramses's galaxies are 2.4 dex smaller (this lies off the figure) and has SD= 0.43. Only G3-OWLS, Arepo-SH and the G3-Music variant itself produce similar galaxies to G3-Music. The stellar angular momentum shows large code-to-code variation and scatter. For example Arepo, G3-OWLS and G2-X galaxies relative to G3-Music are more rotationally supported. The sole well resolved ramses galaxy is also biased high. The other codes show that the overall picture is mixed as codes with/without AGN and modern and classic SPH codes have stellar distributions with similar angular momentum as G3-Music.

Discussion & Conclusion

Hydrodynamical codes, regardless of specific numerical approach used, attempt to model (some of) the complex processes involved in forming a galaxy. In this paper, we have assessed how well hydrodynamic codes reproduce the same subhaloes and galaxies in a cluster environment using the nIFTy cluster data set. To address this goal, we have compared both the overall distribution of subhaloes and galaxies and compared individual objects.

We find that in DM only and non-radiative simulations, codes show 5 - 10% scatter in the dark matter subhalo population and even on an individual object basis the scatter is only 0.1 dex for properties like V max and mass. This is unsurprising considering the small amount of scatter in the dark matter distribution observed in [\cite=nifty1].

The differences lie in the baryonic component. In [\cite=nifty1] we found that even in NR runs, the gas entropy and density profiles of the cluster differed significantly from code-to-code, with mesh and modern SPH codes producing entropy cores whereas classic SPH codes produced ever falling entropy profiles. Here we find that individual subhaloes show large variation in the baryonic fraction depending on the code used. The scatter is 0.2 - 0.5 dex despite the overall similarity between codes in the likelihood of a subhalo being baryon poor. However, subhaloes do not show a strong separation between classic SPH and other codes.

The key result of this paper is that codes produce different galaxy populations and that the diversity is significant, despite all codes approaching galaxy formation in a similar fashion. Codes convert gas particles or cells into a "star" particle when some criterion is satisfied, typically if a converging flow of gaseous material has high enough local densities and able to cool. This newly formed particle represents a star cluster, the basic galaxy building block. Star particles feed energy and metals back into the local environment. The issue is that these processes occur at unresolved scales, thus each code uses their own subgrid modules to model this complex process. Add to this mix, supermassive black holes, their growth by accretion and the associated injection of energy via AGN. Some codes include AGN feedback, some do not. Considering the variety of subgrid physics, some diversity is to be expected but perhaps not to the extent seen here. Even the bulk gas and stellar fractions of the entire cluster show marked differences, with gas and stellar fractions ranging from [formula] & [formula] respectively [\cite=nifty2].

We find that the number of galaxies of a given stellar mass can vary by a factor of 4 in the cluster environment. The exception is ramses, which severely suppresses galaxy formation inside clusters, producing a paltry number of galaxies despite having no supernova feedback. Among the other codes, Arepo produces the fewest, followed by G3-Magneticum, whereas G3-Music & G3-OWLS produce the most.

Not only do the number of galaxies differ, codes do not produce the same stellar mass to halo mass relation. Codes with AGN physics have massive galaxies with much lower M* / Mh, yet some have higher M* / Mh values than G3-Music for the lowest mass galaxies resolved here. Despite all this variety, codes generally produce the same effective baryonic Tully-Fisher (Faber-Jackson) relation, i.e., M*-V max relation, indicating that observations like those of [\cite=bell2001] [\cite=reyes2011] has limited use in pinning subgrid physics.

By comparing well resolved individual objects between codes, we find that if a subhalo hosts a galaxy in one code, generally it will host a galaxy in other codes. The exceptions are the two mesh codes that include AGN, ramses & Arepo, which have the lowest star formation efficiencies. Of greater importance is that this synthetic galaxy will not have the same stellar mass across codes, despite having a similar merger and orbit history. First we note that galaxies show large scatter of [formula] dex in stellar mass, M* / Mh and stellar angular momentum. Second, there are significant systematic differences between codes. For example, galaxies in Arepo are [formula] dex less massive than those in G3-Music.

The variety in synthetic galaxies and input subgrid physics is telling. Some codes with similar subgrid schemes, such as G2-X & G3-OWLS, which have similar SF and AGN but different IMFs and SN feedback and significantly different cooling curves ( G2-X assumes solar metallacity), produce different numbers of galaxies. The number of galaxies here differ by 60%, and distributions like gas fractions and luminosity functions differ in shape. Changes in the cooling curve might account for some of these differences. Another example of similar codes is G3-X-Art & G3-Magneticum. These two modern SPH codes have the same SF, IMF, similar AGN and differ in the SPH conduction scheme and significantly in the SN feedback scheme ( G3-X-Art has kinetic SN, G3-Magneticum has both thermal and kinetic). Here the differences are more subtle: the GSMFs have similar shapes but G3-Magneticum has fewer low stellar mass galaxies likely due to stronger quenching from the addition of thermal SN feedback, resulting in G3-X-Art having 50% more galaxies with [formula].

Mesh codes at first glance are far less efficient than similar SPH codes at producing galaxies. Arepo has similar subgrid schemes to the modern SPH code G3-X-Art, yet has only 30% of the galaxies that G3-X-Art has. The galaxies in the Arepo cluster are more likely to be stripped of gas, have lower stellar masses and do not follow the same GSMF, although they have a similar mass BCG (including intracluster stars). Arepo also has galaxies with higher angular momentum than G3-X-Art. This higher angular momentum difference appears to hinge on the AGN feedback scheme. Arepo-SH, lacking AGN feedback, produces numbers much closer to that of G3-Music, the only code lacking AGN feedback. Moreover, the distributions and even individual galaxies themselves are similar, although G3-Music tends to produce a larger number of low stellar mass galaxies. The dependence of subgrid physics on the method used to evolve gas has been noted for the subgrid physics implemented [\cite=schaye2015a] [\cite=schaller2015a].

Many numerical studies show AGN feedback can play an important role (e.g. [\citealp=puchwein2010] [\citealp=mccarthy2010a] [\citealp=teyssier2011] [\citealp=cui2014a], although observational evidence may not be as clear cut, see [\citealp=schawinski2014a]). However, the galaxy diversity seen between our suite of codes tells us that differences do not solely arise from the inclusion of AGN feedback. G3-OWLS, which has AGN, has similar mass galaxies to G3-Music. Conversely, G3-PESPH produces systematically lower mass galaxies than G3-OWLS yet it does not include AGN, although the use of a quenching model for massive galaxies in G3-PESPH might mimic the statistical suppression of star formation that AGN have.

In general, codes that reproduce the observed galaxy population in some respects, such as the luminosity function, in certain environments will need to be adjusted to reproduce galaxies in another environment. Therefore, subgrid physics as it stands is fine-tuned. The fact that subgrid physics requires tuning has been noted before [\cite=haas2013a] [\cite=haas2013b] [\cite=lebrun2014a] [\cite=schaye2015a] [\cite=crain2015a]. However, the similarity of galaxies produced by codes with different subgrid physics and differences between codes with similar schemes implies the diversity and similarity is not solely a matter of fine-tuning a particular subgrid scheme. Rather current subgrid physics schemes does not fully capture the real processes governing galaxies.

In conclusion, our comparison suggests that the properties of any individual synthetic galaxy should be treated with errors bars of at least [formula] dex.

Acknowledgements

The authors thank Joop Schaye for insightful comments. The authors also express special thanks to the Instituto de Fisica Teorica (IFT-UAM/CSIC in Madrid) for its hospitality and support, via the Centro de Excelencia Severo Ochoa Program under Grant No. SEV-2012-0249, during the three week workshop "nIFTy Cosmology" where this work developed. We further acknowledge the financial support of the University of Western 2014 Australia Research Collaboration Award for ”Fast Approximate Synthetic Universes for the SKA”, the ARC Centre of Excellence for All Sky Astrophysics (CAASTRO) grant number CE110001020, and the two ARC Discovery Projects DP130100117 and DP140100198. We also recognize support from the Universidad Autonoma de Madrid (UAM) for the workshop infrastructure.

PJE is supported by the SSimPL programme and the Sydney Institute for Astronomy (SIfA), and Australian Research Council (ARC) grants DP130100117 and DP140100198. STK acknowledges support from STFC through grant ST/L000768/1. AK is supported by the Ministerio de Economa y Competitividad (MINECO) in Spain through grant AYA2012-31101 as well as the Consolider-Ingenio 2010 Programme of the Spanish Ministerio de Ciencia e Innovación (MICINN) under grant MultiDark CSD2009-00064. He also acknowledges support from the Australian Research Council (ARC) grants DP130100117 and DP140100198. He further thanks The Feelies for crazy rhythms. CP acknowledges support of the Australian Research Council (ARC) through Future Fellowship FT130100041 and Discovery Project DP140100198. WC and CP acknowledge support of ARC DP130100117. GY and FS acknowledge support from MINECO (Spain) through the grant AYA 2012-31101. GY thanks also the Red Española de Supercomputacion for granting the computing time in the Marenostrum Supercomputer at BSC, where all the MUSIC simulations have been performed. AMB is supported by the DFG Research Unit 1254 "Magnetisation of interstellar and intergalactic media" and by the DFG Cluster of Excellence "Universe". SB & GM acknowledge support from the PRIN-MIUR 2012 Grant "The Evolution of Cosmic Baryons" funded by the Italian Minister of University and Research, by the PRIN-INAF 2012 Grant "Multi-scale Simulations of Cosmic Structures", by the INFN INDARK Grant and by the "Consorzio per la Fisica di Trieste". IGM acknowledges support from a STFC Advanced Fellowship. EP acknowledges support by the ERC grant "The Emergence of Structure during the epoch of Reionization". JS acknowledges support from the European Research Council under the European Unions Seventh Framework Programme (FP7/2007-2013)/ERC grant agreement 278594-GasAroundGalaxies.

The authors contributed to this paper in the following ways: PJE organized and analysed the data, made the plots and wrote the paper. AK, GY & FRP organized the nIFTy workshop at which this program was completed. GY supplied the initial conditions. All the other authors, as listed in Section 2 performed the simulations using their codes. All authors have read and commented on the paper.

The simulations used for this paper have been run on a variety of supercomputers and are publicly available at the MUSIC website, . MUSIC simulations were carried out on Marenostrum. AREPO simulations were performed with resources awarded through STFCs DiRAC initiative. The authors thank Volker Springel for helpful discussions and for making AREPO and the original GADGET version available for this project. G3-PESPH Simulations were carried out using resources at the Center for High Performance Computing in Cape Town, South Africa.

This research has made use of NASA's Astrophysics Data System (ADS) and the arXiv preprint server.

Codes

Mesh-based Codes

AMR

RAMSES (Teyssier, Perret)

ramses is an adaptive mesh refinement code that uses a directionally unsplit, second order Godunov scheme with the HLLC Riemann solver to solve hydrodynamics and an adaptive particle mesh code to solve the Poisson equation. The grid is adaptively refined on a cell-by-cell basis, following a quasi-Lagrangian refinement strategy whereby a cell is refined into 8 smaller new cells if its dark matter or baryonic mass grows by more than a factor of eight. Time integration is performed using an adaptive, level-by-level, time stepping strategy.

Cooling & Heating: Gas cooling and heating is performed assuming coronal equilibrium with a modification of the [\cite=haardt1996] UV background and a self-shielding recipe based on [\cite=aubert2010]. Hydrogen and Helium cooling and heating processes are included following [\cite=katz1996], metal cooling follows [\cite=sutherland1993]. Here, the code also uses a temperature floor of 104 K to prevent spurious fragmentation of relatively poorly resolved galactic discs.

Star Formation: Star formation is implemented as a stochastic process using a local Schmidt law as in [\cite=rasera2006]. The density threshold for star formation was set to n* = 0.1H / cc, and the local star formation efficiency per gas free fall time was set to 5%.

Stellar Population Properties & Chemistry: Each star particle is treated as a single stellar population (SSP) with a [\cite=chabrier2003] IMF. Mass and metal return to the gas phase by core collapse supernovae only. A single average metallacity is followed during this process and advected in the gas as a passive scalar, to be used as an indicator of the gas metallicity in the cooling function.

Stellar Feedback: In this project, no feedback processes related to the stellar population are used.

SMBH Growth & AGN Feedback: SMBH particles are represented by sink particles [\cite=teyssier2011]. The SMBH accretion follows Bondi accretion with the rate constrained by the instantaneous Eddington limit. When the gas density is larger than the star formation density threshold the Bondi accretion rate is boosted [\cite=boothschaye2009]. SMBH particles are evolved using a direct gravity solver, to obtain a more accurate treatment of their orbital evolution. SMBH particles more massive than [formula] are allowed to merge if their relative velocity is smaller than their pair-wise scale velocity. Less massive SMBH particles, on the other hand, are merged as soon as they fall within 4 cells from another SMBH particle. The AGN feedback used is a simple thermal energy dump with 0.1c2 of specific energy, multiplied by the instantaneous SMBH accretion rate.

Moving Mesh

Arepo (Puchwein)

Arepo uses a Godunov scheme on an unstructured moving Voronoi mesh; mesh cells move (roughly) with the fluid. The main difference between Arepo and traditional Eulerian AMR codes (such as ) is that Arepo is almost Lagrangian and Galilean invariant by construction. The main difference between Arepo and SPH codes (see next subsection) is that the hydrodynamic equations are solved with a finite-volume Godunov scheme. The version of Arepo used in this study conserves total energy in the Godunov scheme, rather than the entropy-energy formalism described in [\cite=arepo]. Detailed descriptions of the galaxy formation models implemented in Arepo can be found in [\cite=vogelsberger2013] and [\cite=vogelsberger2014a], but the key features can be summarised as follows.

Cooling & Heating: Gas cooling takes the metal abundance into account. The metal cooling rate is computed for solar composition gas and scaled to the total metallicity of the cell. Photoionization and photoheating are followed based on the homogeneous UV background model of [\cite=fauchergiguere2009] and the self-shielding prescription of [\cite=rahmati2013]. In addition to the homogeneous UV background, the ionizing UV emission of nearby AGN is taken into account.

Star Formation: The formation of stars is followed with a multiphase model of the interstellar medium which is based on [\cite=springel2003] but includes a modified effective equation of state above the star formation threshold, i.e. above a hydrogen number density of [formula].

Stellar Population Properties & Chemistry: Each star particle is treated as a single stellar population (SSP) with a [\citet=chabrier2003] IMF. Mass and metal return to the gas phase by AGB stars, core collapse supernovae and Type Ia supernovae is taken into account. Nine elements are followed during this process (H, He, C, N, O, Ne, Mg, Si, Fe).

Stellar Feedback: Feedback by core collapse supernovae is implicitly invoked by the multiphase star formation model. In addition, we include a kinetic wind model in which the wind velocity scales with the local dark matter velocity dispersion ([formula]). The mass-loading is determined by the available energy which is assumed to be [formula] per core collapse supernova. Wind particles are decoupled from the hydrodynamics until they fall below a specific density threshold or exceed a maximum travel time. This ensures that they can escape form the dense interstellar medium.

SMBH Growth & AGN Feedback: SMBHs are treated as collisionless sink particles. [formula] BHs are seeded into haloes once they exceed a mass of [formula]. The BHs subsequently grow by Bondi-Hoyle accretion with a boost factor of α  =  100. The Eddington limit on the accretion rate is enforced in addition. AGN are assumed to be in the quasar mode for accretion rates larger than 5% of the Eddington rate. In this case 1% of the accreted rest mass energy is thermally injected into nearby gas. For accretion rates smaller than 5% of the Eddington rate, AGN are in the radio mode in which 7% of the accreted rest mass energy is thermally injected into spherical bubbles [\cite=sijacki2007]. Full details of the black hole model are given in [\cite=sijacki2014].

In addition to the main run, we have performed a simulation with simplified galaxy formation physics which allows a direct comparison to Gadget simulations with the same baryonic physics. In this simulation, we account only for primordial cooling, photoheating by the UV background, star formation with the [\citetalias=springel2003] model, and kinetic wind feedback with a mass-loading of two times the star formation rate and a wind velocity of [formula], essentially the subgrid physics of G3-Music.

SPH Codes

Classic

Gadget3-MUSIC (Yepes, Sembolini)

This is modified version of the  Tree-PM code that uses classic entropy-conserving SPH formulation with a 40 neighbour M3 kernel. The basic [\citetalias=springel2003] model was used. The variant, G3-MusicPi, uses the same SPH formulation but different radiative feedback [\cite=piontek2011].

Cooling & Heating: Radiative cooling is assumed for a gas of primordial composition, with no metallicity dependence, and the effects of a background homogeneous UV ionising field is assumed, following [\cite=haardtmadau2001].

Star Formation: The [\citetalias=springel2003] model is implemented.

Stellar Population Properties & Chemistry: A [\cite=salpeter1955] IMF is assumed, with a slope of -1.35 and upper and lower mass limits of [formula] and [formula] respectively.

Stellar Feedback: This has both a thermal and a kinetic mode; thermal feedback evaporates the cold phase within SPH particles and increases the temperature of the hot phase, while kinetic feedback is modelled as a stochastic wind (as in [\citetalias=springel2003]) - gas mass is lost due to galactic winds at a rate [formula], which is proportional to the star formation rate [formula], such that [formula], with η = 2. SPH particles near the star forming region will be subjected to enter in the wind in an stochastic way. Those particles impacted upon by the wind will be given an isotropic velocity kick of vw = 400kms- 1 and will freely travel without feeling pressure forces up to 20 kpc distance from their original positions

SMBH Growth & AGN Feedback: These processes are not included.

Gadget3-OWLS (McCarthy, Schaye)

The is a heavily modified version of   using a classic entropy-conserving SPH formulation with a 40 neighbour M3 kernel.

Cooling & Heating: Radiative cooling rates for the gas are computed on an element-by-element basis by interpolating within pre-computed tables [\cite=cloudy] that contain cooling rates as a function of density, temperature and redshift calculated in the presence of the cosmic microwave background and photoionization from a [\cite=haardtmadau2001] ionising UV/X-ray background [\cite=wiersma2009a].

Star Formation: Star formation follows the prescription of [\citetalias=schaye2008] - gas with densities exceeding the critical density for the onset of the thermogravitational instability is expected to be multiphase and to form stars [\cite=schaye2004]. Because the simulations lack both the physics and numerical resolution to model the cold interstellar gas phase, an effective equation of state (EOS) is imposed with pressure [formula] for densities [formula] where [formula]. Gas on the effective EOS is allowed to form stars at a pressure-dependent rate that reproduces the observed Kennicutt-Schmidt law [\cite=schmidt1959] [\cite=kennicutt1998] by construction.

Stellar Population Properties & Chemistry: The ejection of metals by massive- (SNeII and stellar winds) and intermediate-mass stars (SNeIa, AGB stars) is included following the prescription of [\cite=wiersma2009b]. A set of 11 individual elements are followed (H, He, C, Ca, N, O, Ne, Mg, S, Si and Fe), which represent all the important species for computing radiative cooling rates.

Stellar Feedback: Feedback is modelled as a kinetic wind [\cite=dallavecchia2008] with a wind velocity vw = 600km  s- 1 and a mass loading η = 2, which corresponds to using approximately 40 per cent of the total energy available from SNe for the adopted [\cite=chabrier2003] IMF. This choice of parameters results in a good match to the peak of the SFR history of the universe [\cite=schaye2010].

SMBH Growth & AGN Feedback: Each black hole can grow either via mergers with other black holes within the softening length or via Eddington-limited gas accretion, the rate of which is calculated using the Bondi-Hoyle formula with a modified efficiency, setting β = 2 as in [\cite=boothschaye2009]. The black hole is forced to sit on the local potential minimum to suppress spurious gravitational scattering [\cite=springel2005]. Feedback is done by storing up the accretion energy (assuming εr = 0.1, εf = 0.15) until at least one particle can be heated to a fixed temperature of TAGN = 108K [\cite=boothschaye2009].

Gadget2-X (Kay)

This is a modified version of the original  Tree-PM code that uses the classic entropy-conserving SPH formulation with a 40 neighbour M3 kernel. A detailed description of the code can be found in [\cite=pike2014], but its key features can be summarised as follows.

Cooling & Heating: Cooling follows the prescription of [\cite=thomascouchman1992] - a gas particle is assumed to radiate isochorically over the duration of its timestep. Collisional ionisation equilibrium is assumed and the cooling functions of [\cite=sutherland1993] are used, with the metallicity Z=0 to ignore the increase in cooling rate due to heavy elements. Photo-heating rates are not included but the gas is heated to a minimum T = 104K at z < 10 and nH < 0.1cm- 3.

Star Formation: Star formation follows the method of [\citetalias=schaye2008]; it assumes an equation of state for the gas with nH > 0.1  cm- 3, with an effective adiabatic index of [formula] for constant Jeans mass. Gas is converted to stars at a rate given by the Kennicutt-Schmidt relation [\cite=schmidt1959] [\cite=kennicutt1998], assuming a disc mass fraction fg=1. The conversion is done stochastically on a particle-by-particle basis so the gas and star particles have the same mass.

Stellar Population Properties & Chemistry: Each star particle is assumed to be a single stellar population with a [\cite=salpeter1955] IMF.

Stellar Feedback: A prompt thermal Type II SNe feedback model is used. This assumes that a fixed number, NSN, of gas particles are heated to a fixed temperature, TSN, with values of NSN = 3 and TSN = 1e7K chosen to match observed hot gas and star fractions [\cite=pike2014]. Heated gas is allowed to interact hydrodynamically with its surroundings and radiate.

SMBH Growth & AGN Feedback: A variation on the [\cite=boothschaye2009] model is used. Black holes are seeded in friends-of-friends (FOF) haloes with more than 50 particles at z=5, at the position of the most bound star or gas particle, which is replaced with a black hole particle. The gravitational mass of the replaced particle is unchanged but an internal mass of [formula] is adopted for the calculation of feedback. Each black hole can grow either via mergers with other black holes within the softening length or via Eddington-limited gas accretion, the rate of which is calculated using the Bondi-Hoyle formula with a modified efficiency, setting β=2 as in [\cite=boothschaye2009]. The black hole is forced to sit on the local potential minimum, to suppress spurious gravitational scattering. Feedback is done by storing up the accretion energy (assuming εr = 0.1, εf = 0.15) until at least one particle can be heated to a fixed temperature of TAGN = 3  ×  108K. This high temperature was chosen for high-mass clusters to match their observed pressure profiles - a lower temperature causes too much gas to accumulate in cluster cores because there is insufficient entropy to escape to larger radius.

Modern

Gadget3-X (Murante, Beck)

This is a modified version of the non-public that includes: an artificial conduction term that largely improves the SPH capability of following gas-dynamical instabilities and mixing processes; a higher-order Wendland C4 kernel [\cite=dehnen2012] to better describe discontinuities and reduce clumpiness instability; and a time-dependent artificial viscosity term to minimize viscosity away from shock regions. Pure hydrodynamical and hydro/gravitational tests on the performance of modified SPH scheme are presented in [\cite=beck2015a].

Cooling & Heating: Gas cooling is computed for an optically thin gas and takes into account the contribution of metals, using the procedure of [\cite=wiersma2009a], while a uniform UV background is included following the procedure of [\cite=haardtmadau2001].

Star Formation: Star formation is implemented as in [\cite=tornatore2007], and follows the star formation algorithm is that of [\citetalias=springel2003] - gas particles above a given density threshold are treated as multi-phase. The effective model of [\citetalias=springel2003] describes a self-regulated, equilibrium inter-stellar medium and provides a star formation rate that depends upon the gas density only, given the model parameters.

Stellar Population Properties & Chemistry: Each star particle is considered to be a single stellar population (SSP). We follow the evolution of each SSP, according to the [\cite=chabrier2003] IMF. We account for metals produced in the SNeIa, SNeII and AGB phases, and follow 16 chemical species. Star particles are stochastically spawned from parent gas particles as in [\citetalias=springel2003], and get their chemical composition of their parent gas. Stellar lifetimes are from [\cite=padovani1993]; metal yields from [\cite=woosley1995] for SNeII, [\cite=thielemann2003] for SNeIa, and [\cite=vandehoek1997] for AGB stars.

Stellar Feedback: SNeII release energy into their surroundings, but this only sets the hot gas phase temperature and, as a consequence, the average SPH temperature of gas particles. Supernova feedback is therefore modelled as kinetic and the prescription of [\citetalias=springel2003] is followed (i.e. energy-driven scheme with a fixed wind velocity of 350kms- 1, wind particles decoupled from surrounding gas for a period of 30 Myr or until ambient gas density drops below 0.5 times the multiphase density threshold).

SMBH Growth & AGN Feedback: AGN feedback follows [\cite=steinborn2015a]. In the aforementioned model, SMBHs grow via Bondi-Hoyle like gas accretion (Eddington limited) with the model distinguishing between cold and hot component (see their Eq. 19). Here only cold accretion is considered, using a fudge-factor αcold = 100 in the Bondi-Hoyle formula (i.e., αhot = 0). The radiative efficiency is variable, and it is evaluated using the model of [\cite=churazov2005]. Such a model outputs separately the AGN mechanical and radiative power as a function of the SMBH mass and the accretion rate. Here these are summed to give the resulting energy thermally to the surrounding gas with an AGN feedback/gas coupling efficiency of εfb = 0.5. The parameters of the hydro model were tuned using the tests presented in [\cite=beck2015a] and those of the AGN model for reproducing observational scaling relations between SMBH mass and stellar mass of the host galaxies. No attempt was made to reproduce any of the observational properties of the ICM. First results on the application of this code to simulations of galaxy clusters, including the reproduction of the Cool Core/Non-Cool Core dichotomy, can be found in [\cite=rasia2015a].

Gadget3-PESPH (February, Davé, Huang, Katz)

This version of Gadget uses the pressure-entropy SPH formulation of [\cite=hopkins2013] with a 128 neighbour HOCTS(n=5) kernel and the time-dependent artificial viscosity scheme of [\cite=morris1997].

Cooling & Heating: Radiative cooling using primordial abundances is modelled as described in [\cite=katz1996], with additional cooling from metal lines assuming photo-ionisation equilibrium follows [\cite=wiersma2009a]. A [\cite=haardtmadau2001] uniform ionising UV background is assumed.

Star Formation: Star formation follows the approach set out in [\citetalias=springel2003], where a gas particle above a density threshold of nH  =  0.13 cm− 3 is modelled as a fraction of cold clouds embedded in a warm ionised medium, following [\cite=mckee1977]. The star formation rate obeys the [\cite=schmidt1959] law and is proportional to n1.5H, with the star formation timescale scaled to match the z=0 [\cite=kennicutt1998] relation. In addition, the heuristic model of [\cite=rafieferantsoa2015], tuned to reproduce the exponential truncation of the stellar mass function, is used to quench star formation in massive galaxies. A quenching probability PQ, which depends on the velocity dispersion of the galaxy, determines whether or not star formation is stopped in a given galaxy; if it is stopped, each gas particle eligible for star formation first has its quenching probability assessed, and if it is selected for quenching then it is heated to 50 times the galaxy’s virial temperature, which unbinds it from the galaxy.

Stellar Population Properties & Chemistry: Each star particle is treated as a single stellar population with a [\cite=chabrier2003] IMF throughout. Metal enrichment from SNeIa, SNeII and AGB stars are tracked, while 4 elements - C, O, Si and Fe - are also tracked individually, as described by [\cite=oppenheimer2008].

Stellar Feedback: Supernova feedback is assumed to drive galactic outflows, which are implemented using a Monte Carlo approach analogous to that used in the star formation prescription. Outflows are directly tied to the star formation rate, using the relation [formula]SFR, where η is the outflow mass loading factor. The probability for a gas particle to spawn a star particle is calculated from the subgrid model described above, and the probability to be launched in a wind is η times the star formation probability. If the particle is selected to be launched, it is given a velocity boost of vw in the direction of v  ×  a, where v and a are the particle’s instantaneous velocity and acceleration, respectively.

This is a highly constrained heuristic model for galactic outflows, described in detail in [\cite=dave2013], which utilises outflows scalings expected for momentum-driven winds in sizeable galaxies (σ  >  75km s− 1), and energy-driven scalings in dwarf galaxies. In particular, the mass loading factor (i.e. the mass outflow rate in units of the star formation rate) is [formula] for galaxies with velocity dispersion σ  >  75km s− 1 , and [formula] for σ  <  75km s− 1.

SMBH Growth & AGN Feedback: These processes are not included.

Gadget3-Magneticum (Saro)

G3-Magneticum is a modified version of using a kernel based on the bias-corrected, sixth-order Wendland kernel [\cite=dehnen2012] with 295 neighbours. The code also incorporates a low viscosity scheme to track turbulence [\cite=dolag2005a] [\cite=beck2015a], gradients computed with high-order scheme [\cite=price2012a], thermal conduction is modelled isotropically at 1/20th of the Spitzer rate [\cite=dolag2004b], and a time-step limiting particle wake-up algorithm [\cite=pakmor2012].

Cooling & Heating: Cooling follows the prescription of [\cite=wiersma2009a] and photoionization from a [\cite=haardtmadau2001] ionising UV/X-ray background. Radiative cooling rates for 11 elements (H, He, C, N, O, Ne, Mg, Si, S, Ca, Fe) are computed by interpolating within pre-computed tables [\cite=cloudy]

Star Formation: The [\citetalias=springel2003] model is implemented.

Stellar Population Properties & Chemistry: Stars follow a Chabrier IMF. Chemical evolution follows [\cite=tornatore2007]: metals are produced by SNII, by supernovae type Ia (SNIa) and by intermediate and low-mass stars in the asymptotic giant branch (AGB). Metals and energy are released accounting for mass-dependent life-times with lifetimes according to [\cite=padovani1993], metallicity-dependent stellar yields according to [\cite=woosley1995] for SNII, [\cite=vandehoek1997] for AGB stars, and [\cite=thielemann2003] for SNIa.

Stellar Feedback: The hot gas within the multiphase ISM model is heated by supernovae and can evaporate the cold clouds. A certain fraction of massive stars (10%) is assumed to explode as SNII triggering galactic winds with a mass loading rate proportional to the SFR and a wind velocity of 350 km/s.

SMBH Growth & AGN Feedback: SMBH and AGN feedback are based on [\cite=springel2005] [\cite=dimatteo2005] and modifications of [\cite=sijacki2007] [\cite=fabjan2010] [\cite=hirschmann2014a] [\cite=dolag2015a]. SMBH's grow via Bondi-Hoyle accretion of gas or mergers. The accretion rate is limited to the Eddington rate and a characteristic boost factor of 100 is applied as only the accretion to large scale is captured. Unlike [\cite=springel2005] in which entire gas particles are accreted, here 1/4 of a gas particle's mass can be captured in an accretion event. During accretion events, 10% of the accreted mass is converted into energy, 10% of which is thermally coupled with gas within the smoothing length of the SMBH, weighted using the hydrodynamics SPH kernel. When the accretion rate drops below a threshold, it is assumed that there is a transition from a quasar mode to a radio mode of AGN feedback, and the feedback efficiency is enhanced by a factor of 4.