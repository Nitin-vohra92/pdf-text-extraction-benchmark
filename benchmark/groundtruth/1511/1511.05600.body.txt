hyperref

Semiparametric Estimation of CES Demand System with Observed and Unobserved Product Characteristics

We thank Jean-Pierre Dub√©, Chad Syverson, Frank Wolak and seminar participants at the University of Chicago for their valuable comments and suggestions.

University of Chicago and NBER Joonhwi Joo

University of Chicago

Introduction

The Constant Elasticity of Substitution (henceforth CES) preferences, often referred to as the Dixit-Stiglitz-Spence preferences, has long been used to analyze the markets with product differentiation in the macroeconomics and international trade literature since [\citet=Spence1976] [\citet=Dixit1977] [\citet=Krugm1980]. However, recent analyses on the demand of differentiated products in the empirical industrial organization literature since [\citet=Berry1994] [\citet=Berry1995] have been based on a completely different microfoundation: the discrete choice random utility approach in the characteristics space. We reconcile these two different approaches in this paper by adding the "quality kernel" to the CES preferences. Quality kernel is a nonnegative function which maps the observed and unobserved product characteristics to the marginal utility multiplier of consuming one unit of a specific product. It allows us to (i) incorporate the observed and unobserved product characteristics in the CES preferences, (ii) derive the same share equation with that of [\citet=Berry1994] [\citet=Berry1995], and (iii) accommodate the zero market share directly. We further show how we can semiparametrically estimate the product differentiated demand model with the data which has a multitude of zero market shares.

Demand estimation has been regarded as a central problem in the industrial organization. The recent empirical industrial organization literature has taken the characteristics space approach in demand estimation, which was initiated by the seminal work of [\citet=Berry1994] [\citet=Berry1995]. In the characteristic space approach, a product is defined as a bundle of observed and unobserved product characteristics. In the baseline model of [\citet=Berry1994] [\citet=Berry1995] [\citet=Nevo2001], a consumer can choose up to one product which yields the highest utility, or can decide not to buy anything. A consumer's utility from consuming a product is composed of the utility from income net of price, observed product characteristics, unobserved product characteristics, and the idiosyncratic utility shock. The individual choice probability equation is derived from the statistical property of idiosyncratic utility shock, which is assumed to be distributed as Type-I extreme value distribution. We refer to the demand models based on these microfoundations as the discrete choice demand models henceforth. The discrete choice demand models provided a tractable way to estimate differentiated products demands system by reducing the dimension of parameters to be estimated.

As a drawback of such a tractability, discrete choice demand models have imposed some strong assumptions that are often unrealistic. To be specific, the following features of the discrete choice demand models have been often criticized: single choice assumption, lack of wealth effects in the utility specification, impossibility of accommodating zero shares, and ignoring dynamics (See, [\citet=Ackerberg2007] [\citet=Nevo2000] [\citet=Reiss2007] among others). We resolve the first three problems by developing a new microfoundation for the existing discrete choice demand estimation frameworks, based on the CES preferences.

Our first main contribution to the literature is that we develop a novel and tractable method to incorporate the observed and unobserved product characteristics in the CES demand system. Starting from [\citet=Feenstr1994], CES preferences and its variations have been widely used in the macroeconomics and international trade literature to estimate the welfare effects from product varieties, allowing free trade, and so on. Among recent works, [\citet=Broda2006] estimate the elasticities of substitution for a vast number of goods based on the multi-stage CES preferences, [\citet=Handbury] [\citet=Handbury2014] calculate the city-specific price indices based on the estimation of the preference parameters of multi-stage CES preferences, and [\citet=Bronnenberg] [\citet=Li] estimate the utility from product varieties using the CES preferences. Although many works in the literature are closely related to, and have a room to incorporate the product characteristics, to our knowledge none of them directly modeled the utility from the product characteristics.

Our second main contribution is that we provide a concrete linkage between the CES demand system and the discrete choice demand system. CES demand system and discrete choice demand system have been considered to be fundamentally different. First of all, they are based on starkly different microfoundations. CES demand system is based on the CES preferences with infinitely divisible products. By solving the constrained utility maximization problem, the consumer's demand function is derived as a form of the consumer's optimal quantity choice. Then the quantity shares can be calculated, which can be regarded as the individual choice probability of the representative consumer. In the demand system based on discrete choice framework, a consumer can choose up to one product which yields the maximal indirect utility, without being budget constrained. Then, by assuming the independent and identically distributed (i.i.d. henceforth) Type-I extreme value shocks on the preferences, the individual choice probability equations are derived from the statistical property of the i.i.d. Type-I extreme value random variables. Another difference lies in the product characteristics. Discrete choice demand system is regarded to be able to directly incorporate the product characteristics to reduce the dimensionality of parameter space. Although some early works such as [\citet=Anderson1987] [\citet=Anderson1988] [\citet=Anderson1989] [\citet=Anderson1992] [\citet=Verboven1996] point out the similarities with CES demand system and discrete choice demand system, none of them considered the product characteristics as a direct argument of the consumer's utility function. Among the international trade literature, works such as [\citet=Feenstr1994] [\citet=Li] incorporate so-called taste parameter in the CES preferences, but it is not directly related to product characteristics either.

We provide the linkage between the CES demand system and the discrete choice demand system by deriving the individual choice probability equation of discrete choice demand system from the CES preferences, using what we denote as "quality kernel." This equivalence result of CES demand system and the logit/BLP demand system is remarkable for both empirical industrial organization literature and macroeconomics/international trade literature. For the empirical industrial organization literature, it provides an additional appealing microfoundation for the existing demand estimation frameworks based on discrete choice. For macroeconomics/international trade literature, it provides a strong justification that allows for the demand system based on the CES preferences to use the estimation methods developed in the context of discrete choice.

Our third main contribution is that we provide a direct method to accommodate the zero individual choice probabilities using the quality kernel. We embed both the extensive and the intensive margins on the quality kernel. Thus, it allows us to model the representative consumer's choice as a two-stage decision process. In the first stage, the consumer chooses the choice set. In the second stage, for each product in the choice set, the consumer chooses how much to buy. The idea to model both the extensive and the intensive margins in a single utility maximization problem was first pioneered by [\citet=Hanemann1984], and followed by [\citet=Chiang1991] [\citet=Chintagunt1993] [\citet=Nair2005]. More recently, [\citet=Handbury] employs this idea in the multi-stage CES utility maximization problem. However, all of these previous works rely on the single-choice assumption, in the sense that the representative consumer chooses up to one brand/product. Our framework overcomes the single-choice assumption, to allow the representative consumer purchase multiple brands/products.

As a result of separately modeling the extensive margin and the intensive margin, we provide an empirically tractable estimation framework that can accommodate the zero individual choice probabilities. Accommodating the zero individual choice probabilities has been a central problem in the demand estimation literature for the last two decades since [\citet=Berry1994] [\citet=Berry1995]. In fact, the discrete choice framework with an additive idiosyncratic error that has unrestricted support inherently rules out the zero choice probabilities. This is exactly the case with the widely used additive Type-I extreme value error assumption. For the additive Type-I extreme value errors, exponential function in the numerator of the individual choice probabilities are inevitable. This implies that provided a product yields any utility higher than negative infinity, the product must have a strictly positive individual choice probabilities. But, the zero market shares, which is equalized with the the choice probabilities in the estimation, are very often observed in the data. Hence, in practice, researchers just dropped the samples with zero market shares or added a small arbitrary number on the zero shares. Both measures suffer from causing the bias in the estimates. By modeling the extensive and intensive margins separately, we argue that the selection process on the consumer's choice set must be considered during the estimation. This choice set selection drives the conditional expectation of the unobserved product characteristics conditioned on all the instruments to be nonzero, and it is highly likely to be positive. The usual GMM estimation procedure will yield biased estimates when the choice set selection is ignored.

There is one remarkable recent work of [\citet=Gandhi2013], which can rationalize the zero market shares. They take the zero market share as a "measurement error" and provides a partial identification result. The critical difference between theirs and ours is that ours rationalize the zero individual choice probabilities as well as zero market shares, while they allow only the market share to be zero. Nonetheless, their Monte-Carlo simulation and empirical applications show the result which has a very similar implication to ours: when the data with the zero shares are dropped, the price coefficient estimates will be biased upward.

In a different but related context, zero trade flow has also been a serious problem in the gravity models in the international trade literature. As a simple solution, [\citet=Silva2006] argue that in the model that should be estimated is [formula], not [formula] which has been a convention in the literature. However, this method cannot be applied to the discrete choice demand models, because the unobservables in the discrete choice demand models should enter inside the exponential functions. Another reason why this seemingly appealing approach loses its justification is that, if [formula], there must be negative realizations of yi given [formula] unless yi is constant. But, choice probabilities are bounded below by zero. A more closely related to our method is developed by [\citet=Helpman2008]. They use a gravity model with endogenous censoring in the trade volumes. Their structural approach with censoring is similar to ours. Yet, they assumed the normality in the error term while we do not specify the distribution of unobservables. In our empirical example, we also provide an evidence that the distribution of the unobservable product characteristics is far from Gaussian.

Our work can be viewed as a "hedonic model" or "pure characteristics model" of demand, in the sense that we do not require an individual level i.i.d. random utility shocks. Hedonic demand estimation frameworks have been developed by [\citet=Bajari2005] [\citet=Berry2007]. The former is more closely related to our work. They study the general hedonic model of demand, and focus on the local identification and estimation of the coefficients in the product characteristics. For the global identification when the product space is continuous, they specify the Cobb-Douglas preferences. Our work can be viewed as an extension to CES preferences with product characteristics, which can also accommodate the zero shares.

The rest of the paper is organized as follows. In Section [\ref=sec:Microfoundation:-CES-Demand], we present the general microfoundation of the CES demand system with product characteristics. Section [\ref=sub:The-Exponential-Quality] provides the linkage between CES demand system and logit demand system. Section [\ref=sec:Semiparametric-Estimation] presents the semiparametric estimation method when the data contains a multitude of zero shares. Section [\ref=sec:Monte-Carlo-Simulations] presents simulation evidences. In Section [\ref=sec:Empirical-Example], we implement our estimation method to the scanner data of cola sales. Section [\ref=sec:Conclusion] concludes.

CES Demand System with Observed and Unobserved Product Characteristics

Specification of the CES Demand System

We consider a differentiated product market denoted by subscript t composed of homogenous consumers with a CES preference. The utility from a product category is given by:

[formula]

The set Jt is a set of alternatives in the category, which may or may not include the numeraire that represents the outside option. qj,t is the quantity of product j consumed in market t. [formula], what we define by the "quality kernel," is a nonnegative function of observed and unobserved product characteristics. [formula] and [formula] are vectors of product j's characteristics in market t, which are observable to the econometrician. Œæj,t and Œ∑j,t are scalars of product j's characteristics which are unobservable to the econometrician. [formula] and Œ∑j,t are the extensive margin shifters that a consumer considers whether to buy the product or not. [formula] and Œæj,t are the intensive margin shifters that determine the level of utility when a consumer buys the product. [formula] and [formula] may have common components, but we require the exclusion restriction on [formula] for identification when the extensive margin actually matters; [formula] has to contain at least one component that is not in [formula] when zero market shares are observed in data. We will explain further about the identification conditions later in Section [\ref=sec:Semiparametric-Estimation]. As an important remark, we note that the observed extensive margin shifters [formula] may contain the prices pj,t or the logarithm of prices ln pj,t.

The quality kernel [formula] in ([\ref=eq:preference]) plays the key role in our analysis. Conventionally, researchers have put some taste parameters or utility weights in the place where we put the quality kernel. They commonly have the interpretation of a multiplier to the (marginal) utility of consuming a specific product. The quality kernel is a straightforward extension of such conventions, which allows to directly incorporate the observed and unobserved product characteristics in consumer's utility. Furthermore, we allow the possibility of explicitly separating the extensive margin and the intensive margin. This feature will play a key role to accommodate the zero shares in the estimation.

The representative consumer's utility maximization problem is as follows:

[formula]

The Marshallian demand function is given by

[formula]

which leads to the following quantity share equation:

[formula]

([\ref=eq:demandsystem]) can be regarded as the individual choice probability of the representative consumer. Either ([\ref=eq:optimalquantity]) or ([\ref=eq:demandsystem]) specifies the CES demand system with observed and unobserved product characteristics.

For the invertibility of the demand system, we consider the subset [formula] such that œÄj,t > 0 for all j‚ààJ+t. The demand system specified by [formula] or [formula] satisfies the "connected substitutes" conditions by [\citet=Berry2013], and thus invertible. It implies œÉ, the elasticity of substitution, is globally identified. Furthermore, if we impose suitable structures on [formula] such as monotonicity with index restriction, the structural parameters of [formula] is also identified. We shall investigate further on the specific functional forms of [formula] in Section [\ref=sub:The-Exponential-Quality].

Properties of the CES demand system and Comparison to the Discrete Choice Demand System

In this subsection, we explain the properties of the demand system specified by the Marshallian demand function ([\ref=eq:optimalquantity]). The demand system that we propose, which is derived from the constrained optimization problem, has a few more desirable properties over the existing demand estimation frameworks based on the discrete choice random utility models.

We begin with the Marshallian and Hicksian own and cross price elasticities of the demand system. Let bj be the budget share of product j. If [formula] does not include the prices pj,t or its function, we have the following simple closed-form formula for the Marshallian and Hicksian own and cross price elasticities:

[formula]

and the income elasticity is 1. Because the budget shares are observed in data, these elasticities can be calculated given that œÉ is identified. From these elasticity expressions, it is immediate that a version of independence of irrelevant alternatives property holds. That is, the substitution pattern depends solely on the budget share of the corresponding products. It is also noteworthy that the price elasticities should not be derived based on the individual choice probabilities as in the discrete choice frameworks.

If [formula] includes the prices pj,t or its function so that the extensive margin is affected by the price changes, there is no simple closed-form expression for the own and cross elasticities. In practice, the corresponding price elasticities can be calculated using simulation.

Because we have derived the demand system from the constrained optimization problem, the duality between the Marshallian demand function and the Hicksian demand function holds. The Slutsky equation also holds, so we can decompose the substitution effect and the income effect in a more natural way. The Slutsky equation in the elasticity form is given by

[formula]

where ŒµIj,t = 1 in the CES demand system. The income effect depends only on the budget shares, which is a considerable limitation. However, there are at least two advantages over the discrete choice counterpart. First, the income effect depends on the budget shares, not on the quantity shares. In the discrete choice demand frameworks, income effect of a product with a tiny budget share and large quantity shares will be large, which is even more unrealistic. Next, although the numeraire can be included in the consumer's choice set Jt, it is not necessary in our framework. In the demand system derived from the quasilinear utility where budget constraint never binds, the inclusion of numeraire in the choice set is necessary. If the numeraire is not included in the choice set, an increase of the price will only lead to switching to other products in the choice set. In order to include the numeraire in the choice set, the share of the numeraire or the potential market size has to be taken as known in the discrete choice demand models. In a sense the magnitude of the income effect is predetermined, because it solely depends on the size of the outside share.

The Exponential Quality Kernel

We let [formula] flexible so far. In principle, [formula] can be any nonnegative function. Under this weak restriction, the demand system specified by the individual choice probability equation ([\ref=eq:demandsystem]) may be locally identified, as studied in [\citet=Bajari2005]. However, nonparametric estimation of the locally identified demand system places considerable burden on the data and computational power, which is often impractical. Furthermore, the locally identified parameter values are often uninformative for the counterfactual analyses. Alternatively, we can impose further structures on the consumer utility from the product characteristics.

We focus on the exponential quality kernel with the index restriction. This specific functional form is remarkable for two prominent reasons. First, by using the functional form, we can derive the same individual choice probability equation of the homogenous and random coefficients logit model of demand from the CES demand system. Second, it simplifies the estimation problem substantially, because the demand system reduces to the log-linear form. We use the exponential quality kernel to suggest a tractable semiparametric estimation method which can also accommodate the zero individual choice probabilities.

Nesting Homogenous and Random Coefficients Logit Model of Demand

In this subsection, we show that the individual choice probability equation of the homogenous and random coefficients logit models of demand can be derived from ([\ref=eq:demandsystem]) by choosing a specific functional form of the quality kernel [formula].

Suppose [formula], Œæj,t  =  Œ∑j,t, [formula], œÄj,t > 0 and let [formula] be exogenous for all j,t. We do not require an exclusion restriction in this setup because the individual choice probabilities are positive for every alternative. Let Jt contain the numeraire denoted by product 0. Taking ratios of product j and product 0, and then taking logarithm on ([\ref=eq:demandsystem]) yields:

[formula]

It is straightforward that if we normalize [formula], Œæ0,t = 0 and let [formula], ([\ref=eq:logit]) becomes

[formula]

which is the estimation equation of the homogenous logit model of demand, except that in ([\ref=eq:logitestimation]) the [formula] enters in place of pj,t, which has been a convention in the literature. The logarithm of price should enter ([\ref=eq:logitestimation]) because it is inherited from the consumer's budget constraint. However, we observe that [formula] can also enter in place of pj,t in the utility specification of the logit demand system. That is, by substituting [formula] with pj,t in the linear utility specification in the logit demand model, the demand system we propose exactly lines up with the demand system of the logit model. We take the substitution with the logarithm of prices as a simple scale adjustment in the linear utility specification of the logit model.

The random coefficients logit model of demand by [\citet=Berry1995] (henceforth BLP) can be nested in the same way. Let i denote an individual, and let us suppress the market subscript t for a while. For notational simplicity, let œÜj: =  ln pj. Suppose we specify the linear utility of the BLP model as

[formula]

On the other hand, the individual choice probability equation ([\ref=eq:demandsystem]) from CES preferences is

[formula]

where the second equality follows by specifying [formula] and [formula]. Notice that ([\ref=eq:asdjkfasd]) is almost exactly same as the individual choice probability equation obtained in the BLP model. The market share equation is obtained by aggregating these individual choice probabilities over i.

Discussion in the current subsection provides the microfoundation and justification for international trade or macroeconomics literature based on CES preferences to use the differentiated products demand estimation methods developed in empirical industrial organization literature since [\citet=Berry1994] [\citet=Berry1995] [\citet=Nevo2001]. However, the discrete choice differentiated products demand estimation literature has imposed one critical restriction which has been regarded as necessary in inverting the individual choice probabilities: œÄj,t > 0 for all j,t. The restriction is inevitable in the discrete choice demand models which assume the additive idiosyncratic shocks on the preferences distributed with the unrestricted support. The most important example in the literature has been the additive i.i.d. Type-I extreme value distributed shocks. The individual choice probabilities derived from such assumption must have exponential functions in the numerators of choice probabilities.

Zero quantity shares, which are equalized with the individual choice probabilities in the discrete choice demand models, are very often observed in data. Within the discrete choice frameworks, it has often been regarded impossible to rationalize the zero shares. In contrast, the flexibility of quality kernel [formula] in our model allows us to accommodate the zero individual choice probabilities by embedding the buy-or-not decision of the consumer, which determines the extensive margins. In the following subsection, we illustrate how we can directly accommodate the zeros in the market shares.

Accommodating Zero Market Shares: Separating the Extensive and Intensive Margins

From here we restrict our attention on the homogenous consumers, and let [formula], Œ∑j,t  ‚â†  Œæj,t. Let Jt contain the numeraire. Recall the individual choice probability equation of the CES demand system:

[formula]

The individual choice probability equation ([\ref=eq:individualprob]) allows the zero shares, by letting [formula] for some subset of the product characteristic space where [formula] lives on. We can even rationalize the data where all products in a particular market have zero shares. By taking the ratio œÄj,t  /  œÄ0,t, we obtain a reduced form of the demand system ([\ref=eq:individualprob]) as

[formula]

For tractability in identification and estimation, again we consider the following functional form with the index restriction:

[formula]

where [formula] is an indicator function and h is a nonnegative, strictly increasing function on [formula]. Employing this quality kernel is equivalent to assuming a certain structure on the consumer's choice. The consumer first considers the utility from product characteristics represented by [formula]. If it exceeds the threshold -  Œ≥, the consumer decides to buy it. Then [formula] is taken into consideration, which affects the amount of consumption qj,t. On the other hand, if the utility does not exceed the threshold -  Œ≥, the consumer decides not to buy, thus qj,t  =  œÄj,t = 0. We again note that [formula] can contain the current prices pj,t or other endogenous variables provided that the corresponding instruments are available to the researcher.

The choice [formula], which we will focus on throughout the rest of the paper, deserves a special interest. As in Section [\ref=sub:Nesting-Homogenous-and], the demand system reduces to a log-linear form under this choice of the quality kernel. It simplifies the estimation problem significantly because the error term becomes additively separable. Furthermore, our demand system becomes a direct extension of the homogenous logit demand system, which also allows the accommodation of the zero choice probabilities. Our demand system derived from the CES preferences can provide with the microfoundation required to rationalize the zero choice probabilities by separating the intensive margin and the extensive margin.

In Appendix [\ref=sec:Derivation-of-Selection-Correcti], we provide a two-stage modeling of consumer behavior within the discrete choice random utility framework. Both ways lead to the same estimation equation, which is presented in the following Section. Although we find that sticking to the discrete choice random utility framework is less appealing because the extensive margins and the intensive margins cannot be conceptually distinguished, there might be instances in which the single choice assumption is more adequate. The result presented in Appendix [\ref=sec:Derivation-of-Selection-Correcti] can be useful under such circumstances.

Semiparametric Estimation Framework with Exponential Quality Kernel and Zero Shares

In this section, we provide a semiparametric estimation framework for the exponential quality kernel which accommodates the zero market shares. The estimation method we provide is in two stages. In the first stage, we estimate the parameters that determine the extensive margin, using the efficient semiparametric estimators developed by [\citet=Klein1993]. In the second stage, we estimate the parameters that determine the intensive margin, correcting for both the endogeneity in prices and the selectivity bias caused from the consumers' choice set selection. The second-stage estimator we use is developed by [\citet=Ahn1993] [\citet=Powell2001]. Note that when there is no observed zero shares, one can proceed with the existing demand estimation frameworks including BLP.

The first-stage estimation framework illustrated in this section allows only the exogenous covariates for the observed extensive margin shifters [formula]. We chose this partly due to our availability of the data, and partly due to the efficiency concern. If the researcher wants to include the endogenous variables such as prices in the extensive margin shifters [formula], one can proceed with the method developed by [\citet=Blundell2003] [\citet=Blundell2004] in the first-stage. They provide the semiparametric estimation framework for the binary choice models with endogenous covariates.

We assume the existence of instruments for prices such that [formula], where [formula] may include [formula]. It is very well documented in the literature that [formula], and it is highly likely to be positive. As a result, when the prices are not instrumented, very often the upward sloping demand curves are estimated. The same intuition applies when the consumers' choice set selection is ignored and zero shares are simply dropped during the estimation. That is, even after instrumenting for the prices, [formula] does not imply [formula] is zero. [formula] is likely to be positive, because consumers will select the products with high Œ∑j,t in the first-stage choice set decision, and Œ∑j,t is likely to be positively correlated with Œæj,t. Thus, dropping zero shares in the estimation will bias the price coefficient upward, which can even yield the positive price coefficients. Imputing zero shares with some small positive numbers during the estimation can cause an even more serious problem; the direction of the bias is unpredictable.

We normalize œÜ0  =   ln p0 = 0, Œæ0  =  Œ∑0 = 0, [formula], and [formula]. Under the choice of œá specified in ([\ref=eq:chi]), ([\ref=eq:demandsystem2]) simplifies to:

[formula]

which is the econometric model that we are going to identify and estimate in this section. A consumer buys product j if [formula]. For the sample with œÄj,t > 0, the demand system ([\ref=eq:zxdfhaksdf]) further reduces to:

[formula]

However, conditional expectation [formula] does not hold anymore. It boils down to a classic example of the selection problem.

Several methods to estimate the model parameters of the censored selection model have been suggested in the literature under different assumptions. We follow the spirit of [\citet=Heckm1979] here, which imposes the conditional mean restriction. By taking the conditional expectation, we have:

[formula]

[\citet=Ahn1993] [\citet=Powell2001] [\citet=Newey2009] proposed two-stage [formula]-consistent estimators of the model parameters of ([\ref=eq:loglineardemand]). In particular, we use [\citet=Ahn1993] [\citet=Powell2001]'s pairwise differenced weighted least squares estimator, which allows for identification using an instrument in the second stage.

In the first stage, [formula] needs to be estimated. There are a few estimators for this semiparametric binary choice model, among which we use the method by [\citet=Klein1993] which achieves the asymptotic efficiency. In the second stage, the parameters [formula] from the following linear equation is estimated:

[formula]

where [formula] is an unknown function.

We impose the following assumptions on the data generating process for the [formula]-consistency and asymptotic normality of our proposed estimator.

In Assumptions [\ref=assu:The-product-characteristic] and [\ref=assu:-is-independent], we are imposing the independence of the observed and unobserved product characteristics and homoskedasticity of unobservable product characteristics Œ∑j,t, which is related to the extensive margins. However, we do not assume that the unobserved product characteristics and the prices are independent. We allow for the endogeneity in prices, which should be considered in the identification and estimation; the prices can be some function of the observed and unobserved product characteristics. Assumption [\ref=assu:There-exists-a] is the standard instrument condition to correct for the endogeneity in prices. For the discussion about suitable instruments in practice, see [\citet=Nevo2001].

The remaining assumptions are imposed for the [formula]-consistency and asymptotic normality of the distribution-free efficient semiparametric estimator developed by [\citet=Klein1993]. Klein-Spady estimator allows to semiparametrically estimate the parameters of the binary choice models without having to specify the distribution of the error term. The key insight is to replace the likelihood with its uniformly consistent estimates, and to run the pseudo maximum likelihood. Assumption [\ref=assu:exclusion] is the exclusion restriction, which is required for identification in the second-stage. Assumptions [\ref=assu:The-product-characteristic-1] and [\ref=assu:-is-independent-1] are regularity conditions for the [formula]-consistency and asymptotic normality of [\citet=Klein1993] and [\citet=Powell2001] estimator. Under Assumptions [\ref=assu:The-product-characteristic]-[\ref=assu:-is-independent-1], conditions (C.1)-(C.9) of [\citet=Klein1993] and Assumptions 5.1-5.7 of [\citet=Powell2001] are satisfied.

We describe our first and second stage estimators. In the first stage, we estimate [formula] using Klein-Spady estimator. The estimator is defined by:

[formula]

where

[formula]

[formula] is a local smoothing kernel, hn is the bandwidth, and [formula] are trimming sequences for small estimated densities. In the second stage, we follow [\citet=Powell2001]. With an abuse of notation by suppressing the market index t and letting [formula], the estimator is defined by

[formula]

where [formula]. The intuition for the estimator is to cancel out the bias correction term [formula]; if [formula] is same as [formula], the term [formula] in ([\ref=eq:loglinear_estimation_eq]) will be canceled out when we take the difference. Thus, we place more weight on the differenced term which are "close" to each other, and then run the least square estimation. The estimator is [formula]-consistent and asymptotically normal. For the closed form covariance matrix formula and its consistent estimator, see [\citet=Powell2001]. The following theorem summarizes the discussion made in this subsection so far.

Under Assumptions [\ref=assu:The-product-characteristic]-[\ref=assu:-is-independent-1], [formula] defined in ([\ref=eq:betahat]) is [formula]-consistent and asymptotically normal.

The log-linear estimation illustrated in this subsection has an advantage of allowing for the consumer's buy-or-not decision to be completely separate from how-much-to-buy decision. A downside is that we need an exclusion restriction on [formula] to identify [formula]; [formula] cannot be a linear combination of [formula]. This exclusion restriction can be circumvented by adding an interaction term or a nonlinear transformation of nonbinary variables contained in [formula]. For instance, if one proceeds with the method suggested by [\citet=Blundell2003] [\citet=Blundell2004] that can accommodate the prices in the first-stage estimation, including the raw prices pj,t in [formula] may be a possbile choice. But ideally, it would be the best to find additional exogenous variables which only affect the consumer's buy-or-not decision.

Monte-Carlo Simulation

In this section, we simulate the market data and try to back out the model parameters to examine the finite-sample performance of the estimator we proposed in the previous section. We compare the estimation result using our model to the estimation result of the logit model which either drops the sample with zero shares or imputes the zero shares with a small positive number. It turns out that the estimator we proposed works well when the model is correctly specified. The price coefficient estimates œÉÃÇ are quite robust on the model misspecification.

We first describe the data generating process which satisfies the exclusion restriction. There are 2-5 products in each market t. The exact number of products by market is randomly drawn. The observed product characteristics vector [formula] includes three continuous components, one discrete component, and three brand dummies. One of the continuous component is excluded in [formula]. The first component [formula] follows [formula], the second component [formula] [formula], the third component [formula] [formula], the fourth component [formula] [formula]. We let only [formula] is not included in [formula]. [formula] follows Type-I extreme value distribution with mean zero.

There exists two instruments for the prices, which are the proxies of the cost shock. The prices pj,t, which is an endogenous variable, is determined by [formula], where œà is some (possibly) nonlinear function which is strictly monotonic in Œæj,t. To be specific, we specify œà as:

[formula]

We intentionally let the influence of the cost proxies [formula] and [formula] to be fairly weak, which reflects the common circumstances in practice. The individual choice probability is determined by ([\ref=eq:individualprob]). We calibrate the parameters as œÉ = 2, Œ± = 1, [formula], Œ≥  =  Œ±, [formula].

Table [\ref=tab:Estimation-Result-of] presents the estimation result of the simulated data. A few remarks are in order. First, the performance of the estimator we proposed is good if the model is correctly specified. Even if the quality kernel is misspecified, the price coefficient estimates are close to the true parameter. Next, dropping the sample with zero shares or imputing small positive numbers in place of the zero shares biases the estimators substantially. Lastly, we also generated and estimated several other specifications such as different error term distributions, different functional forms of quality kernels, different variables, different pricing functions, and so on. Although we did not present all of them here for brevity, we note that the results and implications presented in this section were robust.

Empirical Example: Scanner Data with a Multitude of Zero Shares

In this section, we implement our proposed demand estimation method to Dominick's supermarket cola sales scanner data. The data is obtained through James M. Kilts Center for Marketing, University of Chicago Booth School of Business. The data contains weekly pricing and sales information of the Dominick's chain stores during 1989-1997, of every UPC-level product in 29 product categories. Promotion statuses and profitability by each unit sold are also recorded in the data. One shortcoming of the data is that there is no systemic record of the product characteristics, which we overcome by choosing cola sales data and hand-coding the product characteristics.

Data

We choose the Dominick's data since it is ideal for our purpose of illustration, for the following two reasons. First, Dominick's data contains the information on which products were displayed in the shelves, even if the product was not sold at all. This feature is necessary for our purpose because we want the exact information of products which were in the consumer's choice set but not chosen at all. Indeed, as presented in Figure [\ref=fig:Histogram-of-Observed], about 1/4 of the observations exhibit zero shares. Second, Dominick's data contains the information of average profit per each unit sold. Combined with the price data, we can back out the average cost per unit. The cost information is very useful, because an ideal instrument for prices in estimating the consumer demand should be a proxy of cost shocks. We can avoid constructing instruments using indirect proxies for the cost, which has been one of the prevailing problems in the demand estimation literature.

We restrict our interest to the cola sales for a few reasons. Cola market is a typical market of product differentiation in which many brands are competing with different tastes and packages. Among them two prominent brands, Coke and Pepsi, take the majority of market shares. Next, the product characteristics are not separately coded in Dominick's data, but only the category information such as "soft drinks" or "bottled juices" are available. We had to extract the information from product descriptions truncated at 30 characters, for which cola is ideal because it has clearly labeled product characteristics. Another reason is that the companies producing cola and the product characteristics of cola have not been changed much for the last few decades. Coke and Pepsi have been two leaders in the market. Diet, cherry-flavored, caffeine-free colas are still sold in the market with considerable market shares in 2015, as well as in 1995. This feature makes our analysis not only convenient, but also the implication of the analysis more realistic. In Appendix [\ref=sub:Laundry-Detergent-Data], we also present the estimation results for laundry detergent demand as a robustness check.

Dominick's data covers 100 chain stores around Chicago area for 400 weeks, from September 1989 to May 1997. We chose the cross-section of week 391, which is the second week of March 1997. We use the cross-section data of a week because we wanted to avoid the following potential problems. First, stockpiling is very common for the products lasting for more than weeks. The same consumer will respond more sensitively in terms of the purchasing behavior than in terms of the consumption behavior. Thus, if we use the data across time series, the estimated elasticities can be larger than it actually is. Next, the demand of soft drinks fluctuate in a week with holiday or events such as Super-bowl, and varies considerably by seasons. Thus we chose one week in March, without any close holidays. Because Dominick's experimented with the prices and sales across different chain stores even for a same product, we still have enough price variations after choosing a cross-section of data. Even after restricting the sample to a cross-section of one week, the sample size is as large as 4300. We present the summary statistics in Table [\ref=tab:Summary-Statistics].

We define the individual product and the individual market in a natural way. An individual product is defined by UPC, and a market is defined by store-week pair. It is the finest way to define the product and the market that our data allows, which produces a multitude of zero shares. As illustrated in Figure [\ref=fig:Histogram-of-Observed], around one third of the products in the shelves were not sold at all.

A few remarks on the data are in order. First, we converted the unit price and unit costs to per-ounce price and costs, respectively. Next, Dominick's did not record the price and cost of the week if the sales of the product is zero in the corresponding week. It is the reason why we cannot include the prices in [formula], and proceed only with other exogenous product characteristics. Also, in estimating the logit model while substituting the observed zero shares with small numbers on the observed zero shares, we had to impute the missing prices using other chain store's prices and profits with the same product and promotion status. Lastly, we had to compute the market share of the outside option, both for our model and logit model. It boils down to estimate the market size. We assume that an average person consumes 100 ounces of soft drinks a week, and compute the size of the market using the daily customer count data of each stores.

Estimation

We estimate the model using the method we proposed in Section [\ref=sec:Semiparametric-Estimation]. We also estimate our model with using Probit as the first-stage estimator for comparison. As a benchmark, we estimate the logit model, with different ways to handle the observed zero shares: (i) dropping the sample with zero shares, and (ii) substituting zero shares with small numbers.

We estimate two models with different specifications. In the baseline model (Model 1), [formula] includes the following product characteristics: bottle size, number of bottles per bundle, diet, caffeine free, cherry flavor, Coke/Pepsi brand dummies, and the promotion status. As an instrument for per-ounce price, we used the per-ounce cost calculated from the profitability variable. For Model 1, we used the store-level demographics for the variables satisfying the exclusion restriction in the customer's buy-or-not decision in [formula]: % blacks and Hispanics, % college graduates, and log of median income. The exclusion assumption on these variables is that a consumer who never buys a certain product will not become an inframarginal consumer no matter what the other product characteristics are. For Model 2, we excluded promotion status from [formula], and used it as the variable satisfying the exclusion restriction. The exclusion assumption is that the promotion affects only the consumers' information about the choice set, not the level of utility by consuming a certain product.

To compare the magnitude of coefficients, we use the logarithm of prices in the logit model as well. As emphasized before, we can take it as a scale adjustment to use the logarithm of prices in estimating the discrete choice logit model of demand. In Appendix [\ref=sub:Cola-Data-for], we provide the robustness checks using the data of different weeks.

The first-stage parameter estimation result for [formula] is presented in Table [\ref=tab:First-stage-Parameter-Estimates]. Model 1 is the baseline model with store-level demographics in the first-stage. Model 2 uses the promotion statuses as the excluded variables in the second stage estimation. For both Model 1 and Model 2, we estimated the Probit model for benchmark and for setting the initialization value for the optimizer to estimate the Klein-Spady model. The coefficients for the Bottle size are normalized to one. We find that the coefficient estimates from Probit estimation and Klein-Spady estimation are considerably different. We also plot the estimated conditional density of Œ∑j,t given [formula] from each model in Figure [\ref=fig:Estimated-Distribution-of]. The estimated densities of Œ∑j,t given [formula] is not even unimodal, which we suggest as a strong evidence that the unobservable product characteristics Œ∑j,t does not follow the Gaussian distribution.

The main estimation result is presented in Table [\ref=tab:Parameter-Estimates], which is striking. In logit models, the coefficients of the logarithm of prices are positive, economically and statistically very significant, even after instrumenting for the prices using the supplier side cost information. However, log-linear estimation of our model with Klein-Spady first stage estimator returns the expected signs and magnitudes for the coefficients of the logarithm of prices. It is also surprising that the estimator with Probit first-stage estimator performs well, even though the distribution of the unobservables are far from the Gaussian distribution. However, we note that we are not sure whether this result can be generalized.

The result provides a very strong evidence of the selection process which has been ignored in the demand estimation literature thus far. Recall the estimation equation ([\ref=eq:loglineardemand]) under the exponential kernel:

[formula]

Except for the term [formula], the estimation equation is the same with the logit model when we drop the sample with zero observed shares. That is, Column 1 (Our Model, K/S, Model 1) and Column 5 (Logit Model, Drop 0) should exactly coincide when the term [formula] is zero. Yet, it turns out that it is not the case. As shown in Table [\ref=tab:Parameter-Estimates], ignoring the consumer's selection process can bias the estimates, even resulting in an upward-sloping demand curve. It lines up with the intuition of [\citet=Heckm1979]: when selection is ignored the whole estimates from a regression can be misleading. To be specific, in our case [formula] is likely to be positive. This is because consumers will select on unobservables Œ∑j,t as well as observables [formula], and Œ∑j,t is highly correlated with Œæj,t. Hence, even after instrumenting for the prices, the price coefficient estimates are likely to be biased upward when the samples with zero shares are just dropped. Imputing some small numbers on zero shares may cause a more serious problem, that the direction of the bias cannot be predicted. In contrast to Table [\ref=tab:Estimation-Result-of] in the previous section, we observe that imputing zeros cause the upward bias in the price coefficient estimates in Table [\ref=tab:Parameter-Estimates]. Indeed, we really do not have an explanation on the direction of the bias when zeros are imputed.

In Appendix [\ref=sec:Robustness-Checks], we also present the estimation results for the cola data from a different week, and for the laundry detergent data. All the results in Appendix [\ref=sec:Robustness-Checks] exhibit the same pattern as in Table [\ref=tab:Parameter-Estimates], which suggest that our findings are robust.

Conclusion

In this paper, we have developed a semiparametric demand estimation framework based on CES preferences with observed and unobserved product characteristics. Our framework is compatible with the widely used logit model of demand based on the discrete choice framework. Furthermore, it can accommodate the zero choice probabilities with a reasonable microfoundation by separating the intensive margin and extensive margin, and embedding them both in the quality kernel that we have introduced. The key breakthrough we made was to account for the selection of the choice set, which has been ignored in the literature so far. If the choice set selection problem is ignored, the estimates of the price coefficients can be misleading not only in their magnitudes but also in their signs. We have shown that it can even result in an upward sloping demand curve.

A direct extension of our work will be random coefficients demand model which can accommodate the zero choice probabilities. As in the homogenous logit model, the own and cross price elasticities derived from our model also exhibit the unrealistic substitution pattern. Overcoming such unrealistic substitution patterns was one of the most important motivations on the development of the random coefficients logit model of demand by [\citet=Berry1995]. Although we provide the microfoundation for the random coefficients, we did not develop the estimation method with random coefficients accommodating the zero individual choice probabilities. We leave such an extension as a future research agenda.

Derivation of Selection-Correction Estimation Equation from the Two-stage Discrete Choice Models

In this section, we show that the estimation equation ([\ref=eq:loglineardemand]) can be derived from a two-stage decision process within a discrete choice random utility framework. Consider a representative consumer with two-stage decision process. In the first stage, the consumer makes a search over Jt, which is all the possible alternatives. The consumer's choice set J+t is determined as a result of the search. In the second stage, the consumer encounters the usual discrete-choice decision problem over J+t, i.e. purchase the product that yields the highest utility.

Let [formula] be the variables that affect the first-stage choice set search, [formula] be the variables that affect the second-stage discrete choice unconstrained utility maximization problem. Notice that these form an analogue of the notations we used in Sections [\ref=sub:The-Exponential-Quality]-[\ref=sec:Semiparametric-Estimation]. Let us model the threshold decision rule of the search for the choice set as [formula], where dj,t = 1 denotes the product j in market t is contained in the consumer's choice set J+t. The second stage utility of the consumer is modeled as

[formula]

The representative consumer solves

[formula]

With the i.i.d. Type-I extreme value assumption on Œµi,j,t's, the choice probability becomes

[formula]

In the estimation, [formula] is equalized with the market shares sj,t. The inversion theorem of [\citet=Berry1994] [\citet=Berry1995] applies. The only difference is again the moment condition; [formula] is not zero, and it is highly likely to be positive. Thus, there has to be a correction term for this selection on the choice set, which leads us to the following estimation equation

[formula]

([\ref=eq:logitcorrection]) coincides with ([\ref=eq:loglineardemand]).

Robustness Checks

Cola Demand for Week 382

In this subsection, we estimate the same models as in Section [\ref=sec:Empirical-Example], with the data from a different week. We use the data of week 382 (from January 1 to 9, 1997). In Tables [\ref=tab:First-stage-Parameter-Estimates-1] and [\ref=tab:Parameter-Estimates-1], we repeat the estimation procedure for Tables [\ref=tab:First-stage-Parameter-Estimates] and [\ref=tab:Parameter-Estimates].

Cola Demand for Week 278

We repeat the estimation procedure for the cola data of week 278 (from January 5 to 11, 1995). It turns out that all the results show the same pattern as in the previous sections. Although not tabulated here, we also examined the data from many other weeks and the results were robust.

Laundry Detergent Demand for Week 375

In this subsection, we estimate the demand for laundry detergent using the same Dominick's data as in Section [\ref=sec:Empirical-Example]. We randomly picked a cross section of week 375, which is the third week of November 1996. The product is defined by UPC, and the market is defined by the week-store pair.

We computed the market shares by loads. There are two types of laundry detergents: liquid and powder. We converted the size of canister by the following criteria. For liquid laundry detergent, 1.6 ounces are counted as 1 load. For powder laundry detergent, 2.3 ounces are counted as 1 load. Some of the powder detergent used pound instead of ounces. For such product, 0.08262 pound is counted as 1 load. We also converted the size of a package. Since the density of powder detergents are around 0.65 and 1 = 0.065198, 1 pound of powder detergent is approximately 23.6 ounces. The market size is computed by assuming each consumer visiting the store consumes 6 loads of laundry detergent a week. Other details about the data are similar to what we described in Section [\ref=sec:Empirical-Example].

Table [\ref=tab:First-stage-Parameter-Estimates-1-1] presents the first-stage estimators, and Table [\ref=tab:Parameter-Estimates-1-1] presents the second-stage estimators. We find the same pattern as in Table [\ref=tab:Parameter-Estimates]: even after instrumenting for the prices, the estimated demand curve is upward sloping when the selection is not considered in the estimation.