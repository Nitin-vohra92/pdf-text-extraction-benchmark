Proposition Lemma Corollary Conjecture Question

Definition Example Remark

Flatness testing over singular bases

Dedicated to Edward Bierstone and Pierre D. Milman

for their 65'th birthdays.

Introduction and main results

This note is concerned with the algebraic notion of flatness. The past few years have seen a significant progress in the attempts to understand flatness of an (analytic or algebraic) morphism in explicit geometric terms. Following the work of Galligo and Kwieciski [\cite=GK], Adamus, Bierstone and Milman [\cite=ABM1] characterized flatness of a morphism φ:X  →  Y of complex-analytic spaces in terms of the so-called vertical components (see [\ref=subsec:vertical]) in fibred powers of φ. An analogous result in the algebraic category was later obtained by Avramov and Iyengar [\cite=AI]. Both theorems assume smoothness of the target Y, as the arguments, inspired by Auslander's [\cite=Au], rely on homological properties of modules over regular local rings.

On the other hand, very little is known in this context in case of singular targets. The best result we know of works only for finite maps over irreducible plane curves (see [\cite=HW]).

Our goal in the present paper is to generalize the results of [\cite=ABM1] to the singular setting. The following is a special case of our main result (Theorem [\ref=thm:main] and Corollary [\ref=cor:main] below).

Let φ:X  →  Y be a morphism of complex-analytic spaces, where Y is locally irreducible. Let ξ∈X. Let X{n} denote the n-fold fibred power of X over Y, where n =  dim Y, and let [formula] be the diagonal point corresponding to ξ. Finally, let [formula] be any dominant morphism of complex-analytic space germs with Zζ smooth of dimension n (e.g., Zζ can be a desingularization of Yη), where η  =  φ(ξ). Then φ is not flat at ξ if and only if the fibred product X{n}  ×  YZ has a vertical component at (ξ{n},ζ); i.e., a local irreducible component (perhaps embedded) of X{n}  ×  YZ at (ξ{n},ζ) whose image by the canonical map X{n}  ×  YZ  →  Y is nowhere-dense in Y.

Throughout the paper, by a dominant morphism [formula] of complex-analytic space germs we mean a germ at ζ of a holomorphic mapping σ:Z  →  Y such that σ(ζ) = η and, for an arbitrarily small open neighbourhood U of ζ in Z, we have [formula].

Note that, according to Theorem [\ref=thm:1], (X{n}  ×  YZ)(ξ{n} ,ζ) has no vertical components for some map germ [formula] satisfying the hypotheses of the theorem if and only if it has no vertical components for all such map germs. In particular, if Y is smooth then, to investigate flatness of φξ, we can choose Z = Y and [formula]. Then X{n}  ×  YZ can be identified with X{n}, and so in this case Theorem [\ref=thm:1] specializes to [\cite=ABM1].

Theorem [\ref=thm:main] and Corollary [\ref=cor:main] provide a more general criterion for OY,η-flatness of a finitely generated OX,ξ-module. Before formulating these results, we will recall the notion of verticality in complex-analytic modules.

Background: vertical elements and analytic tensor product

Let φ:X  →  Y be a holomorphic mapping of complex-analytic spaces. Let ξ∈X, η  =  φ(ξ)∈Y, and let [formula] be the induced morphism of germs. Let Σξ be an irreducible component (isolated or embedded) of Xξ; i.e., the zero-set germ of an associated prime (minimal or not) of the zero ideal in the local ring OX,ξ. We will say that Σξ is a geometric vertical component with respect to φξ, when a sufficiently small representative of Σξ is mapped by a representative of φξ into a nowhere-dense (with respect to the strong topology) subset of a representative of Yη.

One also defines another kind of vertical components, called algebraic vertical (see, e.g., [\cite=ABM1]). We will however not consider them at all in the present paper, and hence will simply use the term vertical components when refering to the geometric vertical ones defined above.

Since the set of zero-divisors of the ring OX,ξ coincides with the union of its associated primes, it follows that [formula] has a vertical component if and only if there exists a nonzero element m∈OX,ξ such that (a sufficiently small representative of) the zero-set germ [formula] of the annihilator of m in OX,ξ is mapped by (a representative of) φξ to a nowhere-dense subset of (a representative of) Yη. We can thus extend the notion of vertical component to a finitely generated OX,ξ-module F:

Let [formula] and let Zξ be the germ of a complex analytic subspace of X, defined by OZ,ξ: = OX,ξ / I. We say that F has a vertical component over Yη (or over OY,η), when Zξ has a vertical component over Yη in the above sense; equivalently, there exists a nonzero m∈F such that the [formula] is mapped to a nowhere-dense subgerm of Yη. We will call such m a geometric vertical element (or simply a vertical element) of F over Yη (or over OY,η).

Vertical elements are geometric analogues of zero-divisors in commutative algebra (see [\cite=ABM1] for details).

In the special case that F  =  OX,ξ, Xξ has no vertical components over Yη if and only if OX,ξ (as an OX,ξ-module) has no vertical elements over OY,η.

Now let R denote a local analytic [formula]-algebra, that is, a quotient ring [formula], for some [formula] and an ideal J in [formula] (the ring of convergent power series in n complex variables). By a local analytic R-algebra we mean a ring of the form [formula], with the canonical homomorphism R  →  R{x} / I, where I is an ideal in [formula] containing [formula]. Let F denote an R-module. Following [\cite=GR], we call F an analytic R-module when F is a finitely generated A-module, for some local analytic R-algebra A. In this case, there is a morphism of germs of complex-analytic spaces [formula] such that [formula], [formula], R  →  A is the induced pull-back homomorphism φ*ξ:OY,η  →  OX,ξ, and F is a finitely generated OX,ξ-module. We say that a nonzero element m∈F is vertical over R if m is vertical over OY,η in the sense of Definition [\ref=def:vert-element]. It is easy to see that the notion of vertical element is well-defined; i.e., independent of the choice of a witness A for F (cf. [\cite=GK]).

In the category of local analytic R-algebras with local R-algebra homomorphisms, the coproduct of two objects A = R{x} / I, B = R{x'} / I' exists, called the analytic tensor product over R, and is denoted by ARB. This can be shown to be isomorphic to [formula] (cf. [\cite=GR]). Given two analytic R-modules F1 and F2, witnessed by A1 and A2 respectively, one defines their analytic tensor product over R as

[formula]

Recall that every local analytic [formula]-algebra R corresponds to a unique complex-analytic space germ denoted [formula]. The duality between the categories of complex-analytic germs and local analytic [formula]-algebras (see [\cite=F]) implies the following important isomorphism. Suppose that φ1:X1  →  Y and φ2:X2  →  Y are holomorphic mappings of analytic spaces, with φ1(ξ1) = φ2(ξ2) = η. Then the local rings OXi,ξi (i = 1,2) are OY,η-modules and, by the uniqueness of fibred product and of analytic tensor product, the local ring OZ,(ξ1,ξ2) of the fibred product Z = X1  ×  YX2 at (ξ1,ξ2) is canonically isomorphic to OX1,ξ1OY,ηOX2,ξ2. Therefore, given a holomorphic germ φξ:Xξ  →  Yη, we can identify the d-fold analytic tensor power [formula] with the local ring of the d-fold fibred power OX{d},ξ{d}, for [formula].

Main results

Our main theorem is the following flatness criterion.

Let R be a local analytic [formula]-algebra and an integral domain of dimension n. Let F be an analytic R-module, and let S be any local analytic R-algebra which is regular, n-dimensional, and such that the induced morphism of complex-analytic space germs [formula] is dominant. Then F is R-flat if and only if the analytic tensor product

[formula]

has no vertical elements over R (equivalently, over S).

Note that an R-algebra S with the above properties always exists. One can, for instance, take S to be the local ring of a desingularization of (a sufficiently small representative of) [formula] (cf. [\cite=BM2]).

Let φ:X  →  Y be a morphism of complex-analytic spaces, where Y is locally irreducible, and let F be a coherent OX-module. Let ξ∈X. Let X{n} denote the n-fold fibred power of X over Y, where n =  dim Y, and let [formula] be the diagonal point corresponding to ξ. Finally, let [formula] be any dominant morphism of complex-analytic space germs with Zζ smooth of dimension n, where η  =  φ(ξ). Then Fξ is a flat OY,η-module if and only if the analytic tensor product

[formula]

has no vertical elements over OY,η (equivalently, over OZ,ζ).

Now, Theorem [\ref=thm:1] follows from Corollary [\ref=cor:main] with F  =  OX, according to Remark [\ref=rem:vert-equivalence] and the canonical isomorphism [formula].

In case when the source X is smooth, of the same dimension as Y, and the map germ φξ is dominant, Theorem [\ref=thm:1] has a particularly pleasing form:

Let [formula] be a dominant morphism of complex-analytic spaces germs, where Yη is irreducible, Xξ is smooth, and [formula]. Then φξ is flat if and only if the induced morphism [formula] has no vertical components over Yη.

In Theorem [\ref=thm:1], take Zζ: = Xξ and σζ: = φξ.

We derive Theorem [\ref=thm:main] from [\cite=ABM1] in Section [\ref=sec:proof-main], via an analytic flatness descent (see below). Section [\ref=sec:alg] contains an algebraic version of our flatness criterion (Theorem [\ref=thm:main-alg]) as well as Example [\ref=ex:sharp] proving sharpness of Theorem [\ref=thm:main].

Analytic flatness descent

By definition, a ring homomorphism R  →  S descends flatness if, for any R-module F, flatness of [formula] (as an S-module) implies flatness of F (as an R-module). In general, flatness descent is a rare luxury. However, as we show below, it does hold for analytic modules over integral domains and local analytic [formula]-algebra homomorphisms inducing dominant morphisms of analytic space germs.

We will say that a homomorphism R  →  S of local analytic [formula]-algebras analytically descends flatness if S-flatness of FRS implies R-flatness of F for every analytic R-module F.

Let κ:R  →  S be a homomorphism of local analytic [formula]-algebras, where R is an integral domain. If the induced morphism [formula] of complex-analytic space germs is dominant, then κ analytically descends flatness.

For a proof by contradiction, suppose the morphism [formula] is dominant and there exists a non-flat analytic R-module F such that FRS is S-flat. By Hironaka's local flattener theorem (see, e.g., [\cite=BM]), there exists a unique non-zero(!) ideal P in R such that FRR / P is R / P-flat and, for every morphism of analytic space germs [formula], if OTRF is OT-flat then φ factors as

[formula]

Since R is an integral domain, it follows that [formula] (hence also the image of T via φ) is nowhere-dense in [formula]. Taking [formula], we get a contradiction.

Proof of the main theorem

We begin with a simple observation regarding commutativity of the analytic tensor product. Let R be a local analytic [formula]-algebra, let A and S be local analytic R-algebras, and let F be a finitely generated A-module. Set A': = ARS and F': = FRS.

With the above notation, for every [formula], we have:

[formula] (as R-algebras).

[formula] (as R-modules).

We will prove the isomorphism (a) for i = 2. The general case follows easily by induction. Write S = R{u} / L, A = R{x} / I, and R{x'} / I' for another copy of A. Then, by [\ref=subsec:vertical], we have

[formula]

For the proof of part (b), apply (a) to a presentation of F as a finite A-module.

For reader's convenience, we recall the analytic flatness criterion of [\cite=ABM1], on which the proof of Theorem [\ref=thm:main] is based.

Let S be a regular local analytic [formula]-algebra and let M denote an analytic S-module. Let n  =   dim S. Then M is S-flat if and only if the n-fold analytic tensor power MnS has no vertical elements over S.

Proof of Theorem [\ref=thm:main]

Let S be an arbitrary local analytic R-algebra, which is a regular ring of dimension dim S = n =  dim R, and such that the induced morphism [formula] is dominant. Let F be an arbitrary analytic R-module.

By Proposition [\ref=prop:descent] and since flatness is preserved by base change ([\cite=H]), it follows that F is a flat R-module if and only if FRS is a flat S-module. Hence, by Theorem [\ref=thm:main-ABM1], F is R-flat if and only if the n-fold tensor power (FRS)nS has no vertical elements over S. By Lemma [\ref=lem:commutativity], this is equivalent to saying that FnRRS has no vertical elements over S.

To complete the proof, it remains to show that the latter is equivalent to the lack of vertical elements in FnRRS over R. Let then A denote a local analytic R-algebra for which F is a finitely generated A-module, and let [formula] denote a morphism of complex-analytic space germs such that R = OY,η, A = OX,ξ, and φ*ξ:OY,η  →  OX,ξ gives the R-algebra structure of A. Further, let [formula] denote a morphism of space germs such that S = OZ,ζ and σ*ζ:OY,η  →  OZ,ζ gives the R-algebra structure of S. Consider the following fibred product square

[formula]

Then, by Definition [\ref=def:vert-element], FnRRS has a vertical element over R if and only if there is a non-zero [formula] such that the zero-set germ [formula] is mapped by [formula] to a nowhere-dense subgerm of Yη. But σζ is a dominant morphism of irreducible germs of the same dimension, and hence σζ(Wζ) is nowhere-dense if and only if Wζ is so. Therefore verticality of m over R is equivalent to saying that λ(ξ{n},ζ) maps [formula] to a nowhere-dense subgerm of Zζ; i.e., m is vertical over S.

Algebraic case

The following is an algebraic version of our flatness criterion.

Let R be an n-dimensional finite type [formula]-algebra, which is locally analytically irreducible. Let A denote an R-algebra essentially of finite type, and let F denote a finitely generated A-module. Let S be any n-dimensional regular R-algebra of finite type such that the induced morphism [formula] is dominant. Then F is R-flat if and only if the tensor product

[formula]

is a torsion-free R-module (equivalently, a torsion-free S-module).

Here, by a locally analytically irreducible algebra we mean a finite type [formula]-algebra R such that the complex-analytic space canonically associated with [formula] is locally irreducible. This is the case, for example, if R is normal. An R-algebra essentially of finite type means a localization of a finite type R-algebra.

By analogy with Corollary [\ref=cor:X-smooth], if F = A is itself regular n-dimensional, we get the following:

Let R be an n-dimensional finite type [formula]-algebra, which is locally analytically irreducible, and let A be a regular n-dimensional R-algebra of finite type such that the induced morphism [formula] is dominant. Then A is R-flat if and only if the (n + 1)-fold tensor power [formula] is a torsion-free R-module.

By Theorem [\ref=thm:main-alg], in order to verify that F is not R-flat, it suffices to find an associated prime [formula] of [formula] in [formula] for which [formula]. Thus our criterion paired with computer algorithms for primary decomposition and desingularization (see, e.g., [\cite=GP]) provides a tool for checking flatness by effective computation, over an arbitrary complex affine locally analytically irreducible domain.

On the other hand, the bound n =  dim R is sharp (see Remark [\ref=rem:generalization] and Example [\ref=ex:sharp]).

The proof of Theorem [\ref=thm:main-alg] is virtually identical with that of [\cite=ABM1] (an algebraic variant of the flatness criterion of [\cite=ABM1]). One reduces to the analytic case by considering the complex-analytic spaces canonically associated with the spectra of the given rings, and then uses standard faithfull flatness arguments and the fact that vertical elements are precisely zero-divisors in the algebraic case. For details we refer the reader to [\cite=ABM1].

It is worth pointing out that, by the Tarski-Lefschetz Principle, one can generalize Theorem [\ref=thm:main-alg] by replacing [formula] with any field of characteristic zero (see [\cite=ABM2] for details). In this case, "analytically irreducible" needs to be replaced with "geometrically unibranch" (cf. [\cite=Gro]).

We conclude with an explicit calculation showing Theorem [\ref=thm:main-alg] at work. This example proves as well that, in general, over a non-regular R, tensoring with S is necessary for detecting non-flatness of an R-module F.

The following example of a non-flat module is due to Douady (see, e.g., [\cite=F]). Let

[formula]

and

[formula]

where [formula] denotes the radical of I. We will use Theorem [\ref=thm:main-alg] to verify that F is a non-flat R-module. Set

[formula]

Then S is the coordinate ring of the normalization of the (locally analytically irreducible) plane curve defined by R, hence it is a regular R-algebra, of dimension dim S = 1 =  dim R. Also, the mapping [formula] is dominant. Now, since dim R = 1, we need to look for R-torsion in [formula]. One can use a computer algebra software, like Singular (cf. [\cite=GP]), to verify that the S-module

[formula]

has an associated prime [formula] such that [formula]. Therefore [formula] has non-zero R-torsion, and hence F is not R-flat, by Theorem [\ref=thm:main-alg].

Finally, notice that F itself is a torsion-free R-module. To see this, observe that F has precisely two associated primes each of which contracts to zero in R.