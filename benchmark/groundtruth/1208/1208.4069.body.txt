Moments of L'(1 / 2) in the Family of Quadratic Twists

The values of L-functions L(s,f) at certain special half-integral points are of central importance in number theory, c.f. the Birch and Swinnerton-Dyer conjecture. Analytic methods have been used successfully to study the behavior of these special values in some family of objects, but much remains unknown. In this paper we study the central values of derivatives of L-functions of holomorphic GL(2) modular forms in the family of quadratic twists. The mean value of this family has been studied successfully in the past by several authors, notably Bump, Friedberg and Hoffstein [\cite=BFH], Murty and Murty [\cite=MurtyMurty], Iwaniec [\cite=IwLvanishing] and Munshi [\cite=MunshiMoments2], [\cite=MunshiMoments3].

When [formula] has even functional equation an asymptotic formula for the second moment of [formula] was computed assuming the generalized Riemann hypothesis (GRH) by Soundararajan and Young [\cite=SoundYoung]. Here, we apply their techniques to several moment problems of comparable difficulty when the sign of the functional equation is - 1 and the derivative [formula] is the correct object of study. The family of quadratic twists with root number + 1 as considered by Soundararajan and Young has even orthogonal symmetry in the sense of random matrix theory, while the family we consider has root number - 1 and odd orthogonal symmetry. Surprisingly, we find that stronger results are possible in the odd case: the analogues of theorems [\ref=thm2] and [\ref=thm3] of are out of reach when the root number of [formula] is 1 and one studies the L-functions themselves. As in Soundararajan and Young, our work is conditional on GRH, but we only use this hypothesis to obtain a useful upper bound to the corresponding un-differentiated moment problem, see conjectures [\ref=conjecture1] and [\ref=conjecture2]. The deduction of the necessary upper bounds from GRH is due to Soundararajan [\cite=SoundMoments]. We restrict our attention to holomorphic forms in this paper, but our results should carry over to Maass forms with only minor modifications to the proofs.

Before stating our results, let us fix some notation and recall some standard facts which can be found in chapter 14 of [\cite=IK]. We consider the space of cuspidal holomorphic modular forms of even weight κ on the congruence subgroup Γ0(N) with trivial central character. Such forms have a Fourier expansion of the form

[formula]

We fix a basis of newforms which are eigenfunctions of the Hecke operators and have λf(1) = 1. From now on, we assume all forms f which we work with are elements of this basis. The Hecke eigenvalues of f are all real (by the adjointness formula and multiplicity one principle), and hence f is self-dual. We study the family of twists of f by quadratic characters. Let d be a fundamental discriminant relatively prime to N, and let [formula] denote the primitive quadratic character of conductor |d|. Then [formula] is a newform on Γ0(N|d|2) and the twisted L-function is defined for [formula] by

[formula]

The completed L-function is defined by

[formula]

It has the functional equation

[formula]

where η is given by the eigenvalue of the Fricke involution, which is independent of d and always ±  1. We denote the root number by [formula]. Note that if d is a fundamental discriminant, then [formula] depending as whether d is positive or negative. In this paper we work with positive discriminants so that χd( - N) = χd(N), but we could just as easily formulate our results with negative discriminants.

We are interested here in the derivative of the L-function, which also has a Dirichlet series convergent in a right half-plane:

[formula]

It also has a functional equation

[formula]

with sign opposite to that of [formula]. When [formula] one has that [formula] and [formula] is the more appropriate object for study.

I would like to acknowledge the support of the number theory community at Stanford, and I would especially like to thank Professor Soundararajan for many fruitful discussions.

Statement of Main Results

In the results of this section we assume the generalized Riemann hypothesis (GRH) for the zeta function, the family of quadratic twists of f and g and the symmetric square of f and g. See also the comments immediately before and after conjectures [\ref=conjecture1] and [\ref=conjecture2], below. We use the notations [formula] or D to denote the sets of square-free integers or fundamental discriminants, respectively. Let [formula] be a fixed smooth function with compact support closely resembling the indicator function of the interval

[formula]

with compact support. For any normalized cuspidal Hecke newform f with trivial central character, odd level N and even weight κ we have In the above

[formula]

γ is Euler's constant, and Z*(u,v) is a holomorphic function defined by [\eqref=prod1] and [\eqref=Z1] for [formula] given by a sum of two absolutely convergent Euler products and is uniformly bounded in u,v where it converges. Moreover, Z*(0,0) = 0 if and only if the root number w(f)  =  1 and N is square, in which case the moment vanishes identically.

By the celebrated theorem of Gross and Zagier [\cite=GrossZagier], theorem [\ref=thm1] also gives the variance of canonical heights of Heegner points on an elliptic curve associated with f. Note that the analogue of theorem [\ref=thm1] without the derivative is the main result of Soundararajan and Young [\cite=SoundYoung]. In this paper, we compute the main terms in a slightly different manner than do Soundararajan and Young, and applying our technique to the second moment without derivatives improves the error term there to ≪  κ,εX( log X)1 / 2 + ε. Nonetheless, shifted moments are still crucial to the theorem of Soundararajan and Young, whereas they are not necessary here.

The next theorem is a moment for two distinct modular forms f and g. Theorem [\ref=thm2] is particularly interesting because the asymptotic formula for the analogous moment without derivatives is completely out of reach by current techniques.

Assume GRH, and let F(  ·  ) be a smooth approximation to the indicator function of

[formula]

Lastly, theorem [\ref=thm3] below is a first moment in the twist aspect with controlled dependence on both the weight κ and level N. Again, the analogue of theorem [\ref=thm3] without the derivative is completely out of reach, but would have interesting corollaries, see [\cite=LiuYoung].

Assume GRH, and let F(  ·  ) be a smooth approximation to the indicator function of

[formula]

Thus our methods break convexity in the dependence on κ and N in the error term by an arbitrary power of log. Using GRH once again, we obtain non-vanishing results. By applying the technique from [\cite=IK] theorem 5.17 we have that

[formula]

These terms therefore may be subsumed into the error term in theorem [\ref=thm3]. In the same vein, by theorem 5.19 of [\cite=IK] one has the bound

[formula]

From these estimates and theorem [\ref=thm3] the following corollary is obtained.

Assume GRH. If the root number of f is 1 then assume also that the level of f is not an integer square. For any A > 0 there exists an odd squarefree d relatively prime to N with d  ≪  AκN  /  ( log κN)A for which

[formula]

If [formula] is an elliptic curve given by the Weierstauss equation y2 = f(x), we may define the twisted elliptic curve [formula] by the equation dy2 = f(x). By the work of Gross and Zagier [\cite=GrossZagier] and the modularity theorem [\cite=BCDT] we have the following corollary.

Assume GRH. Let [formula] be an elliptic curve of odd conductor N. If the root number of E is 1, then assume also that the conductor N is not an integer square. For every A > 0 there exist odd squarefree d relatively prime to N with d  ≪  AN / ( log N)A for which the curve [formula] has root number - 1 and Mordell-Weil rank exactly 1.

One expects the convexity bound here to be a non-vanishing twist of size d  ≪  ε(κN)1 + ε, see e.g. Hoffstein and Kontorovich [\cite=HoffsteinKontorovich]. Our non-vanishing corollaries on GRH are, in fact, quite weak. As previously remarked by many authors, the method of moments is an inefficient way to produce non-vanishing theorems. If one is willing to assume GRH, the methods of Iwaniec, Luo and Sarnak [\cite=ILS], Özlük and Snyder [\cite=OS2], [\cite=OS3] or Heath-Brown [\cite=HBAvgRank] adapted to small nonvanishing twists should yield better results. We postpone carrying out this line of research to a future paper, and moreover, we believe that the theorems [\ref=thm1], [\ref=thm2] and [\ref=thm3] have interest independent of the corollaries.

We do not use the full strength of GRH in theorems [\ref=thm1], [\ref=thm2] or [\ref=thm3]. In fact, in the case of the first two all we need is the following conjecture.

Let ε > 0, and t be a real number with |t|  ≤  X and 1 / 2  ≤  σ  ≤  1 / 2 + 1 /  log X. Then

[formula]

Theorem [\ref=thm3] on the other hand is true if we assume than N is odd squarefree and conjecture [\ref=conjecture2] in place of GRH.

Let ε > 0, and t be a real number with |t|  ≤  X and 1 / 2  ≤  σ  ≤  1 / 2 + 1 /  log X. Then

[formula]

The work of Soundararajan [\cite=SoundMoments] shows that conjecture [\ref=conjecture1] follows from the GRH for the Riemann zeta function, the family of quadratic twists of f and the symmetric square of f. By keeping track of the dependence on κ and N in Soundararajan's proof, one finds that the GRH for quadratic twists of f, the Riemann zeta function, and the symmetric square of f implies conjecture [\ref=conjecture2]. Unconditionally, all that is known towards conjectures [\ref=conjecture1] and [\ref=conjecture2] is a bound of the form ≪  f,ε(X(1 + |t|))1 + ε due to Heath-Brown's quadratic large sieve [\cite=HBQuadSieve]. It seems that obtaining the results of this paper unconditionally should not be completely out of reach, but nonetheless, doing so requires additional ideas.

Let us briefly describe the main difficulties in proving the above theorems, some previous attacks on these difficulties, and the new input in our work which allows us to overcome them.

Take for example theorem [\ref=thm1]. After applying the approximate functional equation and pulling the sum over d inside one encounters a sum of the form

[formula]

for some cut-off function F, where χd is the quadratic character modulo d. One wants to apply Poisson summation to this sum, but the length of the sum U  ≈  X is comparable to the square root of the conductor [formula], so the dual sum that one obtains is of the same shape as the original. This is the familiar "deadlock" situation described, for example, in the paper of Munshi [\cite=MunshiMoments2], or by multiple Dirichlet series, for example in [\cite=DGH]. This deadlock has been broken in some ways before. Soundararajan and Young find that the second moment of [formula] is transformed by Poisson summation to the dual problem of finding an estimate of the integral over shifts it1 and it2 of the same moment. They exploit this transformation using GRH to obtain upper bounds on shifted moments to prove their theorem. Munshi observes in the paper [\cite=MunshiMoments2] that taking derivatives amplifies the main term of moments but does not affect the error term. He uses this fact to unconditionally obtain an asymptotic formula for the first moment of higher derivatives [formula] with [formula] weighted by the number of representations of d as a sum of two squares (a situation with conductor of similar length to ours). Munshi also solves a similar problem in [\cite=MunshiMoments3] obtaining an asymptotic for the first derivative in the special case that f corresponds to a CM elliptic curve.

In our paper, we observe that taking a derivative concentrates the mass of [formula] in the terms of the approximate functional equation with small n. When we truncate U  ≤  X / ( log X)100 we gain something from Poisson summation, and treat the tail separately. The idea behind bounding the tail is that

[formula]

so that when |d| / ( log |d|)100  ≤  n  ≤  |d| we have that the 0  ≤   log |d| / n  ≪   log  log |d| are quite small. These terms look essentially like the series for [formula], the moments of which are smaller than moments of the derivative. We are then able to use Soundararajan's upper bounds assuming GRH [\cite=SoundMoments] to bound the tail. The idea is that the dual sum of a moment of [formula] looks like a moment of the un-differentiated [formula] which we exploit to obtain our results.

Approximate Functional Equation

We begin with a lemma which will be used in all three theorems.

Let f be a λf(1) = 1 normalized cuspidal newform on Γ0(N) with trivial central character and root number w(f) = iκη. Let Z > 0 be an arbitrary real number parameter. Define the cut-off function

[formula]

Then

[formula]

We follow Iwaniec and Kowalski [\cite=IK] Section 5.2. Take

[formula]

so that by a change of variables and an application of the functional equation we have

[formula]

If the root number [formula], we take s = 1 / 2 to find

[formula]

as in the statement of the lemma. On the other hand, if the root number of [formula] is 1, then [formula], hence

[formula]

Thus the lemma holds for both cases of root number of [formula].

In the proof of theorems [\ref=thm1] and [\ref=thm2] we will use Z = 1 so that the approximate functional equation takes a particularly simple form. Let N be the level of f. In the proof of theorem [\ref=thm3] we take Z = N1 / 2 to compensate for the asymmetry in estimates in level aspect introduced from averaging over root numbers. Note that the only difference in the approximate functional equation for [formula] as opposed to that of [formula] is the sign of the root number, and the denominator of the integrand of W(x), which becomes u2 instead of u. Therefore, many of the calculations necessary for our results are identical to those in the paper of Soundararajan and Young [\cite=SoundYoung].

Proof of Theorem [\ref=thm1]

We prove theorem [\ref=thm1] by splitting the sums in the approximate functional equation (lemma [\ref=approxfe]), and using proposition [\ref=prop1] below to compute the main terms.

Let F be a smooth, nonnegative, compactly supported function on [formula], and recall the definition of W(x) = W1(x) from the approximate functional equation (lemma [\ref=approxfe]). For a parameter U  ≤  X / ( log X)100 define the truncated sum

[formula]

and define the tail [formula] by setting [formula] Define the sums

[formula]

so that we have the decomposition

[formula]

Using the below proposition [\ref=prop1] we will be able to give asymptotic formulae for [formula] and [formula], and using conjecture [\ref=conjecture1] we will obtain an upper bound on [formula] smaller than the main terms. Applying this decomposition in Soundararajan and Young's work improves the error term there to [formula].

For N' = 1 or N, and h(x,y,z) some smooth cut-off function let

[formula]

Assume GRH or conjecture [\ref=conjecture1]. Let X,U1,U2 large, U1U2  ≤  X2, and N odd. Let h(x,y,z) be a smooth function on [formula] with compact support in x, having all partial derivatives extending continuously to the boundary, satisfying

[formula]

Set [formula] Then

[formula]

This proposition and its proof are nearly identical to the main proposition from the paper of Soundararajan and Young [\cite=SoundYoung] (see proposition 3.1 and the remarks in § 5 of that paper) except for minor details of generalizing from full level to arbitrary level N, so we omit the proof. The main idea is to use Poisson summation (see lemma [\ref=PoissonSummation]) to evaluate the sum over discriminants d, and conjecture [\ref=conjecture1] to bound the dual sum thereby obtained.

We now proceed to the computation of [formula] and [formula]. Let h(x,y,z)  =  F(8x / X)W(y / U)W(z / 8x). In the notation of proposition [\ref=prop1] we have by the approximate functional equation that

[formula]

For notational ease, set [formula] which, recall, appears in the function W(x). Let [formula] denote the Mellin transform and set

[formula]

Applying proposition [\ref=prop1] and Mellin inversion, we find that

[formula]

We compute for either N' = 1 or N that ZN'(u,v) has the Euler product

[formula]

Hence we have that

[formula]

where Z*N(u,v) and Z*1(u,v) are given by some absolutely convergent Euler products and are uniformly bounded in the region [formula] in u,v,κ and N. Set Z(u,v): = ZN(u,v) - iκηZ1(u,v) and

[formula]

A careful inspection of [\eqref=Z1] and [\eqref=prod1], using positivity of (1  ±  λf(p)p- 1 / 2)- 1 shows that Z*(0,0) = 0 if and only if ε(f) = 1 and N is a square.

We now compute by shifting contours of [\eqref=integral1]. Start the lines of integration at [formula], and begin the computation with shifting the v integration to the [formula] line. We encounter poles at v = 0 and v =  - u. The remaining double integral on the lines [formula] and [formula] is ≪  κ,N,εX- 1 / 10 + ε, and the contribution from the simple pole at v =  - u is ≪  κ,N1. The main term comes from double pole at v  =  0, giving Now Z(u,0) has a single pole and [formula] has a double pole. Combine these with u2 in the denominator, and we encounter a triple and quadruple pole. The residue of the triple pole of

[formula]

at u = 0 is given by

[formula]

The residue of the quadruple pole of

[formula]

at u = 0 is given by

[formula]

By shifting the line of integration to [formula], we find that the the remaining integral is ≪  κ,N,εX- 1 / 5 + ε, hence collecting the above terms coming from residues, we find that

The sum [formula] is computed similarly, but with a different choice of h(x,y,z). As above, the main term comes from the intersection of the two polar divisors u = 0 and v = 0. One finds

We now give an upper bound for the sum [formula] which, recall, involves BU. We have

[formula]

Recall that [formula] has root number - 1 and vanishes at s = 0, therefore the integrand is actually entire and we move the line of integration to the [formula] line. On this line

[formula]

uniformly in s, thus

[formula]

Inserting this in [formula] we have that

[formula]

Use Cauchy-Schwarz to split the sum over d above in two, so that it suffices to bound

[formula]

We have that

[formula]

and

[formula]

uniformly in t by conjecture [\ref=conjecture1] and the sharp cut-off in [formula] for large t. Bringing these estimates together we find that

[formula]

Note that in contrast to the work of Soundararajan and Young, shifted moments are not necessary to prove our theorem.

Finally, set U  =  X / ( log X)100. Note that

[formula]

so that pulling together our evaluations of [formula] and [formula] we find

Proof of Theorem [\ref=thm2]

We turn to the moment for two different forms f and g of levels N1 and N2 respectively. Set N = N1N2. The proof of theorem [\ref=thm2] is a slight variation on the proof of theorem [\ref=thm1].

Assume GRH or conjecture [\ref=conjecture1], and that U  ≤  X  /  ( log X)100. We split the sum [formula] where [formula] and [formula] are defined at the outset of Section [\ref=ProofofTheorem1]. Take the decomposition

[formula]

Summing over [formula], we have the 4 sums which we denote by

[formula]

[formula]

[formula]

and

[formula]

so that

[formula]

We can compute precise asymptotic estimates for [formula] [formula] and [formula], meanwhile [formula] can be reduced by Cauchy-Schwarz to the sum [formula] from the proof of theorem [\ref=thm1]. Hence

[formula]

We next state the proposition which allows us to compute the sums [formula] [formula] and [formula]. Let N' be one of the four choices N'  =  1,N1,N2, or N. Define

[formula]

Assume GRH or conjecture [\ref=conjecture1]. Let X,U1,U2 large, U1U2  ≤  X2, and N = N1N2 odd. Let h(x,y,z) be a smooth function on [formula] with compact support in x, having all partial derivatives extending continuously to the boundary, satisfying

[formula]

Set [formula] Then

[formula]

Proposition [\ref=prop2] is a slight variation on proposition [\ref=prop1], so we omit the proof. The reader should take note of the remarks following proposition [\ref=prop1], as they apply just as well to proposition [\ref=prop2].

Now we proceed to use this proposition to evaluate [formula] [formula] and [formula]. Take for example the case [formula], for which we set h(d,n1,n2)  =  F(8d / X)W(n1 / U)W(n2 / 8d). By the approximate functional equation (lemma [\ref=approxfe]) with Z = 1 we have that

[formula]

Likewise, [formula] and [formula] are evaluated the same way with h(d,n1,n2)  =  F(8d / X)W(n1 / 8d)W(n2 / U) and h(d,n1,n2)  =  F(8d / X)W(n1 / U)W(n2 / U), respectively.

Next, we evaluate the main terms of the various Sf,g in [\eqref=thm2intermsofS] by contour integration. We set [formula] to be the Mellin transform of W1(x), and similarly for Gg. For N' = 1,N1,N2 or N define the Dirichlet series ZN'(u,v) by

[formula]

One has therefore that

[formula]

Let χ0,Ni be the trivial Dirichlet character mod Ni for i = 1,2, that is to say,

[formula]

Then the Euler product for ZN'(u,v) is given by

[formula]

If αf(p) and βf(p) are the local roots of f with αf(p) + βf(p) = λf(p), then we define for [formula]

[formula]

and for [formula] by analytic continuation. Then in any of the four cases N' = 1,N1,N2, or N, we have that

[formula]

where Z*N'(u,v) is given by some absolutely convergent Euler product which is uniformly bounded in the region [formula]. Set Z(u,v)  =  Z1(u,v) - iκ1ηfZN1(u,v) - iκ2ηgZN2(u,v)  +  ZN(u,v), and

[formula]

A careful inspection of [\eqref=Z2] and [\eqref=prod2] using positivity of (1  ±  λf(p)p- 1 / 2)- 1 shows that Z*(0,0) = 0 if and only if either root number w(f) or w(g) = 1, and the corresponding N1 or N2 is a square.

With this information about ZN'(u,v), one shifts contours of [\eqref=integral2] as in the proof of theorem [\ref=thm1] to compute the various Sf,g. We find that

[formula]

and similarly for [formula]. We also compute

[formula]

Finally, setting U  =  X / ( log X)100 we obtain

[formula]

Proof of Theorem [\ref=thm3]

In this section, we apply the techniques of the previous two sections to the first moment of [formula] over twists, keeping careful track of the dependence on both the weight κ and the level N.

We prove the theorem by splitting the sum into a main part and tail, and use the asymmetric approximate functional equation (lemma [\ref=approxfe]) with Z = N1 / 2. Assume GRH or conjecture [\ref=conjecture2], and that both κN  ≤  X and [formula] for A > 0 fixed. Define the main part

[formula]

and the tail [formula] as in Section [\ref=ProofofTheorem1]. Following Soundararajan and Young again, we give the analogue of propositions [\ref=prop1] and [\ref=prop2] for the first moment. Let N' = 1 or N, and for h(x,y) a smooth function on [formula] set

[formula]

We will use the following proposition with z equal to either Z = N1 / 2 when N' = 1, or Z- 1 = N- 1 / 2 when N' = N.

Assume GRH or conjecture 2. Let z > 0 be a parameter (c.f. the asymmetric approximate functional equation), and let X and U be large. Suppose that N is odd, and that [formula]. Let h(x,y) be a smooth function on [formula] which is compactly supported in x, having all partial derivatives extending continuously to the boundary, and satisfying the partial derivative bounds

[formula]

Then, setting [formula] we have

[formula]

[formula]

Proposition [\ref=FirstMomentCalculation] is sufficiently different from proposition 3.1 of Soundararajan and Young that we give a detailed proof in Section [\ref=pfprop3].

Let hL(x,y): = F(8x / X)WN1 / 2(y / U) and hS(x,y): = F(8x / X)WN- 1 / 2(y / U) for "long" and "short", respectively. Recall for fundamental discriminants d > 0 that χd( - N)  =  χd(N), so that we have in the notation of proposition [\ref=FirstMomentCalculation] that the main part of the moment is

[formula]

Recalling that [formula] and taking z = N1 / 2 or N- 1 / 2 in proposition [\ref=FirstMomentCalculation] we have that

[formula]

For N' = 1 or N define the Dirichlet series

[formula]

We compute from the definition of WZ(x) that

[formula]

and in the same way that

[formula]

The Dirichlet series ZN'(u) also has an Euler product

[formula]

We have then that

[formula]

where Z*N'(u) is given by some absolutely convergent Euler product in the region [formula]. Moreover, inspecting the above Euler product, we see that

[formula]

and

[formula]

uniformly in κ.

With this information about ZN'(u), we shift the contours in [\eqref=MT1] and [\eqref=MT2] to [formula], and pick up the residue from the double pole at u = 0. The double pole in [\eqref=MT1] or [\eqref=MT2] contributes

[formula]

We must also bound the integrals

[formula]

and

[formula]

These two are treated a little differently. Let us begin with the simpler case of [\eqref=MT1s]. We have the convexity bound

[formula]

by estimating with the approximate functional equation of the symmetric square L-function, and the Deligne bound [\cite=DeWC] for its coefficients (see for example, equation (5.22) of [\cite=IK]). Hence, the integral [\eqref=MT1s] is

[formula]

The integral [\eqref=MT2s] is a little more delicate, and we need to use the decay of Z*N(u) with respect to N. When [formula], we have that

[formula]

so that

[formula]

Assuming e.g. that N is squarefree, this shows that for fixed [formula] ZN(u) decays as a function of N. If one is willing to assume Lindelöf, it is unnecessary to use the decay of Z*N(u) with respect to N, and hence the restriction to squarefree N may be omitted. Using this along with the convexity bound [\eqref=convexity] for [formula], we find that [\eqref=MT2s] is

[formula]

so that these integrals are subsumed into the error term in the theorem.

Now set

[formula]

so that we have from [\eqref=Asum] that By carefully inspecting [\eqref=prod3] and using that

[formula]

we find that Z*(0) = 0 if and only if iκη: = w(f)  =  1 and N is a square and that if Z*(0)  ≠  0, it is ≫   log  log N  /  ( log N)1 / 2, uniformly in κ.

Now consider the tail

[formula]

Recall the notation [formula] from the definition of WZ(x), and that we have set Z = N1 / 2. We have in similar fashion to the two preceding theorems that

[formula]

The integrand is entire, and we may shift the contour to the line [formula]. On this line we have

[formula]

so that Set [formula]. Using conjecture [\ref=conjecture2] when t is small and the cut-off in |G(1 /  log XκN) + it|1 / 2 when t is large we have

[formula]

We also have the estimate

[formula]

so that pulling these estimates together we obtain

[formula]

hence the theorem.

Proof of Proposition [\ref=FirstMomentCalculation]

We treat the two cases N' = 1 and N' = N somewhat differently. In the case N' = 1, the dependence on N in T(1,h) appears only in the relatively prime condition, which we may we treat solely by Möbuis inversion. In the case of T(N,h), the dependence on N is carried through the average over quadratic characters, but there is one less inversion to preform, making the calculation a bit simpler.

The condition [formula] has been introduced to the sum over twists to restrict 8d to lie in a large subsequence of fundamental discriminants. However, this condition is awkward to work with and our first task will be to remove it.

Preliminary simplifications, N' = 1 case

We start with the N' = 1 case. We use Möbius inversion to remove both the squarefree and relatively prime to N conditions from the sum over d,

[formula]

Split the sums over a1 and a2 at Y1 and Y2 in to tail and main term. This splitting results in 4 truncated sums:

[formula]

where we have defined

[formula]

[formula]

[formula]

[formula]

The main term will come from the most difficult sum T1(1,h). First, however, we estimate the other cases T21(1,h), T22(1,h) and T23(1,h).

Assume GRH or conjecture [\ref=conjecture2]. We have the bounds

[formula]

[formula]

[formula]

Consider the case T21(1,h) and write [formula] with [formula] (b1,N) = 1 and b2|N. Group the variables as c1  =  a1b1 and c2  =  a2b2 to obtain

[formula]

Let fc2 denote the newform given by the quadratic twist [formula] which is of some level dividing N2. Set [formula] which by repeated partial integration can be estimated by

[formula]

We then have by Mellin inversion that T21(1,h) is

[formula]

where [formula] is the function formed from the same Euler product as [formula] but with those factors at primes dividing c1 omitted. We have that

[formula]

so that shifting the contour to the line [formula] we have that T21(1,h) is Using conjecture [\ref=conjecture2] (i.e. GRH) we find that

[formula]

The cases T22(1,h) and T23(1,h) are treated similarly.

Averaging quadratic characters

We now turn to T1(1,h). We quote two very useful lemmas from [\cite=Sound2000]. The first is lemma 2.6 of [\cite=Sound2000], which is the trace formula for quadratic characters.

Let F be a smooth function with compact support on the positive real numbers, and suppose that n is an odd integer. Then

[formula]

where

[formula]

and

[formula]

is a Fourier-type transform of F.

The Gauss-type sum Gk(n) has the following explicit evaluation from lemma 2.3 of [\cite=Sound2000]:

If m and n are relatively prime odd integers, then Gk(mn)  =  Gk(m)Gk(n), and if pα is the largest power of p dividing k (setting α  =    ∞   if k = 0), then

[formula]

Applying these lemmas to T1(1,h) we find that

[formula]

The main term

The main term of T1(1,h) is from the k = 0 term of [\eqref=like305], which we extract and analyze. Call the k = 0 term T10(1,h), and observe from lemma [\ref=GaussSum] that G0(n)  ≠  0 if and only if n is a square, in which case G0(n)  =  φ(n). Setting [formula], we find

[formula]

so that using the bounds on h in the statement of the proposition we have

[formula]

Bounding the dual sum

We now proceed to the k  ≠  0 terms of T1(1,h), which we call T3(1,h). Our first task is to express the integral in [\eqref=like305] in terms of Mellin inverses.

Let k  ≠  0, X > 1 and let h(x,y) be as in the statement of the theorem. Define the transform

[formula]

Then we have

[formula]

Moreover one has the bounds

[formula]

Use the formulae for the Mellin transforms of sin  and cos  and Mellin inversion. See Soundararajan and Young [\cite=SoundYoung], Section 3.3.

Inspecting lemma [\ref=GaussSum], we find that for odd n, Gk(n)  =  G4k(n), so that inserting the formula of lemma [\ref=transform] in [\eqref=like305], one finds that Recall that we denote the set of fundamental discriminants by D. Now set 4k = k1k22k3, where k1k3∈D, and (k1,N) = 1 but k3|N. Define the function

[formula]

and set

[formula]

Splitting up 4k in this manner and after a change of variables one finds that

[formula]

To estimate T3(1,h) by contour shifting, we must analyze the Dirichlet series Z1.

Let k1k3 be a fundamental discriminant, where k3|N but (k1,N) = 1, and q1,q2 positive integers where q2|N and (q1,2N) = 1. Denote by fk3q2 the newform defined by the quadratic twist [formula], which is of some level dividing N3. For the Dirichlet series defined by [\eqref=DirichletSeriesZ] one has

[formula]

where subscripts denote the omission of Euler factors, and Z*1 is given by some Euler product absolutely convergent in [formula] and [formula] and uniformly bounded in q1,q2,k1,k3,κ and N.

By lemma [\ref=GaussSum], the terms of the Dirichlet series defining Z are joint multiplicative in n and k2, so that we may decompose Z as an Euler product. The generic Euler factor is given by

[formula]

and we must check the several cases where p divides the various parameters N,q1,q2,k1,k3, or not. First, we consider the generic case where [formula] By lemma [\ref=GaussSum], we find that the terms k2  ≥  1 contribute ≪  p- (1 + 2ε), and the k2  =  0 terms are exactly

[formula]

so that these Euler factors match those in the statement of the lemma. Next, consider the cases p|k1, [formula] or p|k3, [formula]. In either of these two cases we check that such an Euler factor is

[formula]

which again matches the Euler factor in the lemma. If p|N, but [formula], then this Euler factor is

[formula]

Observing that λf(p2) = λf(p)2 for primes dividing the level, the also matches the Euler factor from the statement of the lemma. Finally, if p|q1q2, then all terms n  ≥  1 vanish, and the contribution of such an Euler factor is 1 + O(p- (1 + 2ε)).

We now return to [\eqref=like311], and split the sum over k1 at [formula]. For the small k1 terms, we shift the lines of integration to [formula] and [formula], and for the large k1 terms to [formula] and [formula]. Recall that [formula] and observe

[formula]

Applying the result of Goldfeld, Hoffstein and Lieman [\cite=HLAppendix], the small k1 terms are Using conjecture [\ref=conjecture2], i.e. GRH, we find that this is [formula] Now consider the large k1 terms. Similarly, their contribution is Again, by conjecture [\ref=conjecture2], this is [formula] Taking

[formula]

we find that

[formula]

and drawing all error terms together we obtain the proposition for N' = 1.

The N' = N case

The proof in the T(N,h) case follows the same outline as in the T(1,h) case, above. We need only Möbius invert the squarefree condition and not the relatively prime to N condition, but we must keep careful track of the dependence on N in the analogue of lemma [\ref=likeLemma331]. We sketch the argument, omitting those details which are similar to those of T(1,h).

We begin by using Möbius inversion to remove the squarefree condition and split the resulting sum at Y.

[formula]

By a slight modification of lemma [\ref=T_2], we find that

[formula]

and so we concentrate on T1(N,h). Applying Poisson summation (lemma [\ref=PoissonSummation]), we have that

[formula]

Now we pick out from T1(N',h) the main term, which is when k = 0, and call it T10(N,h). By pulling the sum over a inside and computing as in Subsection [\ref=mainterm], we find that

[formula]

Now we turn to the k  ≠  0 terms of T1(N,h) and call them T3(N,h). Define

[formula]

Recall the definition of H(s) from [\eqref=H] and apply the inversion formula [\eqref=inversion] for the weight function, to find the analogue of formula [\eqref=like311]:

[formula]

In order to use contour shifting, we analyze the Dirichlet series ZN, taking special care with the dependence on N.

Let k1k3 be a fundamental discriminant, where k3|N but (k1,N) = 1, and q positive integer relatively prime to 2N. Denote by fk3 the newform defined by the quadratic twist [formula], which is of some level dividing N2. For the Dirichlet series defined by [\eqref=DirichletSeriesZN] one has

[formula]

where [formula] uniformly in [formula], [formula]

From lemma [\ref=GaussSum] we see that the summand is within a constant of being jointly multiplicative in n,k2, so that we may write an Euler product. We use the notation pr||N to mean that r is the largest power of p dividing N. Then ZN is given by

[formula]

We must check all possible cases when p does or does not divide the parameters N,q,k1 and k3. Let us begin with the generic [formula]. Suppose first that [formula]. We have that all of the terms where k2  ≥  1 contribute ≪  p- (1 + 2ε), uniformly in all parameters. The k2 = 0 terms are exactly

[formula]

which matches the proposed Euler factor in the statement of the lemma up to a uniformly bounded factor. Now we consider the terms with [formula] but p|k1. In this case, the Euler factor is given by

[formula]

which exactly matches the Euler factor in the statement of the lemma up to a uniformly bounded factor in N,κ,k1. If p|2q, then the Euler factor is 1 + O(p- (1 + 2ε)).

Now we turn to the terms where p|N. Inspecting lemma [\ref=GaussSum] we find four cases depending on whether p divides N to even or odd order and whether p|k3 or not. When r is odd the second product of [\eqref=prod] is

[formula]

and when r is even this product is

[formula]

If r is even then r  ≥  2, so we have that [formula]

Now we return to T3(N,h), and split the sum over k1 at UκN3 / 2zY2 / X. When |k1|  ≤  UκN3 / 2zY2 / X, shift the lines of integration to [formula] and [formula], and for the tail k1, shift to [formula] and [formula]. We have that

[formula]

unconditionally due to the work of Goldfeld, Hoffstein and Lieman [\cite=HLAppendix]. We also have the estimate [formula] so that the small k1 of T3(N,h) are We have that by conjecture [\ref=conjecture2] this is ≪  (UκN3 / 2z)1 / 2Y( log XκN)6. Similarly the tail k1 terms are which is ≪  (UκN3 / 2z)1 / 2Y( log XκN)6 as well by conjecture [\ref=conjecture2]. Taking Y = X1 / 2 / (UκN3 / 2)1 / 4, we find

[formula]