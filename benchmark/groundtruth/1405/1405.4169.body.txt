cm 0.12 cm

Corollary Lemma Proposition Definition Remark Notation Example

Phylogenetic invariants for [formula] scheme-theoretically

Introduction

One of the most important questions in phylogenetic algebraic geometry, motivated by applications, is to determine the ideal of phylogenetic invariants, i.e. the ideal of polynomials vanishing on an algebraic variety corresponding to a model of evolution. It turns out that even determining the minimal degree in which this ideal is generated is a difficult problem. This question is often addressed in the setting of general group-based models of evolution (see e.g. [\cite=Ph]), i.e. models with an abelian group of symmetries. The simplest (but having very interesting properties, studied in [\cite=BW]) example of this class is the binary model, [formula]. The Kimura 3-parameter model with [formula] can be understood as its generalization, important from the point of view of motivation coming from computational biology, see e.g. [\cite=ES] [\cite=SS]. Another small example is the model with [formula], considered in this note. It is known that algebraic varieties associated with group-based models (i.e. their geometric models) are toric, [\cite=SSE] [\cite=SS]. This class appears also in connection with theoretical physics, see [\cite=Man].

In [\cite=SS] Sturmfels and Sullivant conjecture that the ideal of phylogenetic invariants for a group-based model with group of symmetries G is generated in degree at most |G|. The authors give a proof for the binary model and provide some experimental data supporting the conjecture for small trees and groups. In [\cite=phylocomp] we analyze a few more examples with computational methods, and also suggest a geometric approach to the problem of determining phylogenetic invariants.

Let I be the ideal of phylogenetic invariants for a tree T and an abelian group G and I' be the ideal generated by the invariants in degree at most |G|. If [\cite=SS] is true, it implies that I  =  I'. Since comparing these two ideals is a difficult task, there have been a few attempts to compare geometric objects defined by them: projective schemes, sets of zeroes, or even sets of zeroes in the open orbit of a toric model. This last approach is presented in [\cite=CFSM]. The set-theoretical version of this conjecture for the class of equivariant models introduced in [\cite=DK] is considered in [\cite=Draisma2012]. In [\cite=constrdeg] Michałek proves the scheme-theoretical version for the 3-Kimura model, and also that for a fixed abelian group G there is a bound on the degree in which I is generated, independent on the size of the tree.

The aim of this note is to give a combinatorial proof of the scheme-theoretic version for [formula], using ideas similar to those presented in [\cite=constrdeg]. We work over the field of complex numbers [formula].

For [formula] and any tree T the projective schemes defined by the ideal I of phylogenetic invariants of the corresponding model and its subideal I' generated by elements of degree 2 and 3 are the same. That is, the saturation of I' with respect to the irrelevant ideal is equal to I.

Note that this result implies also the set-theoretic one: to check whether a point lies in the set of zeroes of the ideal of phylogenetic invariants for [formula] it is sufficient to see if the invariants of degree at most 3 vanish.

The structure of the paper is as follows. In the next section we describe the background for the problem and reduce the statement of Theorem [\ref=theorem] to a purely combinatorial one, which is then solved in sections [\ref=section_no_pairs]-[\ref=section_two_indices]. The notion of phylogenetic invariants is recalled in sections [\ref=section_phylo] and [\ref=phylo_inv]. Section [\ref=section_saturation] is devoted to explaining the role of saturation in the main result, which leads to a reduction of Theorem [\ref=theorem] to a combinatorial problem, and in section [\ref=section_deletion] we describe a basic step in the proof. Several examples illustrating these ideas are provided. Then, in section [\ref=subsection_outline], we sketch the relations between sections [\ref=section_no_pairs]-[\ref=section_two_indices], containing the main part of the proof: we analyze there a few separate cases depending on the form of a chosen phylogenetic invariant.

Acknowledgements.

Thanks to Mateusz Michałek for comments on preliminary versions of the proof, and to him and Weronika Buczyska for discussions.

The author would also like to thank anonymous referees for many important suggestions for improving the presentation of results.

Background and outline of the proof

In this section we recall basic definitions concerning group-based models, ideals of phylogenetic invariants and their combinatorial presentation. We explain how using the saturation simplifies dealing with phylogenetic invariants for [formula] and give the outline for the remaining part of the proof of the main result.

Phylogenetic models

Let us recall briefly that by a general group-based model with a finite abelian group of symmetries G we understand a triple (T,W,Ŵ), where T is a tree, W is the regular representation of G and [formula] is the space of G-invariant endomorphisms of W. With such a structure one can associate a geometric model: an algebraic variety, affine or projective. This can be done in two equivalent ways, see e.g. [\cite=SS] [\cite=mateusz]. The first one is to consider the closure of the image of a parametrization map (see e.g. [\cite=BW] [\cite=SS]), the second, which will be used here, is to take a toric variety corresponding to a certain lattice polytope (see [\cite=mateusz] and section [\ref=phylo_inv] below).

The ideal of phylogenetic invariants of (T,W,Ŵ) is the ideal vanishing on the corresponding geometric model. The construction of phylogenetic invariants for group-based models (or, more generally, equivariant models) can be reduced to the case of claw trees K1,r, i.e. trees with one inner vertex and r leaves, see e.g. [\cite=SS] and [\cite=sull]. Roughly speaking, the tree T can be constructed by gluing claw trees along edges and [\cite=SS] states that the ideal of phylogenetic invariants of T is the sum of ideals generated by certain extensions of phylogenetic invariants of these claw trees to T and an ideal generated by quadrics. Therefore, if the ideals of phylogenetic invariants for G and all K1,r are generated in degree d  ≥  2, then so is the ideal of phylogenetic invariants for G and any tree T. Hence the general idea is that it is sufficient to prove degree bounds for claw trees. This applies also to the case where the saturation is used.

The statement of Theorem [\ref=theorem] for the claw trees, i.e. T  =  K1,r, where r runs through [formula], implies the general statement, for any tree T.

By [\cite=SS] the ideal of phylogenetic invariants of a tree T is generated by quadrics and binomials which are extensions to T of invariants of all claw trees K1,r embedded (as a star of a vertex) in T. The construction of these extensions is described in [\cite=SS] in terms of group-based flows. The general idea of the proof is explained below without using this notion, but it is very useful for filling in the details. It suffices to show that if any binomial B in the ideal of phylogenetic invariants of K1,r can be written as a sum of multiples {Bj:j∈J} of invariants of degree at most |G|, then any its extension [formula] to T also has such a decomposition.

We can construct the decomposition of [formula] inductively, choosing Bj0 which has a common monomial with B, extending it to some [formula] on the whole tree T, which has a monomial in common with [formula], and then repeating the operation for the binomial [formula] and the set [formula]. And a suitable extension [formula] comes in a natural (but not necessarily unique) way from the chosen extension [formula] (this follows from the fact that B and Bj0 share the same monomial, hence also a multiset of group-based flows).

After performing this step for all j∈J we obtain a phylogenetic invariant of T which must be a sum of multiples of quadric invariants. These quadrics correspond (in terms of group-based flows) to swapping data encoding extensions of invariants from K1,r to T, associated with trees [formula] which are glued to K1,r along edges to obtain T, similarly as in the proof of [\cite=SS].

Therefore, in the next sections we restrict to the case of claw trees.

Note that in the proof of Proposition [\ref=prop_reduction_to_claws] we do not use any information on the group G, hence for any finite abelian group G it is sufficient to prove the scheme-theoretic version of [\cite=SS] just for claw trees.

Combinatorial description of phylogenetic invariants

We use the notation of [\cite=constrdeg] for phylogenetic invariants on a claw tree: we present them as relations between group-based flows on the tree (see [\cite=constrdeg] and [\cite=SS]). We recall here the notion of group-based flows only in the case of claw trees.

A group-based flow [formula] on K1,r is an assignment of elements [formula] of G to the edges [formula] of K1,r such that [formula].

By [\cite=mateusz], group-based flows correspond to vertices of the lattice polytope P describing the toric structure of the associated geometric model (as in [\cite=ToricBook]). Note that P is naturally placed in a big lattice Λ encoding all assignments of group elements to the edges of the tree: to each edge ei we assign |G| coordinates, and the group element fi assigned to ei is described by setting all corresponding coordinates to 0 except of the one corresponding to fi, which becomes 1. However, P has to be considered in a sublattice ΛP spanned by its vertices to obtain the correct toric structure.

The ideal I of phylogenetic invariants is an ideal of [formula], where [formula] are all vertices of P, i.e. all group-based flows on K1,r. Its elements correspond to relations between vertices of P. More precisely, by [\cite=Sturmfelsksiazka] we can express generators of I as relations [formula], where L  =  {Li} and R  =  {Rj} are finite multisets of group-based flows of the same cardinality. We add flows coordinatewise in Gr, counting different group elements at each index (which corresponds to addition in the lattice Λ). In terms of polynomials, the relation [formula] corresponds to a binomial [formula]. We assume [formula].

Saturation

We consider the saturation of I' in the irrelevant ideal [formula]. The aim is to prove that I':J∞  =  I. Since I is prime and thus saturated, the nontrivial part is to show that I is contained in the saturation of I'. Take a∈I. It belongs to I':J∞ if there is [formula] such that aJn  ⊆  I'. This is equivalent to saying that for every variable xFq there is [formula] such that axnqFq  ⊆  I'. Moreover, by [\cite=constrdeg] the situation is symmetric with respect to permutations of variables, hence it is sufficient to prove this statement for one chosen variable. We may choose the one corresponding to the trivial flow, which will be denoted by 0. In terms of relations between multisets of flows multiplying an element of I, [formula], by a power of this variable is adding the same number of copies of the trivial flow to L and R. Let us explain how this allows to simplify the structure of phylogenetic invariants. We concentrate on the case of [formula].

Let a be an element of the ideal I of phylogenetic invariants for [formula], represented by multisets of flows L and R. Then there is [formula] such that xn0a can be decomposed as a sum of an element of I' and an element of I represented by L' and R' which consist only of flows of two types:

pairs - flows with only two nontrivial entries,

triples - flows with only three nontrivial entries.

For any [formula]-flow [formula] there are k,m  ≤  r such that in [formula] at least two and at most three entries are nonzero and [formula]. We use a quadric relation involving the trivial flow L1  +  0  =  L1'  +  L1'' to divide L1 into [formula] and [formula]. In terms of polynomials this gives us

[formula]

That is, we have written the chosen element a∈I multiplied by x0 as a sum of two binomials. The first one is a multiple of a quadric, hence lies in I', so to prove that the chosen element is in I' it is sufficient to show that the second one is also in I' (possibly after multiplying by a power of x0).

Thus in terms of flows, instead of working with [formula] we can now consider the relation

[formula]

that is we have replaced L1  +  0 with L1' + L1'', where L1' is already a pair or a triple. To finish, we use the induction on the size of L1, i.e. the number of nontrivial group elements in this flow, and then apply the same argument for other flows in L and R.

Basic step: using a relation and deleting a flow

The idea of decomposing flows into simpler ones after adding the trivial flow works analogously for any finite abelian group, see [\cite=mateusz], but in the case of [formula] (and other groups of small order) the set of possible basic configurations is relatively simple and allows us to proceed with a combinatorial argument.

Note that for a pair the order of a and b is meaningful, while for triples a permutation of (a,b,c) does not change anything. Obviously, indices in a pair or a triple must be different.

Moreover, we show that one may assume that on one side there are only triples of one type.

If R or L contains both a g1-triple (a,b,c)g1 and a g2-triple (x,y,z)g2, we may replace them with pairs (possibly after adding a trivial flow to both sides of the relation).

Without loss of generality assume that L1  =  (a,b,c)g1 and L2  =  (x,y,z)g2. We use the cubic relation

[formula]

This may require adding a trivial flow to both sides of the relation if there is no trivial flow in L. Also, it may be necessary to permute entries of a triple so that we obtain sensible pairs (i.e. with different indices), but such a permutation always exists. Thus we may replace the left hand side of this cubic relation by its right hand side in L, as explained in Lemma [\ref=flow_types] and Notation [\ref=replacing]. After a finite number of steps we obtain the relation which has only g1-triples or only g2-triples.

We illustrate the reduction to triples and pairs, as in Lemma [\ref=flow_types], with an example. Consider a phylogenetic invariant on K1,5 given by (multi)sets of flows [formula] and [formula], where

Where possible, we write flows (elements of [formula]) already using Notation [\ref=notation_pairs_triples] for pairs and triples; leaves of K1,5 are indexed by [formula]. One can check that this is indeed a phylogenetic invariant, since to each leaf of K1,5 the same multiset of elements of [formula] is assigned by L and R.

Let x0 be the variable corresponding to the trivial flow. We have to prove that the element of I represented by L and R can be multiplied by xn0 for some [formula] such that the result belongs to I', generated by elements of degree at most 3. In terms of flows, we show that after adding n copies of the trivial flow to both L and R we may decompose the relation between flows in these multisets as a sum of relations having at most 3 flows on each side.

We need to use two relations in L to decompose L1 and L2:

[formula]

Since both require the trivial flow and L contains just one, we add one trivial flow to both sides (thus n  ≥  1). After these operations both sides contains (2,3)  =  R4. We just eliminate it and in the next step we will consider disjoint multisets:

[formula]

In terms of polynomials, we start from xL1xL2xL3x0  -  xR1xR2xR3xR4∈I and multiply it by x0. The relations reducing L1 and L2 are quadric binomials

[formula]

Thus we just need to prove that

[formula]

is in I', and in fact this is true for xL3xL5xL6xL7  -  xR1xR2xR3x0, i.e. we can forget xR4.

We continue the previous example to present the elimination of g1-triples and g2-triples appearing on one side, as in Lemma [\ref=different_triple_types]. In the relation between L' and R' there is a g1-triple and a g2-triple in R'. We use the relation

[formula]

(which does not require adding the trivial flow to the relation). Note that now pairs L7  =  (4,5) and L3  =  (5,1) are on both sides of the relation, hence we may eliminate them and consider only L'' containing L5  =  (1,2),L6  =  (4,3) and R'' containing R3  =  (4,2),R6  =  (1,3). But L'' and R'' already represent a quadric relation

[formula]

Thus we obtain that the relation from Example [\ref=example_1] multiplied by x0 can be decomposed into a sum of multiples of quadrics and cubics, hence actually represents an element of I'.

In terms of polynomials, the cubic binomial corresponding to changing triples into pairs in R is

[formula]

Hence we would like to prove that the following polynomial is in I':

[formula]

but it is clearly a multiple of a quadric binomial.

We are going to prove that any binomial in I, represented by a relation between multisets of flows L and R, can be written as a sum of multiples of quadric and cubic binomials, which belong to I'. This will be done by simplifying inductively the relation between L and R using relations between multisets of flows of cardinality at most 3.

As one can already see in the examples above, the aim of using a relation on multisets of flows L and R, as in Notation [\ref=replacing], is to obtain L' and R' with non-empty intersection. Then the flow which appears on both sides of the relation can be deleted, which allows us to use induction. Let us explain this operation more carefully.

We show the decomposition of an element of I into multiples of quadrics and cubics using relations and deletions of flows in a simple example.

We consider a relation already in the form of multisets of triples and pairs, without different types of triples on one side. Several steps of reduction are shown, this time only in the notation of group-based flows. Take again K1,5 and a relation

It belongs to the most general case described in section [\ref=section_four_indices]. We start from using a quadric relation in R:

[formula]

In this way we obtain L5  =  (4,3) on the right side of the relation, which allows us to reduce the problem to considering L'  =  {L1,L2,L3,L4} and R'  =  {R1,R2,R3,(2,5)}. Now we can again use a relation in R:

[formula]

hence L3 can be deleted and we are left with L'' = {L1,L2,L4} and R''  =  {R1,R2,(2,3)}. These sets represent a cubic relation, i.e. we have decomposed the chosen element of I as a sum of multiples of two quadrics and a cubic. However, we may do one more step to see that this is in fact a sum of multiples of four quadrics. We use a relation involving a triple in L:

[formula]

Now we can delete R2 = (1,2) and obtain a quadric relation

[formula]

Outline of the argument

The general idea of the argument is induction, but not on the standard degree, because we need to multiply the relation by the variable corresponding to the trivial flow in Lemmata [\ref=flow_types] and [\ref=different_triple_types]. We use the grading by the size of the flow: a variable is in the d-th graded piece if the corresponding flow has d nontrivial entries. We will take a relation and decompose it into a sum of relations in I', i.e. relations of (standard) degree 2 or 3 multiplied by monomials, and relations of smaller degree with respect to the grading introduced above. Before starting the induction we change the relation such that there are no g1-triples and g2-triples together on one side, by Lemma [\ref=different_triple_types]. We will always assume that this is satisfied and ensure that our modifications do not violate this condition.

In the following sections we consider several separate cases depending on possible configurations of elements in L and R. We start from analyzing the situation where there are no pairs at all in the relation, see section [\ref=section_no_pairs]. In the next two sections we assume that L or R contains at least two different pairs, e.g. (1,2) and (a,b). There are a few possibilities. In section [\ref=section_four_indices] these pairs consist of four different indices. Section [\ref=section_three_indices] concerns the case where these pairs has only three different indices, i.e. the set {1,2,a,b} has three elements. It is divided into two subsections based on the configuration of indices: in [\ref=subsection_three_indices_1] we look at the case 1 = a and in [\ref=subsection_three_indices_2] at the case 1 = b (these are all possibilities up to a permutation). In the second one we either reduce the relation or prove that in fact we are in the situation of [\ref=subsection_three_indices_1]. The last possibility, described in section [\ref=section_two_indices], is that only two different indices can appear in pairs on each side of the relation.

No pairs

First assume that L and R consist only of triples. By Lemma [\ref=different_triple_types], without loss of generality we may assume that there are only g1-triples (we will use the symmetry between g1 and g2, and also between L and R, all the time).

It is worth noting that the fact that in this case the relations can be generated in degree 2 is a consequence of a result on uniform (or, much more generally, strongly base orderable) matroids. This is a special case of the White's conjecture, for the details see [\cite=matroids] and references therein.

We consider two subcases, described in sections [\ref=nopairs_2ind] and [\ref=nopairs_no2ind], depending on whether we can find triples on different sides of the relation which differ just by one index.

There are g1-triples, one in L and one in R, with two indices in common

Say (1,2,3)g1∈L and (1,2,a)g1∈R - we rename the indices if necessary, as we will do often throughout the proof. Then there must be a triple (3,b,c)g1∈R for some indices b,c, because g1 appears in L at the index 3 at least once. If a  ≠  b and a  ≠  c, then we can use the relation

[formula]

in R and delete the flow (1,2,3)g1, as explained in Notation [\ref=replacing] and Notation [\ref=notation_flow_reduction].

Thus we only have to consider the situation where a∈{b,c}. Without loss of generality a = c, so (3,a,b)g1∈R for some b. Moreover, we may assume that 3 can appear in R only in g1-triples containing also a - otherwise we could find a triple which might be used in the relation above.

Symmetrically, if g1 appears on the index a in L in a triple (a,d,e)g1 then either we can use the relation

[formula]

in L and delete (1,2,a)g1 or we have 3∈{d,e}. We prove by contradiction that it is impossible that for every triple (a,d,e)g1in L we have 3∈{d,e}. Hence assume that a appears in L only in g1-triples containing 3.

We finish with an argument which will be repeated frequently throughout the proof. Assume that there are precisely n g1-triples containing 3 in R. We have shown above that in considered situation all of them must contain a. Then a appears at least n times with g1 in R (in all n triples with 3, but maybe also in other flows). Since L and R are two sides of a relation, a appears also at least n times with g1 in L. But this implies that 3 appears at least n + 1 times with g1 in L: once in the triple (1,2,3)g1 not containing a, and n times in a triple containing a. This is a contradiction, since the numbers of appearances of g1 on a chosen index on both sides must be equal.

Thus we conclude that it is impossible that a appears only in g1-triples containing 3 in L. That is, there is a triple (a,d,e)g1 in L such that 3∉{d,e}, so we can use the relation [\eqref=rel_counting_arg] to obtain a deletion of flows, as explained in Notation [\ref=notation_flow_reduction].

Let us reformulate this argument in a form of a general observation, so we can refer to it later on.

Let gk and gm be non-trivial elements of [formula] (not necessarily different), and [formula] be indices of leaves of K1,r, where α  ≠  β. Assume that L and R consist only of pairs and triples, and

if α appears in L in a flow with gm, then this flow contains also β with gk,

if β appears in R in a flow with gk, then this flow contains also α with gm.

Then β cannot appear in L with gk in a flow which does not contain α with gm.

Obviously, L and R may be swapped if needed.

The idea is to count appearances of α with gm and β with gk, exactly as in the example above - let us explain the details.

Assume that there is a flow in L which contains β with gk, but not α with gm. By n we denote the number of configurations containing β with gk in R. By assumptions of the lemma every such a configuration contains also α with gm. Hence α appears in R with gm at least n times. Since the sums of multisets of flows R and L and R are equal, there are also at least n occurrences of α with gm in L. But, by assumptions of the lemma, this implies that β appears at least n + 1 times with gk in L: n times with α with gm and also in a flow which does not contain α with gm. This contradicts the fact that L and R are multisets of flows with equal sums. Hence, under the assumptions of the lemma, L cannot contain any configuration containing β with gk but not containing α with gm.

For example, in the argument given before the lemma we have α  =  a, β  =  3 and k = m = 1. We consider the situation where a appears with g1 in L only in triples containing 3, and 3 appears with g1 in R only in triples containing a. We get a contradiction with the fact that the triple (1,2,3)g1, containing 3 but not containing a, is in L, thus showing that such a situation is impossible.

There are no two triples, one in L and one in R, with two indices in common

Take (1,2,3)g1∈L (if necessary, we rename the indices). Then there is some (1,a,b)g1∈R, because 1 must appear also in R with g1. If there is (2,c,d)g1∈R such that {a,b}  ≠  {c,d}, then we can find a relation which gives a reduction to the previous case [\ref=nopairs_2ind]. For example, if a∉{c,d}, then the relation used is (1,a,b)g1  +  (2,c,d)g1  =  (1,2,b)g1  +  (a,c,d)g1, and we obtain the triple (1,2,b)g1∈R, which has two indices in common with (1,2,3)g1∈L. Hence we may assume that 2 with g1 appears always in the triple (2,a,b)g1 in R. Using the same argument we prove that 3 with g1 appears always in the triple (3,a,b)g1 in R.

Note that since (1,a,b)g1 is in R, then a and b must appear in g1-triples in L. If there is a triple (a,e,f)g1∈L and {e,f}  ≠  {2,3}, then again we can find a quadric relation which leads to the previous case [\ref=nopairs_2ind]. Hence we may assume that a appears with g1 in L always in (a,2,3)g1 and b in (b,2,3)g1. We finish in a very similar way as in Lemma [\ref=counting_argument]. Let n be the number of g1-triples containing index 2 or 3 in R. Since in considered situation every such a triple contains also a and b, R contains n g1-triples with a and b. But we have assumed that a and b appear in L only in triples containing also 2 and 3. Hence 2 (and 3 also) appears in L with g1 at least 2n times: n times with a and n times with b. This is a contradiction with the fact that 2 appears in R at most n times.

Summing up, the only possibility in this case is that a relation can be found which gives a reduction to the previous one, [\ref=nopairs_2ind].

At least two pairs on one side, four different indices

Now assume that there exist pairs (1,2) and (a,b) in L such that 1,2,a,b are pairwise different indices (we swap L with R if necessary).

If two pairs (α,β) and (γ,δ) with all indices different occur on one side of the relation, then we may swap their elements, that is replace them with (α,δ) and (γ,β) by applying quadric relation (α,β) + (γ,δ)  =  (α,δ) + (γ,β).

There are three cases to consider (up to swapping g1 and g2):

R contains triples (1,x,y)g1 and (a,s,t)g1 for some indices x,y,s,t such that x  ≠  y and s  ≠  t (thus, by Lemma [\ref=different_triple_types], neither 2 nor b is contained in a g2-triple in R);

1 is contained in a g1-triple in R and a does not appear in any g1-triple in R (thus, by Lemma [\ref=different_triple_types], neither 2 nor b appears in a g2 triple in R);

there are no g1-triples containing 1 or a and no g2-triples containing 2 or b in R.

There are (1,x,y)g1, (a,s,t)g1, (u,2) and (v,b) in R

Such two pairs must be in R because 2 and b cannot occur in g2-triples. If u∉{x,y} or v∉{s,t} then we could use a quadric relation, e.g. (1,x,y)g1 + (u,2)  =  (u,x,y)g1  +  (1,2), to get (1,2) or (a,b) in R and delete a pair. Hence, without loss of generality, we consider only the situation where u = x and v = s, that is, R contains (x,2) and (s,b). We see that x must appear with g1 in L.

First assume that x occurs with g1 in L only in triples and take such a triple (x,c,d)g1∈L. Then either we can use the relation (1,2)  +  (x,c,d)g1  =  (x,2) + (1,c,d)g1 and delete (x,2) or we may assume that c = 1 and x appears with g1 in L always in a triple containing 1. In the latter case 1 appears at least twice in L with g1. Hence the triple (1,x,y)g1 cannot be the only element of R containing 1 with g1.

Assume that 1 appears with g1 in a pair (1,e)∈R. If x  ≠  e then we apply the quadric relation (x,2)  +  (1,e)  =  (x,e)  +  (1,2) in R and delete (1,2). And if s  ≠  e, we can use the relation (s,b)  +  (1,e)  =  (1,b)  +  (s,e) in R and delete (1,b) after swapping elements of pairs in L as in Remark [\ref=exchanged_pairs]. Thus we can work under assumption that x = s = e, which means that (a,x,t)g1∈R. But then we may use the relation (1,x)  +  (a,x,t)g1  =  (t,x) + (a,x,1)g1, because t  ≠  x and 1  ≠  x, since they appear together in some flows. Thus we may assume that (a,x,1)g1∈R. And in L either we use the relation (a,b)  +  (x,1,d)g1  =  (x,b)  +  (a,1,d)g1, which allows us to delete (x,b), or a = d and (x,1,a)g1 can be deleted.

If 1 appears with g1 in R only in triples, we have (1,e,f)g1∈R. Then either we can use the relation (x,2)  +  (1,e,f)g1  =  (1,2) + (x,e,f)g1 and delete (1,2) or we may assume that e = x. That is, 1 always appears in R in triples containing also x. To finish, we apply Lemma [\ref=counting_argument]: x appears always in a g1-triple containing 1 in L and 1 in a g1-triple containing x in R, but also (1,2)∈L. Hence if we compare numbers of occurrences of 1 on both sides, we get a contradiction.

Thus in this case we are always able to use relations leading to a situation in which a pair or a triple can be deleted, so that the degree of the relation in considered grading is decreased.

The second possibility is that x appears with g1 in L in a pair (x,c). If c  ≠  1 then we use the relation (x,c)  +  (1,2)  =  (x,2)  +  (1,c) and delete (x,2), so we may assume that (x,1)∈L. Then 1 appears in R with g2, and it can be only in pairs by Lemma [\ref=different_triple_types], since there are already some g1-triples. Then (e,1)∈R, and in fact we may assume that this pair is equal to (2,1), because otherwise we would use the relation (e,1)  +  (x,2)  =  (x,1) + (e,2) and delete (x,1).

Now we try to apply the cubic relation

[formula]

in R and delete (x,1). This fails only if s = 2. Then, in particular, (2,b)∈R. In this case 2 must appear with g1 in L. If a pair (2,h)∈L then we try to swap elements with either (x,1) or (a,b) (as described in Remark [\ref=exchanged_pairs]) and delete (2,1) or (2,b). This fails only if x = h = a, but then (a,2)∈R and the same pair can be obtained in L by swapping elements of (1,2) and (a,b). And if there is a triple (2,i,j)g1∈L, then we try to use one of the relations

[formula]

and delete (2,b) or (2,1).

This is impossible only if {i,j}  ⊇  {x,a}. If x = a then we swap elements of (1,2) and (a,b) in L and delete (a,2). Hence we may assume that x  ≠  a and there is (2,x,a)g1∈L. In R we use the relation (a,2,t)g1 + (x,2)  =  (2,x,a)g1 + (t,2) (note that t  ≠  2 since they appear in the same triple), which allows us to delete (2,x,a)g1.

Thus again, in this case we can find relations which lead to a reduction of a flow.

Now 1 is contained in some g1-triple in R, say (1,x,y)g1, a does not appear in any g1-triple and 2 and b do not appear in any g2-triple in R

Then a appears with g1 and 2 and b with g2 in R only in pairs. Let (z,2) be such a pair for the index 2 with g2. Then we may assume that z∈{x,y}, because otherwise we could use the relation (1,x,y)g1 + (z,2)  =  (z,x,y)g1  +  (1,2) and delete (1,2); let z = x. Take now (a,u) and (v,b). We consider only the situation with u = v, because otherwise the relation (a,u) + (v,b)  =  (a,b)  +  (v,u) allows us to delete (a,b). Moreover, we may assume that u = x, because otherwise the relations (a,u) + (x,2)  =  (a,2) + (x,u) in R and (1,2) + (a,b) = (1,b) + (a,2) in L would give a deletion of the pair (a,2). Summing up, we consider the case where R contains (1,x,y)g1, (x,2), (a,x) and (x,b).

Let us determine in what flows x appears with g1 in L. If in a pair (x,c) then we can use one of the relations

[formula]

and delete (x,2) or (x,b). Hence we may assume that x appears with g1 in L only in triples. If (x,c,d)g1 is such a triple then we try to use the relations

[formula]

and delete the same pairs as before. This fails only if {c,d}  =  {1,a}, so we may assume that x appears with g1 in L only in triples (x,1,a)g1. In particular, there is at least one such triple. But then we can use the relation (1,x,y)g1  +  (a,x)  =  (1,x,a)g1 + (y,x) in R, which works because x  ≠  y as they appear in the same triple, and delete (x,1,a)g1.

Hence in this case we can always find a deletion of a flow, after using suitable relations.

Neither 1 nor a appears in a g1-triple and neither 2 nor b is in a g2-triple in R

Then there are pairs (1,x), (x',2), (a,y) and (y',b) in R. We may assume that x = x' and y = y', because otherwise we could use a relation of degree 2 to produce a pair (1,2) or (a,b) and cancel it with equal pair in L. Then, if x  ≠  y, we could use the relation (1,x) + (y,b)  =  (1,b) + (x,y) in R and the relation (1,2) + (a,b)  =  (1,b) + (2,a) in L and delete (1,b). Hence we assume that R contains pairs (1,x), (x,2), (a,x) and (x,b).

Let us check in what flows x appears in L. If it appears in a pair (x,c) then we could use one of the relations

[formula]

and delete either (x,2) or (x,b). Thus we may assume that x does not appear with g1 in any pair in L and also, arguing in the same way, that x does not appear with g2 in any pair in L. This means that L must contain a g1-triple and a g2-triple with x, but by Lemma [\ref=different_triple_types] such a situation cannot happen. Hence this case must end with a deletion of a pair.

At least two pairs on one side, three different indices

Now we assume there are no two pairs on one side of the relation consisting of four pairwise different indices, but there are two pairs such that the set of their indices has three elements. Let 1, 2 and a be pairwise different indices. There are two cases (up to swapping g1 with g2 and L with R, and renaming indices):

L contains pairs (1,2), (1,a),

L contains pairs (1,2), (a,1).

Case (1,2), (1,a)

There are three different possibilities to consider:

2 or a appears in g2-triples in R (thus, by Lemma [\ref=different_triple_types], 1 is not contained in a g1-triple in R);

1 appears in a g1-triple in R (thus, by Lemma [\ref=different_triple_types], neither 2 nor a is contained in a g2-triple in R);

1 does not appear in any g1-triple in R and neither 2 nor a appears in a g2-triple in R.

Assume that R contains a triple (2,x,y)g2 and a pair (1,t)

Then we try to use the relation (2,x,y)g2 + (1,t)  =  (t,x,y)g2 + (1,2) and delete (1,2). Consider the situation when it is impossible: let x = t and (1,x)∈R. We may assume x  ≠  a, otherwise L and R are not disjoint. Now consider flows with x in L. If x appears with g2 in L in a pair (c,x) then we may swap elements in some two pairs as in Remark [\ref=exchanged_pairs] and delete (1,x), because either c  ≠  2 or c  ≠  a. Hence we may assume that x appears with g2 in L just in triples.

Let (x,c,d)g2∈L. Then either we use one of the relations

[formula]

and delete (1,x) or every g2-triple in L containing x is of the form (x,a,2)g2. Now we check in what configurations 2 can occur in R with g2. If it occurs only in triples, then for (2,e,f)g2∈R we try to use the relation (2,e,f)g2 + (1,x)  =  (x,e,f)g2 + (1,2) and delete (1,2). It is impossible only in the case where all g2-triples in R containing 2 contain also x, but then we finish the argument by applying Lemma [\ref=counting_argument]: since x appears in L with g2 only in triples containing 2, and 2 appears in R in g2 only in triples containing x, then we get a contradiction with the fact that (1,2)∈L.

This leaves us in the situation where there is a pair (e,2) in R. Then we may assume that e = x, because otherwise we swap elements in pairs with (1,x) in R and delete (1,2). But then x must occur with g1 in L and it has to be in a pair since we already have g2-triples there. If (x,f)∈L and f  ≠  1 then we swap indices with (1,2) and delete (x,2). And if (x,1)∈L then we use the relation (x,a,2)g2 + (x,1)  =  (x,a,1)g2  +  (x,2) in L, hence (x,2) can also be deleted.

Thus in this case we always get a pair to delete after using some relations.

In R there are (1,x,y)g1, (z,2) and (t,a)

We may assume that z = x (or z = y, but then we just swap x with y), because if not then we could use the relation (1,x,y)g1 + (z,2)  =  (z,x,y)g1  +  (1,2) and delete (1,2). (In the same way we see that t∈{x,y}, we use it later.)

First assume that both x and t occur in L with g1 in a pair, i.e. (x,c),(t,d)∈L for some c,d. Then we can swap elements in pairs as in Remark [\ref=exchanged_pairs] (either (x,c) and (1,2) or (t,d) and (1,a)) and delete a pair, unless c = d = 1. In this case we must have (e,1)∈R, because 1 has to appear with g2 in R, but there cannot be any g2-triple by Lemma [\ref=different_triple_types]. This allows us to swap elements in pairs in R and delete (x,1) or (t,1), since either e  ≠  2 or e  ≠  a.

Hence the only possibility is that x or t occurs in L with g1 only in triples. Let x have this property - the situation is symmetric since t∈{x,y}. If (x,f,h)g1∈L then we try to use the relation (x,f,h)g1 + (1,2)  =  (1,f,h)g1 + (x,2) and delete (x,2). This fails only if every g1-triple in L containing x contains also 1. Consider possible flows with g1 at index 1 in R.

If all of them are triples then we may assume that they contain x, because otherwise the relation (1,i,j)g1 + (x,2)  =  (x,i,j)g1 + (1,2) can be applied and we have a deletion of (1,2). Such a situation is impossible by Lemma [\ref=counting_argument]: if x appears with g1 in L always in triples containing 1, and 1 appears with g1 in R only in triples containing x, then we get a contradiction with the fact that (1,2)∈L.

We are left with the case where 1 appears with g1 in R in a pair (1,k). We try to swap elements in pairs in R with (x,2) or (t,a) and delete (1,2) or (1,a). This fails only if k = x = t. But then we have (1,x)∈R, so x must occur in L with g2. It can be only in a pair because there is already a g1-triple. Hence take (m,x)∈L. Now we can swap elements in pairs with (1,2) or (1,a) in L in a way which allows to delete (1,x). Thus this case also always ends by a deletion of a pair.

Here 1 does not appear in any g1-triple in R and neither 2 nor a appears in a g2-triple in R

Hence R contains pairs (1,x), (y,2) and (z,a). If x  ≠  y or x  ≠  z we can use one of the relations

[formula]

and delete (1,2) or (1,a). So we may assume that R contains (1,x), (x,2) and (x,a). We see that then x must appear with g1 in L. If it appears in a pair (x,c) such that c  ≠  1 then we can use the relation (x,c) + (1,2)  =  (x,2) + (1,c) and delete (x,2). Hence if x appears with g1 in L in a pair then it is (x,1).

If such a pair belongs to L then 1 must appear with g2 in R. If there is (1,s,t)g2∈R then we try to use the relation (1,s,t)g2  +  (x,2)  =  (2,s,t)g2 + (x,1) and delete (x,1). It could fail only if 2∈{s,t}, but this situation contradicts the assumption that 2 does not appear in g2-triples in R. And if there is (s,1)∈R, we can use one of the relations

[formula]

and delete (x,1). Therefore we are left with the case where x appears with g1 in L only in triples; there must be at least one such triple.

Then, because (1,x)∈R, we know that x appears also with g2 in L. It cannot be in a g2-triple since currently we work under assumption that there are g1-triples in L, so it appears in a pair (c,x). Since either c  ≠  2 or c  ≠  a, we can use one of the relations

[formula]

and delete (1,x). Thus again in this case always a pair can be deleted after using certain relations.

Case (1,2), (a,1)

There are three subcases up to swapping sides of the relation or elements of [formula], or renaming the indices. First two concern situations when at least one of {1,2,a} occurs in a triple in R, in the third one all these indices appear only in pairs in R. Because of Lemma [\ref=different_triple_types], up to swapping g1 with g2 there are just two different possibilities. In the last case we see what happens when there are no such triples.

Assume that on one side of the relation three different indices α,β,γ appear in pairs and there is a pair (α,β). Then either all the remaining pairs on this side are equal to (α,β), (γ,α) or (β,γ), or we are in the situation which was already considered in section [\ref=section_four_indices] (four different indices in pairs) or [\ref=subsection_three_indices_1] (an index repeats on the same position in two different pairs).

First consider the case where 1 appears in a g1-triple in R

Then, by Lemma [\ref=different_triple_types], 2 appears with g2 in R only in pairs. So R contains a triple (1,x,y)g1 and a pair (z,2). The relation (1,x,y)g1  +  (z,2)  =  (z,x,y)g1  +  (1,2), which leads to the deletion of (1,2), cannot be used only if z∈{x,y}, so we may assume that 2 appears with g2 in R only in pairs (x,2) (by Remark [\ref=rem_3pairs] in this case (y,2)∉R).

Also, 1 appears in R with g2 and it has to be only in pairs, since there already are g1-triples. If (s,1)∈R then either, by Remark [\ref=rem_3pairs], we are in one of the previous cases or it must be equal to (2,1), because we already have (x,2) and x  ≠  1. Hence we assume that (2,1)∈R. Then 2 appears in L with g1. If in a pair, then by Remark [\ref=rem_3pairs] it is (2,a), so we can use the cubic relation

[formula]

in L and delete (2,1).

Thus we only have to consider the case where 2 appears with g1 in L just in triples. Take such a triple (2,c,d)g1. If a∉{c,d} then we use the relation (2,c,d)g1 + (a,1)  =  (a,c,d)g1 + (2,1) and delete (2,1), so we may assume that if 2 appears in L with g1 then it is always in a triple containing a.

If a appears in R with g1 in a pair (a,t), then by Remark [\ref=rem_3pairs] this pair must be equal to (x,2), because a∉{1,2}. In particular, x = a and R contains (1,a,y)g1. Recall that (2,a,d)g1∈L. We use the following relations in L and R respectively:

[formula]

and delete a triple. This is always possible, because 2  ≠  d and y  ≠  1, since these indices appear together in triples.

The last possibility is that a appears in R with g1 just in triples and let (a,s,t)g1 be such a triple. Then either we can use the relation (a,s,t)g1 + (2,1)  =  (a,1) + (2,s,t)g1 and delete (a,1), or all such triples contain also 2. In the latter case we get a contradiction by Lemma [\ref=counting_argument]: 2 appears with g1 in L only in triples containing a, and a appears with g1 in R only in triples containing 2, which contradicts the fact that (a,1)∈L.

Thus here we either reduce to one of the cases described in section [\ref=subsection_three_indices_1] (by Remark [\ref=rem_3pairs]) or find a deletion of a pair or a triple.

Now consider the case where 1 does not appear in any g1-triple and 2 appears in a g2-triple in R

Thus R contains a pair (1,x) and a triple (2,y,z)g2. If x∉{y,z} then we can use the relation (1,x) + (2,y,z)g2  =  (1,2)  +  (x,y,z)g2 and delete (1,2), so we may assume that x = z and (2,x,y)g2∈R. Also a must appear with g1 in R. It cannot be in a triple since there are g2-triples already, so we have a pair (a,s)∈R. If s = 1 then (a,1) can be deleted, and if not, by Remark [\ref=rem_3pairs] we obtain x = a, i.e. we may assume that R contains (1,a), (a,s) and (2,a,y)g2.

Now we check in what flows 1 can appear with g2 in R. If in a pair (c,1) then by Remark [\ref=rem_3pairs] we have c = s and we use the relation

[formula]

in R and delete (a,1). If 1 appears in a triple (1,d,e)g2∈R and s∉{d,e} then we use the relation (1,d,e)g2 + (a,s)  =  (a,1) + (s,d,e)g2 and delete (a,1) again. Hence we may assume that 1 occurs with g2 in R only in triples containing s.

Since (1,a)∈R, there must be a flow containing a with g2 in L. If a occurs in a pair (f,a), then by Remark [\ref=rem_3pairs] f = 2. Then we can again use the cubic relation between pairs, but this time in L, and delete (1,a). Thus we may assume that a occurs with g2 in L only in triples. Moreover, if (a,h,i)g2 is such a triple, then either we can use the relation (a,h,i)g2 + (1,2)  =  (2,h,i)g2 + (1,a) and delete (1,a), or we may assume that (a,2,i)g2∈L and every g2-triple in L containing a contains also 2.

In this situation we already have two configurations with 2 with g2 in L, but only one in R. Thus 2 appears more times with g2 in R. First assume it is only in triples and take (2,j,k)g2∈R. If a∉{j,k} then we can use the relation (1,a)  +  (2,j,k)g2  =  (1,2)  +  (a,j,k)g2 and delete (1,2). Hence we may assume that a g2-triple containing 2 always contains also a, but this is impossible by Lemma [\ref=counting_argument] applied to occurrences of 2 and a with g2, because (1,2)∈L.

And if there is a pair (m,2)∈R, then by Remark [\ref=rem_3pairs] we have m = a and s = 2 (recall that (1,a),(a,s)∈R). In particular, in R there are (a,2) and (1,2,e)g2. Then we use the following relations in L and R respectively

[formula]

and delete (a,2,1)g2. This is possible since a  ≠  i and 1  ≠  e, as they appear together in triples.

As before, this case ends by reducing to [\ref=subsection_three_indices_1] or by finding a pair or a triple to delete.

Here we assume that 1 appears only in pairs in R, and 2 with g2 and a with g1 also appear only in pairs in R

Thus R contains pairs (1,x), (x',2), (y,1), and (a,y'). If x  ≠  x' or y  ≠  y' then we can swap elements in pairs and delete (1,2) or (a,1). Hence we may assume that R contains (1,x), (x,2), (y,1) and (a,y). Now by Remark [\ref=rem_3pairs] either we are in the case [\ref=subsection_three_indices_1] or we have (y,1) = (2,1). In the latter case we can delete (1,2) after applying the cubic relation

[formula]

Only two different indices in pairs

Assume that (1,2)∈L and the only pairs in L are (1,2) and possibly (2,1). Moreover, in R also at most two indices appear in pairs - otherwise we are in one of the previous cases. Thus if R contains pairs (1,x) and (y,2) then x = 2 and y = 1, so we have an immediate deletion. Hence we are left with two subcases, depending on which index from (1,2) appears in R just in triples, since by Lemma [\ref=different_triple_types] both cannot be in triples. These subcases are symmetric, hence we consider just one of them.

Assume that (1,x)∈R and (2,s,t)g2∈R. If x∉{s,t} then we can use the relation (2,s,t)g2 + (1,x)  =  (x,s,t)g2 + (1,2) and delete (1,2). Hence we may assume that if 2 appears with g2 in R then it is always in a triple containing x, and there is at least one such triple, which implies that x  ≠  2.

We check in what flows x appears with g2 in L. It cannot be in a pair, because the only pairs which can be in L are (1,2) and (2,1), but by looking at flows in R we know that x∉{1,2}. If there is a triple (x,c,d)g2∈L such that 2∉{c,d} then we can use the relation (x,c,d)g2  +  (1,2)  =  (2,c,d)g2  +  (1,x) and delete (1,x). Hence we may assume that x appears with g2 in L only in triples containing 2. We apply Lemma [\ref=counting_argument] to get a contradiction: x appears in L with g2 only in triples containing 2, and 2 appears in R with g2 only in triples containing x, but also we have (1,2)∈L.

Hence here we either show that we are actually in one of the previous cases or find a deletion of a pair. This case finishes the whole proof.