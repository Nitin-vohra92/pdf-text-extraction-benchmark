Theorem Proposition Corollary Lemma Conjecture

Definition Definitions

Remark Remarks

=2pt

On balanced subgroups of the multiplicative group

Introduction

Let d > 2 be an integer and consider [formula], the group of units modulo d. Let Ad be the first half of [formula]; that is, Ad consists of residues with a representative in (0,d / 2). Let [formula] be the second half of [formula]. We say a subgroup H of [formula] is balanced if for each [formula] we have [formula]; that is, each coset of H has equally many members in the first half of [formula] as in the second half.

Our interest in this notion stems from the following result.

Let p be an odd prime number, let [formula] be the finite field of cardinality q = pf, and let [formula] be the rational function field over [formula]. Let d be a positive integer not divisible by p, and for e a divisor of d write 〈p〉e for the cyclic subgroup of [formula] generated by p. Let Ed be the elliptic curve over [formula] defined by

[formula]

Then we have

[formula]

Here φ is Euler's function and lq(e) is the order of q in [formula].

A few simple observations are in order. It is easy to see that 〈 - 1〉 is a balanced subgroup of [formula]. It is also easy to see that if 4|d, then [formula] is a balanced subgroup of [formula]. In addition, if H is a balanced subgroup of [formula] and K is a subgroup of [formula] containing H, then K is balanced as well. Indeed, K is a union of

[formula]

cosets of H, each equally distributed between the first half of [formula] and the second half. Thus, uK is also equally distributed between the first half and the second half.

It follows that if some power of p is congruent to - 1 modulo d and if [formula], then the theorem implies that [formula] if d is even and d - 1 if d is odd. The rank of E when some power of p is - 1 modulo d was first discussed in [\cite=U-L1], and with hindsight it could have been expected to be large from considerations of "supersingularity." The results of [\cite=CHU] show, perhaps surprisingly, that there are many other classes of d for which high ranks occur. Our aim here is to make this observation more quantitative.

More precisely, the aim of this paper is to investigate various questions about balanced pairs (p,d), i.e., pairs such that 〈p〉 is a balanced subgroup of [formula]. In particular, we give a simple criterion in terms of characters for (p,d) to be balanced (Theorem [\ref=thm:char-criterion]), and we use it to determine all balanced subgroups of order 2 (Theorem [\ref=thm:order2]). We also investigate the distribution for a fixed p of the set of d's such that (p,d) is balanced (Theorems [\ref=thm:dist0], [\ref=thm:dist1]). We find that when p is odd, the divisors of pn + 1 are not the largest contributor to this set. Finally, we investigate the average rank and typical rank given by Theorem [\ref=thm:CHU] for fixed q and varying d.

Balanced subgroups and characters

In this section we write G (rather than [formula]) for [formula]. We also write A for Ad as above and similarly for B, so that G is the disjoint union [formula].

We write [formula] for the characteristic function of A  ⊂  G and similarly for [formula]. Let [formula] be the sum over H of translates of [formula]:

[formula]

By definition, H is balanced if and only if f is identically zero.

We write Ĝ for the set of complex characters of G, and we expand f in terms of these characters:

[formula]

where

[formula]

It is easy to see that (χtriv) = 0. Noting that [formula], for χ non-trivial we find that

[formula]

Note that [formula] is zero if and only if the restriction of χ to H is non-trivial. We introduce the notation

[formula]

We view χ as a Dirichlet character, so that we also have

[formula]

As usual, we say χ is even if χ( - 1) = 1 and χ is odd if χ( - 1) =  - 1. Note that if χ is even and non-trivial, then

[formula]

This discussion yields the following characterization of balanced subgroups:

With notation as above, we have that H is balanced if and only if cχ = 0 for every odd character χ of G whose restriction to H is trivial.

As an example, note that if H = 〈 - 1〉, then there are no odd characters trivial on H and so the theorem implies that H is balanced.

We now give a non-vanishing criterion for cχ.

If χ is a primitive, odd character of G, then [formula].

Under the hypotheses on χ, the classical evaluation of L(1,χ) leads to the formula

[formula]

where τ(χ- 1) is a Gauss sum. (See, e.g., [\cite=Marcus] or [\cite=MV], though there is a small typo in the second reference.) By the theorem of Dirichlet, [formula] and so [formula].

In light of the lemma, we should consider imprimitive characters.

Suppose that [formula] is a prime number dividing d and set [formula]. Suppose also that χ is a non-trivial character modulo d induced by a character χ' modulo d'. If [formula], then cχ =  - χ'(2)cχ'. If [formula] is odd, then [formula]. Here we employ the usual convention that [formula] if [formula].

First suppose [formula]. We have

[formula]

If 2|d', this is a complete character sum and so vanishes. If [formula], then

[formula]

as desired.

Now assume that [formula] is odd. We have

[formula]

If [formula], then

[formula]

If [formula], then

[formula]

as desired.

Applying the lemma repeatedly, we arrive at the following non-vanishing criterion.

Suppose that χ is an odd character modulo d induced by a primitive character χ' modulo d'. Then [formula] if and only if the following two conditions both hold: (i) [formula] or d / d' is odd; and (ii) for every odd prime [formula] which divides d and does not divide d', we have [formula].

As an example, suppose that 4|d and [formula]. Note that

[formula]

Thus, if χ is an odd character modulo d and [formula], then the conductor d' of χ divides d / 2. This shows that d / d' is even and so condition (i) of the proposition fails and cχ = 0. Therefore H is balanced.

Balanced subgroups of small order

In this section, we discuss balanced subgroups of small order. We have already seen that a subgroup of G which contains - 1 or [formula] is balanced. We will show that in a certain sense small balanced subgroups are mainly controlled by these balanced subgroups of order 2.

For every positive integer n there is an integer d(n) such that if d > d(n) and H is a balanced subgroup of [formula] of order n, then either - 1∈H or 4|d and [formula].

We can make this much more explicit for subgroups of order 2:

A subgroup H = 〈h〉 of order 2 is balanced if and only if d and h satisfy one of the following conditions:

[formula]

[formula] and [formula]

d = 24 and [formula] or [formula].

d = 60 and [formula] or [formula].

Using Proposition [\ref=prop:non-vanishing], we will show that if d is sufficiently large with respect to n, then for any subgroup [formula] of order n which does not contain - 1 or [formula], there is a character χ which is odd, trivial on H, and with [formula]. By Theorem [\ref=thm:char-criterion], this implies that H is not balanced.

Note that a balanced subgroup obviously has even order, so there is no loss in assuming that n is even. We make this assumption for the rest of the proof.

Let H+ be the subgroup of G generated by H, - 1 and, if 4|d, by [formula]. Fix a character χ0 of G which is trivial on H, odd, and - 1 on [formula] if 4|d. The set of all characters satisfying these restrictions is a homogeneous space for   ⊂  Ĝ. We will argue that multiplying χ0 by a suitable ψ∈ yields a χ  =  χ0ψ for which Proposition [\ref=prop:non-vanishing] implies that [formula].

Note first that any character χ which is odd and, if 4|d, has [formula] automatically satisfies condition (i) in Proposition [\ref=prop:non-vanishing]. Indeed, if 4|d, then the condition [formula] implies that χ is 2-primitive, i.e., the conductor d' of χ has d / d' odd. The rest of the argument relates to condition (ii) in Proposition [\ref=prop:non-vanishing].

Write [formula] and write [formula] for [formula] so that [formula]. Let [formula]. Note that [formula] divides the conductor of χ if and only if [formula] is non-trivial.

We will sloppily write [formula] for [formula] modulo the image of H+ in [formula]. For odd [formula], [formula] is cyclic and therefore so is [formula]; for [formula], since - 1∈H+, G2 / H+ is also cyclic.

Note also that H+ is the product of H and a group of exponent 2, namely the subgroup of G generated by - 1 or by - 1 and [formula]. Also, we have assumed that n = |H| is even. If [formula] is odd, then [formula] is cyclic of even order, so has a unique element of order 2. It follows that the order of the image of H+ in [formula] divides n.

We define three sets of odd primes:

[formula]

[formula]

and

[formula]

Note that S1  ⊂  S2  ⊂  S3 and S3 depends only on n, not on d.

If [formula] is odd, [formula], and [formula], then [formula] is non-trivial. Thus choosing a suitable ψ, we may arrange that the conductor of χ1  =  χ0ψ is divisible by every prime dividing d which is not in S1.

For the odd primes [formula] which divide d and do not divide the conductor of χ1 (a subset of S1, thus also a subset of S3), we must arrange that [formula] (where χ' is the primitive character inducing χ).

Recall that [formula] is cyclic. We now remark that if C is a cyclic group and a∈C, and [formula], then the set of characters [formula] such that χ(a)  ≠  z has cardinality at least |C|(1 - 1 / |〈a〉|) (where |〈a〉| is the order of a). If we have several elements [formula] and several values [formula] to avoid, then the number of characters ψ such that ψ(ai)  ≠  zi is at least

[formula]

Thus we can find such a character provided that each ai has order > n.

Now we use that d is large to conclude that a large prime power [formula] divides d. (Note that [formula] might be 2 here.) Then [formula] is a cyclic group in which the order of each prime in S1 is large. (The primes in S1 are also in S3, so belong to a set fixed independently of d.) We want a character ψ of [formula] which satisfies ψ(r)  ≠  χ- 11(r) for all r∈S1. We also want ψχ1 to have non-trivial [formula] component which, phrased in the language above, means that we want [formula] for some fixed generator of [formula]. Since the size of S1 is fixed depending only on n, the discussion of the previous paragraph shows that these conditions can be met if [formula] is large enough.

Setting χ  =  ψχ1 with ψ as in the previous paragraph yields a character χ such that [formula], and this completes the proof.

We retain the concepts and notation of the proof of Theorem [\ref=thm:small-order]. We also say that a subgroup of order 2 is "exceptional" if it does not contain - 1 or [formula].

Since n = 2, the set S3  =  {3} and the set S2 is either empty (if [formula] or 9|d) or S2  =  {3} (if 3 exactly divides d). If S2 is empty and H is an exceptional subgroup of order 2, then the first part of the proof of Theorem [\ref=thm:small-order] provides a primitive odd character trivial on H, and so H is not balanced.

Suppose we are in the case where 3 exactly divides d. Following the first part of the proof of Theorem [\ref=thm:small-order], we have a character χ1 of G with conductor divisible by d' = d / 3 which is odd, trivial on H, and, if 4|d, satisfies [formula]. If the conductor of χ1 is d or if the primitive character χ' inducing χ1 has [formula], then setting χ  =  χ1 we have [formula] and we see that H is not balanced.

If not, we will modify χ1. Note that if [formula] and 16|d, or [formula] and 25|d, or [formula] is a prime [formula] and [formula], then the order of 3 in [formula] is at least 3. Thus in these cases, there is a character ψ of [formula] so that the [formula] part of χ  =  χ1ψ is non-trivial and so that the primitive character χ' inducing χ satisfies [formula]. Then [formula] and H is not balanced.

This leaves a small number of values of d to check for exceptional balanced subgroups of order 2. Namely, we just need to check divisors of [formula] which are divisible by 3. A quick computation which we leave to the reader finishes the proof.

Distribution of numbers d with 〈p〉d balanced

Fix an integer p with |p| > 1. In our application to elliptic curves, p is an odd prime number, but it seems interesting to state our results on balanced subgroups in a more general context. Let Bp denote the set of integers d > 2 coprime to p for which 〈p〉d is a balanced subgroup of [formula]. Further, let

[formula]

Note that if p is even then Bp,0 is empty. For any set A of positive integers and x a real number at least 1, we let [formula].

We state the principal results of this section, which show that when p is odd, most members of Bp lie in Bp,0.

For each odd integer p with |p| > 1, there are positive numbers bp,bp' with

[formula]

for all sufficiently large numbers x depending on the choice of p.

For each integer p with |p| > 1, there is a number εp > 0 such that for all [formula],

[formula]

We remark that Bp,1 has been studied by Moree. In particular we have the following result.

For each integer p with |p| > 1 there are positive numbers cp,δp such that

[formula]

Note that for p prime we have [formula]. We believe that Bp,0 and Bp,1 comprise most of Bp and in fact we pose the following conjecture.

For each integer p with |p| > 1 we have

[formula]

that is, Bp, *(x)  ~  Bp,1(x) as x  →    ∞  .

It is easy to see that [formula] has at most one element. Indeed, the cyclic group 〈p〉d has at most one element of order exactly 2, so if [formula], then for some f we have [formula] and this can happen only when d = 4. This at least shows that Bp(x)  ≥  Bp,0(x) + (1 + o(1))Bp,1(x) as x  →    ∞  .

We now begin a discussion leading to the proofs of Theorems [\ref=thm:dist0] and [\ref=thm:dist1]. The following useful result comes from [\cite=HR].

There is an absolute positive constant c such that for all numbers [formula] and any set R of primes in

[formula]

not divisible by any member of R is at most

[formula]

Note that the inequality in the display follows immediately from the inequality 1 - θ  <  e-  θ for every θ∈(0,1).

For a positive integer m coprime to p, recall that lp(m) denotes the order of 〈p〉m. If r is a prime, we let vr(m) denote that integer v with rv|m and [formula].

We would like to give a criterion for membership in Bp,0, but before this, we establish an elementary lemma.

Let p be an odd integer with |p| > 1 and let k,i be positive integers. Then

[formula]

The result is clear if i = 1. If i > 1, we see that

[formula]

which is a product of i - 1 factors that are each 2 (mod 4).

The following result gives a criterion for membership in Bp,0.

Let p be odd with |p| > 1 and let [formula] be an odd integer coprime to p. If lp(m) is odd, then 2jm∈Bp,0 if and only if j = 1 + v2(p - 1) or j > v2(p2 - 1). If lp(m) is even, then 2jm∈Bp,0 if and only if j > v2(plp(m) - 1).

We first prove the "only if" part. Assume that d = 2jm∈Bp,0 and let f be an integer with [formula]. Then lp(m)|f so that j - 1 = v2(pf - 1)  ≥  v2(plp(m) - 1). This establishes the "only if" part if lp(m) is even, and it also shows that [formula] always, so in particular if lp(m) is odd. Suppose lp(m) is odd and 1 + v2(p - 1) < j  ≤  v2(p2 - 1). Then j - 1 > v2(p - 1), so that lp(2j - 1m) is even. Using lp(m) odd, this implies that 2lp(m)|f, so that 2j|(p2 - 1)|(pf - 1), contradicting [formula].

Towards showing the "if" part, let v = v2(plp(m) - 1). We have [formula], so that 2v + 1m∈Bp,0. If j > v + 1 and lp(m) is even, then with f = 2j - v - 1lp(m), Lemma [\ref=lem-2power] implies that [formula], so that 2jm∈Bp,0. If lp(m) is odd, then v = v2(p - 1), so that 2v + 1∈Bp,0. Finally assume that j > v2(p2 - 1) and lp(m) is odd. Then Lemma [\ref=lem-2power] implies that [formula], so that 2jm∈Bp,0. This concludes the proof.

For [formula] coprime to 2p, let

[formula]

Proposition [\ref=prop-crit] implies that if 2jm∈Bp,0 with m odd, then j > fp(m). Further, if (m,2p) = 1 then 2jm∈Bp,0 for all j > fp'(m).

Using this last property, we have Bp,0(x) at least as big as the number of choices for m coprime to 2p with 1 < m  ≤  x / 2fp'(m) + 1. Thus, the lower bound in the theorem will follow if we show that there are at least bpx /  log  log x integers m coprime to 2p with m  ≤  x / 2fp'(m) + 1.

Let λ(m) denote Carmichael's function at m, which is the order of the largest cyclic subgroup of [formula]. Then lp(m)|λ(m). Also, for m > 2, λ(m) is even, so that

[formula]

Thus, the lower bound in the theorem will follow if we show that there are at least bpx /  log  log x integers m coprime to 2p with m  ≤  x / 2gp(m) + 1. Using Lemma [\ref=lem-2power], we have gp(m) + 1 = v2(λ(m)) + v2(p2 - 1). Further, it is easy to see that [formula], with equality when |p| + 1 is a power of 2.

It follows from [\cite=amicable] that uniformly for all [formula] and all positive integers n,

[formula]

We apply this with n = 2g0 + 1, where g0 is the first integer with [formula]. Thus, if R is the set of primes r  ≤  x with v2(r - 1) > g0, we have for x sufficiently large,

[formula]

Let z = x / (25|p| log  log x). In

[formula]

coprime to 2p and divisible by r. It follows that for x sufficiently large depending on the choice of p, there are at least

[formula]

integers m  ≤  z coprime to 2p and not divisible by any prime r∈R. (We used that |R| = O(x /  log x) to estimate the O-term above.)

It remains to note that if m  ≤  z, m is coprime to 2p, and m is not divisible by any prime in R, then v2(λ(m))  ≤  g0, so that

[formula]

Thus, 2gp(m) + 1m∈Bp,0 and 2gp(m) + 1m  ≤  x, so that

[formula]

for x sufficiently large depending on the choice of p. This completes our proof of the lower bound.

For the upper bound, it suffices to show that

[formula]

(With this assumption, no two numbers d counted can have the same odd part.) We shall assume that p is not a square, the case when p = p2j0 for some integer p0 and [formula] being only slightly more complicated. From Proposition [\ref=prop-crit], N(x) is at most the number of odd numbers m coprime to p with m  ≤  x / 2fp(m) + 1. Let Nk(x) be the number of odd numbers m  ≤  x / 2k + 1 with m coprime to p and fp(m) = k. Then

[formula]

We now concentrate our attention on Nk(x) with 2k  ≤   log  log x. If fp(m) = k, then m is not divisible by any prime r with (p / r) =  - 1 and 2k + 1|r - 1. Then, using [\eqref=eq-recipsum] and quadratic reciprocity,

[formula]

By Propostion [\ref=prop-sieve], the number of integers m  ≤  x / 2k + 1 not divisible by any such prime r is at most

[formula]

Summing this expression for 2k  ≤   log  log x gives Op(x /  log  log x), which completes the proof of Theorem [\ref=thm:dist0].

One might wonder if there is a positive constant βp such that if p is odd with |p| > 1, then Bp,0(x)  ~  βpx /  log  log x as x  →    ∞  . Here we sketch an argument that no such βp exists; that is,

[formula]

First note that but for Op(x / ( log x)1 / 2) values of d  ≤  x there is a prime r|d with (p / r) =  - 1. (We are assuming here that p is not a square.) For such values of d = 2jm, with m odd, we have 2|lp(m), so that in the notation above we have [formula]. Thus it suffices to count numbers 2jm  ≤  x with m odd and [formula]. Note that

[formula]

say. Further,

[formula]

where r runs over the prime divisors of m. We have

[formula]

For k > ( log  log  log x)2, the density of primes [formula] is so small that we may assume that no d is divisible by such a prime r. For k below this bound, the density of primes r with v2(lp(r)) = k is [formula]. Thus, there is a positive constant ck,p with [formula] as k  →    ∞   such that the density of integers m coprime to 2p and with fp(m) < k + hp is asymptotically equal to

[formula]

as x  →    ∞  . Thus, the number of m  ≤  x / 2k + hp coprime to 2p and with fp(m) = k + hp - 1 is asymptotically equal to

[formula]

as x  →    ∞  . This expression then needs to be summed over k. For k small, the count is negligible because of the exp factor. For k larger, we can assume that the coefficients ck,p are all 1, and then the sum takes on the form

[formula]

Letting this sum on k be denoted g(x), it remains to note that g(x) is bounded away from both 0 and ∞   yet does not tend to a limit, cf. [\cite=Li].

To prove Theorem [\ref=thm:dist1], we first establish the following result.

Let p be an integer with |p| > 1. Let d be a positive integer coprime to p such that d is divisible by odd primes s, t with

[formula]

Assume that 4|lp(d). Then either 4|d and [formula] or 〈p〉d is not balanced.

Let k = lp(d). First assume that 4|d and [formula]. Let 2κ be the largest power of 2 in k. Write d = 2jm where m is odd, let 2κ1 be the power of 2 in lp(m), and let 2κ2 = lp(2j). Then κ  =   max {κ1,κ2}. Suppose that κ2  >  κ1. We have [formula] and [formula]. Since 4|k, we have [formula], and since pk - 1 = (pk / 2 - 1)(pk / 2 + 1), we have [formula]. Thus, [formula], contrary to our assumption. Hence, we may assume that κ  =  κ1  ≥  κ2. Note that this inequality holds too in the case that [formula], since then, κ2 = 0.

We categorize the odd prime powers ra coprime to p as follows.

Type 1: [formula].

Type 2: [formula].

Type 3: It is Type 2 and also [formula].

Type 4: It is Type 2 and also lp(ra) is odd.

By assumption d has at least one Type 3 prime power component and at least one Type 4 prime power component. We will show that 〈p〉d is not balanced in [formula]. By Proposition [\ref=prop:non-vanishing], it is sufficient to exhibit an odd character χ mod d that is trivial at p with conductor d' divisible by the same odd primes as are in d, and with either [formula] or d / d' odd.

Let [formula] where the power of 2 in lp(ra11) is 2κ1. (Note that ra11 cannot be Type 3 nor Type 4, since we have [formula], so that 4|lp(ra11).) Consider the Type 1 prime powers in d, other than possibly ra11 in case it is of Type 1. For each we take the quadratic character and we multiply these together to get a character χ1 whose conductor contains all of the primes involved in Type 1 prime powers, except possibly r1.

If [formula], we let ψ2j be the principal character mod 2j. If [formula], let ψ2j be a primitive character mod 2j with ψ2j(p) = ζ, a primitive 2κ2-th root of unity. Let χ2  =  χ1ψ2j.

We choose a character ψra11 mod ra11 with ψra11(p) = χ2(p)- 1 if [formula], and otherwise we choose it so that ψra11(p) =  - 1. Thus, this character is non-principal. Let χ3  =  ψra11χ2. We now have [formula].

If χ3(p) =  - 1 we use a Type 3 prime power [formula] and choose a character ψra33 mod ra33 with ψra33(p) =  - 1. Let χ4  =  χ3ψra33. If χ3(p) = 1, we let χ4  =  χ3. We now have χ4(p) = 1.

If χ4( - 1) = 1, we use a Type 4 prime power [formula] and choose a character ψra44 mod ra44 with ψra44(p) = 1 and ψra44( - 1) =  - 1. Let χ5  =  χ4ψra. If χ4( - 1) =  - 1, we let χ5  =  χ4.

All remaining prime powers ra in d are of Type 2. For these we take non-principal characters that are trivial on 〈p, - 1〉ra, and multiply them in to χ5 to form χ6. This is the character we are looking for, and so 〈p〉d is not balanced. This completes our proof.

In the proof we shall assume that p is neither a square nor twice a square, showing in these cases that we may take εp = 1 / 16. The remaining cases are done with small adjustments to the basic argument, but may require a smaller value for εp.

Let d  ≤  x be coprime to p. The set of primes [formula] with [formula] and for which p is a quadratic nonresidue has density 1 / 4, and in fact, the sum of reciprocals of such primes r  ≤  x is [formula]. (This follows from either [\eqref=eq-recipsum] and quadratic reciprocity or from the Chebotarev density theorem.) Thus by Proposition [\ref=prop-sieve], the number of integers d  ≤  x not divisible by any of these primes r is Op(x / ( log x)1 / 4). Thus, we may assume that d is divisible by such a prime r and so that 4|lp(d).

Note that if [formula] and that p is a quadratic residue modulo r, but not a fourth power, then any ra is of Type 3. The density of these primes r is 1 / 16, by the Chebotarev theorem, in fact, the sum of reciprocals of such primes r  ≤  x is [formula]. So the number of values of d∈[3,x] not divisible by at least one of them is Op(x / ( log x)1 / 16), using Proposition [\ref=prop-sieve]. Also note that if [formula] and p is a nonzero fourth power modulo r, then any ra is Type 4. The density of these primes r is also 1 / 16, and again the number of d∈[3,x] not divisible by at least one of them is Op(x / ( log x)1 / 16).

Thus, the number of values of d  ≤  x coprime to p and not satisfying the hypotheses of Proposition [\ref=prop:crit] is O(x / ( log x)1 / 16). This completes the proof of Theorem [\ref=thm:dist1].

The average and normal order of the rank

In this section we consider the average and normal order of the rank of the curve Ed given in Theorem [\ref=thm:CHU] as d varies.

It is clear from Theorem [\ref=thm:CHU] that for q odd,

[formula]

with equality when d∈Bp,1 and [formula].

For all q and d > 1, it is known [\cite=Brumer] that

[formula]

(Here log qd is the logarithm of d base q, i.e., log d /  log q.) We do not include the details here, but this bound can be proved directly for the the curves in Theorem [\ref=thm:CHU] using that theorem. In addition, for q odd, considering values of d of the form qf + 1 for some positive integer f, and using Theorem [\ref=thm:CHU], we see that the main term in this inequality is sharp for this family of curves.

We show below that although the average rank of [formula] is large--its average for d up to x is at least x1 / 2--for "most" values of d the rank is much smaller.

There is an absolute constant [formula] with the following property. For each odd prime p and finite field [formula] of characteristic p, with [formula] and Ed as in Theorem [\ref=thm:CHU], we have

[formula]

for all sufficiently large x depending on the choice of p.

This result follows almost immediately from [\cite=PS]. A result is proved there for the average value of the rank of curves in a different family also parametrized by a positive integer d. Using the notation from the present paper, if d∈Bp,1 the rank of the curve considered in [\cite=PS] is within 4 of

[formula]

We have d∈Bp,1 implies that e∈Bp,1 for all e|d with e > 2. By Theorem [\ref=thm:CHU], formula [\eqref=eq-ranksum] is exactly the rank of [formula] for d∈Bp,1. Since the proof of the lower bound xα in [\cite=PS] uses only values of d∈Bp,1, we have the lower bound xα in the present theorem.

Since the rank of [formula] is bounded above by the formula [\eqref=eq-ranksum] whether or not d is in Bp,1, and in fact whether or not 〈p〉d is balanced, the argument given in [\cite=PS] for the upper bound gives our upper bound here.

For each odd prime p and finite field [formula] of characteristic p, with [formula] and Ed as in Theorem [\ref=thm:CHU], we have but for o(x /  log  log x) values of d  ≤  x with d∈Bp that

[formula]

as x  →    ∞  . Further, assuming the GRH, we have but for o(x /  log  log x) values of d  ≤  x with d∈Bp that

[formula]

as x  →    ∞  . Assuming the GRH, this upper bound holds but for o(x) values of d  ≤  x coprime to p as x  →    ∞  , regardless of whether d∈Bp.

For d∈Bp, Theorem [\ref=thm:CHU] implies that the rank of [formula] is at least φ(d) / lq(d)  ≥  φ(d) / λ(d), where λ was defined in the previous section as the order of the largest cyclic subgroup of [formula]. It is shown in the proof of Theorem 2 in [\cite=EPS] that on a set of asymptotic density 1, we have φ(d) / λ(d) = ( log d)(1 + o(1)) log  log  log d. We would like to show this holds for almost all d∈Bp. Note that we have φ(m) / λ(m) = ( log m)(1 + o(1)) log  log  log m for almost all odd numbers m. We have for all odd m and every integer [formula] that

[formula]

Thus, for almost all odd numbers m we have for all nonnegative integers j with 2j  ≤   log m that φ(2jm) / λ(2jm)) = ( log (2jm))(1 + o(1)) log  log  log (2jm). Further, it follows from [\eqref=eq-recipsum] that but for a set of odd numbers m of asymptotic density 0, we have [formula]. It thus follows from Proposition [\ref=prop-crit] that for almost all odd numbers m there is some nonnegative j with 2jm∈Bp and 2j  ≤   log m. By Theorems [\ref=thm:dist0], [\ref=thm:dist1] almost all members of Bp are of this form, and so we have the lower bound in the theorem.

For the upper bound we use an argument in [\cite=LP]. There, Corollary 2 and the following remark imply that under the assumption of the GRH, for almost all numbers d coprime to p we have φ(d) / lq(d) = ( log d)(1 + o(1)) log  log  log d. We use that φ(e) / lq(e)|φ(d) / lq(d) for e|d and from the normal order of the number-of-divisors function τ(d), that most numbers d have τ(d)  ≤   log d. It thus follows from Theorem [\ref=thm:CHU] and the GRH that for almost all numbers d coprime to p that

[formula]

We would like to show as well that this inequality continues to hold for almost all d that are in Bp. As above, the GRH implies that for almost all odd numbers m coprime to p, we have φ(m) / lq(m) = ( log m)(1 + o(1)) log  log  log m. Since [\eqref=eq-comp] continues to hold with lq in place of λ, it follows that for almost all odd m and for all j with [formula], that φ(2jm) / lq(2jm) = ( log (2jm))(1 + o(1)) log  log  log (2jm). Again using the normal order of the number-of-divisors function τ, we have that for almost all odd m and all j with [formula] that τ(2jm)  ≤   log m. Further, as we noted above, from Theorems [\ref=thm:dist0], [\ref=thm:dist1], it follows that almost all members d of Bp are of the form 2jm with m odd and 2j  ≤   log m. The rank formula in Theorem [\ref=thm:CHU] implies that the rank of [formula] is bounded above by τ(d)φ(d) / lq(d). Thus, for almost all d∈Bp we have the rank at most ( log d)(1 + o(1)) log  log  log d. This completes the proof.