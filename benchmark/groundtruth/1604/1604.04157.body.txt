Note on VCG vs. Price Raising for Matching Markets

keywords: matching markets, market clearing prices, VCG mechanism.

Introduction

The idea of market clearing prices seems to exist since more than 200 years (cf. [\cite=Say34]): Prices of products are expected to adapt to the demand such that the demand is satisfied without any leftover products. A rigorous mathematical treatment in the special (and particularly simple) case of a "two-sided market" is presented in Shapley and Shubik's paper [\cite=SS72]. The setup there consists of a set I of items (or "sellers"), a set J of buyers and given valuations vij  ≥  0 indicating the value that item i has for buyer j. One may assume w.l.o.g. that |I| = |J| (otherwise add dummy items of value 0 for all buyers or dummy buyers with zero valuations for all items if necessary). Relative to given prices pi,i∈I, buyer j will only be interested in items that yield him a maximum profit vij - pi. Let us call these items "acceptable" (for buyer j w.r.t. given prices pi). The price vector p = (pi) is market clearing if there is a perfect matching of the buyers with the items such that each buyer is assigned to (matched with) an acceptable item.

Market clearing prices are easy to compute (cf. [\cite=EK10] or section [\ref=s-clearing]), even if we impose the additional requirement that [formula] should be minimal. Such buyer optimal market clearing prices turn out to be unique (cf. [\cite=SS72] or section [\ref=s-clearing]).

The above setup is also interesting in the context of sealed bid auctions, where buyers are called bidders: Assume that an auctioneer is to assign the items i∈I to the buyers j∈J and compute prices pi to be paid by the buyers for the items they get assigned to. The auctioneer employs a mechanism performing this job (computing an assignment and corresponding prices based on the reported valuations vij,i∈I,j∈J). Such a mechanism is called incentive compatible if no bidder has any reason to lie about his valuations, i.e. if telling his true valuations vij,i∈I maximizes the profit vij - pi of bidder j (where i is the item he gets assigned to), irrespective of what the other bidders do. In game theoretic terms one would say that truthtelling is a dominant strategy for each bidder j. A famous mechanism with this property is the so-called VCG mechanism, based on work by to Vickrey [\cite=V61], Clarke [\cite=C71] and Groves [\cite=G73]. The basic idea is that each bidder should pay for "the harm it does to the others" (cf. section [\ref=s-VCG] for details).

In [\cite=EK10], the use of the VCG-mechanism for matching markets (in particular sponsored search) is motivated by saying that computation of market clearing prices "can only be carried out by a search engine that actually knows the valuations" vij of the bidders. VCG is known to be incentive compatible (even in a more general setting, cf. [\cite=N07]), so bidders can indeed be assumed to report their true valuations, once they know that VCG is applied to compute the assignment and corresponding prices.

As it turns out, however, these VCG prices are exactly the buyer optimal prices pi which we could equally well compute by the standard price raising procedure (cf. [\cite=EK10] or section [\ref=s-clearing]) and subsequent reduction to buyer optimal prices. The purpose of our note is to stress that - at least in the context of matching markets - VCG is just an alternative way of defining buyer optimal prices, or, to put it in another way, a means of showing that buyer optimal prices are incentive compatible.

We do not claim that our findings (in particular Lemma [\ref=buyeropt=VCG]) are completely new, but on the other hand we also did could not find them anywhere mentioned explicitly in the literature. Actually, we only found one single document pointing out an equivalence between VCG and market clearing prices ([\cite=A13]) and this completely ignores the crucial buyer optimality. All others adopted the argument from Easley and Kleinberg's book mentioned above.

In the following two sections we discuss market clearing prices, buyer optimality, and the equivalence with VCG in the context of matching markets. We aimed at a mainly selfcontained presentation (assuming only basic knowledge on linear programming and bipartite matchings).

Market clearing prices

Let [formula] be the complete bipartite graph with node sets I (items) and J (buyers), and assume w.l.o.g. that |I| = |J| = n, say. (Otherwise, add dummy items of value 0 to all players or dummy buyers with valuation 0 for all items.) Let vij  ≥  0,i∈I,j∈J denote the valuation of buyer j∈J for item i∈I. A matching in G is a subset M  ⊆  E of paiwise non-incident edges. M is perfect if it matches all nodes, i.e., |M| = n. The value of a matching M is defined as [formula]. We let

[formula]

It is well-known that v* and a corresponding optimal matching M*  ⊆  E can be found by solving the following linear program (P) with variables xij indicating whether ij∈M(xij = 1) or not (xij = 0 and its dual (D):

[formula]

The dual variable pi may be interpreted as price of item i (see also below). To each price vector [formula] there is a corresponding best choice for q, obtained by setting qj: =  max ivij - pi. For this reason we also refer to a given price vector p as a "dual solution" (without mentioning the corresponding q). Clearly, we may - and will - always assume p  ≥  0 w.l.o.g. (by adding a suitable amount to all components of p and subtracting the same amount from q).

The price raising procedure (cf., e.g., [\cite=EK10]), in discrete optimization also known as Hungarian Method ([\cite=Kuhn51], cf. also [\cite=Hi41]) is a rather efficient combinatorial algorithm for solving (P) and (D). It is a special case of a primal-dual algorithm that subsequently modifies a feasible dual solution p until a complementary (hence optimal) primal solution is found:

Given a feasible dual solution (p,q), define the corresponding set of equality edges

[formula]

By complementary slackness, (p,q) is optimal if there is a corresponding perfect matching M  ⊆  E=, i.e., a 0 - 1 solution of (P) with xij = 1  ⇒  pi + qj = vij. Interpreting pi as price of item i, such a matching M assigns each buyer j to an item i with profit qj = vij - pi for buyer j. Dual feasibility ensures that any other item ĩ would result in a lower or equal profit vĩj - pĩ. (This is why [formula] is called "best sellers graph" sometimes (cf., e.g., [\cite=EK10]).

Starting, say, from p = 0, we successively seek to modify the current dual solution (p,q) such that [formula] contains larger and larger matchings M  ⊆  E= in each iteration, until eventually a perfect matching is reached (and hence an optimal solution is found).

Thus assume (p,q) is a current dual feasible solution and M  ⊆  E= is a maximum (non-perfect) matching, i.e., there exists an unmatched j∈J. Let R  ⊆  I denote the set of nodes that can be reached from j along an M-alternating path in G= (as indicated in the figure below).

Each i∈R is matched by M (otherwise the M-alternating path from j to i were M-augmenting, contradicting our assumption that M is maximum). Moreover, the matching partners MR  ⊆  J of R are not joined to any node [formula] in G= (any such i would belong to R by definition). Hence we may increase p on R and decrease q on [formula], maintaining dual feasibility, until some e∈E joining [formula] to MR becomes an equality edge and we update (enlarge R correspondingly. After at most n = |I| steps, a new dual feasible (p̃,) will be found, allowing a larger "primal" matching [formula] of size || = |M| + 1 in the corresponding =.

After at most n = |I| such iterations, we eventually end up with a dual feasible (p,q) and a primal perfect matching M  ⊆  E= in the corresponding G=. As explained earlier, given prices pi, buyer j is ready to buy any item i with ij∈E= as this will maximize his profit. This explains the notion of market clearing prices for the optimal dual solutions on D (as these are exactly the ones that allow a complementary perfect matching M  ⊆  E=).

Market clearing prices are by no means unique. For example, raising all prices by 1 (and decreasing q correspondingly) does not affect optimality. However, there is a unique optimal dual solution p that is buyer optimal in that it minimizes [formula] (recall that we assume all prices to be non-negative). This is an immediate consequence of Shapley and Shubik's [\cite=SS72] "lattice structure" Theorem:

If [formula] are market clearing, so is pi: =  min {p'i,p''i},i∈I.

It is straightforward to verify that p, together with qj: =  max {q'j,q''j} yields a feasible dual solution. (Here q',q'' are the dual variables corresponding to p',p''.) Furthermore, if M is any maximum valuation perfect matching, then M must be complementary with both (p',q') and p'',q''). Thus p'i + q'j = p''i + q''j = vij for all ij∈M. Hence pi + qj  =   min {p'i,p''i}  +   max {q'j,q''j} = vij for all ij∈M, proving that p is market clearing as well.

Once we have computed market clearing prices p by price raising as described above, we may further reduce them to unique buyer optimal prices in a similar way. The following observation is useful in this context (one direction is proved in [\cite=EK10]):

Let p∈Rn+ be market clearing and M  ⊆  E= be a corresponding perfect matching in the corresponding equality graph G=. Then the following are equivalent: (i) p is buyer optimal (ii) Each j∈J is joined by an M-alternating path P  ⊆  E=, starting and ending with a matching edge, to an item i∈I with pi = 0.

"⇒  ": Assume p is buyer optimal and j∈J. Clearly, pmin  =   min pi  =  0 - otherwise p cannot be buyer optimal (decrease all pi by pmin). Let R  ⊆  I denote the set of items i∈I that can be reached from j along M-alternating paths P  ⊆  E= from j, starting (and ending) with a matching edge. By definition of R, there is no edge in E= joining R to any [formula], where again MR  ⊆  J denotes the set of matching partners of R. Hence, in case p > 0 on R, we may decrease p on R and increase q on MR while staying dually feasible and complementary with M. This would contradict the assumed minimality of p. "⇐": Assume that (ii) holds, but p is not buyer optimal, i.e., there exists a market clearing p̃ with p̃i0 < pi0. Let j0 be the matching partner of i0 and let P = j0,i0,j1,i1,...,jk,ik be the M-alternating path whose existence is guaranteed by (ii). As p̃ with corresponding [formula] is an optimal dual solution, complementarity with (the optimal primal) M implies

[formula]

Hence dual feasibility of (p̃,) yields

[formula]

a contradiction.

Lemma [\ref=buyeropt] suggests the following algorithm to reduce a given market clearing p (with corresponding q and any fixed maximum valuation matching M) towards buyer optimality: First decrease all prices uniformly until pi = 0 for some item i. Check whether condition (ii) in Lemma [\ref=buyeropt] is satisfied. If yes, we are done. Otherwise pick any j∈J that violates condition (ii) and let R  ⊆  I denote the set of items that can be reached from j along M-alternating paths starting (and ending) with a matching edge. By assumption, p > 0 on R. Furthermore, there are no edges in E= joining R to [formula]. Hence decreasing p on R and increasing q on MR maintains feasibility and hence optimality of the given dual solution (note that [formula] remains constant). We therefore decrease p on R until eventually a new edge e joining R to [formula] enters E=, in which case we update (enlarge) the current set R  ⊆  I and continue. After at most n = |I| steps, j will get connected to an item i with pi = 0 as required in condition (ii) and the iteration is complete. We finish our description of the algorithm by opbserving that, while proceeding this way (trying to connect a current j as above to the zero price items), we never destroy any M-alternating paths connecting other buyers j' to zero price items. Indeed if any such path P would pass through i∈R as above, then also j were connected to zero price items (follow the M-alternating path from j to i and then switch to P). Thus, indeed, after at most n = |I| iterations we will eventually reach an optimal dual solution (p,q) satisfying condition (ii) in Lemma [\ref=buyeropt], i.e., buyer optimal prices p.

In section [\ref=s-VCG] we will see how buyer optimal prices arise in a natural (and at the first glance different) way in the context of sealed bid auctions.

VCG

The general idea behind VCG mechanisms is that items should be assigned to buyers so as to maximize the total valuation ("social welfare") and that prices are determined so that each buyer j pays for the "harm he does to the others" by taking the item (or, in more general situations, the goods) assigned to him. More precisely, let M be any maximum valuation matching of value v* = v(M). For any ij∈M compute [formula], the maximum valuation of a matching when bidder j is removed or (to maintain our assumption |I| = |J|) replaced by a dummy bidder with valuation 0 for all items.

We then compare this to [formula], the maximum valuation if buyer j has left and taken item i. The difference between these two, i.e., v- j - v- i- j is the harm that buyer j does to the others if he takes away item i and, in VCG-terminology, this is the personalized price pij of item i for buyer j. The VCG mechanism then assigns items to buyers according to the optimal matching M and asks each buyer j to pay his price pVCGi: = pij for the item i he is assigned to.

We claim that the VCG prices pVCGi defined this way are exactly the buyer optimal market clearing prices (cf. also section 15.9 in [\cite=EK10]).

Let p be buyer optimal market clearing prices and M be any maximum valuation matching. Then pi = v- j - v- i- j holds for all ij∈M.

As M is a maximum valuation matching, so is [formula] for the subgraph [formula] for any ij∈M. In other words, v- i- j = v* - vij for ij∈M.

Secondly, observe what happens if we replace j by a dummy bidder: Let [formula] correspond to p, so that [formula]. By Lemma [\ref=buyeropt], there exists an M-alternating path P from j to some zero priced item i.

Construct a new matching [formula] by switching M along P (thereby unmatching i and j) and matching i and j with each other. Correspondingly, obtain [formula] from q by decreasing qj to 0. Then [formula] is (still) complementary with (p,) and hence optimal. Thus v- j = v* - qj. Consequently, the VCG price that j has to pay for the item i that is assigned to him equals

[formula]

as claimed. .

VCG prices have the desirable property of being incentive compatible: Buyers cannot profit by lying about their true valuations vij. Hence this is true for the mechanism thatcomputes (and posts) buyer optimal market clearing prices (and assigns items to buyers according to a maximum value perfect matching M). We include a proof for convenience of the reader.

Assigning items to buyers at (posted) buyer optimal market clearing prices is incentive compatible.

Assume that buyer j, when reporting his valuations vij truthfully gets assigned to item i at a price of pi  =  v- j - v- i- j (according to Lemma [\ref=buyeropt=VCG]). We compare his profit qj = vij - pi to the outcome in case he reports valuations ṽij,i∈I, and, as a consequence, gets assigned to item ĩ∈I (possibly different from i). The resulting price is then (again according to Lemma [\ref=buyeropt=VCG]) p̃i  =  ṽ- j  -  ṽ- i- j, where the tilde indicates that the corresponding values are computed based on valuations ṽij,i∈I of player j.

Let M and [formula] denote the corresponding assignments computed w.r.t. given valuations v and ṽ, resp. Thus ij∈M and ĩj∈. As M is a maximum value matching w.r.t. v, we have v(M)  ≥  v(), i.e.,

[formula]

(The last equation is due to the fact that v-  ĩ- j does not depend on the valuations of j.) Hence the price that j were to pay for item ĩ (when he misreports his valuations as ṽij) is, according to Lemma [\ref=buyeropt=VCG],

[formula]

showing that vĩj  -  p̃i  ≤  vij - pi. So misreporting his valuations cannot increase his profit.