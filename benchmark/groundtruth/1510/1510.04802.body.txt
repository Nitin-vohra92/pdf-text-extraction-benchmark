Insights from Machine-Learned Diet Success Prediction

This is a preprint of an article appearing at the Pacific Symposium on Biocomputing (PSB) 2016.

Introduction

In 2012, 30-50 million Americans were on a diet at any given point in time for reasons ranging from lowering the risk of diseases to having a more positive self image. The annual revenue of the U.S. weight-loss industry is estimated at around $20 billion. Clearly, dieting is not easy and new fashion diets come into existence every year.

In this paper we explore the practice of keeping an online food diary and its relation to dieting outcomes. Concretely, we turn to data from a large fitness and health application, MyFitnessPal (henceforth MFP), and look at the publicly logged food consumption of more than 4,000 users over several months. Figure [\ref=fig:food_selection] shows the interface through which users enter their consumed food. Users not only log their daily intake but they also specify a "daily calories goal" against which their consumption can be compared. Figure [\ref=fig:mfp_screenshot] shows this goal at the bottom of the screenshot. Though we cannot observe their actual weight progression, we are using the information on whether a user mostly consumes more or less calories than their self-declared goal as an indicator for dieting success.

Using these user labels of being "above" or "below" we train a classifier to tell the two user groups apart using the types of food users have logged. Through a feature analysis of the classifier we gain insights into which foods are associated with diet success or failure.

Our findings are largely intuitive, e.g., logging food with "oil", "butter" or "mcdonalds" in the name is an indication of going above one's calorie goals. However, we also discover less obvious trends such as a distinction between pork (indicative for being "over") and poultry (indicative for being "under"). In addition, we describe general behavior related to food logging. E.g., users are least likely to log any meal on the weekend and, if they do, they are most likely to be above their weight goal.

To the best of our knowledge, this is the first systematic analysis of public food diaries. We believe that this paper helps to show the potential that this data holds for various health-related analyses.

Related Work

Our research is centered around "quantified self" data. The quantified self is a movement to voluntarily log personally relevant data for self knowledge and improvement. Users might decide to quantify or track their activity both for goal-driven or documentary motivation [\cite=rooksbyetal14chi]. Striking the right balance between the amount of data that an application wants to collect and the amount of effort required on the user's end can be challenging [\cite=meyeretal14chi]. Rusin et al. [\cite=rusinetal13ijmi] offer a review of technologies used for logging food intake.

When it comes to weight loss and weight maintenance, certain practices related to the quantified self such as "think about how much progress you've made" (by having charts showing this), "weigh yourself" (through weight logging) and "read nutrition labels" (making use of the nutrition database that services such as MFP provide) have been among the few indicators of both successful weight loss and maintenance [\cite=sciamanna11ajpm]. Other research has also found that "self monitoring" is important both for weight loss [\cite=burkeetal11jada] and for successfully maintaining such loss [\cite=kraschnewskietal10ijo]. These studies are, however, from the "pre-smartphone era" where calorie counting was done manually using pencil and paper. Still, they give credence to the potential benefits for both weight loss and weight management that apps such as MFP could offer. A currently ongoing study will also shed light on the effect of frequent weight control [\cite=lindeetal15cct] on dieting outcomes. To date, few studies have, however, looked at the effectiveness of mobile apps for motivating health behavior changes [\cite=payne15jmirmu].

Concerning the analysis of food consumption through user-generated data, some studies have taken a public health approach and looked at regional or temporal patterns in food consumption. West et al. [\cite=westetal13www] used web search and click-through data to study seasonal changes in the recipes people search for. Server logs from a recipe site were used in [\cite=wagneretal14www] [\cite=wagneretal14epj] to study regional differences in food preferences. Their angle is less health-centric and more culture- or preference-centric with a focus on whether ingredients or regional influences dominate the recipe choice. Using only the ingredients of recipes, rather than regional or cultural knowledge, has been explored in [\cite=tengetal12websci] for the purpose of recipe recommendation.

Conceptually close to our study is the work by Abbar et al. [\cite=abbaretal15chi] who look at food mentions on Twitter. Their analysis also includes bit on individual and not only public health. If users were to mention everything they ate on social media then the type of food diaries we are using would become redundant. However, we believe that this is unlikely to be the case for many users and our data is far cleaner and more structured and comes with user-defined daily calorie goals. Culotta [\cite=culotta14chi] also used Twitter data to study obesity and other health issues but from a purely aggregate, public health perspective. Kuener et al. [\cite=kuebleretal13pone] use data from Yahoo Answers to look at issues of both mental and physical health of obese people. They find that "obese people residing in counties with higher levels of BMI may have better physical and mental health than obese people living in counties with lower levels of BMI". They do not, however, look at indicators related to the success or failure of weight loss.

As far as the idea of trying to predict dieting success is concerned, the work in [\cite=lietal14group] is related. The authors study data from an online weight loss community and offer insights into different phases of usage which, potentially, could help to predict who will engage in the long-term and hence have a higher chance of achieving and maintaining weight loss. Finally, Park et al. [\cite=parketal16cscw] study long-term sharing of MFP activity on Twitter. This also indirectly relates to dieting success as long-term engagement with a fitness application could be seen as beneficial for maintaining weight loss.

Data Acquisition and Preprocessing

Obtaining Food Diaries and Constructing Food Taxonomy

The construction of our dataset begins with the download of public food diary pages of MFP users. First, we extracted an initial list of 100K usernames from the 10 most popular MFP groups. Next, for each user, we retrieved up to the last 180 days of food diary pages (until March 2015 when the data collection took place). Ultimately, the food diary pages of 9,896 users are publicly accessible, resulting in 587,187 food diary pages retrieved. On average, each user has logged 59.3 days of diaries (S.D. = 54.6, median = 42) or 652.9 food entries in total (S.D. = 774, median = 366). According to the random samples (N = 200) of user profiles, the average age of users in the dataset is 36.6 years old (S.D. = 10.71). The vast majority of users are female (75%) and reside in the United States (67%). A small fraction of users (5.7%) do not provide any demographic information.

When adding an entry in a food diary, users can either search for existing foods in MFP database or enter a new food description and associated nutritional values. The lack of controlled vocabulary in the food data creation causes several data integrity issues, e.g., the same foods may be described slightly different by different users. To mitigate the problems, we needed ways to group related foods into semantic categories. Thus, we built a food taxonomy by compiling lists of food-related categories and page names from Wikipedia. The taxonomy is manually organized into 18 main categories (e.g., staple food, meats, vegetables, etc.), 149 subcategories (e.g., wheat, rice, beef, etc.) and 4,233 entities, describing individual ingredients and meal types of food entries. For example, the entry "McDonald's - Premium Sweet Chili Chicken Wrap (Grilled)" will be annotated with the following set of {main category: subcategory: entity}: {Staple foods: Wheat: Wrap}, {Meats: Poultry: Chicken}, {Preparation Methods: Grill}, {Fast foods: McDonald's}.

Data Preprocessing and Pruning

To extract categories from a food entry, we first lemmatized all entity words in the taxonomy and the food entry's text. Then, we iterated through the main categories to find the maximal exact substring match between the taxonomic entities and the food entry's text. E.g., the entity "bean sprout" is a match in "Iga - bean sprouts" but not a match in "Sprouts - tiramisu espresso beans". After a match had been found, the corresponding main category, subcategory, and entity were added to the annotation. The taxonomy has a reasonable coverage with respect to our dataset. Out of 632,652 unique food entries, 88% were successfully annotated while 12% produced an empty annotation. The causes of failed annotation include misspelled (e.g., brocolli) and non-English names (e.g., huevos rancheros).

To describe a user's food intake, we used both the categories described above and single-word tokens extracted from the text of the diary entry. The tokenization steps are as follows: (i) splitting on non-word characters, (ii) lower casing everything, (iii) only considering tokens of length at least three, and (iv) requiring all characters to be alphabetical (a-z). Furthermore, for both tokens and categories, we required that more than 500 distinct users had to use it, leaving us with 1,720 distinct tokens and 392 distinct categories. Finally, only users who had at least 30 logged days with at least one non-zero feature were considered, ignoring days with less than 100 calories logged. This left us with 5,797 users.

Labeling Calorie Goals "Success"

The core of our analysis is centered around looking for differences between successful and unsuccessful users, where success is in relation to their self-declared daily calories goal. For each day, a user was assigned a label of "below", "on-target" or "above" depending on their calories goal and actual calories consumed as follows.

below: (goal - actual) / goal >  .2

above: actual >   goal

on-target: otherwise

We chose to label a (user, day) pair where the user exceeds their goal (i.e., too much consumption) by even a single calorie as "above" to encode the inherent asymmetry in dieting to lose weight. Table [\ref=tab:mfp_weekly] shows the trend of the (user, day) pairs when grouping by the day of the week and aggregating across users. As found in previous work looking at food consumption [\cite=abbaretal15chi], the weekend seems to be the worst period for dieting with (i) the highest fraction of "above" incidents, and (ii) the lowest number of logged days. Interestingly, web searches for recipes seem to follow the opposite trend [\cite=westetal13www].

To have a single label for each user, the (user, day) label pairs were aggregated across days by taking the modal class, i.e., the biggest class. Note that this means a user could have as little as 34% of their days belonging to this class. Having a single label for each user, rather than modeling each (user, day) pair separately, had the advantages of (i) reducing noise due to the larger data set being considered, and (ii) interlinking behavior across days so that even "good" behavior on one day could be predictive of "bad" behavior on another day.

Using single-word tokens as features, with the above definition of user labels, 3,320 users were labeled "below", 1,546 were "on-target" and 931 "above". To have a clearer distinction between the classes, we chose not to consider users in the "on-target" group for further analysis. This left us with 4,251 users for the token-based analysis and [formula] for the category-based analysis.

Results

Exploratory Cluster Analysis

To gain a better understanding of the food consumption patterns, we performed a cluster analysis. Each of the 4,251 users for the token-based representation was mapped to a feature vector where each of the 1,720 dimension counted on how many distinct days a user used a specific token. These vectors were then normalized in 2-norm. We used X-Means [\cite=pellegmoore00icml] as implemented in Weka [\cite=halletal09sigkdd] as the clustering algorithm. The algorithm automatically chose k = 6 as the optimal number of clusters (searching between k = 2 and k = 10).

Table [\ref=tab:clustering] shows a summary of the obtained clusters. The cluster sizes are reasonably balanced, ranging from 411 to 1,130. To understand the distinctive features for each cluster we looked at the tokens that went up the most in the ranking, compared to the global average. For example, a token that is globally ranked 1,000th in terms of its average user weight but is ranked 20th within a particular cluster has moved up 980 ranks. Furthermore, we required that the token had to end up in the top 40. This was done to ensure that the token is relatively frequent in the end. Note that the bigger clusters (Clusters 5 & 6) are closer to the "average" and so the relative change in ranking is smaller for them.

The fraction of "below" and "above" users shows moderate variations, ranging from 69% "below" to 84%. However, the discriminative tokens do not necessarily tell an intuitive story as, e.g., Cluster 4 with "pizza" and "bacon" has a lower fraction of "above" than Cluster 6 with "organic" and "natural". Clusters 2 and 3 also seem similar in that they both have many discriminative tokens related to coffee. However, Cluster 2 has an "above" percentage that is 10% above that of Cluster 3.

Overall, the unsupervised clustering did not yield practical insights as clusters seemed to be more influenced by things such as brand names or shopping at particular supermarket chains, than by healthy-vs.-unhealthy food categorization. Hence, we decided to look at supervised methods instead, where the above-vs.-below labels are central.

Above-vs.-Below Machine Classification

To understand the differences in food consumption between our above and below users, we trained a Support Vector Machine (SVM) classifier with a linear kernel and the default settings in the SVM-light implementation [\cite=svmlight]. We used the same general setup for both feature sets, tokens and categories, though the dimensionality of the feature space differed (1,720 vs. 392). In both cases, we trained the classifier on a balanced training set with a equal number of above and below instances, 931 for tokens and 919 for categories. The training set was then split into 10 folds, each with a 90%-10% train-test split. Table [\ref=tab:performance] summarizes the performance for the binary classifier.

The classification performance was sufficient though the category-based model did not perform better than the token-based model. We also performed an analysis to look at when the classifier errs. For both feature sets, both the false positive and false negative instances furthest from the decision boundary had less than 50% in their modal class ("below" or "above"). In other words, their ground truth label had a low degree of confidence. Similarly, in all cases the individual instances furthest from the decision boundary had the correct labels assigned. This can also be seen in Figure [\ref=fig:mfp_users] where the fraction of "above" days for users increases from left to right, i.e., from being classified most strongly as "below" to being classified most strongly as "above". Interestingly, the graph also shows that users with a higher fraction of "above" days also tend to have logged more days in the system.

Feature Analysis

Our main motivation was not to predict if a user will be mostly above or below their weight goal, but rather, to understand the potential effect that different food choices might have on this outcome. To achieve this, we performed a feature analysis for the learned classification models. As we used a linear kernel, each feature is assigned a weight which can be directly interpreted with large and positive feature weights being indicate of "above" and large (in absolute value) and negative feature weights being indicative of "below".

Table [\ref=tab:indicator_tokens] shows the features with the 10 most positive (negative) weights on the left (right). Tokens such as "oil", "butter", or "mcdonalds" are all indicative for consuming more calories than planned. The "added" token in third position is mostly derived from using the "quick added calories" functionality. This functionality allows users to manually enter a summed caloric amount without having to enter each food item separately. Fruit tokens such as "banana", "grapes", or "lemon" are all indicative of staying below one's calorie goal.

Table [\ref=tab:indicator_categories] summarizes the category-based classification model. Overall, categories related to fruit, poultry, and baked foods are indicative of staying below one's calorie goals, whereas wheat, pork, and fried foods point towards going over.

It is interesting to see that desserts in general (denoted by the main category "dessert") are associated with logging too many calories, but caramels (denoted by the specific entity "dessert:confectionery:caramel") are associated with logging less categories than one's goal. However, the average usage of caramels corresponds to only 130kcal, compared to 173kcal for any logging entry under "dessert" and 195kcal for generic cakes ("dessert:cake"). The appearance of donuts ("snack:snack:donut"), with an average of 180 kcal, in the under-goal class is also unexpected. This may be potentially caused by the collinearity of certain features although the regularization term in the SVM usually deals with this.

Note that Table [\ref=tab:indicator_categories] shows that "sabras - hummus" is incorrectly categorized as beverage:alcohol in our taxonomy (see Section [\ref=sec:data:diaries_taxonomy]). A false positive is caused by the token "sabras" which was incorrectly matched to "Sabra", a liqueur produced in Israel, contained in the beverage category. Example foods in Table [\ref=tab:indicator_tokens] & [\ref=tab:indicator_categories] that are marked with [formula] were shortened to fit the table. The full list of names can be found in a footnote.

Discussion

The analysis shown in this paper is preliminary in parts but still serves to show the value of using food diaries for studying dieting success in real-world settings. More complex machine-learning models could be used to, e.g., look at the interaction between food types. Conveniently, MFP provides this nutritional breakdown for the logged meals (see Figure [\ref=fig:mfp_screenshot]). Such analysis could shed light on the success of dieting practices that advocate the separation of carbohydrates and protein or similar approaches.

Our definition of whether a user is below or above their calories goal (see Section [\ref=sec:data:labeling]) is admittedly simple. For example, a user who is over their goal by 100% for one day, but then under for 10% for ten days would be labeled as "under" instead of "on-target". In fact, there are plausible alternative definitions but we do not expect them to change the results dramatically. For example, we had initially used a +/- 20% margin in both directions, not only towards below, and this gave similar list of discriminative tokens (Table [\ref=tab:indicator_tokens]).

More fundamentally, it is very difficult to determine if a shorter-than-usual log entry indicates a day of "food abstinence" or just an incomplete diary. Though we did not use it in this study, we could ideally obtain the weight loss goal, encoded in a picture posted in the profile page of some users. Having this information would also be helpful in distinguishing the small fraction of users on MFP who might be trying to gain or maintain weight rather than losing it. These users are not treated properly by our methodology though the analysis of "which food is linked to being above the weight goal" still holds.

Looking at the temporal patterns across a user's lifetime in the system, we did some preliminary analysis to see if users stopped logging food because of (i) achieving a set weight loss goal or (ii) getting frustrated by the failure to do so. For this, we looked at the fractions of users in a given "temporal percentile range", referring to a user's logging events buckets in 10% of their total time range. For each temporal bucket, we then assign it the modal label during that period. In aggregate, over a user's lifetime in the system their daily success ratios changed only slightly, from an initial below-vs.-on-target-vs.-above of 61%-23%-16%, to 63%-20%-17% for the penultimate 80-90% bucket. Only for the final 10% of logging events, the distribution changed to 69%-16%-15%. We are still unsure if this indicates (i) being most likely to "over-perform" by staying well below one's calories goal just before abandoning, or (ii) logging in a more and more incomplete manner at the end.

Weight control is related to controlling both calorie intake and energy expenditure. In this analysis, we only looked at the former of these. However, given that platforms such as MFP also provide a way to log the latter, we deem this worthwhile for future exploration.

Generally, having more access to user profile information could help predict "what type of diet will work for whom". What works could depend both on what type of foods a user has access to (e.g., due to income, geography, or working hours) but also relate to general lifestyles (e.g., with increased peer pressure when eating in a group). Automatically generated, personalized weight loss programs will definitely attract more attention in the future.

Conclusion

This paper presents a study that uses public food diaries of more than 4,000 long-term active MFP users. Our analysis is centered around a classifier that, given a list of foods consumed by a person, predicts if they will be below or above their self-defined calorie goal. While certain findings are expected ("oil" and "mcdonalds" being indicative of consuming too many calories) others are less obvious (poultry is linked to staying within one's goals, whereas pork indicates going above). Our results prove the feasibility of mining such data for health-related analysis. Especially with additional links to users' activity and general lifestyle patterns, automatically generated personalized and adaptive dieting seem a promising avenue to pursue. Health informatics is only starting to use the veritable gold mine that comes with public quantified-self data. This paper contributes to advances in this field by exploring how public food diaries can be mined to understand differences in unsuccessful and successful diets.

Acknowledgment

This work is supported by the National Research Foundation under its International Research Centre Singapore Funding Initiative and administered by the IDM Programme Office. In particular, we would like to thank Prof. Ee-Peng Lim for supporting a research visit by Dr. Weber in early 2015. This laid the foundation for this collaboration.