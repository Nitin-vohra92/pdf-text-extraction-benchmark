A Geometric Proof of Calibration

Motivation.

Foster [\cite=Fo99] stated that:

Over the past few years many proofs of the existence of calibration have been discovered. Each of the following provides a different algorithm and proof of convergence: Foster and Vohra [\cite=FoVo91] [\cite=FoVo98], Hart [\cite=Ha95], Fudenberg and Levine [\cite=FuLe99], Hart and Mas-Colell [\cite=HaMa97]. Does the literature really need one more? Probably not.

In spite of this, he argued, successfully, that his new proof of the existence of calibrated forecasters in the case of binary outcomes, based on Blackwell's approachability theorem (Blackwell [\cite=Bla56]), was shorter and more direct than most of the previous proofs.

In this paper, we consider the general case of finitely many outcomes and exhibit an even shorter (ten-line long) proof of the existence of calibrated forecasters based on approachability. We show therefore that calibration is a straightforward consequence of approachability. As we realized by browsing on the web, approachability and calibration are well-taught matters and we are confident that this new proof will become a standard example in the list of direct applications of approachability (as is already the case for the existence of no-regret forecasters). Since calibration is a central tool in learning in games (see, e.g., Kakade and Foster [\cite=KakadeFoster08]) and in online learning (see, e.g., Mannor, Tsitsiklis, and Yu [\cite=MannorTY09]), the simplicity of the proof and the guaranteed convergence rates open up new opportunities to use calibration in practical learning algorithms.

Foster [\cite=Fo99] mentions that his approachability-based proof of the existence of a calibrated forecaster was obtained by first considering a modification of an intuitive forecaster already stated in Foster and Vohra [\cite=FoVo91] and then working out the proof of its guarantees. We proceed the other way round and start directly from the statement of Blackwell's approachability theorem for convex sets [\cite=Bla56] but, as a drawback, can only exhibit a forecaster which has to solve a linear program at each step. Taking a closer look at Foster [\cite=Fo99], one can see that we indeed capture the essence of his previous proof. His algorithm is a clever modification, in the case of binary outcomes, of the general approachability-based forecaster presented below; the former has a nice, explicit, and simple statement.

We now recall the informal definition and consequences of calibration. Consider a finite set of possible outcomes and suppose we obtain random forecasts about future events; these forecasts are each given by probability distributions over the outcomes. Now, such a sequence of forecasts is called calibrated whenever it is consistent in hindsight, that is, when, for all distributions [formula], the actual empirical distribution of the outcomes on those rounds when the forecast was close to [formula] is also close to [formula].

Having a calibrated forecasting scheme is beneficial in several ways. On the one hand, it allows some agent to choose the best responses to the predicted forecasts or to consider other risk measures which might be more valuable than greedily choosing the best action leading to highest reward. On the other hand, calibrated forecasting rules enable multiple agents to converge to a reasonable joint play in some situations. For instance, if all players use calibrated forecasts of other players' actions, then the empirical distribution of action profiles converges to the set of correlated equilibria; see Foster and Vohra [\cite=FoVo97]. We refer to Sandroni, Smorodinsky, and Vohra [\cite=SaSmVo03] for further discussion on calibrated forecasting as well as its generalizations.

Setup and formal definition of calibration.

We consider a finite set A of outcomes, with cardinality denoted by A and denote by P  =  Δ(A) the set of probability distributions over A. We equip P, which can be considered a subset of [formula], with some norm [formula], to be referred to as the calibration norm. In particular, the Dirac probability distribution on some outcome a∈A will be referred to as δa.

A forecaster plays a game against Nature. At each step, it outputs a probability distribution Pt∈P while Nature chooses simultaneously an outcome at∈A. We make no assumption on Nature's strategy.

The goal of the forecaster is to ensure the following property, known as calibration: for all strategies of Nature,

[formula]

The a.s. statement accounts for randomized forecasters. (It was shown by Oakes [\cite=Oakes85] and Dawid [\cite=Dawid85] that randomization is essential for calibration.)

The literature (e.g., Foster and Vohra [\cite=FoVo98], Foster [\cite=Fo99]) essentially considers a less ambitious goal, at least in a first step: ε-calibration. (We explain in Section [\ref=sec:cstr] how to get a calibrated forecaster from some sequence of ε-calibrated forecasters with good properties.) Formally, given ε  >  0, an ε-calibrated forecaster considers some finite covering of P by Nε balls of radius ε and abides by the following constraints. Denoting by [formula] the centers of the balls in the covering (they form what will be referred to later on as an ε-grid), the forecaster chooses only forecasts [formula]. We thus denote by Kt the index in [formula] such that [formula]. The final condition to be satisfied is then that for all strategies of Nature,

[formula]

When the calibration norm is the [formula]-norm [formula], the sum appearing in this criterion is usually referred to as the [formula]-calibration score (Foster [\cite=Fo99]). Another popular criterion is the Brier score (Foster and Vohra [\cite=FoVo98]), which we consider in Section [\ref=sec:Brier]; it is bounded, up to a factor of 2, by the [formula]-calibration score.

A geometric construction of ε-calibrated forecasters.

In this section we prove our main result regarding the existence of an ε-calibrated forecaster based on approachability theory. We recall results approachability theory, provide the main result (Theorem [\ref=th:main]), and then address the issue of computational complexity.

Statement of Blackwell's approachability theorem.

Consider a vector-valued game between two players, with respective finite action sets I and J. We denote by d the dimension of the reward vector. The payoff function of the first player is given by a mapping [formula], which is linearly extended to Δ(I)  ×  Δ(J), the set of product-distributions over I  ×  J.

We denote by [formula] and [formula] the sequences of actions in I and J taken by each player (they are possibly given by randomized strategies). Let [formula] be some set. By definition, C is approachable if there exists a strategy for the first player such that for all strategies of the second player,

[formula]

That is, the first player has a strategy that ensures that the average of his vector-valued payoffs converges to the set C.

For closed convex sets C, there is a simple characterization of approachability that is a direct consequence of the minimax theorem.

A closed convex set [formula] is approachable if and only if

[formula]

Application to the existence of an ε-calibrated forecaster.

As indicated above, we equip P with some calibration norm [formula] and fix ε  >  0; we then consider an associated ε-grid [formula] in P  =  Δ(A).

There exists an ε-calibrated forecaster which selects at every stage a distribution from this grid.

We apply the results on approachability recalled above. To that end, we consider in our setting the action sets [formula] for the first player and J  =  A for the second player.

We define the vector-valued payoff function as follows; it takes values in [formula]. For all [formula] and a∈A,

[formula]

which is a vector of [formula] elements of [formula] composed by [formula] occurrences of the zero element [formula] and one non-zero element, located in the k-th position and given by the difference of probability distributions [formula].

We now define the target set C as the following subset of the ε-ball around [formula] for the calibration norm [formula]. We write [formula]-dimensional vectors of [formula] as [formula]-dimensional vectors with components in [formula], i.e., for all [formula],

[formula]

where [formula] for all [formula]. Then,

[formula]

Note that C is a closed convex set.

The condition ([\ref=def:epscal]) of ε-calibration can be rewritten as follows: the sequence of the vector-valued rewards

[formula]

converges to the set C almost surely.

The existence of an ε-calibrated forecaster is thus equivalent to the approachability of C, which we now prove by showing that the characterization provided by Theorem [\ref=th:appr] is satisfied. Let [formula]. By construction, there exists [formula] such that [formula] and thus

[formula]

(Here, the distribution [formula] of the approachability theorem can be taken as the Dirac distribution δk.)

Computation of the exhibited ε-calibrated forecaster.

The proof of the approachability theorem gives rise to an implicit strategy, as indicated in Blackwell [\cite=Bla56]. We denote here by ΠC the projection in [formula]-norm onto C.

At each round [formula] and with the notations above, the forecaster should pick his action Kt at random according to a distribution [formula] on [formula] such that

[formula]

where     ·     denotes the inner product in [formula]. The proof of Theorem [\ref=th:appr] (see Blackwell [\cite=Bla56]) shows that such a distribution ψt indeed exists; the question is how to efficiently compute it. To do so, we first need to compute the projection [formula] of [formula].

We address the two computational issues separately. We first indicate how to find the projection efficiently and then explain how to find the distribution ψt based on the knowledge of this projection.

Projecting onto C.

We need to find the closest point in C to [formula]. Since C is convex and the [formula]-norm is convex, we have to deal with a minimization problem of a convex function over a convex set. Since answering the question whether a given point is in C or not can be done in time linear in [formula], the projection problem can be solved (approximately) in time polynomial in [formula].

Now, for the special case where the calibration norm is the [formula]-norm [formula], we can do much better. For [formula], we denote by si,t - 1∈{ - 1,1} the sign of the i-th component [formula] of the vector [formula]. (The value of the sign function at x is arbitrary at x = 0, equal to - 1 when x < 0 and to 1 when x > 0.) Then, [formula] is the solution of the following optimization problem, where the unknown is [formula]:

[formula]

It can be easily shown (as in Gafni and Bertsekas [\cite=GafniBertsekas84] or by an immediate adaptation of Palomar [\cite=Palomar05]) that the optimal solution is unique; it is given by [formula] where for all [formula],

[formula]

and μ* is chosen as the minimum nonnegative value such that [formula]. (Note that if μ*  >  0 then [formula].) Finding μ* can be done by a binary search to an arbitrary precision.

In conclusion, when the calibration norm is the [formula]-norm [formula], projecting onto C can be done in linear time in ANε to a desired precision δ with complexity that depends on δ like log (1 / δ).

Finding the optimal distribution ψt in ([\ref=eq:Blk]).

The question that has to be resolved is therefore how to find ψt that satisfies condition ([\ref=eq:Blk]). Since we know that such a ψt exists, it suffices, for instance, to compute an element of

[formula]

where we denoted [formula].

This can be done efficiently by linear programming leading to a polynomial complexity in [formula] and A.

However, if instead of solving the minimax problem exactly we are satisfied with solving it approximately, i.e., allowing a small violation δ  >  0 in each of the A constraints given by ([\ref=eq:Blk]), we can use the multiplicative weights algorithm as explained in Freund and Schapire [\cite=FrSc99]; see also Cesa-Bianchi and Lugosi [\cite=CeLu06]. The complexity of such a solution would be

[formula]

since ( ln Nε) / δ2 steps of complexity ANε each have to be performed.

The proof of Blackwell's approachability theorem shows that in this case the sequence of the average payoff vectors [formula] converges rather to the [formula]-expansion (in [formula]-norm) of C; it is easy to see that the latter is included in the δ-expansion (in [formula]-norm) of C.

Putting all things together and taking the [formula]-norm [formula] as the calibration norm (in particular, to define C), we can find a 2ε-calibrated forecaster whose complexity is of the order of [formula] at each step. Since [formula] behaves like ε- (A - 1) we have that the dependence of the complexity per stage behaves like ε- (A + 1) (ignoring multiplicative and logarithmic factors). This implies a polynomial dependence in ε but an exponential dependence in A.

It is worth noting that when choosing a solution ψt, it is not possible to replace ψt with its mean or with an element of [formula] that is close to its mean. The reason is that this would give rise to a deterministic rule, which, as we mentioned in Section [\ref=sec:caldef], cannot be calibrated. The fact that we have to randomize rather than take the mean is due to our construction of the vector-valued game; therein, playing a mixed action ψt over the [formula]'s leads to a very different vector-valued reward than playing the (element [formula] closest to the) mean of the mixed action. This is because different indices of the [formula]-dimensional space are involved.

Rates of convergence and construction of a calibrated forecaster.

In this section we provide rates of convergence and discuss the construction of a calibrated (rather than ε-calibrated) forecaster. We finally compare our results to some existing calibrated forecasters in the literature.

The main result of this section is providing rates of convergence for a calibrated forecaster in ([\ref=eq:ratescalibr]). To the best of our knowledge, this is the first rates results for calibration for an alphabet of size A larger than 2. For A  =  2, (sub)optimal rates follow from the procedure of Foster and Vohra [\cite=FoVo98] as recalled in Section [\ref=sec:FoVo].

Rates of convergence.

Approachability theory provides uniform convergence rates of sequence of empirical payoff vectors to the target set, see Cesa-Bianchi and Lugosi [\cite=CeLu06]. Formally, denoting by [formula] the Euclidian [formula]-norm in [formula], it follows in our context that there exists some absolute constant γ (independent of A and [formula]) such that for all strategies of Nature and for all T, with probability 1 - δ,

[formula]

Here, it is crucial to state the convergence rates based on the Euclidian norm because of an underlying martingale convergence argument in Hilbert spaces proved by Chen and White [\cite=ChWh96]. The reason why the convergence rate here is independent of A and [formula] is that the payoff vectors m(k,a) all have an Euclidian norm bounded by an absolute constant, e.g., 2; this happens because most of their components are 0.

We now apply this result. However, we underline that the set C can be defined by a different calibration norm [formula]; below, we will define it based on the [formula]-norm, for instance. But the stated uniform convergence rate can be used since, via a triangle inequality and an application of the Cauchy-Schwarz inequality,

[formula]

[formula] is of the order of ε- (A - 1); we let γ' be an absolute constant such that [formula] for all [formula] (say). We therefore have proved that given [formula], the forecaster defined in the previous section is such that for all strategies of Nature and for all T, with probability 1 - δ,

[formula]

This high-probability bound is to be used below as the key ingredient to construct a calibrated forecaster, i.e., a forecaster satisfying ([\ref=def:cal]). Combining the Borel-Cantelli Lemma with the bound above shows that the less ambitious goal ([\ref=def:epscal]) can be achieved.

Construction of a calibrated forecaster.

We use a standard approach which is commonly known as the "doubling trick," see, e.g., Cesa-Bianchi and Lugosi [\cite=CeLu06]. It consists of defining a meta-forecaster that proceeds in regimes; regime r (where [formula]) lasts Tr rounds and resorts for the forecasts to an εr-calibrated forecaster, for some εr  >  0 to be defined by the analysis. We now show that for appropriate values of the Tr and εr, the resulting meta-forecaster is calibrated in the sense of ([\ref=def:cal]), and even uniformly calibrated in the following sense, where B denotes the Borel sigma-algebra of P:

[formula]

Of course, uniform calibration ([\ref=def:unifcal]) implies calibration ([\ref=def:cal]) via the choices for B given by ε-balls around probability distributions [formula].

For concreteness, we focus below on the [formula]-calibration score.

Regimes are indexed by [formula] and the index of the regime corresponding to round T is referred to as RT. The set of the rounds within regime [formula] is called Tr; rounds in regime RT with index less than T are gathered in the set TRT (we commit here an abuse of notations). We denote by [formula], where [formula], the finite εr-grid considered in the r-th regime. By the triangle inequality satisfied by [formula], we first decompose the quantity of interest according to the regimes and to the played points of the grids,

[formula]

We now substitue the uniform bound obtained in the previous section and get that with probability [formula],

[formula]

where we defined δr,T  =  1 / (2rT2).

An application of the Borel-Cantelli Lemma and Cesaro's Lemma shows that for suitable choices of a sequence εr decreasing towards 0 and an increasing sequence Tr such that εA - 1r  Tr tends to infinity fast enough, one then gets the desired convergence ([\ref=def:unifcal]). For instance, if Tr  =  2r, and εr is chosen such that

[formula]

are of the same order of magnitude, e.g., εr  =  2- r / (A + 1), then

[formula]

where the constant ΓA depends only on A. As indicated above, to the best of our knowledge, this is the first rates results for calibration for an alphabet of size A larger than 2.

Comparison to previous forecasters.

[formula]-calibration score.

Foster [\cite=Fo99] first considered the [formula]-calibration score in the context of the prediction of binary outcomes only, i.e., when A  =  2. The ε-calibrated forecaster he explicitly exhibited has a computational complexity of the order of 1 / ε. He did not work out the convergence rates but since his procedure is mostly a clever twist on our general procedure, they should be similar to the ones we proved in Section [\ref=sec:rates].

Brier score.

What follows is extracted from Foster and Vohra [\cite=FoVo98]; see also Cesa-Bianchi and Lugosi [\cite=CeLu06].

Given an ε-grid over the simplex P, we define, for all [formula], the empirical distribution of the outcomes chosen by Nature at those rounds t when the forecaster used [formula],

The classical Brier score can be shown in our setup to be equal to the following criterion:

[formula]

Since for two probability distributions [formula] and [formula] of P, one always has

[formula]

the Brier score can be seen to be upper bounded by twice the [formula]-calibration score; it is thus a weaker criterion.

Cesa-Bianchi and Lugosi [\cite=CeLu06] shows however that forecasters with Brier scores asymptotically smaller than ε can be the keystones to construct calibrated forecasters, in a way similar to the construction exhibited in Section [\ref=sec:cstr].

In the case A  =  2, these forecasters essentially bound the Brier score, with probability at least 1 - δ, by a term that is of the order of

[formula]

which is worse than the rate we could exhibit in Section [\ref=sec:rates] for the [formula]-calibration score.

In addition, the computational complexity of the underlying procedure (based on the minimization of internal regret) is of the order of 1 / ε2 per stage and thus is similar to the complexity 1 / εA + 1  =  1 / ε2 we derived in Section [\ref=sec:cplx] for our new procedure.

The general case of [formula] is briefly mentioned in Cesa-Bianchi and Lugosi [\cite=CeLu06] indicating that the case of A = 2 can be extended to [formula] without further details. As far as we can say, the computational complexity of such an extension per step would be of the order of 1 / ε2(A - 1) versus 1 / ε(A + 1) for the approachability-based procedure we suggested above. The convergence rates, for a straightforward extension, seem to be quite slow. However, based on a draft of the present article, Perchet [\cite=Per10] recently proposed a more efficient extension of the procedure of Foster and Vohra [\cite=FoVo98] and obtained the same rates of convergence as in ([\ref=eq:ratescalibr]); he however did not work out the complexity of his procedure, which seems to be similar to the one of our construction.

Acknowledgments.

Shie Mannor was partially supported by the ISF under contract 890015 and a Horev Fellowship. Gilles Stoltz was partially supported by the French "Agence Nationale pour la Recherche" under grant JCJC06-137444 "From applications to theory in learning and adaptive statistics" and by the PASCAL Network of Excellence under EC grant no. 506778.