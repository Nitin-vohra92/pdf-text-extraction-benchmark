Optimality of Non-Restarting CUSUM charts

Key words: CUSUM chart, optimality, non-restarting, upper boundary, continuous signals

Introduction

In statistical process control, one of the most commonly used control charts is the cumulative sum (CUSUM) chart developed by [\cite=page]. As a simple example of a CUSUM chart consider the following. Assume we sequentially observe the independent random variables Xt ([formula]). Suppose the observations [formula] each have distribution N(0,1) and [formula] have N(Δ,1) for some known Δ > 0. The aim is then to find the unknown change point [formula]. The classic CUSUM chart is The chart signals a change at time inf {t > 0;St  ≥  α} for some threshold α > 0. At this time the chart suspects a change in distribution. When the CUSUM chart crosses the threshold α, it is restarted in some fashion. The chart is typically reset at 0, with some practitioners opting for the headstart feature [\citep=Lucas], where the chart is reset at a different value such as α / 2. CUSUM charts were initially designed for use in industry [\citep=page], where restarting coincides with a machine being repaired and reset.

We are concerned with situations where the observations can switch multiple times between two known distributions and where resetting is not possible. For example, medical settings where "machines" such as hospitals cannot be reset when a deterioration of performance is suspected. Thus we shall use the CUSUM charts of the form

[formula]

for [formula], where [formula] is the Radon-Nikodym derivative of F1 with respect to F0 and h > 0 is a constant specifying an upper boundary. As explained in [\cite=gandy11CUSUMFDR], a single non-restarting CUSUM chart [\eqref=eq:our_CUSUM] with R0 = 0 is appropriate in settings where restarting is not possible. Moreover, it is shown that the imposition of an upper boundary facilitates the detection when switching between an in-control state and out-of-control state many times. The CUSUM charts defined by [\eqref=eq:our_CUSUM] constitutes a family of charts, each member represented by a specific choice of starting value R0∈[0,h]. We distinguish two particular CUSUM charts which we shall use throughout this paper. These are the "extreme" charts in [\eqref=eq:our_CUSUM] i.e. for any R0∈[0,h] we have RLt  ≤  Rt  ≤  RUt for all [formula].

In this paper, it is shown that using CUSUM charts of the form [\eqref=eq:our_CUSUM] are optimal in a well-defined sense. The optimality criteria we consider is similar to that used by [\cite=lorden]. Our optimality is a generalisation of the [\cite=moustakides] result, where a single change in distribution is considered. Showing optimality of CUSUM charts is a subject of interest in the change point detection literature. For instance, [\cite=Poor1998] extends the optimality in the sense of [\cite=lorden], to include a exponential penalty for delay. Moreover, extensions to continuous time processes [\citep=Mous2004], use of dependent observations such as Markov chains [\citep=Yakir1994] and random processes [\citep=Mous1998] have also been explored. However, to our knowledge, the optimality of CUSUM charts in a setting where observations can switch between two known distributions multiple times has not been investigated.

To make clear our setting and the charts we shall being using, consider the following illustrative example. Let Xt  ~  N( - 1 / 2,1) when in the in-control state and Xt  ~  N(1 / 2,1) when in the out-of-control state at time t. In this example, we use the charts RLt and RUt with h = 16 with threshold α = 8. These non-restarting CUSUM charts will signal out-of-control at time t if RLt  ≥  α. Moreover, these charts will continually signal out-of-control whilst RLt remains above α. Similarly, for signalling in-control when the upper chart RUt drops below α.

In Figure [\ref=fig:two_eg1] it is clear that the lower boundary at 0 and upper boundary at h are "holding barriers" that prevent the chart dropping too low or rising too high. Beneath the plot of the CUSUM chart in Figure [\ref=fig:two_eg1], is the signal indicator. The grey areas represent the charts signalling out-of-control and in-control, where it is clear that continuous signals are made. This would not be the case when using a traditional CUSUM chart (i.e. a chart of the form [\eqref=eq:our_CUSUM] with h =   ∞   starting at 0) that restarts when its threshold is crossed.

In Section [\ref=sec:notation] we begin by introducing notation appropriate in our setting. We then introduce stochastic processes as signal processes, that allows continuous signalling. In Section [\ref=sec:mous] we present [\cite=lorden] criterion of optimality as used in [\cite=moustakides]. Section [\ref=sec:main] contains the main theoretical result of the paper. Here, it is shown that using non-restarting CUSUM charts with an upper boundary are optimal in a well-defined sense. Although the upper boundary is introduced in the theoretical result, its value remains unspecified. In Section [\ref=sec:prac] we explore how the choice of the upper boundary affects the signals made and practical consequences. We conclude in Section [\ref=sec:discussion] we some remarks concerning future topics of research.

Optimality

In this section we present our optimality criteria. We present the theoretical result proving that using non-restarting CUSUM charts with an upper boundary, are optimal in the sense defined. We begin by introducing notation and recalling the [\cite=moustakides] result.

Notation

Let (Ω,F) be a measurable space with random variables [formula]. Let P be a set of probability measures on (Ω,F) such that for all P∈P, Xt ([formula]) are independent and the distribution of Xt, L(Xt)∈{F0,F1} for all [formula]. Both F0 and F1 are assumed to be known and mutually absolutely continuous. We will assume that [formula] has no atoms with respect to P∈P such that L(Xt) = F0 for all [formula]. The σ-algebra generated by [formula] is denoted by Ft. Henceforth, whenever we use an expectation E or essential supremum, we shall specify with respect to which probability measure in P by defining the distributions of the Xt [formula]. We shall refer to the case L(Xt) = F0 as Xt being in the in-control state and L(Xt) = F1 as Xt being in the out-of-control state.

As we are concerned with detecting periods where the observations are in the in-control state or the out-of-control state, it is not convenient to work with stopping times as used in [\cite=moustakides] and [\cite=lorden]. Thus we shall use a stochastic process as a signal process. For a signal process Z, the events {Zt = j} correspond to signalling in-control (j = 0), signalling out-of-control (j = 1) and no signal ([formula]) at time t. The first in-control (j = 0) or out-of-control (j = 1) signal by the signal process Z after time n is denoted by τjn(Z) =  inf {t  ≥  n:Zt = j}.

Lastly, we define CUSUM chart developed by [\cite=page] SLt and its analogue, with the roles of F0 and F1 swapped SUt as follows.

[\cite=moustakides] Optimality Result

In this section we present the optimality result of [\cite=moustakides] in terms of signal processes. First, we recall optimality criteria used in [\cite=lorden]. The term [formula] is the longest average delay of signalling the X's are Fj distributed, guaranteed regardless of the behaviour of the F1 - j distributed X's before the change.

For a constant γ1 > 0, consider the optimization problem posed in [\cite=moustakides]

[formula]

where Z is a signal process. As proved in [\citet=Ritov1990] a solution of [\eqref=eq:mous] is the signal process Z1 where Z1t = 1 if SLt  ≥  kL for [formula], where kL > 0 is a constant determined by γ1. We appeal to this alternative proof of [\cite=moustakides] to avoid complications with the σ-algebras. By swapping the roles of F0 and F1 we obtain an analogous result. More precisely, for a constant γ0 > 0, consider the optimization problem

[formula]

where Z is a signal process. A solution of [\eqref=eq:mous_alt] is the signal process Z0 where Z0t = 0 if SUt  ≥  kU for [formula], where kU > 0 is a constant determined by γ0.

The expectation in [\eqref=eq:mous] is average time until signalling out-of-control, when all the observations are truly in-control and vice versa for the expectation in [\eqref=eq:mous_alt]. This is referred to as the average in-control and out-of-control run lengths respectively.

Main Result

In this section we present our optimality result. We begin by defining our optimality criteria. For constants c1 > 0 and c2 > 0, consider the optimization problem

[formula]

where Z is a signal process and for j∈{0,1} with P∈P such that L(Xt) = Fj for all [formula] The term [formula] [formula] is the longest average delay of signalling out-of-control (in-control), guaranteed regardless of the distribution of the X's prior to the permanent change out-of-control (in-control) and prior signals made. Unlike [formula] which considers the first stopping time τj1(Z), we consider the reset stopping time τjn(Z). Hence it is possible to repeatedly signal in-control or out-of-control. Each Bjn(Z), [formula], is the in-control (j = 1) or out-of-control (j = 0) average run length after the change point n.

There exists constants kU > 0 and kL > 0 such that for any h  ≥   max (kU,kL) a solution of [\eqref=eq:opt_prob] is the signal process Z* defined, for [formula], by

The proof of Theorem [\ref=thm:our_opt] is in Appendix 1.

Theorem [\ref=thm:our_opt] uses the charts RLt and RUt, which both follow the same evolutionary equation ft. However, RLt starts at value 0 whereas RUt starts at the upper boundary h. Starting at these two values means that we consider both the cases where the observation start (at time 0) in the in-control state and the out-of-control state simultaneously. Thus, the prejudice of assuming the observations are initially in the in-control state or the out-of-control state is removed. Further, Theorem [\ref=thm:our_opt] introduces the upper boundary h that prevents the CUSUM chart rising too high. [\cite=gandy11CUSUMFDR] explain how using an upper boundary in non-restarting CUSUM charts helps detect periods of out-of-control and in-control activity. Although the upper boundary h has been introduced in Theorem [\ref=thm:our_opt], its value is not specified. This practical issue is discussed in detail in Section [\ref=sec:prac] where we explore how varying the upper boundary affects the signal process.

Upper Boundary

In this section we investigate how varying the upper boundary h affects the number of false and correct signals made by the charts. We begin by classifying different scenarios that can occur by changing h. An illustrative example demonstrates how these scenarios leads to different signals for the same data.

Signal Gap and Overlay

Setting h = kU  +  kL in Theorem [\ref=thm:our_opt] means that RLt and RUt signal whenever kL is crossed. We shall refer to this as the single threshold case. However, this need not be the case as Theorem [\ref=thm:our_opt] just stipulates that h  ≥   max (kU,kL). When h  >  kU  +  kL then it is possible to simultaneously signal in-control and out-of-control. We shall refer to this case as a signal overlay. When h < kU  +  kL, then no signal can occur when either chart is between h - kU and kL. We shall refer to this as a signal gap. Thus both a gap and overlay are intervals where the charts cannot signal in-control or out-of-control with confidence. If we consider a simultaneous signal as no signal due to ambiguity, the cases of signal gap and overlay are the same. Thus, henceforth we shall only consider h  ≤  kU  +  kL.

To see the disparity between different values of the upper boundary h consider the following example. Let Xt  ~  N( - 1 / 2,1) when in the in-control state and Xt  ~  N(1 / 2,1) when in the out-of-control state at time t. In this example we set the thresholds at kU  =  kL = 5. In practice, however, it is typical to set these thresholds by pre-specifying the average run length. This can be achieved by running simulations of the CUSUM charts and conducting a numerical search. Alternatively, one could approximate the distribution of the CUSUM chart by a discrete Markov chain and obtain the average run length using the transition matrix [\citep=brook]. Using the [\cite=brook] approach with 100 states, the average in-control and out-of-control run length with kU  =  kL = 5 is approximately 930 time units. In this illustrative example we choose the out-of-control periods as time 16 to 35 and time 51 to 60. In Figure [\ref=fig:signals] we plot the two CUSUM charts RLt and RUt based on the same random realization of [formula] for h = 6,8 and 10.

Figure [\ref=fig:signals] illustrates some important points. First choosing a different value of h leads to a different signalling process for the same data. This is clearly presented by the signal indicators under Figure [\ref=fig:h6], [\ref=fig:h8] and [\ref=fig:h10]. Second, once the two CUSUM charts have coupled into a single chart in the single threshold case (h = kU  +  kL), definitive signals are given. More precisely, in Figure [\ref=fig:h10], after time 13, the chart signals either in-control or out-of-control. This is not the case where a signal gap occurs. Comparing Figure [\ref=fig:h6] and [\ref=fig:h8], we see that as the signal gap increases, fewer incorrect signals are made at the expense of fewer overall signals. This point is explored further in Section [\ref=sec:choice]. Lastly, in this example, the two CUSUM charts eventually coalesce or couple into a single chart. The time until coupling depends, not only on F0 and F1, but also on the upper boundary h. Coupling occurs at value 0 or h by construction of the CUSUM charts. Moreover, if we were the run CUSUM charts of the form [\eqref=eq:our_CUSUM] starting from every R0∈[0,h] all charts will couple either at 0 or h. This follows from the fact that RLt and RUt represent the "extreme" CUSUM charts. Thus at the time of coupling we signal confidently in-control, if at 0, or out-of-control, if at h, since all possible charts of the form [\eqref=eq:our_CUSUM] agree.

Practical Implications

Although we have discussed the scenarios that arise with different choices of the upper boundary, we have yet to explore the practical implications. As illustrated in Section [\ref=sec:gap/overlay], the choice of h affects the signals made by the charts. We now explore how the choice of h affects the number of correct and false signals in a small simulation.

We use the same in-control and out-of-control distributions and thresholds used Section [\ref=sec:gap/overlay]. The true in-control and out-of-control periods are represented by the grey areas in Figure [\ref=fig:fcsignals]. For a single iteration, we use the CUSUM charts RLt and RUt with h = 6,8,10 all with the same seed. We repeated this 10,000 times. Figure [\ref=fig:fsignals] and [\ref=fig:csignals] are plots the average number of false signals and correct signals, respectively, pointwise in time.

In Figure [\ref=fig:fsignals], when switching between states, there is a sudden peak in the number of false signals which subsequently declines. The single threshold case where h = 10, leads to the an overall higher false and correct average than the other values of h. From Figure [\ref=fig:fcsignals] the notion of a signal gap can be interpreted as follows: Whilst a chart is in a signal gap, signalling is deferred until a more "definitive" signal can be made i.e. when the chart exits the gap. This results in fewer false signals being made, with the trade-off that fewer signals overall are made. In practice, this could represent the users attitude to "err on the side of caution" and patiently waiting to signal with more confidence.

Discussion

We have shown that using non-restarting CUSUM charts of the form [\eqref=eq:our_CUSUM] are optimal in the sense of [\eqref=eq:opt_prob]. We specifically use the two charts, RLt starting at 0 and RUt starting at the upper boundary. This choice results in coupling of the CUSUM charts (see Figure [\ref=fig:signals]) where after the charts coalesce, they remain exactly the same. It is clear that after coupling, only one CUSUM chart needs to be considered.Coupling would not occur when using two CUSUM charts that are restarted - this feature is specifically for non-restarting CUSUM charts with an upper boundary.

A natural question to ask about coupling is: how long do the two non-restarting CUSUM charts take to couple? Denote the coupling time as T =  min {t  ≥  1:RLt = RUt}. Denote [formula] and [formula] as the first time when the lower CUSUM chart reaches the upper boundary and the upper CUSUM chart reaches 0 respectively. As [formula] it follows that [formula] for all P∈P, since all CUSUM charts of the form [\eqref=eq:our_CUSUM] with any starting value, couple either at value 0 or the upper boundary. For P∈P such that L(Xt) = F1 for all [formula] we would expect and similarly for P∈P such that L(Xt) = F0 all [formula], Proving such coupling results could be a topic for further research.

Appendix 1

Proof of Theorem [\ref=thm:our_opt]

We proceed to show the following: for any signal process Z and j∈{0,1} We start by showing [formula] for any signal process Z. As a first step we show that

[formula]

Consider the stopping time in [formula], namely τ1n(Z) - n + 1 and [formula]. For all j  ≥  1 and fix [formula] we have and Thus {+  =  j}  ⊆  {τ1n(Z) - n + 1  =  j} and so have a pointwise order of the stopping times. This implies [\eqref=eq:s1.5].

Next we show that

[formula]

For a fixed [formula]

[formula]

where, on the right hand-side of the inequality, is under P∈P such that L(Xt) = F0 for all t < n and L(Xt) = F1 for all t  ≥  n. Taking the supremum of [\eqref=eq:inter] over [formula] shows [\eqref=eq:s1.75]. This completes showing [formula]. A similar argument can be used to show [formula].

Since Bj(Z)  ≥  cj it follows that Bj1(Z)  ≥  cj for j∈{0,1}. As Bj1(Z) is the expectation in [\eqref=eq:mous] it follows that [\citep=Ritov1990] [formula] for any signal process Z.

A consequence of [\citet=moustakides] is that [formula]. Thus, by definition of [formula],

[formula]

Replacing inf {t  ≥  1:SLt  ≥  kL} in [\eqref=eq:a] with inf {t  ≥  1:RLt  ≥  kL} as they are the same, gives Thus, to show [formula], it suffices to show [formula] for all [formula].

To show this we follow an argument similar to that used in [\citet=moustakides]. For any m > n  ≥  1 and for fixed [formula], the quantity RLm is a non-decreasing function of Rn. This implies that the stopping time τ1n(Z*) =  inf {t  ≥  n:RLt  ≥  kL} is non-increasing with Rn - 1. Thus the essential supremum in [formula] is achieved for Rn - 1 = 0. Moreover, the essential supremum in [formula] remains unchanged when taking the maximum over P∈P such that L(Xt) = F1 for t  ≥  n. Hence from stationarity all [formula] are equal. This completes showing [formula].

We now show that [formula]. Similarly, we have [formula] thus by definition of [formula]

[formula]

Replacing [formula] in [\eqref=eq:b] with [formula] as they are the same, gives [formula]. Showing that [formula] for all [formula] follows from the same argument given above. Thus [formula].