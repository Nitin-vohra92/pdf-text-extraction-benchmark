Status and performance of the Gemini Planet Imager adaptive optics system

INTRODUCTION

Over the past two decades, our understanding of exoplanetary systems has progressed thanks to several complementary observational techniques. Transit and radial velocity surveys have yielded a wealth of new terrestrial planets, and a handful of the most tightly-orbiting ones can be characterized spectroscopically. However, no transit or radial velocity survey has a sufficiently long time baseline to detect, much less characterize, the planets in the outer reaches of extrasolar systems. Furthermore, our understanding of the formation and dynamical histories of these systems can be greatly aided by studying the morphology of the protoplanetary disks from which planets form and the debris disks that remain after the systems' evolution has stabilized. Spatially-resolved spectroscopy and polarimetry are powerful tools for investigating these systems.

High-contrast, high-resolution instrumentation is necessary to achieve these goals. To image even young, self-luminous gas giant exoplanets around their bright host stars requires near-infrared flux contrasts of 10- 4  -  10- 6. For even the nearest host stars, the projected separations of interest are often less than 0.5". The Gemini Planet Imager (GPI)[\cite=Macintosh2008] [\cite=Macintosh2014d] is a high-resolution, high-contrast near-infrared coronagraphic imager at Gemini South specifically designed to meet these requirements. GPI operates in one of two modes: a broadband polarimeter[\cite=Perrin2010a] or an integral field spectrograph (IFS) with a wavelength-dependent spectral resolution of approximately 30-80[\cite=Larkin2014]. Both modes have selectable bandpasses from Y to K-band, with pixel scales of 14.166  ±  0.007 mas/px and fields of view 2.7'' square. High-contrast science is enabled by GPI's high-order adaptive optics system[\cite=Poyneer2014]. For a thorough description and characterization of the AO system, as well as preliminary performance analysis based on 10 months of on-sky data, the reader may refer to Poyneer et al. (2016)[\cite=Poyneer2016]. In these proceedings, we provide an updated description the AO system performance, particularly as related to science images, as well as lessons learned, based on data from the first 1.5 yr of the GPI Exoplanet Survey (GPIES).

ADAPTIVE OPTICS SYSTEM DESCRIPTION

GPI AO is a natural guide star system with a woofer/tweeter mirror pair and a spatially filtered Shack-Hartmann wavefront sensor (SH WFS) [\cite=Poyneer2006a] [\cite=Poyneer2014] [\cite=Poyneer2016]. The woofer is a nine actuator diameter piezo mirror from Cilas, with a 5 mm actuator pitch. The tweeter is a micro-electromechanical system (MEMS) device from Boston Micromachines; it has an illuminated diameter of 43.2 actuators with a 0.4 mm actuator pitch. The tweeter actuators are one-to-one mapped to the quad-cell SH WFS subapertures. The 160×  160 px CCID-66 sensor operates at ~  700-900 nm, with selectable bandpass filters for the brightest stars. The WFS has an adjustable-width spatial filter that is used to reduce the effects of aliasing[\cite=Poyneer2004]. The control loop is run at 1 kHz on bright stars (I < 8), and at 500 Hz on fainter stars. Due to WFS detector read noise limitations, we do not observe stars fainter than [formula]. GPI AO uses an LQG controller[\cite=LeRoux2004] [\cite=Poyneer2010] to mitigate tip, tilt, and focus vibrations at 60 Hz (and harmonics). An additional vibration notch can be added if necessary, to counteract other sources of telescope vibration. LQG controllers are also employed by SPHERE[\cite=Petit2014] and CANARY[\cite=Sivo2014].

GPI uses a Fourier Transform Reconstructor (FTR) with independently optimized gains[\cite=Poyneer2005]. In addition to computational efficiency, the FTR has the added benefit of simple mapping between spatial modes and location in the PSF. A sinusoidal phase error maps to a pair of points (and their harmonics) in the focal plane; in the high Strehl Ratio (SR) case, only the primary pair of points dominate. The gain is optimized on a mode-by-mode basis, as described below. Figure [\ref=fig:FTR] shows the mapping between spatial mode, PSF location, and gain map location.

GPI uses Power Spectral Density (PSD) analysis for modal gain optimization. The PSD at the WFS is constructed for each mode from a timeseries of measured phases using a modified periodgram analysis. Then, by dividing by the theoretical Error Transfer Functions (ETFs) for each mode and gain, we reconstruct theoretical open loop PSDs for each mode (Figure [\ref=fig:PSD_TF], left panel). The theoretical closed loop PSD in the science arm (Figure [\ref=fig:PSD_TF], center panel) is calculated from the open loop PSD by multiplying by the appropriate ETF and Noise Transfer Function (NTF) for the mode and gain applied (Figure [\ref=fig:PSD_TF], right panel). Unless otherwise stated, we refer to closed loop PSDs at the science arm, not the WFS arm. For the remainder of the paper, we use the terms "bandwidth wavefront error" (σBW) and "noise wavefront error" (σnoise) to refer to the sums of the atmosphere PSD and noise PSD, respectively, delivered to the science arm. Note that by definition, we cannot calculate PSDs for spatial frequencies above our Nyquist-sampling limit, so their contribution (i.e.: fitting error and aliasing) is not captured in the total bandwidth error.

The results of these PSD analyses are used to optimize gains on a mode-by-mode basis every 8 sec. Higher gains more strongly attenuate low temporal frequency signals, at the expense of greater overshoot at higher temporal frequencies and greater noise contribution. Using a root-finding algorithm, the optimizer chooses the gain that minimizes the closed loop power (bandwidth + noise power), effectively minimizing the wavefront error at the science arm. A gain cap of 0.3 is currently imposed based on stability analysis. The optimization process is further described in previous work[\cite=Poyneer2005] [\cite=Poyneer2016].

In practice, GPI operation is non-ideal in several ways. First, four tweeter actuators within the illuminated pupil are dead and are blocked as part of a custom apodized-pupil Lyot coronagraph mask[\cite=Soummer2005]. Second, for unknown reasons, we find that we cannot close the spatial filter fully to the radius corresponding to the Nyquist-sampled spatial frequency of the wavefront sensor (the "control radius"), due to flux loss and loop instabilities. Therefore, we typically operate the spatial filter 50% oversized in median conditions. Third, the non-common path aberration calibration subsystem[\cite=Macintosh2008] only functions in the lab, due to yet-unresolved vibration sources encountered when mounted on the telescope[\cite=Macintosh2016a]. Nonetheless, NCPA do not dominate our error budget[\cite=Poyneer2016]. Finally, because GPI's WFS is a quad-cell SH design, it is prone to so-called "centroid gain" variability. If the PSF quality is degraded, and the spatial filter cannot be closed tightly, the spot size on the quad cell grows beyond λ / dsubap. Hence, for the same spot displacement, a smaller slope is measured, decreasing the effective gain of the system. We cannot yet reliably measure the system centroid gain; in the meantime we can attempt to compensate for it, as described in Section [\ref=sec:gain_opt_cap].

DATASETS AND REALTIME PROCESSING

One of the major strengths of GPI and the GPIES campaign is realtime science data processing and AO performance monitoring. Images are processed in real time, and headers include a variety of diagnostic information and performance metrics. Additionally, we can manually save detailed AO telemetry sets. Finally, header and AO telemetry metadata from GPIES campaign observations are aggregated in a mySQL database [\cite=Perrin2016]. In the first 1.5 yr of the GPIES campaign, a total of 318 H-band IFS observing sequences were taken, for a total of more than 10,000 science frames. Of these, [formula] frames (249 sequences) had a set of detailed AO telemetry taken during the frame. The overwhelming majority of these images were taken in standard campaign mode (60 sec exposures), typically with 20-40 images per sequence. Unless otherwise noted, only the subset of IFS data with matched AO telemetry is presented.

Every science frame is processed in real time. In IFS mode the microspectra are extracted to produce a 3D x / y / λ cube, while in polarimetry mode the two orthogonal polarization directions are extracted to produce an x / y / pol cube. These cubes are then high-pass filtered and "quicklook" processed to produce single-frame 5σ contrast curves at each wavelength/polarization, and the average 5σ contrast across all wavelengths or polarizations at 0.25", 0.4", and 0.8" is saved in the image header[\cite=Perrin2016]. We refer to these single-frame contrasts as "raw contrasts." Note that throughout these proceedings we quote 5σ contrasts, because that is the typical signal-to-noise threshold used for exoplanet detection; 1σ contrast curves (the "noise floor") are correspondingly 5 times lower. An approximate measure of the average wavefront error (WFE) is also saved with each frame. However, this value is estimated only from the temporal variation of the centroids, without wavefront reconstruction or correction for the ETF, and is systematically 20-70 nm higher than the WFE reconstructed from full AO telemetry sets. Hence, all wavefront error values quoted in this proceedings are derived from full AO telemetry analysis.

Manually triggered AO data sets provide a detailed view of AO performance. Each telemetry set includes: all of the tweeter commands, woofer commands, reconstructed phase residuals, and tip/tilt data; a time-decimated set of 2D gain maps, WFS images, and reference centroids; and the control parameters. These data are reduced with custom IDL scripts to produce reconstructions of quantities such as the tip/tilt vibration amplitude, PSDs of closed and open loop data, and contributions from noise and bandwidth WFEs[\cite=Poyneer2014]. Typically, 22 sec telemetry sets are taken 1-5 times per target; data are not taken with every science frame, because the full data rate is > 1.1 GB/min.

Every science and AO header also contains various environmental parameters such as windspeeds (ambient and at the secondary mirror) as well as seeing estimates and turbulence profiles from the observatory's Differential Image Motion Monitor (DIMM) and Multi-Aperture Scintillation Sensor (MASS)[\cite=Sarazin1990] [\cite=Kornilov2003]. Approximately half of our matching IFS+AO telemetry datasets ([formula]) had valid DIMM and MASS measurements. Stale DIMM/MASS measurements were culled if the values were constant for at least 30 minutes, because that is currently our best available indication for when the MASS/DIMM is closed or otherwise nonoperable. Future work will focus on reconstructing r0 and τ from AO telemetry itself; this will be a more reliable indicator of the turbulence actually seen by GPI.

ANALYSIS AND RESULTS

Contrast performance

We first investigate GPI's raw contrast performance. The distributions of 5σ raw contrasts for all 1.65 ~ μm coronagraphic IFS frames in the GPIES campaign, subdivided by projected separation and guide star I-band magnitude, are shown in Figure [\ref=fig:raw_boxplot]. Several trends are apparent. First, contrasts at all projected separations worsen for I > 8 guide stars. This is because, in addition to IFS background noise (read noise plus sky and thermal backgrounds), the AO system switches from 1 kHz to 500 Hz at I = 8. Second, contrast at 0.25" is roughly independent of stellar magnitude for I < 8, because it is determined by AO residuals, not by the background limit. The effects of background noise become apparent at 0.4" only at [formula]. At 0.8", under good conditions, images may be background-limited on even brighter targets.

Final 5σ contrasts for the 1.65 ~ μm coronagraphic sequences are shown in Figure [\ref=fig:raw_vs_final]. These data were processed using both angular and spectral differential imaging (ADI/SDI), with KLIP PSF modeling and subtraction[\cite=Marois2006] [\cite=Soummer2012] [\cite=Wang2015b]. A "flat" L-type planet spectrum was assumed for the final contrasts shown; an additional factor of [formula] in contrast is typically gained if a strongly-peaked T-type planet spectrum is assumed instead. Final "flat" contrasts are typically at least 10 times more sensitive than raw contrasts. As with raw contrast, the final contrast at 0.8" depends strongly on guide star magnitude, because it is limited by background noise, while final contrast at 0.25" is nearly independent of guide star magnitude.

AO performance dependence on atmospheric conditions

We next study correlations between bandwidth WFE and atmosphere parameters delivered by the MASS/DIMM (Figure [\ref=fig:wfe_seeing]). Our last published analysis of these correlations [\cite=Poyneer2016] included only the first 10 months of campaign data, and did not filter out stale seeing measurements. However, the observed relationships remain similar. Bandwidth WFE is not strongly correlated with the seeing measurements from the DIMM. However, at low significance, there may be a lower limit to the wavefront error achievable for a given value of MASS seeing. There is a weak trend with isoplanatic angle, θ0; however, θ0 is degenerate with the height of the turbulent layers. The relationship to the characteristic timescale of seeing (τ  =  0.31r0  /  vwind) does follow the expected [formula] power law, albeit with significant scatter. In particular, WFE at the shortest τ is better than expected from a fit to longer τ. This could indicate either a systematic error in the measurement of very short τ or an under-performing system at the longest τ. As we will demonstrate, bandwidth error due to wind lag is the primary factor limiting GPI's performance on bright stars. GPI was designed for an assumed median τ of [formula] ms[\cite=Poyneer2016] [\cite=Poyneer2006], while the average MASS τ is < 2 ms.

Combined AO and IFS analysis

We next seek a deeper understanding of the link between AO parameters and science data quality with a joint analysis of the two datasets. Preliminary versions of some of these analyses, based on early GPIES campaign data, were previously published[\cite=Poyneer2016]. Our analysis is based on 1071 raw IFS frames with AO telemetry; we have a total of 90 observing sequences with MASS data, 113 observing sequences with DIMM data, and 246 observing sequences with AO telemetry.

Raw contrast is a clear function of WFE (Figure [\ref=fig:raw_contrast_vs_WFE]). At small separations, bandwidth error residuals (speckles) dominate; the 0.25" raw contrast follows a σ2BW trend, while it is nearly uncorrelated with σnoise. At larger separations, background noise dominates, with a smaller contribution from bandwidth error. The 0.8" raw contrast follows a σ1 / 2noise trend, although there is scatter in this relationship due to a sub-dominant contribution from σBW.

Final contrast similarly depends on WFE and MASS τ, while it is uncorrelated with DIMM seeing (Figure [\ref=fig:final_contr_1000_vs_WFE]). Final contrast at 0.25" is still dominated by σBW. Final contrast at 0.8" has a much stronger contribution from σBW than did raw contrast, because integration time has beaten down the background noise. As a result, 0.8" final contrast does not follow a σ1 / 2noise trend. With fewer datapoints, the relationship to MASS τ is less evident than it was for raw contrast. However, the same degradation in contrast with decreasing τ is still apparent, as we expect given the dependence of contrast on σBW.

We can also verify the relationship between focal plane images and reconstructed WFE in two dimensions. From the analysis above, we see that contrast across most of the PSF is proportional to the square of the bandwidth WFE, so we compare reconstructed bandwidth WFE maps to IFS frames. In these maps, the total WFE in each mode is the integrated power under each bandwidth error PSD. Because GPI uses a Fourier basis set for modal control, the RMS WFE in a given mode can be directly mapped to the corresponding location in the PSF. Figure [\ref=fig:WFE_PSF_comp] shows one such example. Qualitatively, the morphology of the PSF is well-matched to the reconstructed WFE. Such comparisons not only verify our understanding of the process of WFE reconstruction, but can guide future targeted efforts for contrast improvement, and may potentially inform PSF subtraction. More thorough studies of PSF reconstruction from AO telemetry are left to future work.

Exploratory factor analysis of raw contrast

A long term goal for the GPI instrument is to be able to predict raw and final contrast, given information about current conditions and/or AO performance. Gemini typically operates in queue mode, and GPIES observations are executed in priority visitor mode; in both cases, observers need to decide whether conditions are of sufficient quality to meet the science goals of a given sequence. If we can predict final contrast for a sequence, with reasonable error bars, we can help observers choose when to execute GPI sequences. To this end, we present some preliminary results from exploratory factor analysis of raw contrast data.

Exploratory Factor Analysis (EFA) is a tool designed to identify underlying latent variables based on common behavior in a number of measured variables. Given a set of independent variables, EFA groups them into "factors" based on the degree of correlation between the variables' behavior. Computed latent variables (factors) are believed to be a more robust measure of a complex underlying phenomenon (e.g. atmospheric conditions) than can be captured with a single measured variable alone (e.g. DIMM seeing measure). In our case, the measured variables considered in this initial analysis include all AO telemetry metadata and atmospheric condition measurements. As the purpose of this EFA analysis was to identify more robust predictors of contrast, and since we expect these variables to have power law relationships with contrast, all measured variables were log-scaled before EFA.

We completed our EFA analysis using IBM's SPSS Statistics software's[\cite=IBM2015a] built-in "dimension reduction" capabilities. We chose principal factors analysis, done using the "maximum likelihood" method in SPSS and the oblique rotation method "direct oblimin," which allows the extracted factors to be correlated with one another rather than forcing them to be orthogonally related.

Based on the initial output, we removed several variables from analysis that were either redundant (colinear) or poorly sampled. We define redundant variables based on off-diagonal correlation matrix values >  0.9, and remove all but one of the redundant variables in each case. An example redundant pair is H-band and I-band magnitudes; we kept I-band magnitude. We also removed total WFE, because both bandwidth WFE and noise WFE were included. We also removed two variables, MASS C2N at 0.5 km and the centroid gain estimate, whose diagonal values in the Anti-Image Correlation Matrix indicated a lack of sampling adequacy (< 0.5).

The number of factors to extract was determined based on a scree plot, which shows a marked inflection at five factors, suggesting that a four factor solution was in order (indeed, factor solutions with [formula] do not converge for this dataset). Table [\ref=tab:EFA_Table] shows the final set of 17 independent variables used in our EFA, and the resulting factor loading scores for the four extracted factors. These four factors appear to describe: (1) upper atmosphere conditions, (2) noise errors, (3) bandwidth errors, and (4) lower atmosphere conditions. Two variables, MASS C2N at 8 km and 4 km, did not load onto any factors.

We then engaged in a linear regression analysis to predict raw contrast values based on all four factors as well as the variables that we had previously removed from the EFA analysis due to redundancy or poor sampling. Table [\ref=tab:EFA_fits] shows the linear combination of factors that describes the maximum amount of variance in the raw contrast at each separation, and Figure [\ref=fig:EFA] shows the resulting fits. In all cases, standardized regression (beta) coefficients are listed only for variables that show a significant (p < 0.05) linear relationship with log contrast at that separation. In all three cases, a linear regression model generated from the four EFA factors alone has an r2 value of [formula]. The inclusion of additional standalone variables in the regression model, particularly the tip/tilt bandwidth error and total WFE, doubles the amount of explained raw contrast variance to between 60-70%.

The regression model fits show many of the trends expected given the correlations discussed in Section [\ref=subsect:AO+IFS], with some differences in need of further study. As expected, contrast at 0.25" is fit primarily by variables related to bandwidth error. Also as expected, contrast at 0.8" requires terms related to noise limits in the AO system and the science camera (F2 and star H magnitude), and does not require the standalone total WFE term. The physical interpretation of the effects of the lower and upper atmosphere components at 0.8" and 0.4" will require further study. Additional work is also needed to understand why redundant variables (tip/tilt bandwidth error and total WFE) are not adequately captured in the extracted factors and must be added as standalone variables. Future work will refine this preliminary analysis of raw contrasts, and expand the analysis to final contrasts as well.

Gain optimizer cap

As discussed in Section [\ref=subsect:AO+IFS], AO bandwidth error is the dominant factor determining raw contrast at close-to-intermediate separations, and it impacts contrasts at all separations in final PSF-subtracted data. This is particularly true for low spatial frequencies at 500 Hz loop speed, where these modes are within the controllable bandwidth of the system, but not fully corrected. In poorer seeing conditions, the system is also affected by the uncorrected centroid gain factor discussed in Section [\ref=sec:intro]. Until GPI has a reliable measurement of centroid gain, we can address the symptom by increasing the control loop gain to compensate. In post-processing of AO telemetry, we can duplicate the analysis of the gain optimizer, but increase the gain cap. The offline optimizer code is an IDL implementation of the optimization strategy described in section [\ref=sect:GPIdescription]. We see in some cases (e.g. left panel of Figure [\ref=fig:highgain_gainWFE]) that the optimal gains may be at least 50% higher for some modes.

On UT April 30, 2016, we ran a high gain test on an I = 6.2 guide star at 500 Hz. The sky transparency was constant and the ground wind speed was 4 m/s; the DIMM and MASS were not operational. Although such a bright star would normally be controlled with a 1 kHz loop, for these preliminary 500 Hz tests we chose a bright star in order to increase our signal to noise and so simplify interpretation of the results. In the high signal to noise regime, WFE (and hence IFS contrast) is dominated by bandwidth errors. We alternated GPIAO between uniform 0.3 gains and a static, non-uniform gain map with higher gains. The high gain map was calculated using the offline gain optimizer code with a gain cap of 0.5, from telemetry saved during the uniform 0.3 gain tests.

Figures [\ref=fig:highgain_gainWFE] and [\ref=fig:highgain_img] show the gain change, WFE change, and IFS images for one pair of low/high gain tests. Note that Figure [\ref=fig:highgain_gainWFE] as well as the right panel of Figure [\ref=fig:highgain_img] are masked to show only the central, strongly bandwidth error-dominated, region. As anticipated, the WFE improved in the region with higher gains; the largest improvements were in low spatial frequencies along the wind direction. The IFS image contrast also improved, and the percent change in IFS flux was approximately equal to the square of the percent change in WFE, as anticipated for AO speckle-dominated regions of the PSF. In the regions of greatest improvement, the WFE decreased by 15-20%, and the flux in the corresponding PSF regions decreased by 40% or more. The maximum decrease in IFS flux is slightly more than we predict from the improvement in bandwidth WFE alone. This could be the result of seeing variations between the two tests, but because the DIMM and MASS were inoperable, it is not possible to independently confirm this hypothesis.

These tests show that GPI should consider increasing the gain cap on the realtime gain optimizer, particularly at 500 Hz loop speed. However, overdriving the system is a danger; the gain cap of 0.3 was chosen because it would not overdrive the system even in very good conditions (when the centroid gain is [formula]). An underperforming system is preferable to an unstable one, and future work will test whether the optimizer properly avoids instabilities in good conditions when the gain cap is raised.

CONCLUSIONS

The GPIES campaign has observed more than 300 stars in 1.5 yr, and these science and AO data provide a wealth of information about the performance of the AO system. Considerable effort has been invested in automated and semi-automated data reduction pipelines for both science data and AO telemetry, greatly facilitating performance data mining. As a result, we know that GPI AO is consistently achieving 10- 4 5σ raw contrast at 0.4" in single 60 sec H-band images, with a stability that enables 1 hr sequences to reach a final 5σ contrast 10-20 times better.

We find several correlations between IFS images, AO telemetry, and seeing conditions. First, we find that bandwidth errors dominate the final error budget at most locations in the PSF, except for the faintest stars and/or separations beyond [formula]. This conclusion is reinforced by the good correspondence between 2D reconstructed bandwidth WFE maps and IFS images. Interestingly, seeing values are not well correlated with either WFE or contrast, although the atmospheric coherence time, τ, is correlated. This reinforces the conclusion that GPI AO is not typically limited by the amplitude of seeing phase errors, but by the time lag relative to the speed of the turbulent layers. In a preliminary study, we used exploratory factor analysis to investigate the underlying factors responsible for raw contrast. We find four main underlying factors that track the lower atmosphere, the upper atmosphere, the AO bandwidth residual speckles, and the AO noise errors. A combination of these factors can explain 60-70% of the variation in raw contrasts. Future work will refine and expand this analysis.

We tested the system with higher gains at 500 Hz loop speeds. Until a reliable centroid gain measurement method is implemented, GPI may consider increasing the gain cap on its gain optimizer to compensate for optical gain variations, particularly in sub-median seeing. In an on-sky test, the contrast improvement in high gain IFS images corresponded well to the expected improvement based on 2D reconstructed bandwidth WFE maps. Additional work is needed to ensure that, when operated with a higher gain cap, the gain optimizer will select stable gains in all conditions.

These analyses point to key areas for future potential upgrades. The strong dependence of performance on τ suggests GPI would benefit from wind predictive control and/or increased loop speed. Some initial studies have been done on wind measurement from GPI telemetry[\cite=Srinath2016] and predictive Fourier control is being tested at ShaneAO[\cite=Rudy2016], but neither has been implemented on GPI. Several high contrast systems operate or have planned upgrades to operate at > 1 kHz[\cite=Fusco2016] [\cite=Jovanovic2016] [\cite=Males2016] [\cite=Pinna2016], to clear advantage with respect to lag errors. Additionally, GPI's WFS detector noise limits the system to guide stars of I < 10. Upgrading to an EMCCD would both increase sky coverage and allow GPI to run faster on fainter targets.