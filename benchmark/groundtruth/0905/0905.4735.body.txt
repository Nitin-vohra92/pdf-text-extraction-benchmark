Lemma Corollary Definition Claim Conjecture Proposition

Remark

Counting substructures III: quadruple systems

Introduction

Given a k-uniform hypergraph (k-graph for short) F, let ex(n,F), the Turán number of F, be the maximum number of edges in an n vertex k-graph with no copy of F. Beginning with a result of Rademacher the following phenomenon has been discovered and studied intensely for k = 2: If an n vertex k-graph has ex(n,F) + 1 edges, then it has not just one, but many copies of F. This is the third in a series of papers where we refine and extend earlier results of Rademacher, Erd os [\cite=E1] [\cite=E2], Lovasz-Simonovits [\cite=LS] and others on this phenomenon. The first paper in this series [\cite=M1] studied the question when F is a color critical graph, the second [\cite=M2] studied the case of 3-graphs, and here we study 4-graphs.

We are able to go beyond earlier work in this area due to the new tool we have at our disposal: the hypergraph removal lemma. This is a consequence of the hypergraph regularity lemma proved by Gowers [\cite=G], Nagle-Rödl-Schacht [\cite=NRS], Rödl-Skokan [\cite=RS], Tao [\cite=T].

Fix k  ≥  2 and a k-graph F with f vertices. Suppose that an n vertex k-graph H has at most o(nf) copies of F. Then there is a set of edges in H of size o(nk) whose removal from H results in a k-graph with no copies of F.

There are two types of configurations we will be concerned with in this paper, books and expanded triangles. These (with one exception that was treated in [\cite=M2]) represent all known cases of a 4-graph F where ex(n,F) has been exactly determined.

For 2  ≤  l  ≤  4, the l-book Pl is the 4-graph with l + 1 edges l of which share the same three points, and another edge that contains the remaining point in each of the l edges together with 4 - l new points. Explicitly

[formula]

The expanded triangle C3 is the 4-graph obtained from a graph triangle by replacing each vertex by a pair of vertices. Formally,

[formula]

Suppose F is a 4-graph with the property that for sufficiently large n, there is a unique (up to isomorphism) 4-graph H(n,F) with ex(n,F) edges. Let c(n,F) be the minimum number of copies of F in the 4-graph obtained from H(n,F) by adding an edge, where the minimum is taken over all possible edges that may be added.

In the next two subsections will discuss H(n,F) and c(n,F) for F∈{P2,P3,P4,C3} and then we will state our results.

Notation: We associate a hypergraph with its edge set. The number of edges in a hypergraph H is |H|. Given hypergraphs F,H (F has f vertices), a copy of F in H is a subset of f vertices and |F| edges of H such that the subhypergraph formed by this set of vertices and edges is isomorphic to F. In other words, if we denote Aut(F) to be the number of automorphisms of F, then the number of copies of F in H is the number of edge-preserving injections from V(F) to V(H) divided by Aut(F). For a set S of vertices, define dH(S) to be the number of edges of H containing S. If S = {v}, we simply write dH(v). We will omit floor and ceiling symbols whenever they are not crucial, so that the presentation is clearer.

Books

P2  =  {123a,123b,abcd}. Write

[formula]

for the number of edges in T4(n), the complete 4-partite 4-graph with the maximum number of edges. It is easy to see that T4(n) contains no copy of P2. Frankl and Füredi [\cite=FF] conjectured, and Pikhurko [\cite=P] proved, that ex(n,P2) = t4(n) for n sufficiently large. This shows that c(n,P2) is defined and one achieves c(n,P2) by adding an edge to T4(n) with two points in each of two parts, and no point in the remaining two parts. We then see that

[formula]

P3  =  {123a,123b,123c,abcd}. Say that a 4-graph has a (2,2)-partition if it has a vertex partition into two parts so that every edge intersects each part in two points. Write

[formula]

for the number of edges in D4(n), the n vertex 4-graph with a (2,2)-partition having the maximum number of edges. It is easy to see that D4(n) contains no copy of P3. Füredi, Simonovits and Pikhurko [\cite=P] proved that ex(n,P3) = d4(n) for n sufficiently large. This shows that c(n,P3) is defined and one achieves c(n,P2) by adding an edge to D4(n) with exactly three points in the part of size ⌈n / 2⌉. We then see that

[formula]

P4  =  {123a,123b,123c,123c,abcd}. A 4-graph H is odd if it has a vertex partition [formula] such that every edge intersects both parts in an odd number of vertices. Let B4(n) be the odd 4-graph with the maximum number of edges. Note that

[formula]

is not achieved by choosing a = ⌊n / 2⌋, but it can easily be shown that [formula]. Füredi, Mubayi and Pikhurko [\cite=P] proved that ex(n,P4) = b4(n) for n sufficiently large. This shows that c(n,P4) is defined and one achieves c(n,P2) by adding an edge to D4(n) with two points in each part. We then see that

[formula]

Now we state our result about counting books.

Fix l∈{2,3,4}. For every ε > 0 there exists δ > 0 and n0 such that the following holds for n > n0. Let H be an n vertex 4-graph with ex(n,Pl) + q edges where q < δn. Then the number of copies of Pl in H is at least q(1 - ε)c(n,Pl). The expression q is sharp for 1  ≤  q < δn. Moreover, if the number of copies is less than δn4, then there is a collection of q distinct edges that each lie in (1 - ε)c(n,Pl) copies of Pl with no two of these edges accounting for the same copy of Pl.

Expanded triangle

The expanded triangle is a 4-uniform example whose extremal value has been studied by Frankl [\cite=F], Sidorenko, Keevash and Sudakov [\cite=KSFr]. Recall that C3  =  {1234,3456,1256} is the 4-graph obtained from a graph triangle by expanding each vertex to a set of size two. Frankl [\cite=F] proved that every n vertex 4-graph containing no copy of C3 has at most (1 + o(1))b4(n) edges. Recently, Keevash and Sudakov [\cite=KSFr] sharpened this by proving that the unique 4-graph that achieves this maximum is B4(n). Adding an edge to B4(n) results in at least

[formula]

copies of C3.

For every ε > 0 there exists δ > 0 and n0 such that the following holds for n > n0. Let H be an n vertex 4-graph with b4(n) + q edges where q < δn2. Then the number of copies of C3 in H is at least q(1 - ε)c(n,C3). The expression q is sharp for 1  ≤  q < δn2. Moreover, if the number of copies is less than δn4, then there is a collection of q distinct edges that each lie in (1 - ε)c(n,C3) copies of C3 with no two of these edges accounting for the same copy of C3.

We remark that although our proof follows the same general structure as that in [\cite=KSFr], some new ideas are needed. In particular, since we start our proof with an application of the removal lemma, we do not have such fine control over the size of the parts in the underlying hypergraph as in [\cite=KSFr]. Thus our approach is somewhat more robust, although the approach in [\cite=KSFr] extends to the k-uniform case which we do not address here.

Throughout the paper we will frequently use the notation δ  ≪  ε, which is supposed to mean that δ, and any function of δ (that tends to zero with δ) used in a proof is smaller than any function of ε used in the proof. It is pretty difficult to write the precise dependence between δ and ε as one of the constraints comes from an application of the removal lemma.

Counting P2's

Recall that c(n,P2) = 2(n / 4)3  +  Θ(n2). Theorem [\ref=books] for l = 2 follows from the following result.

For every ε > 0 there exists δ > 0 and n0 such that the following holds for n > n0. Every n vertex 4-graph with t4(n) + 1 edges contains either

[formula] an edge that lies in at least (2 - ε)(n / 4)3 copies of P2, or

[formula] at least δn4 copies of P2.

Proof of Theorem [\ref=books] for l = 2. Remove q - 1 edges from H and apply Theorem [\ref=P2]. If we find δn4 copies of P2, then since q < δn, the number of copies is much larger than (1 - ε)qc(n,P2) and we are done. Consequently, we find an edge e1 in at least (2 - ε)(n / 4)3 > (1 - ε)c(n,P2) copies of P3. Now remove q - 2 edges from H - e1 and repeat this argument to obtain e2. In this way we obtain edges [formula] as required.

The bound is sharp due to the following construction. Suppose that T4(n) has parts W,X,Y,Z. Fix a pair of points a,b∈W, and add q edges of the form abcd where c,d∈X. It is easy to see that each added edge lies in 2(n / 4)3 + O(n2) copies of P2 and no copy of P2 contains two of the new edges. Consequently, the copies of P2 are counted exactly once.

We will need the following stability theorem for P2 proved by Pikhurko [\cite=P]

Let H be a 4-graph with n vertices and t4(n) - o(n4) edges that contains no copy of P2. Then there is a partition of the vertex set of H into [formula] so that the number of edges that intersect a part in at least two points is o(n4). In other words, H can be obtained from T4(n) by adding and deleting a set of o(n4) edges.

Proof of Theorem [\ref=P2]. Given ε let 0 < δ  ≪  ε. Write oδ(1) for any function that approaches zero as δ approaches zero and moreover, oδ(1)  ≪  ε. Let n be sufficiently large and let H be an n vertex 4-graph with t4(n) + 1 edges. Write #  P2 for the number of copies of P2 in H.

We first argue that we may assume that H has minimum degree at least [formula], where δ1  =  δ1 / 4. Indeed, if this is not the case, then remove a vertex of degree less than d to form the 4-graph H1 with n - 1 vertices. Continue removing a vertex of degree less than d if such a vertex exists. If we could continue this process for δ2n steps, where δ2  =  δ1 / 2, then the resulting 4-graph H' has (1 - δ2)n vertices and number of edges at least

[formula]

By the result of Pikhurko [\cite=P] and Erd os-Simonovits supersaturation we conclude that H has at least δ'n7  >  δn4 copies of P2 (for some fixed δ' > 0 depending on δ) and we are done. So we may assume that this process of removing vertices of degree less than d terminates in at most δ2n steps, and when it terminates we are left with a 4-graph H' on n' > (1 - δ2)n vertices and minimum degree at least d.

Now suppose that we could prove that there is an edge of H' that lies in at least (2 - ε / 2)(n' / 4)3 copies of P2. Since δ  ≪  ε, this is greater than (2 - ε)(n / 4)3 and we are done. If on the other hand H' contains at least 2δn'4 copies of P2, then again this is at least δn4 and we are done. So if we could prove the result for H' with 2δ,ε / 2, then we could prove the result for H (with δ,ε). Consequently, we may assume that H has minimum degree at least [formula].

If #  P2  ≥  δn4, then we are done so assume that #  P2  <  δn4 = (δ / n3)n7. Then by the Removal lemma, there is a set of at most δn4 edges of H whose removal results in a 4-graph H' with no copies of P2. Since |H'| > t4(n) - δn4, by Theorem [\ref=P2stability], we conclude that there is a partition of H' (and also of H) into four parts such that the number of edges intersecting some part in at least two points is oδ(n4). Now pick a partition [formula] of H that maximizes e(W,X,Y,Z), the number of edges that intersect each part. We know that e(W,X,Y,Z)  ≥  t4(n) - oδ(n4), and an easy calculation also shows that each of W,X,Y,Z has size n / 4  ±  oδ(n).

Let B be the set of edges of H that intersect some part in at least two points. Let G = H - B be the set of edges of H that intersect each part. Let M be the set of 4-tuples which intersect each part and are not edges of H. Then [formula] is a 4-partite 4-graph with partition W,X,Y,Z, so it has at most t4(n) edges. We conclude that

[formula]

in particular [formula].

Claim. For every vertex a of H we have dM(a) < ε1(n / 4)3, where ε1  =  ε / 105.

Proof of Claim. Suppose for contradiction that dM(a)  ≥  ε1(n / 4)3 for some vertex a. Then

[formula]

We conclude that dB(a)  ≥  (ε1 - oδ(1))(n / 4)3  >  (ε1 / 2)(n / 4)3. Let L = L(a) be the set of triples {b,c,d} such that abcd∈B. So |L| = dB(a) > (ε1 / 2)(n / 4)3. Partition [formula], where Li consists of those triples that intersect precisely i parts.

Case 1: |L1|  >  (ε1 / 10)(n / 4)3. Let us assume by symmetry that the number of triples bcd∈L1 with b,c,d∈W is at least (ε1 / 40)(n / 4)3. For each choice of (x,y,z)∈X  ×  Y  ×  Z with a  ≠  x,y,z, the three 4-tuples bxyz,cxyz,abcd form a potential copy of P2. The number of such choices of ({b,c,d},x,y,z) is at least (1 - oδ(1))(ε1 / 40)(n / 4)6  >  δn6 so for at least half of these choices, one of the 4-tuples bxyz,cxyz must be in M. Each of these 4-tuples is counted at most n2 times, since a is fixed. We obtain the contradiction (ε1 / 100n2)(n / 4)6 < |M| = oδ(n4). This concludes the proof in this case.

Case 2: |L2|  >  (3ε1 / 10)(n / 4)3. Pick bcd∈L2. There are [formula] possibilities for the way the points b,c,d are distributed within the parts. Let us assume by symmetry that the number of triples bcd∈L2 with b,c∈W, d∈X is at least (ε1 / 40)(n / 4)3. Now proceed exactly as in the proof of Case 1.

Case 3: |L3|  >  (ε1 / 10)(n / 4)3. Assume wlog that a∈W. Pick bcd∈L3. There are 3 possibilities for the way the points b,c,d are distributed within the parts (one point must be in W, the part containing a). Let us assume by symmetry that the number of triples bcd∈L3 with (b,c,d)∈W  ×  X  ×  Y is at least (ε1 / 30)(n / 4)3. We may assume that dG(a)  ≥  (ε1 / 30)(n / 4)3 for otherwise we can move a to Z and increase e(W,X,Y,Z) thereby contradicting the choice of the partition. Now pick bcd∈L3 as above and (x,y,z)∈(X - {c})  ×  (Y - {d})  ×  Z with axyz∈G. For each choice of (b,c,d,x,y,z) the three 4-tuples abcd,axyz,bxyz form a copy of P2. The number of such choices of (b,c,d,x,y,z) is at least (ε1 / 30)2(n / 4)6  >  δn6 so for at least half of these choices, one of the 4-tuples bxyz∈M. Each of these 4-tuples is counted at most n2 times, since a is fixed. We obtain the contradiction (ε1 / 30n)2(n / 4)6 < |M| = oδ(n4). This concludes the proof of this case and the Claim.

Partition [formula], where B2 consists of those edges of B with exactly two points in one part, one point in a second part and one point in a third part (for example a WWXY edge would be in B2). Suppose that [formula] and pick e = abcd∈B1. Some two points of e must lie in the same part, so assume wlog that a,b∈W.

Let us first suppose that c or d is in W, say c∈W. For every (x,y,z)∈X  ×  Y  ×  Z (x,y,z  ≠  d), we get three potential copies of P2 of the form wxyz,w'xyz,e where w,w'∈{a,b,c}. At least (n / 4)3 of these potential copies of P2 contains a 4-tuple from M, otherwise we obtain (2 - oδ(1))(n / 4)3 copies of P2 containing e and we are done. Each such 4-tuple from M is counted at most twice, so we obtain at least (1 / 2)(n / 4)3 4-tuples from M that contain some vertex in {a,b,c}. Consequently, there exists w∈e with dM(w)  ≥  (1 / 6)(n / 4)3 and this contradicts the Claim.

We may therefore assume that a,b∈W and c,d lie in the same part different from W, say c,d∈X. There are at least (ε / 3)(n / 4)3 choices (x,y,z)∈(X - {c,d})  ×  Y  ×  Z with vxyz∈M for some v∈{a,b} or there are at least (ε / 3)(n / 4)3 choices (w,y,z)∈(W - {a,b})  ×  Y  ×  Z with vxyz∈M for some v∈{c,d}. This is because otherwise e would lie in at least (2 - oδ(1) - 2ε / 3)(n / 4)3 > (2 - ε)(n / 4)3 copies of P2. In either case, we conclude that there exists v∈e with dM(v) > (ε / 6)(n / 4)3 thus contradicting the Claim.

We conclude from the arguments above that [formula]. Pick e = abcd∈B2 and assume wlog that a,b∈W,c∈X,d∈Y. For (x,y,z)∈(X - {c})  ×  (Y  -  {d})  ×  Z, consider the following two potential copies of P2:

[formula]

The number of these potential copies of P2 is twice the number of choices of (x,y,z) and this is at least (2 - oδ(1))(n / 4)3. At least (ε / 2)(n / 4)3 of these potential P2's has a 4-tuple from M, otherwise we obtain at least (2 - ε)(n / 4)3 copies of P2 containing e and we are done. If for at least (ε / 4)(n / 4)3 of these potential P2's, the 4-tuple from M is of the form wxyz,w∈{a,b} (i.e., the third in the lists), then there exists v∈{a,b} with dM(v)  ≥  (ε / 8)(n / 4)3  >  ε1n3 thereby contradicting the Claim. So for at least (ε / 4)(n / 4)3 of these potential P2's, the 4-tuple from M is of the form wcdz,w∈{a,b} (i.e., the second in the lists). Each such 4-tuple from M is counted at most |X||Y| times, so there are at least (ε / 4)(n / 4)3 / (|X||Y|) > (ε / 20)n 4-tuples from M that intersect e in three points.

Form the bipartite graph with parts B = B2 and M where e∈B is adjacent to f∈M if [formula]. We have shown above that each e∈B has degree at least (ε / 20)n. Since |B| > |M|, we conclude that there exists f = abcd∈M (with (a,b,c,d)∈W  ×  X  ×  Y  ×  Z) that is adjacent to at least (ε / 20)n different e's from B. Assume wlog that at least (ε / 80)n of these e's contain a,b,c. We may also assume wlog that at least (ε / 240)n of these e's have their fourth vertex in the same part as a, namely W.

Now for each [formula], let ej = wjabc∈B with wj∈W. For every (x,y,z)∈(X - {b})  ×  (Y - {c})  ×  Z, consider the potential copy of P2 given by wjxyz,axyz,ej. The number of choices for (j,x,y,z) is at least (ε / 240)n|X||Y||Z| > (4ε / 105)n4 > 2δn4. If for at least half of these choices of (j,x,y,z) the potential copy of P2 is a real copy of P2 in H, then #  P2  ≥  δn4 and we are done. So we may assume that for at least half of the choices of (j,x,y,z) (i.e. for at least (2ε / 105)n4 choices), the potential copy of P2 referenced above has a 4-tuple g∈M. If at least half the time [formula], then we obtain the contradiction (ε / 105)n4  ≤  |M|  =  oδ(n4). So at least half the time a∈g. Each such g containing a is counted at most n times (once for each wj), so we obtain dM(a) > (ε / 105)n3  ≥  ε1n3. This contradicts the Claim and completes the proof of the theorem.

Counting P3's

Recall that c(n,P3) = 2(n / 2)3  -  Θ(n2). Theorem [\ref=books] for l = 3 follows from the following result.

For every ε > 0 there exists δ > 0 and n0 such that the following holds for n > n0. Every n vertex 4-graph with d4(n) + 1 edges contains either

[formula] an edge that lies in at least (2 - ε)(n / 2)3 copies of P3, or

[formula] at least δn4 copies of P3.

Proof of Theorem [\ref=books] for l = 3. Remove q - 1 edges from H and apply Theorem [\ref=P3]. If we find δn4 copies of P3, then since q < δn, the number of copies is much larger than q(1 - ε)c(n,P3) and we are done. Consequently, we find an edge e1 in at least (2 - ε)(n / 2)3 > (1 - ε)c(n,P3) copies of P3. Now remove q - 2 edges from H - e1 and repeat this argument to obtain e2. In this way we obtain edges [formula] as required.

The bound is sharp due to the following construction. Add a collection of q pairwise disjoint edges within one part of D4(n). It is easy to see that each added edge lies in 2(n / 2)3 + O(n2) copies of P3 and clearly no copy of P3 contains two of the new edges. Consequently, the copies of P3 are counted exactly once.

We will need the following stability theorem for P3 proved by Füredi-Pikhurko-Simonovits [\cite=FPS]

Let H be a 4-graph with n vertices and d4(n) - o(n4) edges that contains no copy of P3. Then there is a partition of the vertex set of H into [formula] so that the number of edges that intersect some part in 0, 1, 3 or 4 points is o(n4). In other words, H can be obtained from D4(n) by adding and deleting a set of o(n4) edges.

Proof of Theorem [\ref=P3]. Given ε let 0 < δ  ≪  ε. Write oδ(1) for any function that approaches zero as δ approaches zero and moreover, oδ(1)  ≪  ε. Let n be sufficiently large and let H be an n vertex 4-graph with d4(n) + 1 edges. Write #  P3 for the number of copies of P3 in H.

As in the proof of Theorem [\ref=P2] (just replacing 3/32 by 3/8), we may assume that H has minimum degree at least [formula]

If #  P3  ≥  δn4, then we are done so assume that #  P3  <  δn4 = (δ / n3)n7. Then by the Removal lemma, there is a set of at most δn4 edges of H whose removal results in a 4-graph H' with no copies of P3. Since |H'| > d4(n) - δn4, by Theorem [\ref=P3stability], we conclude that there is a partition of H' (and also of H) into two parts such that the number of edges intersecting some part in 0,1,3, or 4 points is oδ(n4). Now pick a partition [formula] of H that maximizes e(X,Y), the number of edges that intersect each part in two points. We know that e(X,Y)  ≥  d4(n) - oδ(n4), and an easy calculation also shows that each of X,Y has size n / 2  ±  oδ(n).

Let B be the set of edges of H that intersect some part in 0,1,3 or 4 points. Let G = H - B be the set of edges of H that intersect each part in two points. Let M be the set of 4-tuples which intersect each part in two points and are not edges of H. Then [formula] is a 4-graph with (2,2)-partition [formula], so it has at most d4(n) edges. We conclude that

[formula]

in particular [formula].

Claim. For every vertex a of H we have dM(a) < ε1(n / 2)3, where ε1  =  ε / 106.

Proof of Claim. Suppose for contradiction that dM(a)  ≥  ε1(n / 2)3 for some vertex a. Then

[formula]

We conclude that dB(a)  ≥  (ε1 - oδ(1))(n / 2)3  >  (ε1 / 2)(n / 2)3. Let L = L(a) be the set of triples {b,c,d} such that abcd∈B. So |L| = dB(a) > (ε1 / 2)(n / 2)3. Assume wlog that a∈X. Partition [formula], where LXiY3 - i consists of those triples that intersect X in precisely i points (note that [formula] by definition of B).

Case 1: |LXXX|  >  (ε1 / 6)(n / 2)3 or |LYYY|  >  (ε1 / 6)(n / 2)3. Let us first assume that |LXXX|  >  (ε1 / 6)(n / 2)3. For each bcd∈LXXX with e = abcd and [formula], the four 4-tuples bxyy',cxyy',dxyy',e form a potential copy of P3. The number of such choices of (e,x,{y,y'}) is at least (ε1 / 13)(n / 2)6  >  δn6 so for at least half of these choices, one of the 4-tuples bxyy',cxyy',dxyy' must be in M. Each of these 4-tuples in M is counted at most |X|2 < n2 times, since a is fixed. We obtain the contradiction (ε1 / 13n2)(n / 2)6 < |M| = oδ(n4). If |LYYY|  >  (ε1 / 6)(n / 2)3, then the same proof works by replacing (x,{y,y'}) with [formula]. This concludes the proof in this case.

Case 2: |LXXY|  >  (ε1 / 6)(n / 2)3. We may assume that dG(a)  ≥  |LXXY| for otherwise we can move a to Y and increase e(X,Y) thereby contradicting the choice of the partition. Pick bcd∈LXXY with b,c∈X and d∈Y. Consider x,y,y' with x∈X - e,y,y'∈Y - e and axyy'∈G. For each choice of (e,x,{y,y'}) the four 4-tuples bcdy,bcdy',e,axyy' form a copy of P3. The number of such choices of (e,x,{y,y'}) is at least

[formula]

so for at least half of these choices, one of the 4-tuples bcdy,bcdy'∈M. Each of these 4-tuples of M is counted at most n2 times, since a is fixed. We obtain the contradiction (ε1 / 105)2n4 < |M| = oδ(n4). This concludes the proof of this case and the Claim.

Partition [formula], where B2 consists of those edges of B that intersect both parts in an odd number of points. Suppose that [formula], pick e = abcd∈B1 and assume wlog that e  ⊂  X. For every [formula], we get four potential copies of P3 of the form w1xyy',w2xyy',w3xyy',e where {w1,w2,w3}  ⊂  e and wi  ≠  wj. At least (ε / 2)(n / 2)3 of these potential copies of P3 contains a 4-tuple from M, otherwise we obtain

[formula]

copies of P3 containing e and we are done. Each such 4-tuple from M contains some point of e so there exists w∈e with dM(w)  ≥  (ε / 8)(n / 2)3  >  ε1(n / 2)3 and this contradicts the Claim.

We conclude the [formula]. Pick e = abcd∈B2 and assume wlog that a,b,c∈X,d∈Y. For [formula], consider the following types of potential copies of P3:

Type 1: xyy'a,xyy'b,xyy'c,e

Type 2: e,abdy,abdy',xcyy';  e,acdy,acdy',xbyy';  e,bcdy,bcdy',xayy'.

At least (ε / 2)(n / 2)3 of these potential copies of P3 contains a 4-tuple from M, otherwise we obtain at least (2 - ε)(n / 2)2 copies of P3 containing e (as in ([\ref=star])) and we are done. Suppose that at least half the time, the 4-tuple from M is in one of the Type 1 copies, or the last 4-tuple in one of the type two copies (i.e., xcyy',xbyy',xayy'). Each such 4-tuple is counted at most twice, and so we obtain at least (ε / 8)(n / 2)3 4-tuples of M that intersect e. We conclude that there exists w∈e with dM(w)  ≥  (ε / 32)(n / 2)3  >  ε1(n / 2)3 and this contradicts the Claim.

We may therefore assume that for at least (ε / 4)(n / 2)3 of these potential copies of P3, the 4-tuple from M is one of the two middle ones of the Type 2 copies, and so it intersects e in three points. Each such 4-tuple is counted at most |X||Y| < (1 + oδ(1))(n / 2)2 times, so we obtain at least (ε / 10)n 4-tuples from M that intersect e in three points. We have argued that for every e∈B2 = B, there are at least (ε / 10)n different f∈M for which [formula]. Since |B| > |M|, we conclude that there exists f'∈M with at least (ε / 10)n different e'∈B2 such that [formula]. At least (ε / 40)n of these e''s intersect f in the same three points. Consequently, we may assume wlog that there are a,b∈X, d∈Y and [formula] with t = (ε / 40)n such that ei = abxid∈B.

Fix i, set e = ei and consider the Type 1 potential copies of P3 referenced in the notation above with c = xi, i.e., consider xyy'a,xyy'b,xyy'c,e. Recall that there are at least [formula] such copies. If at least εn3 of these potential copies of P3 have a 4-tuple from M, then we find a vertex w∈{a,b,xi} with dM(w) > (ε / 4)n3  >  ε1n3 and this contradicts the Claim. We conclude that each ei = abcxi lies in at least (1 / 20 - ε)n3  >  εn3 copies of P3, and these copies are clearly distinct for distinct i. Altogether we therefore have #  P3  ≥  tεn3 = (ε2 / 40)n4  >  δn4 and we are done.

Counting P4's

Recall that [formula]. Theorem [\ref=books] for l = 4 follows from the following result.

For every ε > 0 there exists δ > 0 and n0 such that the following holds for n > n0. Every n vertex 3-graph with b4(n) + 1 edges contains either

[formula] an edge that lies in at least (1 - ε)c(n,P4) copies of P4, or

[formula] at least δn4 copies of P4.

Proof of Theorem [\ref=books] for l = 4. Remove q - 1 edges from H and apply Theorem [\ref=P4]. If we find δn4 copies of P4, then since q < δn, the number of copies is much larger than q(1 - ε)c(n,P4) and we are done. Consequently, we find an edge e1 in at least (1 - ε)c(n,P4) copies of P4. Now remove q - 2 edges from H - e1 and repeat this argument to obtain e2. In this way we obtain edges [formula] as required.

The result is asymptotically tight as we can add q pairwise disjoint 4-tuples to B4(n), each intersecting both parts in two points.

We need the following stability result proved in [\cite=FMP].

Let H be a 4-graph with n vertices and b4(n) - o(n4) edges that contains no copy of P4. Then there is a partition of the vertex set of H into [formula] so that the number of edges that intersect X or Y in an even number of points is o(n4). In other words, H can be obtained from B4(n) by adding and deleting a set of o(n4) edges.

Proof of Theorem [\ref=P4]. Given ε let 0 < δ  ≪  ε. Write oδ(1) for any function that approaches zero as δ approaches zero and moreover, oδ(1)  ≪  ε. Let n be sufficiently large and let H be an n vertex 4-graph with b4(n) + 1 edges. Write #  P4 for the number of copies of P4 in H.

As in the proof of Theorem [\ref=P2] (just replacing 3/32 by 1/2), we may assume that H has minimum degree at least [formula].

If #  P4  ≥  δn4, then we are done so assume that #  P4  <  δn4. Then by the Removal lemma, there is a set of at most δn4 edges of H whose removal results in a 4-graph H' with no copies of P4. Since |H'| > b4(n) - δn4, by Theorem [\ref=P4stability], we conclude that there is a partition of H' (and also of H) into two parts such that the number of edges intersecting some part in an even number of points is oδ(n4). Now pick a partition [formula] of H that maximizes e(X,Y), the number of edges that intersect each part in an odd number of points. We know that e(X,Y)  ≥  b4(n) - oδ(n4), and an easy calculation also shows that each of X,Y has size n / 2  ±  oδ(n).

Let B be the set of edges of H that intersect one (and therefore both) of X,Y in an even number of points. Let G = H - B be the set of edges of H that intersect both X,Y in an odd number of points. Let M be the set of 4-tuples which intersect both parts in an odd number of points and are not edges of H. Then [formula] is an odd 4-graph with partition X,Y, so it has at most b4(n) edges. We conclude that

[formula]

in particular [formula]. Let BXiY4 - i (HXiY4 - i) be the set of edges in B (H) with exactly i points in X. Let

[formula]

Claim. For every vertex a of H we have dM(a) < ε1n3.

Proof of Claim. Suppose for a contradiction that dM(a) > ε1n3. Since

[formula]

we conclude that dB(a) > dM(a) - oδ(n3) > (ε1 / 2)n3. Assume wlog that a∈X. Then dB(a) = dBXXXX(a) + dBXXYY(a).

Case 1. dBXXXX(a)  ≥  (ε1 / 4)n3

We may assume that dG(a)  ≥  dBXXXX(a) otherwise moving a from X to Y increases e(X,Y) and contradicts the choice of the partition. Pick e = abcd∈BXXXX and f = auvw∈G. The number of choices for (e,f) is at least dBXXXX(a)2  ≥  (ε1 / 4)4n6. For each such (e,f), consider the five 4-tuples

[formula]

This gives at least (ε21 / 16)n6 > 2δn6 potential copies of P4 so at least (ε21 / 32)n6 of them have a 4-tuple not in H. Since e,f∈H, the absent 4-tuple is of the form uvwz where z∈{b,c,d}. Notice that uvwz∈M since auvw∈G and a,z∈X. Each such 4-tuple of M is counted at most 3n2 times, as there are at most three choices for [formula] and [formula] choices for the two vertices of e - f - {a}. This yields the contradiction (ε21 / 32)n6 / (3n2) < |M| = oδ(n4).

Case 2. dBXXYY(a)  ≥  (ε1 / 4)n3

Suppose that dHXYYY(a)  ≥  (ε1 / 2)n3. Then pick e = abcd∈BXXYY and f = auvw∈HXYYY (so u,v,w∈Y) with [formula]. The number of such pairs (e,f) is at least (ε21 / 10)n6. For each such (e,f), consider the potential copy of P4 given by

[formula]

Since (ε21 / 10)n6 > 2δn6 at least half of them have a 4-tuple from M. Each such 4-tuple is counted at most 3n2 times, so we obtain the contradiction (ε21 / 20)n6 / (3n2)  ≤  |M| = oδ(n4). We may therefore assume that

(i) dHXYYY(a) < (ε1 / 2)n3 and

(ii) dBXXXX(a)  <  (ε1 / 4)n3.

Define L(a) = {bcd:abcd∈H}, so [formula]. Consider the partition

[formula]

where the subscripts have the obvious meaning. Then (i) and (ii) translate to

[formula]

For (u,v)∈X  ×  Y, let dL(uv) be the number of w such that uvw∈L(a). Then

[formula]

Consequently, there exists (b,c)∈X  ×  Y such that

[formula]

We conclude that there exists S  ⊂  X,T  ⊂  Y such that

[formula]

and abcd∈H for every [formula]. Now pick s1,s2,s3∈S and t∈T and consider the potential P4

[formula]

The number of choice for ({s1,s2,s3},t) is at least [formula]. If for at least half of these choices of ({s1,s2,s3},t) we get a copy of P4 in H as shown above, then #  P4 > (1 / 2)10- 4n4  >  δn4, a contradiction. So for at least half of the choices, one of the 4-tuples in ([\ref=r]) is not in H. By definition of S and T, the first four are in H, so the last one is in M. This is counted exactly once, so we obtain the contradiction (1 / 2)10- 4n4 < |M| = oδ(n4). This completes the proof of the Claim.

Partition [formula] where

[formula]

Case 1. |B1|  ≥  ε|B|.

Pick e = abcd∈B1, and assume wlog that e∈BXXXX. Let e'  ⊂  e with |e'| = 3. Assume wlog that e' = bcd. Let [formula] and consider the five 4-tuples

[formula]

These 4-tuples from a potential copy of P4. The number of choices for (e',{y1,y2,y3}) is at least [formula]. For at least 2ε of these choices, one of the 4-tuples above must not be in H, otherwise [formula] and we are done. If for at least ε of these choices, the missing 4-tuple is the last one in the list, then we obtain [formula] for some x∈e (since ε1  ≤  ε / 200). This contradicts the Claim. We may therefore assume that for at least ε of these choices, the 4-tuple from M has exactly three points in e. Each such 4-tuple is counted at most [formula] times giving at least (ε / 7)n 4-tuples from M with three points in e.

We have argued above that for every e∈B1, there are more than (ε / 7)n different f∈M with [formula]. Form the bipartite graph with parts B1,M, where e∈B1 is adjacent to f∈M if [formula]. Then each vertex in B1 has degree more than (ε / 7)n, and since |B1|  ≥  ε|B|  >  ε|M|, we conclude that there exists f∈M that is adjacent to more than |B1|(ε / 7)n / |M| > (ε2 / 7)n different e∈B1. Consequently, there exist a,b,c such that dB1(abc) > (ε2 / 7)n. Assume wlog that a,b,c∈X.

For each choice of d with e = abcd∈B1 and [formula] five 4-tuples y1y2y3x where x∈e together with e form a potential copy of P4. The number of choices for (d,{y1,y2,y3}) is at least [formula] (since ε1  ≤  ε2 / 104). If for at least half of them, we get a copy of P4 in H, then #  P4  >  δn4 and we are done. So for at least 3ε1n4 of the choices, one of the five 4-tuples is not in H. If for at least ε1n4 choices the missing 4-tuple is of the form y1y2y3d, then we obtain the contradiction ε1n4  ≤  |M| = oδ(n4). So for at least 2ε1n4 choices the missing 4-tuple is of the form y1y2y3x, x  ≠  d. Each such missing 4-tuple is counted at most |X| < n times. We conclude that there exists x∈e with dM(x) > 2ε1n4 / n > ε1n3. This contradicts the Claim and completes the proof in this case.

Case 2. |B1|  <  ε|B|.

In this case we have |BXXYY|  ≥  (1 - ε)|B|. Partition [formula] where

[formula]

Suppose that |B2|  ≥  (1 - ε)|BXXYY|. Then we count 4-tuples of M from sets in B2. For each set in B2, there are four choices for e'  ⊂  e with |e'| = 3, and given e', there are (1 - ε)(n / 2) 4-tuples of M containing e'. Each 4-tuple from M is counted at most 3 max {|X|,|Y|} times. This gives the contradiction

[formula]

We may therefore suppose that |B3| > ε|BXXYY| > (ε / 2)|B|. We may also assume that no edge of B lies in at least (1 - ε)c(n,P4) copies of P4, otherwise we are done. Using this observation we conclude that we have at least (ε / 4)n 4-tuples in M. To see this we pick an edge e∈B and consider potential copies of P4 containing e. We know that at least (ε / 2)c(n,P4) of these potential copies have a 4-tuple from M, for otherwise e lies in at least (1 - ε)c(n,P4) copies of P4. Each such 4-tuple is counted at most [formula] times. So we may assume that

[formula]

Now pick an edge e = abcd∈B3. By definition of B3, there exists e' = bcd  ⊂  e with dM(bcd)  ≤  (1 - ε)n / 2. Assume wlog that b∈X,c,d∈Y. Then there is a set Y'  ⊂  Y such that bcdy∈H for every y∈Y' and

[formula]

By the Claim and ε1  ≤  ε3 / 103, we know that the number of [formula] with ay1y2y3∈H is at least

[formula]

Each such [formula] yields the P4 given by

[formula]

We have argued above that for each e∈B3 there are at least ε1n3 copies of P4 containing e. Each such copy of P4 contains a unique edge of B3. Consequently, we obtain

[formula]

This contradiction completes the proof of the theorem.

Counting Expanded triangles

Recall that c(n,C3) = 3(n / 2)2  +  Θ(n). Theorem [\ref=C3q] follows from the following result.

For every ε > 0 there exists δ > 0 and n0 such that the following holds for n > n0. Every n vertex 4-graph with b4(n) + 1 edges contains either

[formula] an edge that lies in at least (3 - ε)(n / 2)2 copies of C3, or

[formula] at least δn4 copies of C3.

Proof of Theorem [\ref=C3q]. Remove q - 1 edges from H and apply Theorem [\ref=C3]. If we find δn4 copies of C3, then since q < δn2, the number of copies is much larger than q(1 - ε)c(n,C3) and we are done. Consequently, we find an edge e1 in at least (3 - ε)(n / 2)2 > (1 - ε)c(n,C3) copies of C3. Now remove q - 2 edges from H - e1 and repeat this argument to obtain e2. In this way we obtain edges [formula] as required.

Sharpness follows by the following construction: Add a collection of q 4-tuples to B4(n) within one of the parts (say X) such that every two 4-tuples have at most one point in common. It is well-known that such quadruple-systems exist of size δn2 (in fact such Steiner systems also exist for an appropriate congruence class of n). It is easy to see that each added 4-tuple lies in at most 3(n / 2)2 copies of C3, since there are three ways to partition the edge into two disjoint pairs, and for each of these ways, there are at most (n / 2)2 copies of C3 using this partition. Moreover, no two added edges lie in a copy of C3 since they share at most one point. Consequently, the number of copies of C3 is at most 3q(n / 2)2.

We need the following stability result proved by Keevash and Sudakov [\cite=KSFr].

Let H be a 4-graph with n vertices and b4(n) - o(n4) edges that contains no copy of C3. Then there is a partition of the vertex set of H into [formula] so that the number of edges that intersect X or Y in an even number of points is o(n4). In other words, H can be obtained from B4(n) by adding and deleting a set of o(n4) edges.

Proof of Theorem [\ref=C3]. Given ε let 0 < δ  ≪  ε. Write oδ(1) for any function that approaches zero as δ approaches zero and moreover, oδ(1)  ≪  ε. Let n be sufficiently large and let H be an n vertex 4-graph with b4(n) + 1 edges. Write #  C3 for the number of copies of C3 in H.

As in the proof of Theorem [\ref=P2] (just replacing 3/32 by 1/2), we may assume that H has minimum degree at least [formula].

If #  C3  ≥  δn4, then we are done so assume that #  C3  <  δn4 = (δ / n2)n6. Then by the Removal lemma, there is a set of at most δn4 edges of H whose removal results in a 4-graph H' with no copies of C3. Since |H'| > b4(n) - δn4, by Theorem [\ref=C3stability], we conclude that there is a partition of H' (and also of H) into two parts such that the number of edges intersecting some part in an even number of points is oδ(n4). Now pick a partition [formula] of H that maximizes e(X,Y), the number of edges that intersect each part in an odd number of points. We know that e(X,Y)  ≥  b4(n) - oδ(n4), and an easy calculation also shows that each of X,Y has size n / 2  ±  oδ(n).

Let B be the set of edges of H that intersect one (and therefore both) of X,Y in an even number of points. Let G = H - B be the set of edges of H that intersect both X,Y in an odd number of points. Let M be the set of 4-tuples which intersect both parts in an odd number of points and are not edges of H. Then [formula] is an odd 4-graph with partition X,Y, so it has at most b4(n) edges. We conclude that

[formula]

in particular [formula].

Given vertices a,b and hypergraph F, write dF(ab) for the number of edges of F containing both a and b. The rest of the proof has many similarities (modulo technical changes) to the proof of the exact Turán result for C3 in [\cite=KSFr]. Let ε1  =  ε / 105.

Claim 1. For every two vertices [formula], either dG(ab) < ε1n2 or dB(ab) < ε1n2.

Proof. Suppose, for contradiction, that both dG(ab) and dB(ab) are at least ε1n2. Pick e∈B and f∈G with [formula]. Note that in all cases [formula], i.e., ge,f intersects both parts in an odd number of points. The number of such pairs e,f is at least (ε1n2)2 / 2 > 2δn4 (the factor of 2 is to ensure that [formula]). If at least δn4 of these pairs form a copy of C3, then we are done, so we may assume that at least (ε1n2)2 / 4 of these pairs satisfy ge,f∈M. This contradicts ([\ref=m<b]) and completes the proof of the Claim.

Claim 2. dB(v) < (ε / 103)n3 for every v∈V.

Proof. Let us fix a vertex v∈V, ε' = ε / 103 > 24ε1, and assume for contradiction that dB(v)  ≥  ε'n3. Call vertex w∈V - {v} good if dB(vw) < ε1n2, otherwise say that w is bad. Claim 1 implies that if w is bad, then dG(vw) < ε1n2. Moreover, the number of bad vertices is at least ε'n for otherwise we obtain the contradiction

[formula]

Next we observe that dG(v)  ≥  dB(v) for otherwise we could move v to the other part and contradict the choice of X,Y. This implies that [formula]. If the number of good vertices is less than n / 18, then

[formula]

This contradicts the lower bound on dG(v). We may therefore assume that the number of good vertices is αn, where

[formula]

Write dH(v) = dG(v) + dB(v) and let us estimate these two terms separately. The number of edges of G containing v and a bad vertex is at most ((1 - α)n + 1)ε1n2  <  ε1n3. The number of edges of G containing v and no bad vertex is at most

[formula]

The bound above is obtained by picking two good vertices which then restricts the edge being counted to one of the parts. This procedure counts each edge six times. We conclude that [formula].

The number of edges of B containing v and a good vertex is at most ε1n3. Using a similar argument to that used above, the number of edges of B containing v and no good vertex is at most [formula]. We conclude that

[formula]

Using ([\ref=ep]) and ε1  <  ε' / 24, we observe that

[formula]

Consequently, [formula]. This contradicts the fact that [formula] and completes the proof of the Claim.

The rest of the proof is devoted to showing that dB(v)  ≥  (ε / 103)n3 for some vertex v and this contradicts Claim 2. Note that for every edge e∈B, there are at least (3 - oδ(1))(n / 2)2 copies of C3 containing e where the other two edges in the copy are in G. Indeed, this is why c(n,C3) = (3 + o(1))(n / 2)2. This requires some case analysis, for example, if e = {a,b,c,d}  ⊂  X, then for every choice of (x,y)∈(X - e)  ×  Y, and for every partition of e into two disjoint pairs p,q, the three edges [formula] form a copy of C3 and [formula]. The number of such copies is therefore the number of (x,y) times the number of pairs p,q and this is (3 - oδ(1))(n / 2)2. The case a,b∈X,c,d∈Y is similar except that the argument further breaks into two cases depending on the choice of p,q. We omit these details.

Claim 3. There is a pair of vertices a,b with dB(ab) > (ε / 48)n2

Proof. For every e∈B, at least (ε / 2)(n / 2)2 of the copies of C3 using e,f,g with [formula] must have at f∈M or g∈M. Otherwise, there are at least (3 - oδ(1) - ε / 2)(n / 2)2 > (3 - ε)(n / 2)2 copies of C3 containing e and we are done. The edge in M is counted precisely once, since a copy of C3 is uniquely determined by two of its edges. We conclude that for each e∈B, there are at least (ε / 2)(n / 2)2 edges of M that intersect e is exactly two points. Now form a bipartite graph with parts B,M where e∈B is adjacent to f∈M if [formula]. Since |M| < |B|, and each e∈B is adjacent to at least (ε / 2)(n / 2)2 different f∈M, we conclude that there exists f∈M that is adjacent to more than (ε / 2)(n / 2)2 different e∈B. At least 1/6 of these e intersect f in the same pair of points a,b. Consequently, dB(ab) > (ε / 12)(n / 2)2 = (ε / 48)n2 and the Claim is proved.

Let us fix a,b from Claim 3. For each edge e = abcd∈B, there are at least n2 / 5 pairs r,s∈V such that the three sets e,acrs,bdrs form a copy of C3. By Claim 3, the number of such potential copies of C3 is at least (ε / 240)n4 > 2δn4, so for at least half of them, either acrs∈M or bdrs∈M. Each such 4-tuple of M is counted at most n times, since a,b,r,s are fixed. This gives us at least (ε / 480)n3 4-tuples of M containing either a or b. At least (ε / 960)n3 must contain the same point, say a. Consequently, dM(a)  ≥  (ε / 960)n3. We know that [formula], and the above argument shows that [formula]. We conclude that dB(a) > (ε / 103)n3 which contradicts Claim 2 and completes the proof.