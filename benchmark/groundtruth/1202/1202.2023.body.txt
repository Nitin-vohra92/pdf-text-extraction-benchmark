Surprising symmetries in 132-avoiding permutations

Dedicated to the memory of Herb Wilf

Introduction

Background and Definitions

Let [formula] be a permutation in the symmetric group Sk. We say that the permutation [formula] contains a q-pattern if and only if there is a subsequence [formula] of p whose elements are in the same relative order as those in q, that is,

[formula]

whenever 1  ≤  t,u  ≤  k. If p does not contain q, then we say that p avoids q. For instance, 214653 contains 231 (consider the third, fourth, and sixth entries), but avoids 4321. See Chapter 14 of [\cite=bona] for an introduction to pattern avoiding permutations, and Chapters 4 and 5 of [\cite=combperm] for a somewhat more detailed treatment.

It is straightforward to compute, using the linear property of expectation, that the average number of q-patterns in a randomly selected permutation of length n is [formula], where k is the length of q.

Joshua Cooper [\cite=cooper] has raised the following interesting family of questions. Let r be a given permutation pattern. What can be said about the average number of occurrences of q in a randomly selected r-avoiding permutation of a given length? Equivalently, can we determine the total number Sn,r(q) of all q-patterns in all r-avoiding permutations of length n?

Earlier Results

In [\cite=occurrences], present author found formulae for the generating functions of the sequence S132,n(q) for the cases of monotone q, that is, for [formula] and [formula], for any k. He also proved that if n is large enough, then for any fixed k, among all patterns q of length k, it is the monotone decreasing pattern that maximizes S132,n(q) and it is the monotone increasing pattern that minimizes S132,n(q).

The Outline of our Paper

In this paper, we first present a computational proof of the surprising fact that for all n, the equalities

[formula]

hold. The first equality is trivial, since taking the inverse of a 132-avoiding permutation keeps that permutation 132-avoiding, and turns 231-patterns into 312-patterns. However, the second equality is non-trivial. (The reverse or complement of a 132-avoiding permutation is not necessarily 132-avoiding.) In particular, if a(p) denotes the number of 213-copies in p, and b(p) denotes the number of 231-copies in p, then the statistics a(p) and b(p) are not equidistributed over the set of all 132-avoiding permutations of length n, but their average values are equal over that set.

In other words, we will prove that a randomly selected non-monotonic pattern of length three in a 132-avoiding permutation is equally likely to be a 231-pattern, a 312-pattern, or a 213-pattern. It is well-known (see Chapter 14 of [\cite=bona]) that 132-avoiding permutations of length n are counted by the Catalan numbers [formula], and as such, they are one of more than 150 distinct kinds of objects counted by those numbers. However, we do not know of any other example when a natural statistic on objects counted by Catalan numbers shows a similar threefold symmetry.

In the next part of the paper we provide a bijective proof of ([\ref=triple]). Finally, we will significantly generalize this result by showing more than ch - 2 pairs of patterns q and q' of length h that behave as 213 and 231, that is, for which Sn,132(q) = Sn,132(q'), and the equality is non-trivial.

Arguments Using Generating Functions

Let dn be the total number of inversions (in other words, copies of the pattern 21) in all 132-avoiding n-permutations. It is proved in [\cite=occurrences] that

[formula]

Counting Copies of 213

Let an be the total number of all 213-patterns in all 132-avoiding permutations of length n. Clearly, then a0 = a1 = a2 = 0.

There are three ways that a 132-avoiding permutation p of length n can contain a 213-pattern q. Either q is entirely on the left of the entry n, or q is entirely on the right of n, or q ends in n.

For n  ≥  3, this leads to the recurrence relation

[formula]

Let A(x) (resp. C(x)) be the ordinary generating function for the sequence of the numbers an (resp. cn). Then the last displayed formula yields the functional equation

[formula]

which is equivalent to

[formula]

From here, we get that if n  ≥  3, then

[formula]

which simplifies to

[formula]

Counting Copies of 231

Let hn be the total number of all non-inversions (in other words, copies of the pattern 12) in all 132-avoiding permutations of length n. It is proved in [\cite=occurrences] that

[formula]

Let bn be the total number of all 231-copies in all 132-avoiding permutations of length n, and let [formula].

Let

[formula]

Note that Z(x) is the generating function for the number of entries (which are copies of the pattern 1) in all 132-avoiding n-permutations.

If p is a 132-avoiding n-permutation, and q is a 231-pattern contained in p, then either q is entirely on the left of the entry n, or q is entirely on the right of the entry n, or the entry n is the largest entry of q, or the first and second entries of q form a 12-pattern on the left of n, while the third entry of q is on the right of n.

For n  ≥  3, this leads to the recurrence relation

[formula]

In terms of generating functions, this yields

[formula]

[formula]

Given the explicit formulae ([\ref=non-inversions]) and ([\ref=explicitZ]) for H(x) and Z(x), the last displayed equation yields the formula

[formula]

The proof of the main result of this section is now immediate.

For all positive integers n, the equalities

[formula]

hold.

As we mentioned in the Introduction, the first equality is trivially true since there is a natural bijection between the 231-copies of the 132-avoiding permutation p and the 312-copies of the 132-avoiding permutation p- 1. Indeed, let [formula] be a 132-avoiding permutation, and let 1  ≤  i < j < k  ≤  n. Then pipjpk is a 231-copy in p if and only if ijk is a 312-copy in p- 1.

The equality Sn,132(231) = Sn,132(213) holds since we have seen in formulae ([\ref=explicitA]) and ([\ref=explicitB]) that the two sides of this equality have identical generating functions.

A Bijective Proof

In this section we provide a bijective proof for the surprising identity Sn,132(213) = Sn,132(231).

Binary Plane Trees

In our proof, we will identify a 132-avoiding permutation p with its binary plane tree T(p) using a very well-known bijection. We will briefly describe this bijection now. For more details, the reader may consult Chapter 14 of [\cite=bona]. The tree T(p) will be a binary plane tree, that is, a rooted unlabeled tree in which each vertex has at most two children, and each child is a left child or a right child of its parent, even if it is the only child of its parent.

The root of T(p) corresponds to the entry n of p, the left subtree of the root corresponds to the string of entries of p on the left of n, and the right subtree of the root corresponds to the string of entries of p on the right of n. Both subtrees are constructed recursively, by the same rule. Note that since p is 132-avoiding, the position of the entry n of p determines the set of entries that are on the left (resp. on the right) of n. In fact, if n is in the ith position, the set of entries on the left of n must be [formula], and the set of entries on the right of n must be [formula].

We point out that in the process of constructing T(p), each vertex of T(p) is associated to an entry of p. Indeed, each vertex is added to T(p) as the root of a subtree S, and so each vertex is associated to the entry that is the largest among the entries that belong to S. However, it is important to point out that T(p) is an unlabeled tree since the way in which the entries of p correspond to the vertices of T(p) is completely determined by the unlabeled tree T(p) as long as p is 132-avoiding.

See Figure [\ref=binplane] for an illustration.

Note that in order to get p from T(p), it suffices to read the vertices of T(p) in-order, that is, by first reading the left subtree of the root, then the right subtree of the root, and then the right subtree of the root. The respective subtrees are read recursively, by this same rule. Therefore, it is meaningful to talk about the first, second, etc, last vertex of T(p), since that means the first, second, etc, last vertex of T(p) in the in-order reading.

A left descendant (resp. right descendant of a vertex x in a binary plane tree is a vertex in the left (resp. right) subtree of x. The left (resp. right) subtree of x does not contain x itself.

It is straightforward to see that pipj is a 12-pattern in p if and only if pi is a left-descendant of pj in T(p). On the other hand, pjpi is a 21-pattern in p if and only if either pi is a right descendant of pj in T(p) or there is a vertex x in T(p) so that pj is a left descendant of x and pi is a right descendant of x. In the previous section we gave an exhaustive list of the ways in which 213-patterns and 231-patterns can occur in a 132-avoiding permutation. The reader is invited to translate that list into the language of binary plane trees.

Our Bijection

Let p be a 132-avoiding n-permutation, and let Q be an occurrence of the pattern 213 in p. Let Q2,Q1,Q3 be the three vertices of T(p) that correspond to Q, going left to right. Let us color these three entries black. There are then two possibilities.

Either Q1 is a right descendant of Q2 and Q2 is a left descendant of Q3, or

there exists a lowest left descendant Qx of Q3 so that Q2 is a left descendant of Qx and Q1 is a right descendant of Qx.

Let An be the set of all binary plane trees on n vertices in which three vertices forming a 213-pattern are colored black. Let Bn be the set of all binary plane trees on n vertices in which three vertices forming a 231-pattern are colored black.

Now we are going to define a map f:An  →  Bn. We will then prove that f is a bijection. The map f will be defined differently in the two cases described above.

Case 1. If T∈An is in the first case, then let f(T) be the pair obtained by interchanging the right subtree of Q2 and the right subtree of Q3. Keep all three black vertices Qi black, even as Q1 gets moved.

See Figure [\ref=firstmove] for an illustration.

Note that in f(T), in the set of black vertices, there is one that is an ancestor of the other two, namely Q3.

Case 2. If T∈An is in the second case, then let f(T) be the tree obtained by interchanging the right subtrees of the vertices Qx and Q3, and coloring Q2, Qx and Q1 black. See Figure [\ref=secondmove] for an illustration.

Note that in f(T), there is no black vertex that is an ancestor of the other two black vertices. Also note that in f(T), the lowest common ancestor of Qx and Q1 is Q3.

It is a direct consequence of our definitions that if T∈An, then f(T) = Bn. Now we are in a position to prove the main result of this section.

The map f:An  →  Bn defined above is a bijection.

Let U∈Bn. We will show that there is exactly one T∈An so that f(T) = U holds. This will show that f has an inverse, proving that f is a bijection.

By definition, three nodes of U are colored black, and the entries of the permutation corresponding to U form a 231-pattern. Let K2, K3, and K1 denote these three vertices, from left to right. There are two possibilities for the location of the Ki relative to each other. We will show that in both cases, U has a unique preimage under f, essentially because swapping two subtrees is an involution.

If K3 is an ancestor of both other black vertices, then f(T) = U implies that T belongs to Case 1. In this case, the unique T∈An satisfying f(T) = U is obtained by swapping the right subtrees of K3 and K2, and keeping all three black vertices black, even if K1 got moved.

If K3 is not an ancestor of both other black vertices and then f(T) = U implies that T belongs to Case 2. In this case, let Kx be the smallest common ancestor of U3 and U1. Then the unique T∈An satisfying f(T) = U is obtained by swapping the right subtrees of K3 and Kx, and coloring Kx black instead of K3, while keeping K1 and K2 black.

This completes the proof.

A Generalization

In this section, we will significantly generalize the result of the previous section. The key observation is that in the proof of Theorem [\ref=bijective], the left subtrees of Q1 and Q2 never changed.

In order to state our result, we announce the following definitions.

Let q be a pattern of length k and let t be a pattern of length m. Then [formula] is the pattern of length k + m defined by

[formula]

In other words, [formula] is the concatenation of q and t so that all entries of t are increased by the size of q.

If q = 3142 and t = 132, then [formula].

Let q be a pattern of length k and let t be a pattern of length m. Then [formula] is the pattern of length k + m defined by

[formula]

In other words, [formula] is the concatenation of q and t so that all entries of q are increased by the size of t.

If q = 3142 and t = 132, then [formula].

Now we are ready to state and prove the most general result of this paper.

Let q and t be any non-empty patterns that end in their largest entry. Let iu denote the increasing pattern [formula]. Then for all positive integers n, we have

[formula]

where 1 denotes the pattern consisting of one entry.

In particular, the result of the previous section is the special case of Theorem [\ref=general] in which q = t = iu = 1 (the one-entry pattern 1).

If q = 3124, t = 213, and u = 2, then Theorem [\ref=general] says that

[formula]

(of Theorem [\ref=general]) Note that we can assume that q and t are both 132-avoiding, since otherwise the statement of Theorem [\ref=general] is trivially true as both sides are equal to 0.

Let k denote the length of q, let m denote the length of t. Similarly to the proof of Theorem [\ref=bijective], let An be the set of all binary plane trees on n vertices in which h vertices forming a [formula]-pattern are colored black, and let Bn be the set of all binary plane trees on n vertices in which h vertices forming a [formula]-pattern are colored black.

Let T∈An. Let Qb be the kth black vertex of T in the in-order reading, let Qa be the (k + m)th black vertex of T, and let Qc be the rightmost black vertex of T. We are now going to construct a bijection F:An  →  Bn. The construction is analogous to the one that we saw before Theorem [\ref=bijective]

If Qa is a right descendant of Qb, then let F(T) be the tree obtained from T by swapping the right subtree of Qb and the right subtree of Qc. Note that in F(T), the black vertices form a [formula]-pattern, and that Qc is an ancestor of all other black vertices in F(T). See Figure [\ref=firstg] for an illustration.

Otherwise, there exists a lowest vertex Qx∈T so that Qb is a left descendant of Qx and Qa is a right descendant of Qx. Note that in this case, it follows that Qx is not black. Now let F(T) be the tree obtained from T by swapping the right subtree of Qx and the right subtree of Qc, and by coloring Qx black, instead of Qc. Note that again, in F(T), the black vertices form a [formula]-pattern. Also note that there is no black vertex in F(T) that would be an ancestor of all other black vertices. See Figure [\ref=secondg] for an illustration.

It is straightforward to show that F:An  →  Bn is a bijection. Indeed, let U∈Bn. If there is a black vertex in U that is an ancestor of all other black vertices, then U could only be obtained by the first rule, otherwise U could only be obtained by the second rule. The unique preimage F- 1(U) is then obtained by swapping the appropriate right subtrees. In the first case, swap the right subtrees of Ub and Uc, where Ub is the kth and Uc is the (k + u)th black vertex of U in the in-order reading. In the second case, let Ux be the (k + 1)st black vertex of U, let Ua be the last black vertex of U, and let Uc be the lowest common ancestor of Ux and Ua. Then the unique preimage F- 1(U) is obtained by swapping the right subtrees of Ux and Uc, and coloring Uc black instead of Ux.

Note that by transitivity, Theorem [\ref=general] implies the following.

Let q, t, and iu be as in Theorem [\ref=general], and let 1  ≤  v < u. Then we have

[formula]

Theorem [\ref=general] shows that both sides are equal to [formula].

Further Directions

Formula ([\ref=exactfora]) implies that Sn,132(213)  ~  C14nn, while the generating functions computed in [\cite=occurrences] imply that Sn,132(321)  ~  C24nn3 / 2 and Sn,132(123)  ~  C34nn1 / 2, where the Ci are positive constants. So occurrences of non-monotone patterns of length three are infinitely rare compared to occurrences of 321, and infinitely frequent compared to occurrences of 123; the frequency of non-monotone patterns is halfway between the two extremes.

While precise formulae like the ones given in earlier sections of this paper may not be obtainable for longer patterns, comparative results as the ones described in the previous paragraph may be possible to prove even for such patterns.

If we set u = 1 and h = k + m + 1, then Theorem [\ref=general] provides [formula] non-trivial examples of two patterns s and s' for which Sn,132(s) = Sn,132(s') for all n. Other choices of u provide additional such pairs. However, it seems that there are other pairs of patterns whose total number of copies in all 132-avoiding permutations agree. We hope to discuss such pairs in an upcoming paper.

Are there any other such pairs? Are there any such pairs when 132 is replaced by another pattern r? Are there any patterns r and r' for which Sn,r(u) = Sn,r'(u') for all n and the equality is non-trivial?

Finally, how do the permutation statistics studied in this paper translate to the other 150 families of objects counted by the Catalan numbers listed in [\cite=stanley]?