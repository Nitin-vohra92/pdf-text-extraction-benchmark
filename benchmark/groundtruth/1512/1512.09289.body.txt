Laser-plasma interactions with a Fourier-Bessel Particle-in-Cell method

Introduction

In the last few decades, numerical simulation has become an indispensable tool for plasma physics in a wide range of problems from astro- and atmosphere physics, to laser plasma interactions. Often for such studies one needs to model plasma kinetics in presence of the strong electromagnetic fields, which produce relativistic motion of the charges in plasma. Such systems can be described by using the particle methods [\cite=hockney:1988], where plasma is presented by the macro-particles, which have the same charge-to-mass ratios as plasma particle species, but represent large quantities of the real ones. One example here is the particle-in-cell (PIC) method, which is widely used for the plasma modeling [\cite=langdon:2004]. In PIC, the electromagnetic fields are calculated at the nodes of a spatial grid, and each macro-particle interacts with only a few such nodes in its vicinity.

The majority of the PIC codes advance the electromagnetic fields via the finite-difference time domain (FDTD) methods [\cite=taflove:2005]. In this approach, the finite differences approximate all derivatives in the Maxwell equations, and the discrete steps are used to advance the fields-particles system in time. The FDTD scheme stability is defined by the resolutions, Δt and [formula], which define the precisions of the temporal and spatial derivatives of the electric and magnetic fields. In practice, the velocities of the traveling waves in FDTD happen to depend on how well their propagation is resolved in space and time, and this phenomenon is known as the numerical dispersion. In the cases, where electromagnetic waves co-propagate with the relativistic particles, such dispersion may result to the unphysical wave-particle interactions, which should be treated explicitly [\cite=lehe:PRSTAB2013] [\cite=nuter:EPJD2014] [\cite=godfrey:JCP2014]. On the other hand, the derivatives in the Maxwell equations are coupled, and for the better accuracy, the fields [formula] and [formula] in FDTD are usually staggered in space and in time. In this case, the terms [formula] and [formula] of the Lorentz force, with which wave acts on the particle, may compensate each other with a reminder [formula], where γp  =  (1  -  β2p) -  1  /  2 is the particle's Lorentz factor. For a relativistic particle, the force [formula] can be very small, and for the correct projection of the staggered fields a very fine temporal and spatial resolutions may be required [\cite=lehe:PRSTAB2014].

The mentioned issues become especially important in modeling the wakefield acceleration of particles (WFA). In WFA, the strong plasma waves transfer the energy from a high-power laser or particle driver beam, to the trailing particles, eventually injected into these waves [\cite=esarey:RMP2009] [\cite=Litos:Nat2014] [\cite=Corde:Nat2015]. These accelerators are being actively explored for the last two decades in pursuit for the compact sources of high intensity beams of energetic particles. The three-dimensional FDTD PIC modeling is commonly used for the detailed theoretical studies of WFA physics, and to interpret the experiments. Besides the WFA modeling, such simulations are used to study the accompanying phenomena, e.g. generation of X-rays by the accelerated charges [\cite=corde:RevModPhys2013], collimation of the particle beams [\cite=lehe:PRSTAB2014] etc.

One alternative to the FDTD approach is the pseudo-spectral time domain (PSTD) method [\cite=haber:PROC1973]. In PSTD, at each time step the equations are translated from the real space to a spectral (e.g. Fourier) domain, where the derivatives are presented by the linear coefficients. This approach provides high precision in calculation of the spatial derivatives, and, in some cases, allows to run simulations with the much lower spatial resolutions, than the finite differences methods [\cite=LiuQH:MOP1997]. Moreover, for a wide class of equations, their spectral counterparts can be integrated in time analytically, so that the accuracy of the fields dynamics modeling does not directly depend on the simulations temporal resolution [\cite=haber:PROC1973]. This is known as the pseudo-spectral analytical time domain (PSATD) method, and it was shown to produce no numerical dispersion of electromagnetic fields associated with the temporal and spatial resolutions in PIC [\cite=Vay:JCP2013].

Here we develop the PSATD PIC considering that the model geometry has a certain level of cylindrical symmetry, which allows to replace the three-dimensional Cartesian geometry with a series of cylindrical models with different symmetries, e.g. Fourier series over the azimuthal angle. This is known as the quasi-cylindrical geometry, and previously it was proposed for the FDTD PIC simulations in [\cite=lifschitz:JCP2009]. Allowing to model the laser-plasma interactions with only few angular modes, the quasi-cylindrical FDTD approach has become popular for modeling WFA-type problems [\cite=davidson:JCP2015], and the combinations of such method with the Fourier methods were considered [\cite=YuP:arXiv2015]. For the fully spectral quasi-cylindrical PSATD, we consider the decomposition into the cylindrical harmonics, where the angular Fourier decomposition is naturally extended by the Fourier-Bessel transform of the azimuthal modes. Previously, the quasi-cylindrical spectral modeling was considered for a variety of problems [\cite=guizar:JOCA2004] [\cite=veysman:POP2006] [\cite=andriyash:JCP2014], and in this work we apply it for PIC simulations. One similar method was recently developed in [\cite=lehe:arxiv2015], in parallel with the present one. In [\cite=lehe:arxiv2015] the different mathematical formulation is used, which has led to a different numerical scheme.

The physical and mathematical models are presented and discussed in . In , we briefly discuss the implementation of the scheme, and demonstrate a few examples of laser plasma simulations, which are compared to the ones provided by the quasi-cylindrical FDTD PIC. The conclusions are given in , and are followed by a brief review of the spectral transforms (), and their properties ().

Physical and mathematical models

Two main ingredients of a numerical model of plasma electrodynamics are the integrator of the electromagnetic equations called Maxwell solver, and the particle pusher, which integrates the motion equations for the charged plasma particles. In our Maxwell solver, we employ the Fourier-Bessel transform for the spatial distributions of electromagnetic fields, and the charge densities and currents. The description of the transform is provided in , and in the following text we denote the spectral images with the hat-like accent, [formula]. The spatial dependencies are considered in the cylindrical coordinates [formula], while the vectorial components are chosen to be Cartesian, [formula], so they are naturally well-defined on the axis, r = 0 (in contrast to the cylindrical components).

The components of the Fourier-Bessel series are the cylindrical harmonics, which are the eigenfunctions of the Laplace operator,   =    -  ω2. On the other hand, the first-order operators involve coupling of the azimuthal modes, and do not transform directly into the linear coefficients (see ). Therefore, to take advantage of these properties, we derive the mathematical model, where the Laplace operator acts on the functions updated in time (i.e. are acted on by ∂t), and the operators [formula], [formula] and [formula] act only on the terms, which are re-calculated at each iteration.

For convenience, in the following discussion we use the dimensionless units - the field components are normalized as [formula] and [formula], where me and e are the mass of the electron and the elementary charge, k0 = 2π  /  λ0 and ω0  =  k0c are the wavenumber and the frequency, which correspond to a scale unity λ0 (e.g. laser or plasma wavelength). The mass, charge, velocity, coordinates of the particles are in the units of me, e, c, k- 10 respectively, and time is normalized to ω- 10. The particles density np in this notations is normalized to the critical plasma density for the unity wavelength, nc = meω20 / 4πe2.

Field equations in the spectral space

To construct the spectral Maxwell solver, we start from the standard equations for the electric and magnetic fields (cf [\cite=landau:FieldTheor1975]):

[formula]

where n and [formula] are the normalized charge density and current.

As mentioned before, in the Fourier-Bessel space the first-order operators couple the angular Fourier modes, and are to be excluded from the integration. For this, we replace the magnetic field with its rotation vector, [formula], which in contrast to the pseudo-vector [formula] is a polar vector, and it behaves similarly to the currents (in magnetostatic problems [formula]). Next, we take the curl of the Faraday's law and combine it with the Poisson equation, which leads to:

Equations ([\ref=maxwell1]) are now well adapted for the integration in the spectral space, and after the Fourier-Bessel transform the first pair reads:

It is easy to see, that, while [formula] and [formula] can be advanced in time with , the first-order derivatives appear only to communicate fields with particles, so they are recalculated at each integration step.

Integration cycle of the quasi-cylindrical spectral PIC

In the time-domain particle-in-cell methods, the system of fields and particles advances in time by the discrete steps. Let us consider one integration cycle on the time interval (t0,t0  +  Δt), and denote the variables at t0, t0  +  Δt / 2 and t0  +  Δt with the indices "0","1/2" and "1" respectively. During one cycle:

particles velocities [formula] are used to advance their positions from [formula] to [formula] (leapfrog),

densities n1 and currents [formula] are deposed onto the spatial grid for each angular mode,

spectral projections of 1 / 2 and 1 are calculated,

is used to update 1 and 1, and 1 is calculated from

[formula] and [formula] are projected onto the spatial grid,

Lorentz force is calculated at the particles positions, and their velocities are advanced to [formula].

The steps (i,ii,vi) are common for the PIC methods, and their various implementations are widely discussed in the literature [\cite=langdon:2004]. The steps (iii) and (v), are simply the translations between spectral and real domains, and these operations are discussed in .

The step (iv) corresponds to the spectral Maxwell solver, where eqs. ([\ref=maxwell2:1]) are integrated in time for [formula] and [formula]. Let us assume that, following the particles dynamics, the current [formula] remains constant during one integration cycle, and the density evolves linearly from n0 to n1. In this case, on the interval (t0,t0  +  Δt) the electromagnetic equations can be written as:

[formula]

can be integrated in time analytically, which allows to obtain the fields at t0  +  Δt as:

[formula]

where vector [formula] contains the known variables, and the integration coefficients are:

On any interval, when [formula] and n can be assumed constant, is the exact solution of the Maxwell equations. The physical precision of such solution is independent of Δt, but is defined solely by the accuracies of the initial and boundary conditions. This is a principal advantage of the developed PSATD method along with the high accuracy of spatial derivatives achieved in spectral calculations.

Charge continuity.

In the simulations, relies on the charge density and current, which are calculated via the weighted projections of macro-particles positions and velocities onto the grid. The numerical errors, produced in such projections, typically dominate the overall accuracy of the model, and should be considered with care. One issue related to the projection errors in PIC, is that the continuity equation,

[formula]

may be not satisfied with the sufficient precision. Consequently, the violation of charge continuity leads to violation of the Poisson equation, [formula], and the magnetic monopoles absence condition, [formula]. Considering the series of , one may show that:

[formula]

where the term in the rightmost side corresponds to the continuity equation . The produced errors tend to accumulate, and the unphysical electric and magnetic fields may develop.

Commonly in the PIC methods, the charge continuity is assured by either correcting the deposed current [\cite=morse:PoF1971], or by using the charge-conserving deposition techniques [\cite=esirkepov:CPC2001]. The proper current correction may be introduced as, [formula], where Γ satisfies, [formula]. In the Fourier space, this correction becomes a simple algebraic operation, which makes this approach especially convenient in the spectral methods [\cite=Vay:JCP2013]. In the developed scheme, the current correction reads:

[formula]

and in contrast to the pure Fourier approach, differential operations in are not linear in the Fourier-Bessel space, but involve matrix operations. In the simulations, this correction should applied at each PIC cycle after the step (iii).

Boundary conditions for the fields.

In spectral methods, the boundary conditions of the simulation domain are determined by the basis functions, and providing the model-specific boundaries in the general case can be rather challenging. In our model, the vertical boundaries are periodic, as imposed by the Fourier transform, and the horizontal boundary, r = R, is chosen to be reflective (cf ). In the situations, when these conditions do not correspond to the physical model, it is often possible to assume the unbounded media, i.e. sufficiently large simulation domain, so that the interaction does not reach the boundaries. In the cases, when such approximation cannot be provided, the absorbing boundaries can be produced by multiplying the concerned values by the evanescent envelopes (for an example, see [\cite=kosloff:JCP1986]).

In beam-plasma interactions, the domain of interest may often be restricted to the area around a laser or particle beam, which travels through the plasma. In this case, we may apply the unbounded media model by considering the simulation domain, which covers the interaction region, and co-propagates with it. Obviously, such moving window technique requires the fields at the downstream boundary to be suppressed in order to prevent their upstream translation. In our scheme, when using the moving window, after each shift of the simulation domain we multiply [formula] and [formula] with a profile function, which is equal to unity everywhere but in a narrow layer near the boundary, where it is evanescent. We have tested the profiles:

[formula]

for suppression of [formula], and

[formula]

for a less perturbing suppression of [formula]. For this operation, the fields are projected to the real space along x-coordinate via the inverse Fourier transform, and returned to the spectral domain after the profiling. Plasma is also removed from this layer. The physical properties of such "absorbing" layers are also affected by the fact, that they travel with the domain. In the performed tests, the described method has proven efficient, however, its more rigorous development remains a subject for the further studies.

Simulations

The described algorithm was implemented as the separate module in the code PLARES [\cite=andriyash:JCP2014]. The original code was designed to simulate physics of free electron lasers using the reduced Fourier and Fourier-Bessel Maxwell solvers acting directly on the particles. In PLARES-PIC we use the linear interpolation for the particle-grid projections, and the particles are advanced in the [formula]-space via the standard Boris pusher [\cite=boris:proc1973].

Code runtime is managed by the scripts written in Python, which provides very simple coding and takes benefit of the numerical and scientific computation modules, Numpy and Scipy [\cite=numpy_ref], and on-the-fly simulation visualization can be easily implemented using the Matplotlib module [\cite=pylab_ref]. To provide the higher code performance, the computationally intense operations are written in Fortran 90, and are wrapped for Python calls via F2PY interface generator [\cite=f2py_ref]. For the fast Fourier transforms we use the FFTW3 package [\cite=fftw3_ref]. The parallel computation is managed by MPI from the Python runtime via MPI4PY [\cite=mpi4py_ref]. For simplicity in our code we use the radial decomposition, i.e. the spatial grid and the particles are divided into the slices along the radial direction.

Linear laser-plasma interaction

Let us firstly check of the scheme dispersion properties, by modeling the propagation of laser pulse in vacuum and plasma. The classical dispersion relation of electromagnetic waves in plasma reads, ω2  =  k2c2   +   ω2pe, where ωpe = (4πe2ne / me)1 / 2 is the frequency of electron plasma with the density ne (is cgs units). In the underdense plasmas, where ωpe  ≪  ω0, a simple estimate for the radiation group velocity can be derived, βG   =   ∂kcω≃1  -  ω2pe  /  2k2c2. Moreover, even in vacuum the finite-size laser beam is slowed by the diffraction [\cite=esarey:JOSAB95]. As a result, the deviation of the Gaussian beams centroid velocity from the speed of light in vacuum estimates as:

[formula]

where ne is the plasma density, and w0 is the beam waist.

In our test, we propagate the linearly polarized laser beam with the Gaussian profiles, a  =  a0 exp ( - r2 / w20 - x2 / l2x), where the parameters are a0  =  10- 2, w0  =  12λ0, and lx  =  12λ0. Firstly, laser travels 50λ0 distance in vacuum until its centroid enters the plasma. The plasma density increases linearly along first 50λ0, and then reaches its maximal value of ne  =  10- 3nc, after which it remains constant. The longitudinal and transverse resolutions are Δx = 0.048λ0 and Δr = 0.32λ0, and the time-step is Δt  =  Δx / c. At each iteration we measure the laser beam centroid position as [formula], and then deduce its group velocity βG  =  Δxc  /  Δt, which is also averaged over the laser period.

Evolution of the laser group velocity in our simulation is shown in with a blue solid curve, and theoretical estimate is plotted with the black dot-dashed line. The blue dashed line corresponds to the FDTD PIC simulation, performed for the same grid resolutions with the quasi-cylindrical code CALDER-CIRC [\cite=lifschitz:JCP2009]. One can see that the numerical dispersion in FDTD PIC, significantly slows the laser free-space propagation and perturbs its propagation in plasma. To approach the correct laser velocity with the finite differences method, we had to use much higher resolutions, Δx  =  0.016λ0, Δr = 0.16λ0 (red dashed curve).

Propagating in plasma, the laser excites the plasma wave, often refereed as a wake. When [formula], the produced wake is "linear", i.e. the density perturbations in electron plasma are very small, if compared to the plasma density. The laser-driven plasma waves have been extensively studied, and in the linear regime the generated electrostatic fields, aka wakefields, can be described analytically (cf [\cite=gorbunov:JETP1987]). From this linear theory, the longitudinal wakefield reads:

[formula]

where the electron plasma wavenumber is kpe  =  ωpe / c.

In , we map with colors the distribution of electrostatic field εx, which clearly corresponds to the plasma wave. The solid blue curve shows the field at the axis εx(x,r = 0), and it is compared to the estimate provided by shown by the dashed curve.

Laser plasma acceleration of electrons

For a more complex test, we model the acceleration of electrons from the underdense plasma by a few-mJ-few-cycle laser pulse. The practical interest to this mechanism is related to the recent idea of using the high repetition rate (kHz) laser for the sources of low energy femtosecond electron beams [\cite=beaurepaire:NJP2014]. Tightly focusing such a laser in a sub-millimeter short plasma, one produces a strong bubble-like wake along the laser Rayleigh length, which is only a few dozens of micrometers. To provide the electron injection into this wake, an abrupt change of the plasma density, so-called shock, is produced near the laser focus. Such interaction is rich with laser-plasma physics e.g. the laser-driven wakefield, which evolves from the linear to the bubble regime, laser self-focusing near the shock, and generation of the secondary wake by the accelerated beam.

In our test, we consider the pre-ionized plasma with the density profile, which grows linearly along first 300λ0 to reach its maximal value of nmax  =  0.005  nc, then rapidly falls to ne = 0.5  nmax over 15 λ0, and further remains constant. The Gaussian laser beam with a0  =  3, w0  =  4λ0, and lx  =  5λ0 is focused at the density peak at x = 300λ0. The interaction is visually demonstrated in , where the animation is provided by the graphical output from the PLARES-PIC simulation.

For a more detailed analysis, we have compared this simulation with the same test performed with CALDER-CIRC code. Note, that the group velocity of such a tightly focused laser differs significantly from the speed of light in vacuum, hence, the simulation is rather sensitive to the numerical dispersion. In PSATD simulation we consider the grid with Δx = 0.025λ0 and Δr = 0.25λ0, and the time step is Δt = Δx / c. To resolve correctly the laser propagation, and hence the electron injection, the FDTD simulation requires higher resolution, and we used Δx = 0.016λ0 and Δr = 0.16λ0, and the time step was Δt = 0.98  Δx / c.

In both simulations the structures of the plasma wakes are almost identical, while the accelerated beams differ significantly. To study this we select the electrons with γp > 8 (injected ones), and project their density onto the (x,r) and [formula] planes for the time 385λ0 / c after laser enters the plasma. In the right of we plot the (x,r) density profiles, and, while in PSATD beam has a clear structure with the injection signatures, in FDTD simulation the beam is blurred, and we see the small-scale density modulations near its front. These result from the artificial high-frequency electromagnetic waves, which in FDTD are significantly slowed by numerical diffraction, and are generated by the relativistic particles, in a way similar to the physical Cherenkov radiation in the dispersive media. The numerical Cherenkov effect, along with the errors of Lorentz force projection, are known to also increase beams emittance in the wakefield acceleration simulations [\cite=lehe:PRSTAB2013] [\cite=lehe:PRSTAB2014]. The particles transverse velocities FDTD is significantly affected by the numerical effects (see upper left of ), and for more of comparative analysis of the numerical effects in the quasi cylindrical FDTD and PSATD methods see [\cite=lehe:arxiv2015].

The electrons energy in FDTD simulation is slightly bigger than one in PSATD, as well as the full charge, which is 33 pC and 28 pC in the FDTD and spectral models respectively (for λ0 = 0.8μm). These differences can be attributed to the electron injection modeling, which in this test is very fast and is therefore very sensitive to the laser velocity.

Conclusions

We have developed and discussed a spectral quasi-cylindrical particle-in-cell method designed for plasma modeling. The proposed scheme is based on the pseudo-spectral analytical time domain method, and, in contrast to the commonly used finite-difference PIC schemes, it does not produce grid-related numerical dispersion of electromagnetic fields. Moreover, the electric and magnetic fields are not staggered, which significantly reduces the errors of the Lorentz force projection. This makes the proposed approach advantageous in a wide class of problems, where co-propagation of relativistic particles and light is involved, e.g. simulations of the wakefield accelerators.

The developed model was implemented in the code PLARES-PIC, which was tested and benchmarked against the quasi-cylindrical FDTD PIC code CALDER-CIRC. The new code has demonstrated capacity to accurately model the laser propagation in vacuum and in plasma, even with the spatial and temporal resolutions few times lower than in FDTD PIC. In the more complex test, we have simulated wakefield acceleration of electrons by a few-mJ-few-cycle laser in the configuration, where electrons are injected in the plasma density shock. The new spectral code has demonstrated a good agreement with the FDTD PIC, save for the numerical effects development in the latter.

The proposed method provides a principally new approach to three-dimensional modeling of plasma electrodynamics. Although the spectral transforms are computationally more demanding than conventional FDTD PIC, the natural accuracy of the spectral method and absence of the numerical dispersion, can often compensate the additional load by using lower temporal and spectral resolutions.

Acknowledgments

One of the authors (IAA) acknowledges the support of Victor Malka and Marie-Emmanuelle Couprie, and partial funding from their ERC programs X-Five (contract No. 339128) and COXINEL (contract No. 340015).

Supplementary Materials

In [\cite=plaresmovie], we use green colors to plot the electron density, and the colormap scales from the dark green at ne = 0 to the white at ne = 0.01  nc. The amplitude of the laser beam is mapped in semi-transparent red colors, and their colormap maximum is fixed at εz  =  3. The video is based on 665 images, which the graphical module of PLARES-PIC outputs each 30 time-steps.

Definition of Fourier-Bessel transform

The generalized Fourier-Bessel series consists of the cylindrical harmonics, [formula], where (x,r,θ) are the coordinates, Jm is the m-th order Bessel function, and parameters (kx,kr,m) are the coordinates in the spectral space. In the spectral transformation these harmonics are used to represent a function defined in a three-dimensional space as:

[formula]

where the discrete spectral domain K defines the possible wavenumbers [formula]. Practically, corresponds to the three transforms of the initial function: Fourier transform over the angle θ, Fourier transform over x-axis, and Hankel transform in the radial direction.

In the quasi-cylindrical PIC methods, the angular Fourier decomposition is considered at the particles positions [\cite=lifschitz:JCP2009]. This means, that the weight of each macro-particle is presented as [formula], and the components w(m)p are gathered on the grid separately, to obtain the azimuthal components of the charge density and current. When the angular components of the fields [formula] are calculated from electromagnetic equations, the total fields are projected onto the particles as, [formula] .

The spectral decomposition in (x,r)-space is done at the nodes of the grid via the consecutive discrete Fourier and Hankel transforms (DFT and DHT). For the DFT we use the fast Fourier transform (FFT), which operates on the uniform spatial and spectral grids, and involves only ~  Nx log Nx instead of the standard N2x-fold DFT matrix product. Note, that FFT naturally provides the periodic boundaries at x = 0 and x = NxΔx.

For the radial transforms, we define the matrices of the inverse Hankel transforms as, [formula], and consider the uniform spatial grid rj  =  jR / Nr, where j = 1,..,Nr are integers, and R is a radial boundary of the simulation domain. Note, that the radial grid is common for all modes, and the point r = 0 is excluded, so that the matrices for m > 0 will not be degenerate. In this case, the DHT matrix can be computed via the numerical inversion [formula].

The choice of the spectral grids k(m)r defines the properties of the radial boundaries for each azimuthal mode. We choose the radial boundary r = R, to satisfy the Dirichlet condition, [formula], for which k(m)r  =  u(m)j / R, where u(m)j are the zeros of Jm. In the continuous space, such choice provides the orthogonality of the Bessel terms, and assures the transforms reversibility.

Useful differential properties of Fourier-Bessel transform

Mathematical properties of the Fourier-Bessel series are well known, and here we briefly revise their main features used in our study. The differential properties of are defined by the basis functions [formula], [formula] and Jm(krr). It is easy to see that, cylindrical harmonics are the eigenfunctions of the Laplace operator, i.e.   =    -  ω2, where [formula].

Let us, construct the first-order differential operators for the Cartesian vector components. For this, we note that the derivative over the longitudinal coordinate is ∂x = ikx, and the transverse derivatives can be presented as,

[formula]

Using the properties of the Bessel functions, we calculate the components of the scalar function gradient as:

[formula]

where "*  " means matrix product, and the transformation matrices for the transverse derivatives are:

[formula]

In contrast to the ordinary Fourier series, the transverse derivatives in couple the azimuthal modes m with m + 1 and m - 1.

Linearly combining the transformation matrices, one can construct any necessary differential operatior. For example, for the spectral-spectral and real-spectral derivative projectors one should use the operators,

[formula]

and,

[formula]

respectively.

In our study, we use for spectral-real projection of the magnetic field, and another differential operator is constructed for the real-spectral projection of charge density n directly to its gradient [formula]. The spectral-spectral rot, div and grad operations are used for the current correction operations in and for magnetic field calculation .