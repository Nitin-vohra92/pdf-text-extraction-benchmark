Operation of a Brain-Computer Interface Walking Simulator by Users with Spinal Cord Injury

Keywords

Spinal cord injury, brain computer interface, virtual reality environment, electroencephalogram, kinesthetic motor imagery, gait, ambulation, locomotion.

Introduction

Spinal cord injury (SCI) can leave the affected individuals with paraparesis or paraplegia, thus rendering them unable to ambulate. Since there are currently no restorative treatments for this population, technological approaches have been sought to substitute for the lost motor functions. Examples include robotic exoskeletons [\cite=argo:10], functional electrical stimulation (FES) systems [\cite=dgraupe:98], and spinal cord stimulators [\cite=sharkema:11]. However, these systems lack the able-body-like supraspinal control, and so the ambulation function of these devices is controlled manually. In addition to being unintuitive, these systems may be costly and cumbersome to use, and therefore have not yet garnered popular appeal and adoption among potential SCI users. Due to these limitations, wheelchairs remain the primary means of mobility after SCI. Unfortunately, the extended reliance on wheelchairs typically lead to a wide variety of comorbidities that constitute the bulk of chronic SCI-related medical care costs [\cite=jkschmitt:03] [\cite=ssabharwal:03] [\cite=yzehnder:04] [\cite=mmpriebe:03]. Consequently, to address the above issues associated with the treatment of paraparesis and paraplegia after SCI, novel brain-controlled prostheses are currently being pursued [\cite=ptwang:10] [\cite=ptwang:12].

Recent results by our group [\cite=ptwang:10] [\cite=ptwang:12] suggest that an electroencephalogram (EEG) based brain-computer interface (BCI) controlled lower extremity prosthesis may be feasible. More specifically, these studies demonstrated the successful implementation of a BCI system that controls the ambulation of an avatar (a stand-in for a lower extremity prosthesis) within a virtual reality environment (VRE). By using a data-driven machine learning approach to decode the users' kinesthetic motor imageries (KMIs), this BCI-controlled walking simulator enabled a small group of subjects (one with paraplegia due to SCI [\cite=ptwang:12]) to achieve intuitive and purposeful BCI control after a short training session. While the single SCI subject outperformed most able-bodied subjects in this study, the operability of this system has not yet been tested in a SCI population. The successful implementation of the BCI-controlled walking simulator in a population of subjects with SCI will establish the feasibility of future BCI-controlled lower extremity prostheses and will represent an important step toward developing novel gait rehabilitation strategies for SCI.

Extending the application of the BCI-controlled walking simulator to a SCI population is faced with several problems. First, cortical reorganization, which is common after SCI [\cite=Cramer2005] [\cite=Sabbah2002] [\cite=Alkadhi2005] [\cite=Hotz-Boendermaker2008], may cause the cortical representation of walking KMI to vary vastly from one SCI subject to another. Second, this representation may dramatically evolve over time when SCI subjects are engaged in KMI training [\cite=Cramer2007]. Finally, subjects with SCI may interpret walking KMI either as motor imagery or as attempted walking, which in turn may result in multiple patterns of cortical activation across these individuals. Therefore, intuitive BCI operation under these conditions requires a system that can accommodate for the variations of brain physiology across SCI individuals, time, and strategies. To address these problems, we used a data-driven machine learning method to decode walking KMIs in a small population of SCI individuals. This approach enabled 5 subjects to achieve intuitive and self-paced operation of the BCI-controlled walking simulator after only minimal training. Furthermore, they were able to maintain this level of control over the course of several weeks.

Methods

Overview

The goal of this study was to determine if individuals with complete motor SCI can use intuitive control strategies to purposefully operate a BCI-controlled walking simulator. To achieve this goal, 5 subjects with SCI underwent a short training procedure where they performed alternating epochs of idling and walking KMI while their EEG were recorded. These training EEG data were then analyzed to build decoding models for subsequent online BCI operation. To ascertain purposeful BCI control, subjects then performed 5 sessions of an online BCI goal-oriented virtual walking task [\cite=ptwang:12]. This entire procedure was performed 5 times over the course of several weeks to determine if subjects' performances improved with additional practice.

Subject Recruitment

This study was approved by the University of California, Irvine Institutional Review Board. Four subjects with paraplegia and one with tetraplegia due to SCI were recruited via physician referral from the Long Beach Veterans Affairs Spinal Cord Injury Center and other SCI outreach programs. The subjects (see Table 1) gave their informed consent to participate in the study. Note that all subjects were BCI naïve and most of them performed the experimental procedures at a rate of once per week.

Data Acquisition

Each subject was positioned ~  0.8 to 1 m from a computer screen that displayed textual cues or the VRE. EEG were recorded using a 63-channel cap (Medi Factory, Heerlen, The Netherlands) with Ag-AgCl electrodes arranged according to the extended 10-20 International Standard. Conductive gel (Compumedics USA, Charlotte, NC) was applied to all electrodes and the 30-Hz impedances between each electrode and the reference electrode were maintained at <  10 KΩ by abrading the scalp with a blunt needle. The EEG signals were amplified and digitized (sampling rate: 256 Hz, resolution: 22 bits) using two linked NeXus-32 EEG bioamplifiers (MindMedia, Roermond-Herten, The Netherlands). These signals were then streamed in real-time to a computer, re-referenced in a common average mode, band-pass filtered (0.01-40 Hz), and subsequently analyzed. The above procedures were performed using custom-written MATLAB (MathWorks, Natick, MA) programs.

Training Procedure

To facilitate intuitive control of ambulation within in a VRE, a EEG decoding model was developed that differentiates between idling and walking KMI. To this end, training EEG data were acquired while subjects underwent 30-sec alternating epochs of idling and walking KMI over a 10-min session. Subjects were instructed to perform walking KMI and idling via automated textual cues displayed on the screen. For the walking KMI task, subjects were coached to vividly imagine themselves walking or to attempt to perform the cyclic (albeit ineffective) leg movements of walking. During this entire procedure, a computer labeling signal (to identify idling and walking KMI epochs) was recorded by an auxiliary data acquisition system (MP150, Biopac Systems, Goleta, CA), and a common pulse train sent to both EEG and auxiliary data systems was used to synchronize the EEG and labeling signals. Also, the subjects were asked to remain still during the entire procedure, and their movement was monitored by the experimenter. If consistent movements were observed, the subject was asked to repeat the entire training procedure without making the undesired movements.

Decoding Model Generation

Offline signal analysis to generate EEG decoding models was performed in a manner similar to Wang et al. [\cite=ptwang:12]. Briefly, EEG and labeling signals were first aligned and merged using the synchronization signal, and an iterative artifact rejection algorithm [\cite=ahdo:11] was used to exclude EEG channels with excessive electromyogram (EMG) artifacts from further analysis. The pre-processed EEG data were then split into segments of idling and walking KMI states using the labeling signal. Each EEG segment was then divided into 5 randomly spaced, non-overlapping 4-sec trials, which were then transformed into the frequency domain using the Fast Fourier Transform (FFT). Note that the remaining data in each segment were discarded. Finally, the power spectral density of each trial was integrated in 2-Hz bins, resulting in 20 binned power spectral values per channel.

Once the EEG segments were transformed into the frequency domain, a systematic search was performed to find the best contiguous frequency range for classification [\cite=ptwang:12]. The dimension of the input data was then reduced using classwise principal component analysis (CPCA) [\cite=Das2007] [\cite=kdas:09], and discriminating features were extracted using either Fisher's linear discriminant analysis (LDA) [\cite=roduda:01] or approximate information discriminant analysis (AIDA) [\cite=znenadic:07] [\cite=Das2008]. This resulted in the extraction of one-dimensional (1D) spatio-spectral features:

[formula]

where [formula] is a single-trial of EEG data with B frequency bins per channel and C retained EEG channels, [formula] is a piecewise linear mapping from the data space to an m-dimensional CPCA-subspace, and [formula] is a LDA or AIDA transformation matrix.

Once the single-trial data were reduced to 1D spatio-spectral features, a linear Bayesian classifier:

[formula]

was designed in the feature domain, where [formula] and [formula] are the posterior probabilities of idling and walking classes given the observed feature, [formula], respectively. Eq. ([\ref=eq:lrt]) can be read as: "classify [formula] as idle class if the posterior probability of idling is greater than the posterior probability of walking given the feature, [formula], and vice versa." The offline performance of the Bayesian classifier ([\ref=eq:lrt]), expressed as a classification accuracy, was then assessed by performing 10 runs of stratified 10-fold cross-validation (CV) [\cite=rkohavi:95]. To determine the optimal parameters for classification, the lower bound of the frequency range was then increased in 2-Hz steps, and this procedure was repeated until the classifier performance stopped improving, allowing the optimal lower frequency bound to be determined. The upper bound of the optimal frequency range was determined in a similar manner. The classification accuracy was also used to decide whether to use AIDA or LDA as a feature extraction technique. Finally, the parameters of the decoding model, including the optimal frequency range, the feature extraction mapping, and the classifier parameters, were saved for real-time EEG analysis.

Online Signal Analysis

During online operation, 0.5-sec long segments of EEG data were acquired in real time (at a rate of two segments per second), and were processed using the methods described in the section. Briefly, the EEG signals were first band-pass filtered, followed by automated artifact rejection. The pre-processed EEG data were then transformed into the frequency domain using FFT, and the power spectral densities over the optimal frequency range were calculated. These spectral data were used as an input for the feature extraction algorithm ([\ref=eq:features]). Finally, using Bayes' rule ([\ref=eq:lrt]), the posterior probabilities of idling and walking classes given the observed EEG feature, [formula], were calculated.

Online Calibration

Since the BCI system is a binary state machine with an idling and a walking state, a brief calibration procedure was required to identify the posterior probability thresholds to transition between these two states [\cite=ptwang:12]. Using the decoding model developed during the training procedure, the BCI system was set to run in the online mode while subjects were prompted to alternate between performing idling and walking KMI for ~  2 min. The posterior probabilities were recorded and their histograms were plotted to determine two thresholds, one to initiate the ambulation of the avatar, TW, and the other to stop the avatar, TI. These two thresholds were initially set as [formula] and [formula]. Then, a brief online test was performed and based on the subject's feedback, the thresholds were adjusted as necessary. During online BCI operation, the posterior probabilities [formula] corresponding to the most recent 1.5 sec of EEG data were averaged and compared to the thresholds TW and TI, and the state transitions were executed based on the finite state machine diagram given in Fig. 1. This step was implemented in order to smooth the sequence of posterior probabilities and reduce noisy state transitions.

BCI and Virtual Reality Environment Integration

Using a simulated physics environment (Half-Life 2 Garry's Mod, Valve Corporation, Bellevue, WA), a VRE was constructed to represent a flat grassland with 10 non-player characters (NPCs) arranged in a linear path in front of an avatar (see Fig. 2). During online evaluation, the subjects were assigned the task of utilizing idling and walking KMI to control the avatar's standing and walking, similar to [\cite=ptwang:10] [\cite=ptwang:12]. A virtual joystick program [\cite=DvanderWesthuysen:2011] was used to interface the BCI software (MATLAB) and the VRE to enable the BCI's control of the avatar's walking. Full details on this integration process can be found in Wang et al. [\cite=ptwang:12].

Online Performance and Assessment

To assess the online BCI performance, subjects were tasked to move the avatar within two body lengths of each NPC and remain idle at each location for at least 2 sec. On each experimental day, subjects repeated this task for 2-8 online sessions. This depended upon the subject's willingness and availability. In total, each subject underwent between 19 and 29 online sessions performed over 5 experimental days conducted over the course of several weeks. Two performance measures were recorded for each session: the number of successful stops at the NPCs and the time taken to complete the course. The successful stops were defined as follows. Subjects were given one point for dwelling at the designated stop for at least 2 sec, and a fraction of a point for dwelling at the designated stop for at least 0.5 sec. No point penalty was incurred for dwelling longer than 2 sec, but this inherently increased the time to completion. Thus, the maximum successful stop score was 10 points. In addition, subjects were given a 20-min time limit to complete the course. If the subject could not finish the course within 20 min, the trial was interrupted and the number of successful stops achieved thus far was recorded.

[formula]

where cs and ct are the normalized performance measures for the number of successful stops and completion times, respectively, i.e.

[formula]

Here, s is the subject's number of successful stops, [formula] is the maximum number of successful stops, t is the subject's completion time, [formula] sec is the maximum allowed time, and [formula] sec is the minimum time required to complete the course while achieving 10 successful stops. The values of cs and ct, and consequently c, range from 0 to 100%, where 100% corresponds to a perfect performance. Note that the use of the geometric mean favors a performance that is balanced over a performance that sacrifices one performance measure over the other (e.g. when a subject finishes the course in a short time while failing to make stops). Also note that the normalization of cs and ct ensures that the performance measures are unitless.

Results

Offline Performances

After subjects underwent the training data collection for each experimental day (see section), subject-specific EEG decoding models were generated as described in the  section. Cross-validation of these models resulted in offline classification accuracies that ranged from 60.5% to 92.3% (Table 2), with corresponding p-values between 0.018 and 10- 20, thus indicating that the classifier performances were well above the chance level (50%). In addition, the subjects' average offline performances over 5 experimental days were 82.3%, 71.8%, 82.3%, 82.5%, and 82.2%, respectively. Finally, the overall average for all 5 subjects across all 5 experimental days was 80.2% ±   8.62 (n = 25).

Spatio-spectral feature extraction maps generated from offline analysis, as described in the  section, revealed salient brain areas and frequency bands underlying idling and walking KMI for each subject. Qualitative analysis of these topographic maps revealed significant variations in the brain areas utilized by the subjects while performing this task. For example, Subject 2 used mostly the Cz area (Fig. 3), whereas Subject 5 used areas C3 and C4 (Fig. 4). Furthermore, the utilized brain areas and frequency bands evolved for each subject over the 5 experimental days. For example, Subject 2 had growing activation of mid-frontal areas up to experimental day 4, followed by a slight shrinkage on day 5. However, one consistent feature among all subjects was the activation of mid-frontal areas (over Cz or FCz and adjacent electrodes) mostly in the μ (8-12 Hz) and low β (12-16 Hz) bands.

Online Calibration

After the short calibration procedure (see in the Methods section), the state transition thresholds, TI and TW, were determined from the distributions of the posterior probabilities, [formula] (see Fig. 5 for an example), and their values are presented in Table 3. Note that in an ideal situation, [formula] and [formula] should cluster around 1 and 0, respectively, but as long as these probabilities are separable, online BCI control should be achievable. The values of TI and TW ranged from 0.07 to 0.70 and from 0.09 to 0.90, respectively, and the average across all subjects on all experimental days was 0.40 and 0.62 for TI and TW, respectively.

Online Performances

All subjects were able to achieve purposeful online control immediately (on day 1), with the exception of Subject 2 (on day 2). The online BCI performances upon achieving purposeful control are summarized in Table 4. The average stop score was 7.4 ±   2.3, and the average completion time was 273 ±   51 sec across all online sessions (n = 124). Note that minimal lapses in BCI control occurred, as only 5 out of 124 online sessions (~  4%) were non-purposeful. Examples of the best online performances for each subject are shown in Fig. 6 along with the simulated random walk PDFs. For additional comparison, the average performance achieved by a manually controlled physical joystick was 9.38 ±   0.95, and on their best day, Subjects 3, 4, and 5, achieved a similar number of successful stops; however, no subjects were able to complete the course as fast as manual control. A representative time-space course of an online session (see Fig. 7) shows only a single false alarm and a single omission. Also, a supplementary video showing a representative online session from Subject 3 is can be found at http://www.youtube.com/watch?v=K4Frq9pwAz8.

The composite scores were calculated from the online performance measures and are summarized in Table 5. In general, the performances improved significantly over time; the average on day 1 was 77.8% and the average on day 5 was 85.7% (p=  0.0302). For comparison, the composite score of the joystick task is also shown. On their best days, Subjects 3, 4 and 5 achieved performances similar to those of the manually controlled joystick, reaching nearly perfect performances (100%).

Discussion

The results of this study show that subjects with paraplegia or tetraplegia due to SCI can operate a non-invasive BCI-controlled avatar within a VRE to accomplish a goal-oriented ambulation task. All subjects gained purposeful online BCI control on the first day after undergoing a 10-min training session, with the exception of Subject 2, who did not attain control until day 2. In addition, BCI control was maintained and continued to improve over the course of the study. These findings suggest that a BCI-controlled lower extremity prosthesis for either gait rehabilitation or restoration may be feasible.

The offline classification accuracies varied across subjects and experimental days, but were significantly above the chance level performance (50%). Similar to able-bodied subjects engaged in the same task [\cite=ptwang:10] [\cite=ptwang:12], a short 10-min training session was sufficient for the data-driven machine learning algorithm to generate accurate subject-specific EEG decoding models for this population. The topographic maps of these models (e.g. Fig. 3 and Fig. 4) showed that the spatio-spectral features underlying the differences between walking and idling KMIs varied across subjects and evolved over experimental days. The differences in the brain areas and EEG frequencies across subjects may be due to variations in cortical reorganization following SCI [\cite=Cramer2005] [\cite=Sabbah2002] [\cite=Alkadhi2005] [\cite=Hotz-Boendermaker2008], or due to differences in imageries employed by each subject (e.g. the KMI of walking instructions may have been interpreted differently by each subject). Nevertheless, all subjects showed activation of mid-frontal areas, which likely overlay the pre-motor and supplementary motor areas, as well as the pre-frontal cortex. Their activation during walking KMI is consistent with functional imaging findings, such as those in [\cite=clafougere:10]. Another common pattern across subjects was the presence of activity near bilateral, lateral central-parietal electrodes, which likely represents the arm sensorimotor areas. A similar pattern was observed in able-bodied individuals [\cite=ptwang:12], and is hypothesized to originate from arm swing imagery. Finally, the evolution of the feature extraction maps over the 5 experimental days may be indicative of a neuro-plasticity process associated with practice and learning [\cite=nsward:03] [\cite=sjpage:09].

The spatio-temporal variations of walking KMI activation patterns demonstrate the necessity of a data-driven machine learning approach for rapid acquisition of intuitive BCI control. First, our approach accommodates for the variations of these activity patterns across subjects, as well as their evolution over time. Second, it facilitates rapid acquisition of online BCI control, presumably by enabling subjects to utilize intuitive mental strategies. The user training time necessary to acquire purposeful BCI control in this study is significantly shorter than those of other BCI studies where users must learn a completely new cognitive skill to modulate pre-selected EEG features, such as the μ-rhythm over lateral central areas [\cite=jrwolpaw:04]. Finally, this approach carries a significant potential value in the future practical implementation of BCI-prostheses, as it may drastically reduce the training time needed to attain purposeful and useful BCI control from a timescale of weeks to months to one of minutes to days. This in turn may significantly reduce the cost of training users to operate future BCI-prostheses.

The results presented in Table 4 show that once purposeful control was achieved, it was maintained in 96% of all online sessions. In addition, 3 out of 5 subjects achieved successful stop scores similar to those obtained using a manually controlled joystick. Even though no subjects were able to complete the course as fast as manual control, it is encouraging that the average composite scores increased significantly over the course of the study. Furthermore, the average composite scores (Table 5) improved over time, with the best scores approaching 100% for Subjects 3 and 5 by the end of the study. Therefore, not only was online control significantly different from random walk, but it was also meaningful. Given this trend, additional training and practice may help further improve performance, possibly to the point of approaching that of the manually controlled joystick. In conclusion, the high level of online control achieved by SCI subjects over the course of 5 experimental days suggests that it may be feasible to apply this BCI system to control a lower extremity prosthesis for ambulation after SCI. Furthermore, the proposed BCI-VRE system may serve as a training platform for operation of BCI lower extremity prostheses once they become widely available.

Conclusions

This study shows that SCI subjects can purposefully operate a self-paced BCI-VRE system in real time, and that the current BCI design approach is able to overcome the potential problems associated with variations in neurophysiology due to cortical reorganization after SCI, learning and plasticity processes, and differences in KMI strategies. Furthermore, the system satisfies the requirements of an ideal BCI-lower extremity prosthesis set forth in [\cite=ptwang:12], namely: intuitiveness, robustness, and short training time. The operation of the system is intuitive as it enabled subjects to use walking KMI to control the ambulation of the avatar. The system is robust in that the data-driven decoding methodology was able to successfully accommodate for subject-to-subject and day-to-day variations in the neurophysiological underpinnings of idling and walking KMI behaviors. In addition, subjects were able to maintain purposeful online control over the course of several weeks, further underscoring the system's robustness over time. Finally, the system required only a short training time, as BCI control was generally attained after only a 10-min training data collection procedure followed by a 2-min calibration session on the 1[formula] experimental day (for 4 out of the 5 subjects). The successful outcome of this study indicates that BCI-controlled lower extremity prostheses for gait rehabilitation or restoration after SCI may be feasible in the future.

List of abbreviations

SCI, Spinal cord injury; BCI, Brain-computer interface; VRE, Virtual reality environment; KMI, Kinesthetic motor imagery; EEG, Electroencephalogram; FES, Functional electrical stimulation; EMG, Electromyogram; FFT, Fast Fourier Transform; CPCA, Classwise principal component analysis; LDA, Fisher's linear discriminant analysis; AIDA, Approximate information discriminant analysis; 1D, One-dimensional; CV, Cross-validation; NPC, Non-player character; MC, Monte Carlo; PDF, Probability density function; ASIA, American Spinal Injury Association.

Competing interests

CEK received salary from HRL Laboratories, LLC (Malibu, CA). The remaining authors declare that they have no competing interests.

Author's contributions

CEK carried out the experiments, collected and analyzed the data, and wrote the article. PTW programmed the brain-computer interface software, assisted with carrying out the experiments, collecting the data, and analyzing the data. LAC contributed to conception of the study. AHD conceived and designed the study, implemented the VRE, recruited and consented subjects, supervised the experiments, and co-wrote and proofread the article. ZN conceived and designed the study, designed the signal processing, pattern recognition, and classification algorithms, and co-wrote and proofead the article. All authors read and approved the final manuscript.

Acknowledgments

This study was funded by the Roman Reed Spinal Cord Injury Research Fund of California (RR 08-258 and RR 10-281), and was partially funded by the Long Beach VA Advanced Fellowship Research Award.