On representing chemical environments

Introduction

The appropriate representation of atomic environments is a crucial ingredient of algorithms used in modern computational chemistry and condensed matter physics. For example, in structure search applications[\cite=Pickard:2008ty], each configuration depends numerically on the precise initial conditions and the path of the search, so it is important to be able to identify equivalent structures and detect similarities. In molecular dynamics simulations of phase transitions[\cite=Wales:2004vn], one needs good order parameters that are capable of detecting changes in the local order around atoms. Typically the representation is in terms of a descriptor (also called a fingerprint), a tuple of real valued functions of the atomic positions, e.g.  bond lengths, bond angles, etc. "In silico" drug discovery[\cite=Obrezanova:2007fz] [\cite=Segall:2011ke] and other areas of chemical informatics also rely on characterising molecules using descriptors. When constructing interatomic potentials and fitting potential energy surfaces (PES)[\cite=Behler:2007th] [\cite=Raff:2012vr] [\cite=Braams:2009tl] [\cite=Bartok:2010fj], the driving application behind the present work, the functional forms depend on components of a carefully chosen representation of atomic neighbourhoods.

While specifying the position of each atom in a Cartesian coordinate system provides a simple and unequivocal description of atomic configurations, it is not directly suitable for making comparisons between structures: the list of coordinates is ordered arbitrarily and two structures might be mapped to each other by a rotation, reflection or translation so that two different lists of atomic coordinates can, in fact, represent the same or very similar structures. A good representation is invariant with respect to permutational, rotational, reflectional and translational symmetries, while retaining the faithfulness of the Cartesian representation. In particular, a system of invariant descriptors [formula] is said to be complete if it uniquely determines the atomic environment, up to symmetries. It is said to be over-complete if it contains spurious descriptors in the sense that a proper subset of [formula] is, by itself, complete. If a representation is complete, then there is a one-to-one mapping (i.e. a bijection) between the genuinely different atomic environments and the invariant tuples comprising the representation. An over-complete representation assigns potentially many distinct descriptors to a given atomic structure, but guarantees that genuinely different atomic structures will never have identical descriptors associated with them: the function relating representations to atomic structures is a surjection.

Fitting potential energy surfaces (PESs) and electrostatic multipole moment surfaces of small molecules to data generated by first principles electronic structure calculations has been a mainstay of computational chemistry for decades [\cite=Tromans:1998ve] [\cite=Ischtwan:1994dj] [\cite=Collins:2002cq] [\cite=Ho:1996kf] [\cite=Maisuradze:2003kh] [\cite=Guo:2004kn] [\cite=Huang:2004ib] [\cite=Zhang:2006gd] [\cite=Blank:1995dy] [\cite=Gassner:1998tn] [\cite=Lorenz:2004eb] [\cite=Brown:2003tu] [\cite=Huang:2005ij] [\cite=Manzhos:2006fd] [\cite=Manzhos:2006jn] [\cite=Handley:2009wg] [\cite=Partridge:1997kh] [\cite=Tipping:1971ui] [\cite=Braams:2009tl] [\cite=Cencek:2008dc]. Typically, when modelling the PES of a small group of atoms, the list of pairwise distances is used or, equivalently, some transformed version of the interatomic distances, e.g. reciprocal[\cite=Raff:2012vr] or exponential[\cite=Braams:2009tl]. This description works when the number of atoms is fixed. Even in this case, a seemingly new configuration is obtained by just permuting the order of atoms, i.e. crucial symmetries may be missing in this framework. Braams and Bowman[\cite=Braams:2009tl] remedied this last shortcoming by using polynomials of pairwise distances, constructed such that each term is invariant to the permutation of identical atoms. Computer code is available that generates the permutationally invariant polynomials automatically[\cite=Braams:2009tl] (up to ten atoms), but this approach still does not allow for varying number of atoms in the database of configurations.

In order to generate interatomic potentials for solids or large clusters, capable of describing a wide variety of conditions, the number of neighbours that contribute to the energetics of an atom has to be allowed to vary, with the symmetry invariant descriptors remaining continuous and differentiable. Even though it is possible to allow the dimensionality M to change with the number of neighbours, for the purpose of function fitting it is more practical that M remains the same. None of the traditional representations fulfil this criterion. Recently, however, a number of new, promising descriptors have been proposed together with potential energy surfaces based on them [\cite=Behler:2007th] [\cite=ESanville:2008jt] [\cite=Bartok:2010fj] [\cite=Handley:2009wg] [\cite=Rupp:2012kx]. Behler and Parrinello's "symmetry functions"[\cite=Behler:2007th] were used to generate potentials for silicon[\cite=Behler:2008vo], sodium[\cite=Eshet:2012dz], zinc oxide[\cite=Artrith:2011em] and water[\cite=Morawietz:2012kt] amongst others; Bartok et al.  employed the bispectrum [\cite=Bartok:2010fj] to fit a many-body potential for crystalline phases and defects in diamond. Sanville et al.  used a subset of internal coordinates to fit silicon potentials [\cite=ESanville:2008jt]. Rupp et al.  used the ordered eigenvalues of the Coulomb-matrix to fit atomisation energies [\cite=Rupp:2012kx] of a set of over 7000 small organic molecules. At this point it is not clear which method of representing atomic neighbourhoods will prove to be optimal in the long term. We attempt to disentangle this issue from the rather complex details of generating first principles data and fitting PES, and separately consider the problem of constructing good descriptors.

The most well-known invariants describing atomic neighbourhoods are the bond-order parameters originally proposed by Steinhardt et al. [\cite=Steinhardt:1983uh] Here we show that the bond-order parameters form a subset of a more general set of invariants called the bispectrum[\cite=Kondor:2007wz]. The formally infinite array of bispectrum components provides an over-complete system of invariants, and by truncating it one obtains representations whose sensitivity can be refined at will. We relate the bispectrum to the representation proposed by Behler et al. [\cite=Behler:2007th] [\cite=Behler:2011it], and show that, together with another descriptor set described below, their angular parts are all simple polynomials of the same set of canonical invariants.

The paper is organised as follows. In section [\ref=sec:pes] we briefly recall how potential energy surfaces are constructed using invariant descriptors. In section [\ref=sec:descriptors] we describe a number of descriptors, starting with a simple distance metric between atomic configurations which will be used as a reference to assess the faithfulness of all other descriptors but which itself is not differentiable. In Section [\ref=sec:soap] we introduce a new, continuous and differentiable distance metric for constructing potential energy surfaces, called Smooth Overlap of Atomic Functions (SOAP), which has superior properties. In section [\ref=sec:results] we show numerical tests that help assess the degree of completeness and faithfulness of various descriptors and SOAP, and also show an explore their performance in fitting models for small silicon clusters and the bulk crystal.

Potential energy surface fitting

The main motivation behind this paper is to define and assess a family of invariant descriptors to be used for fitting interatomic potentials, or potential energy surfaces (PESs). In the construction of potentials for materials applications, the short range part of the total energy is decomposed into atomic contributions, where ε is the contribution of the nth atom, and [formula] is a system of descriptors characterizing the local atomic environment.

Traditionally, such atomic energy functions are defined in closed form. However, recently, there has been a lot of interest in using more flexible, nonparametric PESs, derived from computing the total energy and its derivatives at a certain set [formula] of "training" configurations using first principles calculations. A crucial question then is how to fit ε to the computed datapoints. The simplest approach is to use a linear fit, while Behler and Parrniello advocate using artificial neural networks (NN)[\cite=Behler:2007th], and Bartók et al. use Gaussian Approximation Potentials[\cite=Bartok:2010fj]. However, ultimately, each of these procedures result in a PES of the form

[formula]

where the coefficient vector [formula] is determined by the fitting procedure, and K is a fixed (nonlinear) function, called the kernel, whose role, intuitively, is to capture the degree of similarity between the atomic environments described by its two arguments. Clearly, then, the choice of descriptors, in particular, their invariance to symmetries, as well as the choice of kernel, are critical ingredients to obtaining good quality PESs.

In general, the kernel K can be interpreted as a covariance function, and therefore it must be symmetric and positive definite (meaning that [formula] and for any non-zero vector [formula] of coefficients, [formula]). Rasmussen and Williams[\cite=Williams:2007vz] present a number of such kernels, some of the simplest ones being the following.

The dot-product (DP) kernel is defined as

[formula]

which, when substituted into equation ([\ref=eq:GP_kernel]), results in

[formula]

i.e. the linear regression on the descriptor elements with coefficient vector [formula].

When using artificial neural networks with NH hidden units, the atomic energy function ε is given by

[formula]

where b is the bias, [formula] the vector of unit weights, h is the transfer function, and [formula] the unit parameters[\cite=Williams:2007vz]. In the limit of an infinite number of hidden units, for specific transfer functions it is possible to reformulate equation ([\ref=eq:NN]) in the form of equation ([\ref=eq:GP_kernel]) with well-defined covariance functions[\cite=Mackay:tw] [\cite=Williams:2007vz] [\cite=Neal:1995ws]. For example, for [formula] the corresponding kernel is[\cite=Neal:1995ws]

Finally, the squared exponential (SE) kernel that we have used in the past with the Gaussian Approximation Potentials[\cite=Bartok:2010fj] and in some of the examples below is

[formula]

Descriptors

Among the applications mentioned in the introduction, some require representing the geometry of an entire molecule, while for others one needs to describe the neighbourhood of an atom perhaps within a finite cutoff distance. While these two cases are closely related, the descriptors for one are not directly suitable for the other, although often the same idea can be used to derive representations for either case. Below, we focus on representing the neighbour environment of a single atom, but for some cases we briefly mention easy generalisations that yield global molecular descriptors.

For N neighbouring atomic position vectors [formula] taken relative to a central atom, the symmetric matrix

[formula]

is, according to Weyl[\cite=Weyl:1946wd], an over-complete array of basic invariants with respect to rotation, reflection and translation. However, Σ is not a suitable descriptor, because permutations of atoms change the order of rows and columns. For example, swapping atoms 1 and 2 results in the transformed matrix

[formula]

To compare two structures using their Weyl matrices Σ and Σ', we define a reference distance metric

[formula]

where [formula] is a permutation matrix and the minimisation is over all possible permutations. This metric is not differentiable at locations where the permutation that minimises ([\ref=eq:d_refp]) changes. It would also be intractable to calculate exactly for large numbers of atoms, but nevertheless we will use this metric to assess the faithfulness of other representations for a small system. Other, differentiable invariants shown later in this paper are, however, closely related to the elements of Σ.

One way to generate permutationally invariant differentiable functions of the Weyl matrix is to compute its eigenvalues; indeed, a very similar descriptor was recently used to fit the atomisation energies of a large set of molecules[\cite=Rupp:2012kx]. However, the list of eigenvalues is very far from being complete, since there are only N eigenvalues, whereas the dimensionality of the configuration space of N neighbour atoms is 3N - 3 (after the rotational symmetries are removed). It is also unclear how to make the descriptors based on the eigenspectrum continuous and differentiable as the number of neighbours varies.

The Z-matrix, or internal coordinates, is a customary set of rotationally invariant descriptors usually used to describe the geometry of entire molecules, but it is not invariant to permutations of atoms. The Z-matrix is complete, but in contrast to the Weyl matrix of basic invariants which are based solely on bond lengths and bond angles, it is a minimal set of descriptors that also contains some dihedral angles.

Another straightforward way to compare structures is based on pairing the atoms from each and finding the optimal rotation that brings the two structures into as close an alignment as possible. For each pair of structures [formula] and [formula], it is possible to order the atoms according to their distance from the central atom (or centre of mass, in case we want to compare entire molecules) and compute where R̂ represents an arbitrary rotation (including the possibility of a reflection). We can then define the distance between two configurations as

[formula]

This distance clearly has all the necessary invariances and completeness properties, but, like [formula], it is not suitable for parametrising potential energy surfaces, because it is again not differentiable: the reordering procedure and the minimisation over rotations and reflections introduce cusps.

In the field of molecular informatics, one popular descriptor is based on the histogram of pairwise atomic distances[\cite=Swamidass:2005jx], similar to Valle's crystal fingerprint[\cite=Valle:2010jt]. We will not consider these here, because they are unsuitable for fitting PES, as they are clearly not complete: e.g.  from six unordered distance values it is not necessarily possible to construct a unique tetrahedron, even though the number of degrees of freedom is also six. Figure [\ref=fgr:tetra12] shows two tetrahedra that were constructed such that the edges in each correspond to the same set of six distances. The tetrahedra are manifestly different, which can also be seen by comparing the lists of angles, shown in Table [\ref=tbl:tetra12].

Bond-order parameters

As a first step in deriving continuous invariant representations of atomic environments, we define the atomic neighbour density function associated with a given atom as

[formula]

where the index i runs over the neighbours of the atom within some cutoff distance, wZi is a unique weight factor assigned according to the atomic species of i, and [formula] is the vector from the central atom to neighbour i. For clarity, we will omit the species weights from now on, and assume a single atomic species, but none of our results rely on this. Determining which neighbours to include in the summation can be done by using a simple binary valued, or a smooth real valued cutoff function of the interatomic distance, or via a more sophisticated procedure, e.g.  Voronoi analysis[\cite=Steinhardt:1983uh]. The atomic neighbour density is already invariant to permuting neighbours, because changing the order of the atoms in the neighbour list only affects the order of the summation. To simplify the following derivation, for now we omit the information on the radial distance to the neighbours, but will show later how the radial information can be included. The atomic neighbour density function can then be expanded in terms of spherical harmonics:

[formula]

where [formula] is the point on the unit sphere corresponding to the direction of the vector [formula], thus ρ() is the projection of [formula] onto the unit sphere, S2.

The properties of functions defined on the unit sphere are related to the group theory of SO(3), the group of three dimensional rotations. Spherical harmonics form an orthonormal basis set for L2(S2), the class of square integrable functions on the sphere: where the inner product of functions f and g is defined as where the surface element [formula] can be expressed in terms of the polar angles θ and φ as and the coefficients clm are given by

[formula]

The quantities Qlm introduced by Steinhardt et al. [\cite=Steinhardt:1983uh] are proportional to the coefficients clm. Dividing by N, the number of neighbours of the atom (within a finite cut-off distance) provides the atomic order parameters

[formula]

Furthermore, averaging ([\ref=Qlmdef]) over atoms in the entire system gives a set of global order parameters where Nb is the total number of atom pairs included in the summation, and we wrote [formula] for the vector connecting atom i to its neighbour [formula]. Both sets are invariant to permutations of atoms and translations, but still depend on the orientation of the reference frame. However, rotationally invariant combinations can be constructed as

[formula]

for atomic neighbourhoods and

[formula]

for the entire structure. The factor in parentheses is the Wigner-3jm symbol[\cite=Varshalovich:1987ul], which is zero unless m1 + m2 + m3 = 0.

The numbers Ql and Wl are called second-order and third-order bond-order parameters, respectively. It is possible to normalise Wl such that it does not depend strongly on the number of neighbours:

For symmetry reasons, only coefficients with l  ≥  4 have non-zero values in environments with cubic symmetry and l  ≥  6 for environments with icosahedral symmetry. Different values correspond to crystalline materials with different symmetry, while the global order parameters vanish in disordered phases, such as liquids. Bond-order parameters were originally introduced for studying order in liquids and glasses[\cite=Steinhardt:1983uh], but were soon adopted for a wide range of applications. They have been used to study the free energy of clusters [\cite=Doye:1999jn] [\cite=Partay:2010cy], melting of quantum solids [\cite=Chakravarty:2000ek], nucleation[\cite=Mountain:1984il], as well as to serve as reaction coordinates in simulations of phase transitions[\cite=Duijneveldt:1992tg] [\cite=Hernandez:2007ta] and glasses[\cite=vanBlaaderen:1995th], and also to generate interatomic potentials [\cite=Biswas:1987vp].

The power spectrum

Using some basic concepts from representation theory, we now prove that the second-order bond-order parameters are indeed rotationally invariant, then we show a more general set of third order invariants,[\cite=Kondor:2007wz] of which the Qs and the Ws are a subset. An arbitrary rotation R̂ operating on a spherical harmonic function Ylm transforms it into a linear combination of spherical harmonics with the same l index: where the [formula] matrices are known as the Wigner matrices, which form the irreducible representations of the three dimensional rotation group, SO(3). The elements of the Wigner matrices are given by

[formula]

It follows that the rotation operator R̂ acts on the function ρ as

[formula]

thus the column vector [formula] of expansion coefficients transforms under rotation as

Making use of the fact that rotations are unitary operations on L2(S2), it is possible to show that the matrices [formula] are unitary, and therefore [formula] transforms according to

[formula]

i.e. is invariant under rotation. We call pl the rotational power spectrum due to the analogy with the familiar power spectrum of ordinary Fourier analysis.

We also note that the elements of [formula] transform under reflection about the origin as

[formula]

thus the power spectrum is also invariant to this symmetry operation. A comparison with equations ([\ref=clmdef]), ([\ref=Qlmdef]) and ([\ref=Qldef]) shows that the second-order bond-order parameters are related to the power spectrum via the simple scaling

The power spectrum is clearly not a complete descriptor for a general function f() on the sphere, for example consider the two different functions and which both have the same power spectrum, p2 = 2 and p3 = 2 (with all other components equal to zero). However, for the restricted class of functions which are sums of a limited number of delta functions (such as the atomic neighbour density ρ in equation ([\ref=eq:atomic_density])), the power spectrum elements turn out to be polynomials of the basic invariants of Weyl. Using numerical experiments we demonstrate in section [\ref=sec:results] that for a fixed number of neighbours a certain set of power spectrum components is likely to be over-complete.

The bispectrum

We generalise the concept of the power spectrum to obtain a larger set of invariants via coupling different angular momentum channels[\cite=Kondor:2007wz] [\cite=Kakarala:1992]. Let us consider the direct product [formula], which transforms under a rotation as It follows from the representation theory of compact groups that the direct product of two irreducible representations can be decomposed into a direct sum of irreducible representations[\cite=Maschke:1898uy]. In case of the SO(3) group, the direct product of two Wigner matrices can be decomposed into a direct sum of Wigner matrices,

[formula]

where Cl  l1l2mm1m2 denote the Clebsch-Gordan coefficients or, using more compact notation,

[formula]

where [formula] denote the matrices formed of the Clebsch-Gordan coefficients. These are themselves unitary, so the vector [formula] transforms as

[formula]

Writing out the block diagonal matrix in the square brackets as we see that each block selects a particular slice of the vector in equation ([\ref=eq:cg_times_direct]), which transforms according to a given [formula] matrix. We give a new symbol to these slices, [formula], so that the original vector is their direct sum and each [formula] transforms under rotation as

Analogously to the power spectrum, we can now define the bispectrum as the collection of scalars which are invariant to rotations: It follows from equation ([\ref=eq:c_reflect]) that those elements of the bispectrum where l1 + l2 + l is odd change sign under reflection about the origin. If invariance to reflection is required, we take the absolute value of these components or omit them from the descriptor.

Rewriting the bispectrum formula as

[formula]

the similarity to the third-order bond-order parameters becomes apparent. Indeed, the Wigner 3jm-symbols are related to the Clebsch-Gordan coefficients through

[formula]

and by substituting the spherical harmonics identity Ylm  =  ( - 1)mY*l - m in equation ([\ref=Qlmdef]) it follows that

[formula]

Substituting the identities ([\ref=eq:wigner3jm_CG]) and ([\ref=eq:qlm_identity]) into the definition ([\ref=Wldef]) we obtain

[formula]

thus the third-order parameters Wl are seen to be proportional to the diagonal elements of the bispectrum, bl  l  l. Noting that [formula], the coefficient c00 is the number of neighbours N, and using Cl  0  l2m  0  m2  =  δl  l2δmm2, the bispectrum elements l1 = 0, l = l2 are identical to the previously introduced power spectrum components:

[formula]

therefore,

[formula]

The first few terms of the power spectrum and bispectrum for an atom with three neighbours are shown below, where [formula] is the angle between the bonds to neighbours i and [formula], and the sums are over all the neighbours.

[formula]

[formula]

Radial basis

Thus far we neglected the distance of neighbouring atoms from the central atom by using the unit-sphere projection of the atomic environment. One way to introduce radial information is to complement the spherical harmonics basis in equation ([\ref=eq:rho_expand]) with radial basis functions gn[\cite=Taylor:2009em],

[formula]

If the set of radial basis functions is not orthonormal, i.e. 〈gn|gm〉  =  Snm  ≠  δnm, after obtaining the coefficients c'nlm with the elements cnlm are given by In practice, when constructing the bispectrum, either c'nlm or cnlm can be used.

Rotational invariance must only apply globally, and not to each radial basis separately, therefore the angular momentum channels corresponding to different radial basis functions need to be coupled. So, although extending equations ([\ref=eq:power_spectrum]) and ([\ref=eq:bispectrum_so3]) simply as

[formula]

provides a set of invariants describing the three-dimensional neighbourhood of the atom, this can easily lead to a poor representation if the radial basis functions do not sufficiently overlap. The different radial shells will only be weakly coupled, and the representation will have spurious quasi-invariances to rotating subsets of atoms at approximately the same distance, as illustrated in Figure [\ref=fig:radial_gauss].

To avoid this, it is necessary to choose basis functions that are sensitive over a wide range of distances, although this may reduce the sensitivity of each radial basis function, because they are varying very slowly. The fine-tuning of the basis set is rather arbitrary, and there is no guarantee that a choice exists that is optimal or even satisfactory for all systems of interest.

We suggest constructing radial functions from cubic and higher order polynomials, [formula] for [formula], normalised on the range [formula] using

The orthonormalised construction

[formula]

guarantees that each radial function returns smoothly to zero at the cutoff with both the first and the second derivative equal to zero. The matrix [formula] of linear combination coefficients is obtained from the overlap matrix as

Another way to avoid radial decoupling is to define the rotational invariants in such a way that they couple different radial channels explicitly, for example, as

[formula]

Here, each invariant has contributions from two different radial basis channels, and so we ensure that they cannot become decoupled, but at the price of increasing the number of invariants quadratically or even cubically in the number of radial basis functions used.

4-dimensional power spectrum and bispectrum

We now present an alternative to the SO(3) power spectrum and bispectrum that does not need the explicit introduction of a radial basis set, but still represents atomic neighbourhoods in three-dimensional space. We start by projecting the atomic neighbourhood density within a cutoff radius [formula] onto the surface of the four-dimensional sphere S3 with radius r0. The surface of S3 is defined as the set of points [formula], where s21 + s22 + s23 + s24 = r20, while the polar angles φ, θ and θ0 of [formula] are defined so that We choose to use the projection where [formula] is a parameter, thus rotations in three-dimensional space correspond to a subset of rotations in four-dimensional space. This projection is somewhat similar to a Riemann projection, except in that case θ0 would be defined as implying In contrast to the Riemann projection, our choice of θ0 allows more sensitive representation of the entire radial range. The limit [formula] projects each atom at the cutoff distance to the South pole of the 4-dimensional sphere, thus losing all angular information. Too large an r0 would project all positions onto a small surface area of the sphere around the North pole, requiring a large number of basis functions to represent the atomic environment. In practice, a large range of r0 values works well, in particular, we used [formula].

To illustrate the procedure, Figure [\ref=fig:riemann] shows the Riemann projections for one and two dimensions, which can be easily drawn.

An arbitrary function ρ defined on the surface of a 4D sphere can be numerically represented using the hyperspherical harmonic functions Ujm'm(φ,θ,θ0)[\cite=Meremianin:2006gs] [\cite=Varshalovich:1987ul]:

[formula]

which, in fact, correspond to individual matrix components of the Wigner (i.e. rotational) matrices, as defined in equation ([\ref=eq:wigner]). In this case the arguments represent a rotation by θ0 around the vector pointing in the (φ,θ) direction, which can be transformed to the conventional Euler-angles, and j takes half-integer values.

The hyperspherical harmonics form an orthonormal basis for L2(S3), thus the expansion coefficients cjm'm can be calculated via where 〈.|.〉 denotes the inner product defined on the four-dimensional hypersphere:

[formula]

Although the coefficients cjm'm have two indices besides j, for each j it is convenient to collect them into a single vector [formula]. Similarly to the three-dimensional case, rotations act on the hyperspherical harmonic functions as where the matrix elements Rjm1'm1m2'm2 are given by Hence the rotation R̂ acting on ρ transforms the coefficient vectors [formula] according to The unitary [formula] matrices are the SO(4) analogues of the Wigner-matrices [formula] of the SO(3) case above, and it can be shown that the direct product of the four-dimensional rotation matrices decomposes according to which is the 4-dimensional analogue of equation ([\ref=eq:cross_wigner_compact]). The coupling constants [formula], or Clebsch-Gordan coefficients of SO(4) are[\cite=Meremianin:2006gs] [\cite=Caprio:2010ho] The rest of the derivation continues analogously to the 3D case, and finally we arrive at the expression for the SO(4) bispectrum elements

[formula]

while the SO(4) power spectrum is

The SO(4) bispectrum is invariant to rotations of four-dimensional space, which include three-dimensional rotations. However, there are additional rotations, associated with the third polar angle θ0, which, in our case, represents the radial information. In order to eliminate the unphysical invariance with respect to rotations along the third polar angle, we modify the atomic density as i.e. we add the central atom -- with the coordinates (0,0,0) -- as a fixed reference point, anchoring the neighbourhood. The resulting invariants Bj  j1j2 have only three indices, but contain both radial and angular information, and have the required symmetry properties. There are no adjustable parameters in the definition of these invariants, apart from the projection parameter r0 discussed above.

The number of components in the truncated representation depends on the band limit [formula] in the expansion ([\ref=eq:hyper_expansion]). For symmetry reasons, the bispectrum components with non-integer j1 + j2 + j change sign under reflection and, because of this reason, we omitted them. Just as in the 3D case, the representation is probably over-complete, i.e. most of the bispectrum components are redundant. To reduce the number of redundant elements, we only used the 'diagonal' components, i.e. j1 = j2. Table [\ref=tbl:num_bisp] shows the number of bispectrum elements for increasing band limit values.

Parrinello-Behler descriptor

We include in the tests below the descriptor suggested by Parrinello and Behler[\cite=Behler:2007th] using the parameters published recently [\cite=Artrith:2012fw] (and henceforth termed PB). The two- and three-body symmetry functions (in their terminology) are, and

[formula]

where the cutoff function is defined as Different values of the parameters η,Rs,ζ,λ can be used to generate an arbitrary number of invariants.

Angular Fourier Series

Notice that the angular part of the power spectrum, bispectrum (section [\ref=sec:bispectrum]) and the descriptors defined by Parrinello and Behler (section [\ref=subsection:pb]) are all simple polynomials of the canonical set [formula] for integer m, which, in turn, are sums of powers of the basic invariants of Weyl. We include in the tests in the next section a further descriptor set, which we call the Angular Fourier Series (AFS) descriptor, formed by a system of orthogonal polynomials of the basic invariants, conveniently chosen as the Chebyshev-polynomials Tl(x), as and incorporate the radial information using the basis functions defined in equation ([\ref=eq:afs_radial]), leading to

A similarity measure between atomic environments

It is clear from the preceding section that there is a lot of freedom in constructing descriptors, e.g. in the choice of angular band limit, the radial basis and also which subset of the basis elements are actually used. As we have shown in section [\ref=sec:pes], the key to PES fitting are not the descriptors per se, but the similarity measure [formula] that is constructed from the descriptors. This suggests an alternative approach, in which descriptors are bypassed altogether, and a similarity measure between atomic neighbourhoods is constructed directly. The criteria for a good similarity measure is not only that it be invariant to symmetry operations of the atoms of each environment and have a well-defined limit when comparing two identical or two very different environments, but also that the it change smoothly with the Cartesian atomic coordinates.

We define the similarity of two atomic environments directly as the inner product of two atomic neighbour densities ρ and [formula] (defined in equation ([\ref=eq:atomic_density])), as the overlap

[formula]

This clearly satisfies the permutational invariance criterion. Integrating equation ([\ref=eq:similarity_rhoi_rhoj]) over all possible rotations of one of the environments leads to a rotationally invariant similarity kernel

[formula]

It is easy to see that for n = 1, all angular information - the relative orientation of individual atoms - is lost because the order of the two integrations can be exchanged, but for n  ≥  2 the kernel retains the angular information of the original environments. The obvious practical difficulty with this construction is the evaluation of the angular integral, which is addressed next.

Analytic evaluation a smooth similarity kernel

Retaining the Dirac-delta functions in the definition of the atomic neighbour density would lead to a discontinuous similarity kernel in that the dissimilarity between two environments with very close but not identical atomic positions would be large. Therefore, instead of the Dirac-delta functions, we construct the atomic neighbour density using Gaussians, expanded in terms of spherical harmonic functions as [\cite=Kaufmann:1989tq]

[formula]

where ιl are the modified spherical Bessel functions of the first kind. The atomic neighbour density function is then defined as a sum of Gaussians with one centred on each neighbour,

[formula]

where

The overlap between an atomic environment (unprimed) and a rotated environment (primed) is where the integral of the coefficients is

[formula]

and

[formula]

The rotationally invariant kernel with n = 2 then becomes

[formula]

where we used the orthogonality of the Wigner-matrices. Although in practice we always use n = 2, it is easy to derive the kernel for any arbitrary order n using the Clebsch-Gordan series in equation ([\ref=eq:CG_series]). For n = 3, using the fact that S, as defined in equation ([\ref=eq:similarity_rhoi_rhoj]) is real and positive, which can be shown to be

[formula]

Raising a positive definite function to a positive integer power yields a function that is similarly positive definite. In our context, raising k to some power ζ  ≥  2 has the effect of accentuating the sensitivity of the kernel to changing the atomic positions, which we generally found to be advantageous in experiments. Therefore, following normalization by dividing by [formula], we define the general form of what we call the Smooth Overlap of Atomic Positions (SOAP) kernel as

[formula]

where ζ is any positive integer.

Radial basis and relation to spectra

Note that [formula] needs to be computed for each pair of neighbours, which can become expensive for a large number of neighbours. If we expand equation ([\ref=eq:expexpansion]) using radial basis functions gn(r), the atomic neighbour density function becomes

[formula]

and similarly, the [formula] environment is expanded using coefficients [formula]. If the radial basis functions form an orthonormal basis, i.e. the sum in equation ([\ref=eq:integral_ilmm]) becomes

[formula]

The significance of this result becomes apparent when substituting equation ([\ref=eq:integral_rad]) into equation ([\ref=eq:kernel_ilmm]) to obtain

[formula]

since

[formula]

is exactly the power spectrum (cf.  equation ([\ref=eq:pnnl])), and, analogously, [formula] is the power spectrum of the primed environment. Furthermore, the kernel in equation ([\ref=eq:kernel_power]) is the dot-product of the power spectra, cf.  equation ([\ref=eq:dp-kernel]). Analogously, the kernel for n = 3, defined in equation ([\ref=eq:kernel_third]), can be expressed as

[formula]

where cf.  equation ([\ref=eq:bispectrum_so3]), and [formula] is analogously the bispectrum of the primed environment. In Figure [\ref=fgr:soap_convergence] we show the convergence of the similarity kernel ([\ref=eq:kernel_power]) with increasing number of angular and radial basis functions in the expansion.

In this section we started out by taking a different approach to the problem of comparing neighbour environments, defining the SOAP similarity kernel ([\ref=eq:similarity_kernel]) directly, rather than going via a descriptor. Equations ([\ref=eq:kernel_power]) and ([\ref=eq:kernel_bispectrum]), however, reveal the relation between SOAP and the SO(3) power spectrum and bispectrum: SOAP is equivalent to using the SO(3) power or bispectrum descriptor together with Gaussian atomic neighbour density contributions and a dot product covariance kernel. The advantage of SOAP over the previous descriptors is that it eliminates some of the ad hoc choices that were needed before, while retaining control over the smoothness of the similarity measure using α, the width of the Gaussians in defining the atomic neighbourhood density in equation ([\ref=eq:expexpansion]) and its sensitivity using the exponent ζ in equation ([\ref=eq:similarity_kernel]).

Numerical results

We have derived methods to transform atomic neighbourhoods to descriptors that are invariant under the required symmetry operators, however, their relative merit for fitting potential energy surfaces remains to be seen. The faithfulness of the representation, i.e. that no genuinely different configurations should map onto the same descriptor, is of particular interest. As the inverse transformation from the descriptor to atomic coordinates -- apart from the simplest cases -- is not available, we describe numerical experiments in which we attempt to reconstruct atomic coordinates from descriptors, up to rotations, reflections and permutations. Descriptors which severely fail in this test are unlikely to be good for fitting potential energy surfaces, because entire manifolds of neighbour environments that are genuinely different with widely varying true energies will be assigned the same descriptor, resulting in fitted PES with many degenerate modes. We compare and test the performance of the various descriptors by generating potential energy surfaces for silicon clusters and the bulk crystal using our Gaussian Approximation Potentials framework[\cite=Bartok:2010fj].

Reconstruction experiments

Recall that the elements [formula] of Σ defined in equation ([\ref=eq:rirj]) are an over-complete set of basic invariants, which, in the case of atoms scattered on the surface of a unit sphere ([formula]), are the cosines of the bond angles, [formula]. Thus, the angular part of all descriptors in section [\ref=sec:descriptors] are permutationally invariant functions of the basic invariants in Σ, and depending on the actual number of descriptor elements used, they may form an incomplete, complete or over-complete representation of the atomic environment. In practice, one would like to use as few descriptors as possible, partly due to computational cost, but also because descriptors that use high exponents of the angles are likely to lead to less smooth PESs, as will be shown below.

Given N neighbours, the number of independent degrees of freedom in the neighbourhood configuration is 3N - 3, so we need at most this many algebraically independent descriptor elements. But because the algebraic dependency relationships between the descriptor elements is in general complicated, it is unclear how many descriptor elements are actually needed in order to make the descriptor complete and thus able to uniquely specify an atomic environment of the N neighbours. However, it is possible to conduct numerical experiments in which we compare the descriptors of a fixed target with that of a candidate structure and minimise the difference with respect to the atomic coordinates of the candidate. In this way we determine if a representation is likely to be complete or not, and in the latter case to characterise the degree of its faithfulness.

Descriptor matching procedure.

The global minimum of the descriptor difference between the target and the candidate is zero and is always attained on a manifold due to the symmetries built into the descriptors, but for an incomplete descriptor, many inequivalent structures will also appear equivalent, thus enlarging the dimensionality of the global minimum manifold. Furthermore, it can be expected that the descriptor difference function has a number of local minima.

In our experiments we tried to recover a given target structure after randomising its atomic coordinates. For each n (4  ≤  n  ≤  19) we used 10 different n clusters as targets, obtained from a tight-binding[\cite=Porezag:1995tk] molecular dynamics trajectory run at a temperature of 2000 K. For each target cluster, we selected one atom as the origin, randomised the positions of its neighbours by some amount, and then tried to reconstruct the original structure by minimising the magnitude of the difference between the descriptors of the fixed target and the candidate as the atomic positions of the latter were varied.

In contrast to a general global minimum search problem, we have the advantage of knowing the target value of the objective function at the global minimum. Also, the motivation of our experiments is to find at least one configuration, if it exists, that is genuinely different from the target, but where the descriptors match within a pre-defined numerical tolerance. Thus it is sufficient to perform local, gradient-based optimisations starting from random configurations, and reject all local minima (by noting the small gradient of the objective function while the value of the objective function is not small) until we find one where the objective function -- the difference in the descriptors -- is less than than the specified tolerance. If the configuration thus obtained is genuinely different from the target, the descriptor is shown to be incomplete.

In order to assess the success of the reconstruction procedure (i.e. whether the target and candidate configurations are genuinely different or not) we employed the reference measures defined in equations ([\ref=eq:d_refp]) and ([\ref=eq:d_refr]). However, in some cases it was difficult or impossible to find the right rotation R̂ in ([\ref=eq:d_refr]), whereas [formula] in ([\ref=eq:d_refp]) proved reliable. For each [formula], an initial [formula] was generated by ordering the atoms according to their distances from the central atom, then the optimal permutation was found using a simple random search in the space of permutations.

We minimised the difference between the target and candidate descriptors in the space of atomic coordinates of the latter using the Conjugate Gradients algorithm, stopping the minimisation when either the gradient or the reference distance [formula] became smaller than 10- 8Å2 and 10- 2Å2, respectively. In order to ensure that structures deemed non-equivalent by [formula]Å2 were genuinely different, we cross-checked them by noting the value of Δ from equation ([\ref=eq:d_refr]) and also employing the atomic fingerprints suggested by Oganov and Valle[\cite=Valle:2010jt]. To give a sense of the typical magnitude of the [formula] measure, the actual difference in terms of atomic distances between two example structures is shown in Figure [\ref=fgr:dref].

In the first set of reconstruction experiments, in order to provide a fair comparison, the truncation of the formally infinite set of descriptors was chosen in such a way that the finite descriptors had roughly equal numbers of components: 51 in total for the SO(3) bispectrum and PB descriptors and 50 for the AFS and SO(3) power spectrum. This corresponds to a truncation of the SO(4) bispectrum with [formula] (the factor of 2 on account of the half-integer nature of j), the SO(3) bispectrum with [formula] and [formula], the PB descriptor with its published parameters[\cite=Artrith:2012fw] and the AFS and SO(3) power spectrum using [formula] and [formula]. We note that in case of the PB descriptor the band limit of the angular descriptors (corresponding to our [formula] or [formula]) was [formula] and only the values ζ = 1,2,4,16 are used.

Figure [\ref=fgr:reconstruct_0216] shows the quality of reconstruction for different cluster sizes, based on the PB, AFS, SO(3) power spectrum, SO(3) bispectrum and SO(4) bispectrum as given by the reference distance [formula] achieved, averaged over 10 reconstruction trials for each cluster size n. The general trend is the same for all descriptors: as the number of neighbours increases, the average [formula] increases, and thus the faithfulness of the reconstruction decreases. Noting that the stopping criterion for the reconstruction process was [formula]Å2, larger randomisation of the initial atomic coordinates (bottom panel) reveals the poor representation power for all descriptors using this parameter set for n  >  10, and the neighbour configuration becomes impossible to determine from the descriptor.

The poor quality of representation is partly attributable to the decrease in sensitivity to the positions of atoms near the cutoff. For example, Figure [\ref=fgr:dref_bisp] shows two Si8 clusters for which none of the descriptors lead to perfect reconstructions (resulting in the observed peak on Figure [\ref=fgr:reconstruct_0216]). The atom marked A in the figure is within the 6Å cutoff, but close to it. In order to separate out this effect, we repeated the reconstruction experiments with a radial cutoff of 9Å (omitting the PB descriptor now since there is no published parameter set for this cutoff). The results are shown in Figure [\ref=fgr:reconstruct_9A] for the larger initial randomisation. The peak near n = 8 is now absent, and the transition from faithful reconstruction (for n  ≤  9 for the SO(3) power spectrum and AFS, and for n  ≤  12 for the SO(4) bispectrum) to failure for larger n is much clearer.

Since all the descriptors are likely to be over-complete when the infinite series of the basis set expansion is not truncated, the reconstruction quality is expected to increase with increasing descriptor length. To verify this, Figure [\ref=fgr:afs_conv] shows the reconstruction quality of the AFS descriptor for varying truncations of the angular part of the basis set. The representation becomes monotonically better for higher angular resolutions. However, this comes at the price of introducing ever more highly oscillating basis functions, which might be less and less suitable for fitting generally smooth potential energy surfaces.

Figure [\ref=fgr:afs_conv] also shows the achieved reference values when using the SOAP similarity measure. In this case, rather than minimising the difference between descriptors, we optimised the candidate structure until its normalised similarity to the target as given by equation ([\ref=eq:similarity_kernel]) was as close to unity as possible. In contrast to the other descriptors, SOAP with the modest band limit of [formula] performs perfectly for all structures, without showing any degradation for larger numbers of neighbours.

To verify that the above results are not affected by artefacts of the minimisation procedure, e.g.  getting stuck, Figure [\ref=fgr:convergence] shows the convergence of the reference measure [formula] during a minimisation as well as the corresponding convergence of the target function (the difference between the target and candidate descriptors). There was no difficulty in converging the target function to zero (the global minimum) for any of the complete (or over-complete) descriptors or SOAP, while the reference similarity converged to a non-zero value for incomplete descriptors.

Gaussian Approximation Potentials

Our main motivation for assessing different approaches to representing atomic neighbour environments is to determine their efficacy for generating interatomic potentials. Therefore, as a final test, we fitted a series of interatomic potentials for 3 - 19, based on different descriptors, using our Gaussian Approximation Potential (GAP) framework[\cite=Bartok:2010fj]. The training and the testing configurations were obtained from tight-binding[\cite=Porezag:1995tk] molecular dynamics trajectories run at the temperatures between 500 K and 2000 K. We used four sets of cluster configurations, containing 2000, 4000, 6000 and 8000 atomic environments for the training, corresponding to a total of 180, 360, 540 and 720 unique cluster configurations, respectively. The test set contained 12000 atomic environments, independent from those used in the fitting procedure.

We tested AFS, the SO(3) power spectrum and the SO(4) bispectrum using the squared exponential covariance kernel ([\ref=eq:sekernel]) as well as SOAP for potential fitting. The accuracy of the resulting potential energy surfaces is shown in Table [\ref=tbl:GAP] as a function of the angular band limit, and in Figure [\ref=fgr:teach_fcorr] as a function of the database size. Both demonstrate that SOAP outperforms the other descriptors. As can be expected from the reconstruction tests (cf.  Figure [\ref=fgr:afs_conv]) the fit gets better with all descriptors when a larger angular resolution is used, with the error not yet saturated for [formula]. Similarly, increasing the database size makes the fit more accurate, and one can expect improvement if even more than 8000 atomic environments are used (this corresponds to, on average, just 40 configurations for each cluster size).

Perhaps contrary to initial expectations, making all the descriptors more faithful by using a larger angular band limit is not necessarily beneficial. Descriptor components corresponding to high angular momentum channels involve angular basis functions that are highly oscillatory, and can thus degrade the fitted potential energy surface. To demonstrate this, we constructed a GAP model for bulk silicon using a database of configurations with randomly displaced atoms in randomly distorted unit cells, containing two atoms. Figure [\ref=fgr:cij] shows the elastic constants of the GAP fits as a function of the angular band limit for SOAP and the SO(4) bispectrum descriptor (which performed the best in our reconstruction and cluster PES tests compared to the other descriptors). In case of the bispectrum, the elastic constants of the model improve up to [formula], but then deteriorate dramatically, irrespective of the database size. SOAP does not show this behaviour, and leads to reasonable elastic constants using the smaller database, and is already well converged for [formula] using the larger database. Given the view of SOAP as an SO(3) power spectrum, it appears that the benefit comes from the combination of building the atomic neighbourhood density from smooth Gaussians and using the dot product kernel -- both directly linked to the construction of SOAP as a smooth similarity measure -- in contrast to using Dirac-delta functions for the density and a squared exponential kernel for the other descriptors.

Conclusion

In this paper we discussed a number of approaches to representing atomic neighbour environments within a finite cutoff such that the representation is a continuous and differentiable function of the atomic positions and is invariant to global rotations, reflections, and permutations of atoms. We showed that the Steinhardt bond-order parameters are equivalent to certain elements of the SO(3) angular power spectrum and bispectrum. To incorporate radial information, and therefore provide a full description of the atomic neighbour environment, we reviewed the construction of the SO(4) power spectrum and bispectrum as an alternative to introducing explicit radial basis functions. We also demonstrated that all these constructs, as well as the descriptors suggested by Parrinello and Behler, use very similar terms and form part of a general family that is based on the bond angles. In practice, when the expansion is truncated, the faithfulness of the descriptors decreases as the number of neighbours increases, leading to a tuneable trade-off between the size of the descriptor and its faithfulness in terms of its ability to represent the atomic environment uniquely up to symmetries. With typically used parameters, however, the faithfulness of the descriptors are quite different, and all descriptors fail for Si clusters with more than 13 atoms. In order to improve on this, we therefore introduced a similarity measure between atomic neighbour environments called Smooth Overlap of Atomic Positions, which does not suffer from these difficulties and demonstrates excellent faithfulness for any number of neighbours. We also tested the performance of the descriptors for fitting models of small silicon clusters and bulk silicon crystal and found that SOAP leads to a more accurate and much more robust potential energy surface.