=1

Definition Lemma Corollary Note

Cross-Gramian Based Combined State and Parameter Reduction for Large-Scale Control Systems

Mario Ohlberger

Introduction

Efficient reduction of large-scale nonlinear control systems is a challenging task. Even more in the case of parametrized systems, in an inverse problem setting, where a combined reduction of parameters and states is targeted. For instance, a neural network with many nodes and unknown connectivity, modeled as a parametrized nonlinear dynamic system, requiring much time during parameter estimation due to system size and parameter count. Large-scale nonlinear neural networks have widespread use, such as forward control problems on artificial neural networks or inverse problems on biological neural networks. A real-life example is the reconstruction of connectivity between brain regions from activity measurements for instance with EEG or MRI (see for example [\cite=moran07]). With the aim to lower computational complexity, the parameter and state spaces are confined to low-dimensional subspaces. One class of model order reduction techniques is concerned with determining projections to such subspaces, mapping the high-dimensional model to a reduced surrogate model. In this contribution, the projection based method of balanced truncation is the origin of the proposed combined reduction of state and parameter space.

Since the number of a systems inputs and outputs usually remains fixed, the maps to and from the intermediary states characterize the reducibility of a system [\cite=vandooren00]. The balanced truncation approach, introduced in [\cite=moore81], categorizes the states of a system in terms of controllability and observability. From the input-to-state map the systems controllability is computed, quantifying how well a state is driven by the input. The state-to-output map is used to compute the systems observability, quantifying how well changes in a state are reflected by the output. Excluding the least controllable and observable states from a model motivates a projection from the full to a truncated model, approximating a mapping from inputs to outputs.

Let us look at a linear time-invariant control system,

[formula]

with states [formula], input or control [formula], outputs [formula], a system matrix [formula], an input matrix [formula] and an output matrix [formula]. The systems controllability and observability can be assessed through the associated controllability gramian WC and observability gramian WO, which are classically computed as the smallest semi-positive definite solutions of the Lyapunov equations AWC  +  WCA*  =   - BB* and A*WO  +  WOA  =   - C*C. To make a compound statement about controllability and observability, WC and WO have to be balanced [\cite=laub87]. The singular values of the resulting balanced gramian correspond to the Hankel singular values of the system, with their magnitude describing how controllable and observable the associated state is. An extension to this approach can be found in [\cite=davidson86].

This work focuses on cross gramian based methods for model reduction. The cross gramian WX was introduced in [\cite=fernando83a] and corresponds to a solution of the Sylvester equation AWX  +  WXA =  - BC. It combines controllability and observability information into a single gramian matrix and is elaborately described in [\cite=antoulas05].

An alternative to solving the Lyapunov or Sylvester equations is the method of empirical gramians, which was introduced in the works [\cite=lall99], [\cite=lall02] and enables the computation of gramian matrices also for nonlinear systems by mere basic vector and matrix operations. This concept was extended among others in [\cite=hahn02a] providing more general input signals than delta impulses. Particularly noted should be [\cite=streif06] and [\cite=streif09] for developing the empirical cross gramian for single-input-single-output (SISO) systems in the context of sensitivity analysis. In this article we generalize the empirical cross gramian to be applicable to multiple-input-multiple-output (MIMO) systems. For the gramian based parameter reduction, the groundwork has been laid by [\cite=geffen08] from the observability and by [\cite=sun06a] from the controllability point of view. From the cross gramian point of view of parameter reduction a new gramian, namely the joint gramian, is introduced in this article. Furthermore, the concept of gramian-based combined state and parameter reduction is established. Using empirical gramians, it is shown, that combined reduction allows efficient inversion of nonlinear problems.

To begin, the cross gramian and its properties are reviewed in . Then the empirical cross gramian (for MIMO systems) is developed in . introduces combined state and parameter reduction in two variants. First, a controllability and second, an observability based approach; the latter is enhanced to a cross gramian based combined reduction, that is presented in . From this, a procedure to reduce parameter spaces in Bayesian inverse problems, prior to parameter estimation, is suggested in . Finally, numerical experiments are conducted in comparing the newly presented methods for a linear and nonlinear neural network.

Review of the Cross Gramian

A brief review of the cross gramian along with its application to model reduction of linear time-invariant control systems is given next. The cross gramian WX (also known as: WCO) was introduced in a sequence of works ([\cite=fernando83a], [\cite=fernando82], [\cite=fernando83b], [\cite=fernando84a], [\cite=fernando84b], [\cite=fernando85], [\cite=laub83]) and encodes controllability and observability into a single matrix, yet it can only be computed for a square system, which is a system with the same number of inputs and outputs. In this case the cross gramian is a solution of the Sylvester equation. Approximate solutions for the Sylvester equation were discussed in [\cite=sorensen01], [\cite=sorensen02] and [\cite=baur08]. The cross gramian can also be specified by the product of input-to-state and state-to-output maps:

[formula]

in case the underlying system is asymptotically stable. If the system is also symmetric, the following relation between the cross, the controllability and observability gramian holds [\cite=fernando83a]:

[formula]

While a SISO system is always symmetric [\cite=fernando83a], a linear MIMO system not only requires the same number of inputs and outputs, but also the system gain G =  - CA- 1B, or equivalently the transfer function H(t) = CeAtB, to be symmetric [\cite=sorensen01]; consequently a symmetric transformation J, with AJ  =  JAT and B = CTJ exists. Trivially for [formula] the system would be restricted by A = AT and B = CT.

As presented in [\cite=fernando83a], the trace of the cross gramian equals half the gain for a SISO system (A,b,c):

[formula]

The trace being the sum of eigenvalues, the cross gramians eigenvalues are associated with the system gain. This result was used in [\cite=streif06] and [\cite=streif09] for parameter identification purposes, using the system gain as a sensitivity measure. An extension of to [\cite=fernando83a] for MIMO systems is developed next:

For an asymptotically stable system, the trace of the cross gramian (in the form of ) is given by:

[formula]

Employing the cross gramian instead of controllability and observability gramian, means only a single gramian has to be computed. And since no balancing is required, the truncation procedure can be simplified to a direct truncation ([\cite=aldhaheri91], [\cite=antoulas05]). A balanced transformation can be approximated by the singular value decomposition (SVD) of the cross gramian. The approximated Hankel singular values of the diagonal matrix D are sorted by the controllability and observability of the states. A projection to a subspace of the state space is then given by truncation of U and V:

[formula]

The matrices [formula] are partitioned based on a threshold [formula] into [formula] and [formula]. This leads to the following reduced order model:

[formula]

Apart from truncation based model reduction, the cross gramian has applications for example in system identification [\cite=ionescu11] and decentralized control ([\cite=moaveni06], [\cite=moaveni08], [\cite=moaveni08b]) by computing the participation matrix (see [\cite=shaker12]) based on the cross gramian. The cross gramian has also the benefit of conveying more information than controllability and observability gramian, since the systems Cauchy index is given by the cross gramians signature [\cite=fernando83b]. Lastly, the cross gramian can also be computed only via the controllability gramian as presented in [\cite=fernando85] and [\cite=shaker12a].

Empirical Cross Gramian

In this section the empirical cross gramian for MIMO systems is introduced. For general, possibly nonlinear, control systems,

[formula]

with states [formula], input or control [formula], outputs [formula], a system function [formula] and an output function [formula], the procedure from Section [\ref=crossgramian] is not viable. In [\cite=lall99], [\cite=lall02] and [\cite=hahn00] the concept of empirical (controllability and observability) gramians was introduced. This is a POD method based solely on simulations of the system [\cite=antoulas01]. Subsequently this approach and its field of application was advanced by [\cite=hahn02b], [\cite=hahn03], [\cite=condon04] and [\cite=shaker12]. The empirical gramians correspond to the classic gramians for linear systems [\cite=lall99]. Because they can be aligned to the operating region of the underlying system, in terms of initial states and input or control, the empirical gramians carry more information on the system [\cite=singh05] than the gramians computed as solutions of matrix equations.

Empirical gramians are based on averaging the response of a system that is perturbed in inputs and initial states. Initially, the perturbed input was restricted to a delta impulse δ(t), which was broadened to more general input configurations in [\cite=hahn02a] under the name of empirical controllability covarinace matrix and empirical observability covariance matrix. The necessary perturbation sets are systematically defined next; these should reflect the operating range of the underlying system. Eu and Ex are sets of standard directions for the inputs and initial states. Sets Ru and Rx are orthogonal transformations (rotations) to these standard directions of inputs and initial states respectively, while Qu and Qx hold scales to these directions:

[formula]

Along the lines of the empirical controllability gramian and empirical observability gramian [\cite=lall99], the empirical cross gramian for SISO systems was introduced in [\cite=streif06]. In this work, as a new contribution, the empirical cross gramian is generalized to square MIMO systems. Hence the scope of the cross gramian is extended to nonlinear systems and provides an alternative nonlinear cross gramian to [\cite=ionescu11]. For a general (possibly nonlinear) MIMO system with dim (u)  =   dim (x) the empirical cross gramian is defined by: Essentially, the empirical cross gramian is an averaged cross gramian over the system with the specified perturbations in input and initial states around a steady state (x̄(ū)).

Next, similar to [\cite=lall99] and [\cite=streif06], the equality of the cross gramian and the empirical cross gramian of a linear MIMO control system is shown next:

For an asymptotically stable linear control system, the input-to-state and state-to-output maps are given by:

[formula]

thus:

[formula]

The snapshots xhij and ykla can be computed on demand, but also included from observed experimental data. In case the data is collected at discrete times t in regular intervals Δt, following [\cite=hahn01], a discrete representation of the empirical cross gramian is given here, too:

Computational complexity depends largely on the number of scales and rotations of perturbations as well as the cost and order of integration of the system ([\ref=nsys]). The empirical cross gramian enables state reduction for square nonlinear control systems without an additional balancing procedure using the direct truncation, where V and U are computed by a SVD, analogous to ([\ref=dt]):

[formula]

Like for the proper orthogonal decomposition, to quantify how close the subspace obtained by reduction is approximating the state space, a measure of total preserved energy [\cite=condon04a] can be employed:

[formula]

for k retained states of a n-dimensional model with n - k truncated states with the smallest singular values of the (empirical) cross gramian σi.

Combined State and Parameter Reduction

Two methods for combined model reduction, allowing simultaneous reduction of state and parameter spaces, are proposed; an observability-based and a controllability-based ansatz. For parametrized general control systems with parameters [formula]

[formula]

in [\cite=geffen08], the identifiability gramian was introduced, which extends the concept of observability from states to parameters. Augmenting the states of a given system by appending its parameters θ as constant components, the parameters are treated like states:

[formula]

The initial states [formula] are also augmented by the given parameter value θ, yielding: [formula]. The identifiability of the parameters is obtained through the observability of these parameter-states by the augmented observability gramian:

[formula]

with the (state) observability gramian [formula], the parameter observability gramian [formula] and a mixture matrix [formula]. From the observability gramian of this augmented system, the identifiability gramian [formula] can be extracted via the Schur-complement,

[formula]

For an approximation of the identifiability gramian WI, the parameter observability gramian WP  ≈  WI itself is often sufficient. The identifiability is then given as the observability of the parameters, through the singular values of WI, or WP respectively. Instead of using the identifiability information for sensitivity analysis as in [\cite=geffen08], a projection to the dominant parameter subspace is computed from WI. Similar to the cross gramian approach, a singular value decomposition of the approximate identifiability gramian yields:

[formula]

The partitioning depends on the singular values in Δ. A truncation of the projection Π results in the reduced parameters [formula]:

[formula]

Next, a combined reduction of state and parameter space is introduced. Observability of the states is encoded in this augmented observability gramian, too; it can be extracted as the upper-left n  ×  n matrix from [formula]. Using the identifiability gramian based parameter reduction, the parameter space of the system is reduced. Then, after computation of a controllability gramian WC, the state space is reduced by balanced truncation. This results in an observability-based combined state and parameter reduction:

[formula]

Similarly, a controllability based combined reduction can be achieved by a parameter reduction using the sensitivity gramian for additively partitioned systems:

[formula]

from [\cite=himpe13a], which is based on [\cite=sun06a] and [\cite=sun06b] and treats the parameters as additional inputs. By the sensitivity gramian, controllability information on the parameters is provided, that also allows a parameter reduction; again by a singular value decomposition of WS. Since an approximate controllability gramian WC is also computed in the process ([\ref=ws]), after computation of an observability gramian WO, the parameter reduced system is reduced in states by balanced truncation. This results in a controllability-based combined state and parameter reduction. The controllability-based combined reduced order model has the same form as the observability-based reduced model ([\ref=cr]).

Joint Gramian and Combined Reduction

In addition to controllability- and observability-based combined reduction, a cross-gramian-based combined reduction is proposed next, which, for symmetric control systems, is enabled by the empirical cross gramian for MIMO systems from . Aggregating the computation of controllability and observability not only for states like the cross gramian, but also for identifiability of parameters, leads to a reduction and identification method requiring a new single gramian. Like the states can be augmented with constant parameter states as before, also the inputs can be augmented acting via identity on the augmented parameter states. To remain square, also the outputs are augmented reflecting the parameter value to preserve symmetry:

[formula]

Yet this approach would require many simulations, due to the high number of inputs. Instead, the augmented system ([\ref=aug1]) is used, without the augmented inputs and outputs. The systems symmetry is not affected by the augmentation with the constant (parameter)-states, since in terms of linear systems {A,B,C} are expanded with zeros. This leads to the following new gramian matrix, which utilizes the cross gramian and thus unifies controllability and observability of states and parameters: The joint gramian also has a 2  ×  2 block structure:

[formula]

with the cross gramian [formula], the parameter cross gramian [formula], and the mixture matrices [formula]. Since no inputs are affecting the parameter-states, WP  =  0 and Wm  =  0. A Schur-complement of the joint gramian to extract the parameter associated lower right block matrix will always be zero:

[formula]

Yet, the identifiability information on the parameters is encoded in the non-zero mixture matrix WM. By taking the symmetric part of the joint gramian [formula], one obtains:

[formula]

Taking the inverse of the symmetrized cross gramian is too costly in a large-scale setting. But the Schur complement can be approximated by using [formula] as a coarse approximation to the inverse. Thus, a more efficient cross-identifiability gramian is given by:

[formula]

Usually, the cross-identifiability gramian is not equal to the (observability-based) identifiability gramian due to the incorporation of controllability information in the cross gramian.

A reduced set of parameters is again computed by a truncated projection obtained from the singular value decomposition of the approximate cross-identifiability gramian:

[formula]

After a parameter reduction,

[formula]

the states can be reduced with a state reduction by direct truncation, employing the usual cross gramian WX, a byproduct of the joint gramian WJ, which is the upper left n  ×  n block matrix of WJ:

[formula]

For this combined reduction of states and parameters no further gramians have to be computed and no balancing transformation is required.

Combined Reduction for Bayesian Inversion

The empirical gramian method is especially well suited for parameter identification, for example see [\cite=eberle12]. For inverse problems, a parametrized model's output is fit to match experimental data through optimization of the parameter space. Parameter identification and parameter space reduction for inverse problems are complicated settings, since the parameter reduction should occur before the model inversion. Furthermore, inversions require many forward solutions; whereby an individual solution is costly for high dimensional state space, and the overall inversion is costly for high dimensional parameter spaces. A Bayesian inverse problem [\cite=stuart10] is based upon the Bayes' formula:

[formula]

It states that a posterior probability distribution P(θ|yd) on the parameters θ, for some observed data yd, is proportional to the product of the likelihood P(yd|θ) times the prior distribution P(θ). The prior distribution P(θ) is before-hand information on the parameters. By fitting the parametrized models output to experimental data, the likelihood is the distribution P(yd|θ) is estimated by the optimization of the parameters. For Bayesian inverse problems, empirical gramians are suited especially well due to the prior distribution on the unknown parameters. Assuming a Gaussian setting, the provided prior knowledge, given by mean and covariance can be employed to define the configuration of the parameters steady states and perturbations. The steady states of the augmented parameter states are set to the prior mean:

[formula]

while the prior covariance defines the perturbation scales. Given a sequence ai∈[0,1], the scales of the state perturbations are defined by:

[formula]

Since the parameters are treated as additional inputs for the sensitivity gramian, and as states for identifiability and joint gramian, the perturbations can be setup to affect the parameters in the range of the prior distribution. Thus, the uncertainty in the parameters is incorporated into the reduction procedure. The reduction of prior mean and covariance as well as reconstruction of the posterior distribution is accomplished in the same manner as the parameter projection. Following the truncation procedure, the priors are projected to a low-dimensional subspace and only a low number of parameters is estimated in the optimization after the reduction. As described in sections [\ref=combined] and [\ref=joint], not only the reduction of the parameter space, but also combined state and parameter reduction can be applied, With combined reduction, the duration of the parameter optimization is reduced, in two ways. First, because of the reduced state space, each integration of the model for a point in the parameter space requires less time and memory. Second, a reduced parameter space implies less integrations and less memory requirements.

Implementation and Numerical Experiments

For an efficient implementation, the structure of the gramian computation is exploited. First, the empirical gramians allow extensive parallelization. Each combination of direction, transformation and scale can be processed separately yielding a sub-gramian. Second, the assembly of each sub-gramian can be comprehensively vectorized, since it consists of vector additions, inner- and outer-products. In the special case of the empirical cross gramian, and thus the empirical joint gramian which is an encapsulation of the empirical cross gramian, organizing the observability snapshots into a 3rd-order-tensor and exploiting generalized transpositions is very efficient. The output gramian is the normalized accumulation of all sub-gramians. For further details about the implementation we refer to [\cite=himpe13a].

All gramians for the numerical experiments are computed by the empirical gramian framework introduced in [\cite=himpe13a]. The empirical gramian framework emgr can be found at and is compatible with Octave and Matlab. The source code, used for the following experiments, can be found at .

The empirical cross gramian and empirical joint gramian are verified with a parametrized linear system (Model 1),

[formula]

and tested with a parametrized nonlinear system (Model 2),

[formula]

with the nonlinearity being a component-wise applied sigmoid function, here a hyperbolic tangent. This system is called hyperbolic network model [\cite=quan01] and models a neural network.

In both cases the matrix [formula] is fully parametrized, thus each component of Aθ is a separate parameter, hence p  =   dim (θ)  =  n2. The parameters constituting Aθ are generated randomly, but stability is guaranteed. To enable the use of the cross and joint gramian, the systems symmetry is ensured, too.

Three types of reductions are tested for the linear and nonlinear network models; first, a state reduction, second, a parameter reduction and lastly a combined reduction. All reduced models are compared to the original full order model. Each type of reduction is tested for state dimensions:

[formula]

with input and output dimensions:

[formula]

timing and errors are averaged over ten samples. Parameter and combined reductions are treated as Bayesian inversions, where the parameter space is characterized only by the priors and is reduced before estimation by an unconstrained optimization. The prior distribution ensures the stability of the system by P(θi  ≠  j)  =  N(0,1) for the off-diagonal and P(θi = j)  =  N( - 1,1) for the diagonal elements of Aθ:

[formula]

An integration of the full order system with the original parameters using a higher order method is used as synthetic experimental data for the inversion to fit the models output by tuning the parameters.

In the offline phase the model reduction composed of gramian and projection computation is performed, while in the online phase the forward solution or inversion is calculated. The reduced number of states is set to the number of inputs, as opposed to using for example the biggest drop in Hankel singular values or set a certain error bound. This achieves better comparability of the offline and online times, which includes the parameter optimization for the parameter and combined reduction. Furthermore, the estimation duration of the full order model is plotted together with the offline times of the reduction approaches as these happen on similar scales. The relative L2-error employed in the following plots is the L2-error for a vector valued time series [\cite=fortuna12] using the signals relative error: This error relates the full order with the reduced order outputs in the following experiments.

State Reduction

The state reduction using the empirical cross gramian (WX) is compared to balanced truncation of the empirical controllability gramian (WC) and the empirical observability gramian (WO), and also to a variant of balanced proper orthogonal decomposition from [\cite=willcox02] using solely the empirical controllability gramian (WC).

For both the linear and the nonlinear system all methods produce reduced models of similar accuracy and online times (see tables [\ref=tab:tls], [\ref=tab:tns] and figures [\ref=fig:fls], [\ref=fig:fns]). Naturally, the balanced POD requires the least offline time, as the empirical controllability gramian only needs to perturb the inputs, which are of lower dimension than the states. This suggests balanced POD as the most efficient state reduction method for the given situation, yet verifies the applicability of the empirical cross gramian.

Parameter Reduction

For the parameter reduction the parameters constituting Aθ are treated as unknown posterior Gaussian distribution and are initialized with flat priors. Thus each online phase solves an inverse problem by estimating the parameter distribution using unconstrained optimization. The parameter reduction performance, of the empirical joint gramian (WJ) is assessed in comparison to the empirical sensitivity gramian (WS, see [\cite=himpe13a]), and the empirical identifiability gramian (WI, from [\cite=geffen08]).

All three methods generate reduced parameter space models of similar accuracy, and consequently with similar online times for both, the linear (table [\ref=tab:tlp], figure [\ref=fig:flp]) and the nonlinear system (table [\ref=tab:tnp], figure [\ref=fig:fnp]), with a relative L2-error of the same order of magnitude as the inversion of the full order system. The offline times of all methods are below the duration of the inversion of the full order system. The sensitivity gramian is the fastest, because it utilizes internally smaller systems than the identifiability and the joint gramian. Since the sensitivity gramian is only applicable to systems where the system function f can be partitioned into f(x,u,θ)  =  fu(x,u)  +  fθ(x,θ), it is not always applicable. If the system meets the symmetry criteria, the joint gramian is the next best choice as its offline times are much lower and rising more gradually than the identifiability gramian.

Combined Reduction

Finally, the combined state and parameter reduction of the empirical joint gramian (WJ) is benchmarked against the two variants of combined reduction by balanced truncation described in section [\ref=combined]. The first variant reduces the parameter space by the empirical sensitivity gramian (WS). Since a controllability gramian is already computed in the process, with an empirical observability gramian (WO) the state space is reduced by balanced truncation. The second variant reduces the parameter space by the empirical identifiability gramian (WI). Then, a state space reduction utilizes balanced truncation of an empirical controllability gramian (WC) and observability gramian, latter being a byproduct of the identifiability gramian.

Tables [\ref=tab:tlc], [\ref=tab:tnc] and figures [\ref=fig:flc], [\ref=fig:fnc] show that the newly introduced combined reduction works for all methods. As the parameter associated gramians consume the bulk of the offline time, the offline times are comparable to the parameter reduction. The reduced order linear systems online time is about an order of magnitude shorter than for the nonlinear system, since the linear systems matrices can be reduced before the optimization, yet for a general nonlinear system this cannot be done. While for the nonlinear system the reduced order systems relative error are comparable, in the linear setting the observability based combined reduction performs inferior, the cross gramian based combined reduction performs better and the controllability based combined reduction even outperforms the full order estimation.

Combined Reduction Effectivity

To assess the effectivity of the combined model reduction, the resulting error and total time required to complete the solution are normalized by the full order solution error and time. By this comparison, the efficiency of the combined reduction can be compared in terms of factors to the full order estimation.

The combination of sensitivity gramian and observability gramian (WS and WO) seems to require on average about 14% of the full order estimation duration, while the joint gramian (WJ) consumes about 24%. Yet the combined reduction using controllability gramian and identifiability gramian (WC and WI) seems to require on average about 48% of the full order estimation time. For the linear system the estimation error of WS and WO undercuts the full order error by 60%, WJ exceeds the full order error by 60% and WC and WI nine times. In the nonlinear setting the relative error worsens for WS and WO by a factor 3.5, for WJ by a factor 4.2 and for WC and WI by a factor five compared to the full order estimation.

Conclusion

In this paper we introduced and benchmarked the empirical cross gramian for MIMO systems and the (empirical) joint gramian for parameter and combined state and parameter reduction. The empirical cross gramian allows a state reduction of linear and nonlinear symmetric systems. Even though all presented methods for parameter and combined reduction allow a more swift optimization with a relative error of the same order as the full order systems, the (empirical) joint gramian produces a lower error for linear systems and is the fastest option for symmetric non-partitionable systems. The numerical experiments have shown that gramian-based combined reduction is already profitable for a single inversion, due to the total time of each method undercutting the full order inversion. For recurring Bayesian inversions, in which many data sets are fit to the same model, the reduced model can be reused, since the reduction is only based on the prior distribution.

Further research has to be conducted on applying the empirical cross gramian to nonlinear or non-symmetric systems. Existing extensions for non-symmetric systems are generalizing the symmetry constraint to orthogonal symmetry [\cite=abreu86] or embedding into a symmetric system [\cite=sorensen01].

The empirical cross gramian for MIMO systems completes the set of empirical gramians for state reduction, while the joint gramian completes the body of parameter identification gramians and enables combined reduction without balancing.

Acknowledgement

This work was supported by the Center of the University of Münster.