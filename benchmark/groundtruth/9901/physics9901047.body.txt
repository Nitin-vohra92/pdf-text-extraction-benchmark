Exact charge conservation scheme for Particle-in-Cell simulations for a big class of form-factors

T.Zh.Esirkepov

Forum for Theoretical Physics INFM, Pisa, Italy

Moscow Institute of Physics and Technology, Institutskij per.9, Dolgoprudnij, Moscow region, 141700 Russia

tel. & fax.: +7 (095) 4086772

e-mail: timur@nonlin-gw.rphys.mipt.ru

Subject classifications:

65C20 Models, numerical methods; 65P20 Solution of discretized equations; 70F10 n-body problem; 77F05 Fluid-particle models.

Keywords:

Particle-in-Cell, continuity equation, charge conservation.

Introduction

In the present paper we develope a new procedure called density decomposition for obtaining the current density automatically satisfying the continuity equation.

In the set of Maxwell equations along with hyperbolic equations of wave propagation we have an equation of elliptic type -- Gauss's law, that in terms of electric potential φ can be expressed as Poisson equation. In practice Poisson equation is used for correction of "potential" part of electric field.

It is well known that Particle-in-Cell (PIC) method in plasma simulations can be implemented without solving Poisson equation for electric field correction. Instead, we need the continuity equation (or charge conservation law) in finite differences to be satisfyed.

There are a few methods for satisfying the continuity equation locally -- for charge and current density associated with each particle, Ref. [\cite=Morse-Nilson] [\cite=Buneman] [\cite=Vshivkov]. For this purpose authors use special definition for the current density wich is naturally connected with the change of charge density due to particle motion. Unfortunately, these methods are implemented only for simple shapes of particles, for the zero- and the first-order form-factors. We present the generalization of these methods, valid for a big class of form-factors. Also we have proved that the density decomposition is the only possible linear procedure for defining the current density associated with the motion of a particle.

There are another methods for incorporating Gauss's law into Maxwell solver using usual definition of local current density, see [\cite=Langdon-92] [\cite=Marder-87].

Very detailed study of PIC method can be found in [\cite=Langdon] [\cite=Hockney] [\cite=VA-book]. The new construction will be usefull firstly for overdensed plasma simulation with the paradigm of 'Clouds-in-Cell' [\cite=CIC].

Continuity equation in finite differences

Let us consider the local Maxwell solver, wich is equivalent to Finite Difference Time Domain (FDTD) method [\cite=YEE]

[formula]

combined with the particle mover

[formula]

Equations Eqs.([\ref=FDTD1]-[\ref=FDTD4]) are discreetized Maxwell equations and Eqs.([\ref=MOVER1]-[\ref=MOVER2]) are leap-frog scheme for solving of Newton-Lorentz equations. Here we use dimensionless variables defined by transformations [formula] where me,e -- electron mass and charge, c -- speed of light, ω0 and λ0 -- some characteristic frequency and length (e.g. the frequency and wavelength of incident EM radiation). Index n denotes integer time step and α stands for the number of a particle; dt,dx,dy,dz -- discreetization of time and space coordinates.

Different components of electromagnetic fields and charge density ρ and current density J are defined on different grids,

[formula]

where i,j,k are integers. Discreet operators [formula] in Eqs.([\ref=FDTD1]-[\ref=FDTD4]) are vectors,

[formula]

These operators have the next convenient properties

[formula]

where Δ is discreet Poisson operator in central differences,

[formula]

Acting on the Eq.([\ref=FDTD1]) by [formula] and on the Eq.([\ref=FDTD2]) by [formula], we obtain

[formula]

It means that if the continuity equation Eq.([\ref=CONT-E]) is fulfilled then the divergence of [formula] is always equal to charge density (Gauss's law), and if the initial discreet divergence of [formula] is zero then it remains zero forever.

Thus, for solving Maxwell equations we need Eqs.([\ref=FDTD1]-[\ref=FDTD2]) and Eq.([\ref=CONT-E]) with initial conditions

[formula]

Let us consider the continuity equation (or charge conservation law) in finite differences

[formula]

Further we will drop indices and modificators like ±  1 / 2, where it can not lead to an ambiguity. The charge density ρ is constructed from form-factors of separate particles

[formula]

where S is the form-factor (or density) of a particle,

[formula]

Xi,Yj,Zk denote coordinates of the grid, (xα,yα,zα) is the location of the particle with number α. Here form-factor can be interpreted as a charge density of a single particle. So the particle is considered as it would be a charged cloud. Form-factor must obey the rule of conservation of full charge which leads to

[formula]

where the sum is taken over all grid nodes.

Density decomposition

Due to linearity of charge conservation law Eq.([\ref=CONTINUITY]), it is sufficient to construct current density associated with motion of a single particle.

Let us consider a single particle with form-factor Eq.([\ref=FORM-FACTOR]) and coordinates (x,y,z). We introduce vector W as finite differences of the current density associated with particle motion:

[formula]

Then according to charge conservation law, we can write dropping grid indices,

[formula]

Here (Δx,Δy,Δz) is 3-dimensional shift of the particle due to motion.

Shift of the particle generates eight functions

[formula]

We will assume that vector W and corresponding current density linearly depends from these functions. The base for this assumption is the following. (1) We can consider the form-factor as charge density of the particle. If form-factor amplitude is increasing, the current density associated with a shift of the form-factor must increase proportionally. (2) We can decompose any three-dimensional shift of form-factor S(x,y,z) into three one-dimensional shifts:

[formula]

Currents corresponding to each one-dimensional shift must be additive.

Let us formulate some conditions directly going form the nature of vector W.

Vector W1i,j,k,W2i,j,k,W3i,j,k is a decomposition of finite difference Si,j,k(x + Δx,y + Δy,z + Δz) - Si,j,k(x,y,z), Eq.([\ref=CONSERVATION]).

If some of shifts Δx, Δy, Δz iz zero, the corresponding component W is also zero:

Δx = 0  ⇒  W1 = 0, Δy = 0  ⇒  W2 = 0, Δz = 0  ⇒  W3 = 0.

If S(x,y,z) is symmetrical with respect to permutation of (x,y), S(x,y,z) = S(y,x,z) and Δx = Δy, then W1 = W2. The same property is assumed for symmetries with respect to permutations of pairs (x,z) and (y,z).

Suggestion.

There is only one linear combination of eight functions Eq.([\ref=8-fun]), each satisfying Eq.([\ref=WEIGHT]), that is consistent with properties 1-3:

[formula]

Proof.

(Scenario). We can write all the properties 1-3 in the form of linear equations with unknown coefficients of eight functions. Remembering Eq.([\ref=WEIGHT]) we can obtain additional equations on coefficients taking sum over all grid points (i,j,k) from each linear combination for W. Solving 10 linear equations for all S, we will find all the coefficients. Of course, not all eight values Eq.([\ref=8-fun]) are independent. We have six independend variables x,y,z,Δx,Δy,Δz, so in the most general case only six values S can be also independend, for example, excluding S(x,y,z) and S(x + Δx,y + Δy,z + Δz). Among all possible solutions we must left only one, which doesn't assume special numerical values for excluded functions. [formula]

Taking into account boundary conditions for the current of one particle (vanishing of the current density at nodes far from the form-factor domain), and using Eq.([\ref=WEIGHT]) we obtain:

[formula]

Two systems Eq.([\ref=DECOMPOSITION]) and Eq.([\ref=BND]) define the density decomposition. Solving Eq.([\ref=W-DEF]) with natural boundary condition we obtain the current density associated with a single particle motion.

The condition Eq.([\ref=BND]) can be easily satisfyed if form-factor have a property of inheritance in decreasing of the dimension, i.e. if sum of form-factor over any dimension is again form-factor but of lower dimension. Formally, it means

[formula]

where S(2D)i,j doesn't depend on z and obeys Eq.([\ref=WEIGHT]) automatically.

There is a big and widely used in PIC codes class of form-factors that have a property of inheritance: all form-factors that are the products of one-dimensional form-factors,

[formula]

Here we use the same symbol for (probably) different one-dimensional form-factors, each of them must satisfy conservation of full charge, Eq.([\ref=WEIGHT]).

It can be easily proved that density decomposition Eq.([\ref=DECOMPOSITION]) along with Eq.([\ref=CLASS]) is the generalization of techniques proposed in [\cite=Morse-Nilson] [\cite=Buneman] [\cite=Vshivkov].

Computing of the current with second-order polynomial form-factor

In this section we present an algorithm for density decomposition in the case of second-order piecewise-polynomial form-factor and discuss a problem of dimension reduction.

Let us consider well-known one-dimensional form-factor

[formula]

which is the second-order spline. The particle is bell-shaped. The correspondent 3-dimensional form-factor is Eq.([\ref=CLASS]).

Now we can formulate a scenario for computing the current density based on density decomposition Eq.([\ref=DECOMPOSITION]). Suppose we consider a code that uses Finite Difference Time Domain (FDTD) technique [\cite=YEE], where electromagnetic fields and current density are defined on different regular grids. Here we do not pretend to show optimized or fastest algorithm.

Prepare 15-component array [formula] containing one-dimensional form-factors corresponding to particle coordinates [formula] with respect to the grid of the charge density ρ:

[formula]

Really, components [formula] and [formula] are zero, but we need these additional components for further calculations.

The actual 3-dimensional form-factor is 27-component array

[formula]

Using [formula] or precomputed S(3D), compute the force acting on the particle. Here we can use fields spatially averaged to the grid of ρ or compute additional form-factors for each type of grid. Advance particle and compute new particle coordinates [formula]. Note here that particle shift in any direction must be smaller or equal than grid step in this direction,

[formula]

Using new particle coordinates compute a new array [formula] containing new form-factors:

[formula]

Components [formula] and [formula] are not zero in general, because of particle motion. If conditions Eq.([\ref=PART-LIMIT]) are satisfyed, the array [formula] doesn't have non-zero components out of i =  - 2,2.

Compute auxiliary array of differences of new and old form-factors:

[formula]

It is possible to use [formula] for storage of differences.

Compute 125*3-component array containing density decomposition [formula], in accordance with Eq.([\ref=DECOMPOSITION]). We need so many componets because we have current whose components are defined on different regular grids (in FDTD technique).

[formula]

Of course, this computation is easy to optimize.

Compute three components of the current density J1,J2,J3 associated with motion of the particle, using Eq.([\ref=W-DEF]) and boundary condition (there is no current in nodes far from particle location),

[formula]

where [formula] is the charge of the particle.

Add computed contribution from the single particle to array of the current density.

As this algorithm uses only simple polynomes, its accuracy is equivalent to the accuracy of the last digit of numerical representation (e.g. 10- 8 in SINGLE PRECISION 4-BYTE data or 10- 17 in DOUBLE PRECISION 8-BYTE data).

Suppose we have two-dimensional problem, when all the variables depend on (x,y) only. In this case density decomposition Eq.([\ref=DECOMPOSITION]) provides only two first components of the current density. How to construct the third one, in consistency with the rest? The simplest idea is to derive the third component from 3-dimensional case by reducing the dimension. We can imagine chaines of infinite number of particles along z-axise. Being projected into (x,y)-plane these N chaines produces N 2-dimensional particles. Then we can do averaging over z-axise. As a result we will obtain first two components of the current density in accordance with Eq.([\ref=DECOMPOSITION]), and the third component.

In the particular case of the above algorithm we must change formulae of items 5 and 6 in the following way:

[formula]

[formula]

where [formula] is the third component of particle velocity.

As one can see these formulae have an obvious connection with 3D-case, Eqs.([\ref=A-5]-[\ref=A-6]).

Conclusion

In this paper we have developed a construction for a current density, which exactly satisfy the charge conservation law and is valid for a wide class of form-factors. It is shown that this construction is the only allowed by very natural conditions derived from the properties of the current density. An algorithm in the case of second-order polynomial form-factor is presented. One can see that this method is not restricted by special Maxwell solver, but uses only discreetized continuity equation. These teqnique was implemented by author and D.V.Sokolov in three-dimensional and two-dimensional PIC codes.

The author is glad to thank Dmitry Sokolov for collaboration, Prof. Vitaly A. Vshivkov and Dr. Hartmut Ruhl for useful discussion.

The author is pleased to thank Prof. Francesco Pegoraro and Prof. Giuseppe Bertin for support.

This work was prepared in Scuola Normale Superiore in Pisa and supported by Istituto Nazionale per la Fisica della Materia, Italy and by Russian Fond for Basic Research (No.98-02-16298).