Corollary Proposition Lemma Fact Conjecture Question Definition Example Remark

Invariant types in NIP theories

Introduction

An M-invariant type is a type over the monster model which is invariant under all automorphisms fixing the model M pointwise. There are two well-known classes of M-invariant types: types finitely satisfiable in M and types definable over M. In a stable theory, all M-invariant types are both definable over M and finitely satisfiable in M. This is no longer true in NIP theories. An old theorem of Poizat and Shelah says that a theory is NIP if and only if the number of M-invariant types for any model M is at most 2|M|, if and only if there are at most 2|M| global types finitely satisfiable in M([\cite=PoiInstable], [\cite=PoiPostScript]). In fact, an M-invariant type is determined by the type of its Morley sequence over M. This basic observation already suggests that invariant types should have special properties in NIP theories.

Any type finitely satisfiable in M is the limit of some ultrafilter on M. We will show that if M and L are countable, then any such type is in fact a limit of a sequence of elements of M. More generally, we observe that a theory in a countable language is NIP if and only if any sequence (pi:i < ω) of types (over any set) has a converging subsequence. This is related to some results in Banach space theory. See Rosenthal's theorem ([\cite=Banach_topics]) and also the work of Bourgain, Fremlin and Talagrand [\cite=BFT] which uncovers an analogue of the IP/NIP dichotomy in the context of measurable functions on Polish spaces.

An important result about NIP families is the (p,q)-theorem of finite combinatorics, proved by Alon-Kleitman and Matou sek. This theorem states roughly the following: Let φ(x;y) be an NIP formula and fix p  ≥  q large enough, then there is N with the following property: If S  =  {φ(x;bi):i < n} is a finite family of non-empty instances of φ(x;y) such that out of every subfamily S0  ⊆  S of size p, there is S1  ⊆  S0 of size q whose conjunction is consistent, then there is an N point set intersecting each φ(x;bi). This result has proved to be extremely useful in model theory; it is a major ingredient in the proof of the UDTFS conjecture [\cite=ExtDef2] and also in the study of generics in definably amenable groups [\cite=tamedyn]. We will see in Section [\ref=sec_pq] how this theorem is linked with properties of finitely satisfiable types and give a model theoretic proof of a weaker version of it. Also, we prove in Theorem [\ref=th_pqdef] a definable version of the (p,q)-theorem, assuming that types over countable models have at most [formula] coheirs. This generalises previous results in [\cite=invdp] where dp-minimality was assumed.

The biggest mystery concerning invariant types has to do with those invariant types that are neither definable nor finitely satisfiable. Let p be a global M-invariant φ-type. In general, whether or not φ(x;b) is in p depends on the full type [formula] and not only on its restriction to φ-formulas (or rather φopp-formulas). In Section [\ref=sec_localdescription] we propose a new point of view of invariant φ-types which remedies this. An invariant φ-type is described in a way that only involves the formula φ and not the rest of the language.

An intuition that was already presented in [\cite=invdp] is that amongst M-invariant types, M-definable types and M-finitely satisfiable types should be seen as two opposite extremes, and other invariant types sit somehow in between. In fact, one should be able to analyse a general invariant type into a finitely satisfiable part and a definable 'quotient'. This is very vague, but we will give precise conjectures along this line at the end of the paper. In [\cite=invdp], we gave one piece of evidence in favour of this idea: we showed that a dp-minimal invariant type is either finitely satisfiable in a small model or definable. We will in fact give another, more conceptual, proof of this (Theorem [\ref=th_dpmindich]). In Section [\ref=sec_fm] we show how to define a canonical retraction FM from the space of M-invariant types to that of M-finitely satisfiable types. We prove a number of commutativity properties of this map. This is related to another idea: the relation "p commutes with q", where p and q are global invariant types, is very meaningful and expresses in some way that p and q are far away from each other (think of DLO). It is shown in [\cite=distal] that two types which commute behave with respect to each other as in a stable theory. For example p has a unique non-forking extension to a realisation of q and the limit type of any Morley sequence of p over a realisation of q is equal to the invariant extension of p.

This retraction FM is interesting in its own right. It is used in [\cite=ChePilSim] to show that some properties of definably amenable groups are preserved under taking the Shelah expansion. Nevertheless, this map remains rather puzzling. It would be nice to have a better understanding of it, for instance a different construction leading to it. Also, we did not solve the following question, which, if answered positively, would certainly shed some new light on invariant types: are the fibres of FM of bounded cardinality (say 2|T|), independent of M?

Finally, in Section [\ref=sec_amalg], we prove some amalgamation properties of invariant types and in Section [\ref=sec_questions] we state a number of open questions.

Setting and basic facts

Throughout, T is a complete theory in a language L and U is a monster model. We usually do not assume that T is NIP. If A  ⊂  U is a set of parameters, we let L(A) denote the set of formulas with parameters in A. We do not distinguish between points and tuples. Thus [formula] usually denote tuples of variables and a∈A means a∈A|a|.

We write [formula] to mean [formula] and N is |M|+-saturated.

The notation φ0 means [formula] and φ1 means φ.

Let Δ be a set of formulas and A a set of parameters. A (possibly finite) sequence I = (ai:i∈I) is Δ-indiscernible over A, if for every integer k and two increasing tuples [formula] and [formula], b∈A and formula [formula], we have [formula]. An indiscernible sequence is an infinite sequence which is Δ-indiscernible for all Δ.

Let I = (ai:i∈I) be any infinite sequence. The Ehrenfeucht-Mostowski type (or EM-type) of I over A is the set of L(A)-formulas [formula] such that [formula] for all [formula], k < ω. If I is an indiscernible sequence, then for every k, the restriction of the EM-type of I to formulas in k variables is a complete type over A. If I is any sequence and J is any infinite linear order, then using Ramsey's theorem and compactness, we can find an indiscernible sequence J indexed by J and realising the EM-type of I (see e.g., [\cite=TentZieg]).

Sequences (Ii:i < k) are said to be mutually indiscernible over A if each Ii is indiscernible over [formula].

Let Δ  =  {φi(x;yi):i < α} be a set of formulas with the same first variable x. Then a Δ-type over A is a maximal consistent set of formulas of the form φi(x;b) for some i < α and b∈A. The set of Δ-types over A is denoted SΔ(A). If Δ  =  {φ(x;y)}, we write φ instead of Δ. The Δ-type [formula] of a over A is defined in the obvious way.

If φ(x;y) is a formula, then we let φopp(y;x) denote the opposite formula: φopp(y;x) = φ(x;y), but the roles of variables and parameters are reversed. Hence a φ-type over A is a type in variable x and a φopp-type over A is a type in variable y.

We assume that the reader is familiar with basic facts concerning NIP theories as presented, e.g., in [\cite=NIPbook], though we will recall all that we need. The main property, which can be taken as a definition, is the following.

In particular for any A, the sequence [formula] converges. We denote the limit type by lim (I / A).

By compactness, if φ(x;y) is NIP, then there is some finite Δ such that the conclusion holds for any Δ-indiscernible sequence.

Invariant types

We present some basic facts about invariant types in NIP theories. The reader may consult [\cite=NIPbook] for more information and proofs.

By an M-invariant type, we always mean a global type p(x)∈S(U) which is invariant under automorphisms fixing M pointwise. An invariant type is a global type which is M-invariant for some M. There are two well-known subclasses of invariant types: definable types and finitely satisfiable types. A type p(x)∈S(U) is definable if for every formula φ(x;y)∈L, there is some dφ(y)∈L(U) such that for any b∈U, [formula]. The type p is M-definable, or definable over M, if all the formulas dφ(y) can be taken with parameters in M. A type p(x)∈S(U) is finitely satisfiable in M, or M-finitely satisfiable, if every formula φ(x;b)∈p has a realisation in M. If p is M-invariant and finitely satisfiable in some N, then it is M-finitely satisfiable, and similarly for definable.

The set of M-invariant types is a closed subspace of the space of global types. In particular it is compact. The same is true of the space of global M-finitely satisfiable types.

Given p(x) and q(y) two M-invariant types, one can define the product [formula] as the type r(x,y)∈S(U) such that for any N  ⊇  M, [formula] where [formula] and [formula]. This defines an M-invariant type. The operation [formula] is associative, but not commutative in general.

We will sometimes write [formula] instead of [formula] to make the notation more compact.

If p(x) is an M-invariant type, we define by induction on [formula]:

[formula]

Let also [formula]. For any B  ⊇  M, a realisation (ai:i < ω) of p(ω)|B is called a Morley sequence of p over B (indexed by ω). It follows from associativity of [formula] that such a sequence (ai:i < ω) is indiscernible over B.

In particular, there are at most 2|M| + |T| invariant types over a model M. This property actually characterises NIP theories.

A local version of Fact [\ref=fact_morley] also holds, with the exact same proof.

Assume that for example [formula] and [formula] for some b∈U. Build inductively a sequence (ai:i < ω) such that:

·   when i is even, [formula];

·   when i is odd, [formula].

Then by hypothesis, the sequence (ai:i < ω) is indiscernible (its type over M is p(ω)|M = q(ω)|M) and the formula φ(x;b) alternates infinitely often on it, contradicting NIP.

Dividing and forking

Let A  ⊆  B and let π(x) be a partial type over B. We say that π(x) divides over A if there is an A-indiscernible sequence (bi:i < ω) and a formula φ(x;y) such that [formula] and the partial type {φ(x;bi):i < ω} is inconsistent. We say that π(x) forks over A if it implies a finite disjunction of formulas, each of which divides over A.

We recall the notion of strict non-forking from [\cite=CherKapl] (which is used in the proof of the above fact). Let M be a model of an NIP theory. A sequence (bi)i < ω is strictly non-forking over M if for each i < ω, [formula] is strictly non-forking over M, which means that it extends to a global type [formula] such that both [formula] and [formula] are non-forking over M. We will only need to know two facts about strict non-forking sequences:

(Existence) Given b∈U and [formula], there is a sequence [formula] which is strictly non-forking over M. We might call such a sequence a strict Morley sequence of [formula].

(Witnessing property) If the formula φ(x;b) forks over M, then for any strictly non-forking sequence [formula], the type {φ(x;bi):i < ω} is inconsistent.

In addition to [\cite=CherKapl], an exposition of those facts can be found in [\cite=NIPbook].

Commuting types

The notion of commuting types is central in this work, especially in Section [\ref=sec_fm]. Two invariant types p(x) and q(y) commute if [formula] as global types. By associativity of [formula], if p and q commute, then p commutes with q(n) for n  ≤  ω.

As usual, we say that two types p(x),q(y)∈S(N) are weakly orthogonal if [formula] defines a complete type in two variables over N. If p and q are M-invariant types, we say they are orthogonal if they are weakly orthogonal as global types. Note that this implies that p|N and q|N are weakly orthogonal for any N such that [formula].

Of course, if p and q are orthogonal, then they commute. In NIP theories, we can consider commuting as a kind of weak form of orthogonality. This is motivated by the study of distal theories (see [\cite=distal]) where in fact two types commute if and only if they are orthogonal (and this can be taken as a definition of distal theories amongst NIP theories). It is also proved in [\cite=distal] that two commuting types behave with respect to each other as do types in a stable theory. One instance of this will be recalled in Proposition [\ref=prop_finitecofinite] below.

Build a sequence (an,bn:n < ω) such that [formula] when n is even and [formula] when n is odd. Using the commutativity hypothesis, one shows by induction that this sequence is indiscernible over M. Assume that p and q do not commute: say [formula] and [formula] for some φ(x;y)∈L(U). Then we have [formula] is even, which contradicts NIP.

Recall that in an NIP theory, a global invariant type p is generically stable if it is definable and finitely satisifiable. This is equivalent to saying that p commutes with itself: [formula]. In fact, a generically stable type commutes with all invariant types. We will not explicitly need this notion in this text, but it is useful to have it in mind.

We recall two results from previous papers (the first one is easy and can constitute an exercise; the second one is more involved).

Directionality

In [\cite=Sh946], Kaplan and Shelah classify NIP theories depending on the number of global coheirs a type can have.

A theory T is said to be of small directionality if, given a model M and p∈S(M), then for any finite set Δ of formulas the global coheirs of p determine only finitely many Δ-types. In particular, p has at most 2|T| global coheirs. The theory T is of medium directionality if it is not of small directionality and if the global coheirs of every such p determine at most |M| Δ-types (and thus p has at most |M||T| coheirs). Finally, T has large directionality if it is NIP, but has neither small nor medium directionality.

(p,q)-theorems

Let X be a set (finite or infinite) and S a family of subsets of X. Such a pair (X,S) is called a set system. We say that the family S shatters a subset A  ⊆  X if for every A'  ⊆  A, there is a set S in S such that [formula]. In other words, the family S when restricted to A is the full power set of A.

The family S has VC-dimension at most n (written [formula]), if there is no A  ⊆  X of cardinality n + 1 such that S shatters A. We say that S is of VC-dimension n if it is of VC-dimension at most n and shatters some subset of size n.

If for each n we can find a subset of X of cardinality n shattered by S, then we say that S has infinite VC-dimension (and write [formula]).

Given a set system (X,S), we define the dual set system as the set system (X*,S*), where X*  =  S and S*  =  {Sa:a∈X} with Sa  =  {S∈S:a∈S}. We then define the dual VC-dimension of S (written [formula]) as the VC-dimension of S*.

If φ(x;y) is a formula, then VC(φ) denotes the VC-dimension of the set {φ(U;b):b∈U}. Similarly, VC*(φ) denotes the dual VC-dimension of {φ(U;b):b∈U}, or equivalently, the VC-dimension of {φ(a;U):a∈U}.

A formula φ(x;y) has finite VC-dimension if and only if it has finite dual VC-dimension if and only if it is NIP. For more on this, see [\cite=NIPbook].

Let p  ≥  q be two integers. A family S of some set X has the (p,q)-property if out of every p sets of S, some q have non-empty intersection.

The first (p,q)-type theorem was proved by Alon and Kleitman [\cite=pq_conv] for families of convex subsets of [formula] (where in the statement VC*(S) is replaced by the dimension n). Then Matou sek [\cite=pq] showed how to adapt the proof to the case of families of finite VC-dimension. The proof in the special case where p = q is also exposed in [\cite=NIPbook].

The following lemma and corollary are well-known.

Assume that the partial type {φ(x;bi):i < ω} is (q0 + 1)-consistent, but q-inconsistent for some q  ≥  q0 + 2. First increase the sequence (bi:i < ω) to an indiscernible sequence (bi:i < ω2). Let B = {bi:i < q0 + 1}. We will show that B is shattered by the dual family {φ(a;U):a∈U} thus contradicting the definition of the dual VC-dimension.

By hypothesis, there is some a* satisfying [formula]. Let A be the set of indices l∈ω2 for which [formula]. By the q-inconsistency hypothesis, for every k, there are infinitely many elements of A in the interval ωk  ≤  x < ω(k + 1). Now fix any B0  ⊆  B and let η:q0 + 1  →  ω2 be an increasing map such that η(k) = ωk if bk∈B0 and η(k)∈A otherwise. By indiscernibility, the map η extends to an automorphism of U which we still call η. Then, for any b∈B, we have [formula].

Let φ(x;y) be an NIP formula and M a model. Then the set {b∈U:φ(x;b) does not divide over M} is open over M.

Let q0 be the dual VC-dimension of φ(x;y). Let b∈U. If φ(x;b) does not divide over M, then there is no M-indiscernible sequence (bi:i < ω) with b0 = b which is (q0 + 1)-inconsistent. By compactness, there is some formula [formula] which ensures this and then φ(x;b') does not divide over M for any [formula].

Let φ(x;y) and ψ(y) be two formulas over some model M. Consider the family Sφ,ψ={φ(M;b): b∈ψ(M)} of subsets of M.

3  ⇒  2: Assume the third bullet and pick some q. Then we cannot find an M-indiscernible (bi:i < ω) of elements of ψ(U) such that {φ(x;bi):i < ω} is q-inconsistent. Hence by compactness and Ramsey, for some p, the family {φ(U;b):b∈ψ(U)} has the (p,q)-property. This is a first order statement so we can replace U with any model, in particular M. This implies that Sφ,ψ has the (p,q)-property.

2  ⇒  1: Trivial.

1  ⇒  3: Assume that the first bullet holds and let (p,q) be given by it. Let also q0 be the dual VC-dimension of φ(x;y). If there is some M-indiscernible sequence (bi:i < ω) in ψ(U) such that {φ(x;bi):i < ω} is inconsistent, then by Lemma [\ref=lem_low], it is already (q0 + 1)-inconsistent and in particular q-inconsistent. Then the p-point set (bi:i < p) contradicts the (p,q)-property. This shows that no formula φ(x;b), b∈ψ(U) divides over M.

As was already observed in [\cite=ExtDef2], the (p,q)-theorem has the following model-theoretic consequence.

Let q > VC*(φ). By the previous lemma, there is p such that the family {φ(U;b):b∈ψ(U)} has the (p,q)-property. Let N be given by applying Fact [\ref=fact_pq] to this pair (p,q). Consider the partial type

[formula]

By construction of N, every finite subset of [formula] is consistent. Hence the whole type is consistent and we obtain what we want.

Our aim now is to give a model theoretic proof of this proposition. Note that we do not say in the statement that the integer N depends only on p, q and φ(x;y), although it follows from the proof. The reason is that we will not manage to give a model-theoretic proof of that. The reader should convince herself that the uniformity of N does not follow by a simple compactness argument. The same problem appears in the proof of uniformity of honest definitions [\cite=ExtDef2] and was in fact solved using the (p,q)-theorem.

Assume that ( * ) holds and take φ(x;y), ψ(y) over M satisfying the hypothesis of Proposition [\ref=prop_corpq]. Let K  ⊆  Sy(U) be the space of global types finitely satisfiable in ψ(M). Then for every ∈K, ( * ) gives us some a∈U such that the clopen subset φ(a;y) of K contains [formula]. By compactness of K, we can find finitely many tuples [formula] such that the sets φ(a'i;y) cover K. In particular, they cover the set of types realised in ψ(M). Hence we have found [formula] such that for any b∈ψ(M), one of φ(a'i;b) holds. To get global types, simply let [formula] realise an heir of [formula] over U. The heir property ensures that for any b∈ψ(U), one of φ(ai;b) holds. Now set [formula].

Conversely, assume that Proposition [\ref=prop_corpq] holds. Let M, q and [formula] as in ( * ). By Corollary [\ref=cor_low], there is some [formula] such that φ(x;b') does not divide over M whenever [formula]. Proposition [\ref=prop_corpq] then gives types [formula] such that for any b'∈ψ(U), φ(x;b') is in one of them. For i < n, let [formula]. Then any tuple b'∈ψ(M) satisfies [formula]. Hence [formula] also satisfies that formula which proves ( * ).

Converging subsequences

A sequence (ai:i < ω) is called converging if for any formula φ(x)∈L(U) the truth value of φ(ai) is eventually constant.

A sequence is eventually indiscernible if for any finite Δ, some final segment of it is Δ-indiscernible. By Ramsey and a simple diagonal argument, if the language is countable, then every sequence (indexed by ω) has an eventually indiscernible subsequence. For our purposes, eventually indiscernible sequences are as good as truly indiscernible ones. Indeed if φ(x;y) is NIP and (ai:i < ω) is eventually indiscernible, then for any b, the truth value of φ(ai;b) alternates only finitely often (because by NIP and compactness, this is true for any Δ-indiscernible sequence, for some finite Δ depending only on φ).

The following is a very simple observation that will permit us to use sequences indexed by ω, when in previous works we needed indiscernible sequences.

Assume that φ(x;y) is NIP. Let L0 be a countable sublanguage containing φ and we work in L0. Pick some [formula]. There is a subsequence (af(i):i < ω) which is eventually indiscernible. Then as φ(x;y) is NIP the sequence [formula] is converging and so is the sequence (pf(i):i < ω).

Conversely, if φ(x;y) is not NIP, then there are an indiscernible sequence (ai:i < ω) and b is such that φ(ai;b) holds if and only if i is even. Then no subsequence of [formula] can be converging (since by indiscernibility, we can find a corresponding b' such that φ(x;b') alternates on it).

Note that this statement looks even more natural in continuous model theory, where it would probably make a convenient definition of NIP.

Actually, a little bit more is true when M is countable: closures of sets are given by limits of sequences (we say that the space Sφ(M) is Fréchet), as we will see now.

Let L0 be a countable language containing Δ and we work in L0. Extend q to some complete type [formula] finitely satisfiable in M. Let I = (b'i:i < ω) be a Morley sequence of [formula] over M. By a diagonal construction, we can find a sequence (bi:i < ω) in M such that for any formula φ(x)∈|MI, φ(bi) is true for almost all i. We show that the sequence [formula] converges to q. Let q' be an accumulation point of [formula] in S(U) (hence q' is a global type finitely satisfiable in M). Then the restrictions of q' and [formula] to MI coincide. By an easy induction, this implies that the Morley sequence of q' is the same as that of [formula]. By Fact [\ref=fact_morleyloc], the restrictions of [formula] and q' to Δ-formulas agree.

When M is uncountable, one cannot work with sequences anymore. We have to replace them by more complicated directed families. Let [formula] be a cardinal. Let S<  ω(κ) be the set of finite subsets of κ and let F be the filter on S<  ω(κ) generated by the sets TJ  =  {I∈S<  ω(κ):I  ⊇  J} where J ranges in S<  ω(κ).

The conclusion means that for any formula φ(x;c)∈q, for F-almost all l∈S<  ω(κ), [formula].

Extend q to some complete type [formula] finitely satisfiable in M and let I = (b'i:i < ω) be a Morley sequence of [formula] over M. List the formulas in |MI as (φi(x;ci):i < κ). For l∈S<  ω(κ), take bl∈M realising [formula]. Assume that the family [formula] does not converge to q along F and let φ(x;c)∈q witness it. Let D be an ultrafilter on S<  ω(κ) extending F and containing [formula]. Let [formula]. Then as D contains F, we have q'|MI  =  |MI and hence q'(ω)|M  =  (ω)|M as before. By Fact [\ref=fact_morleyloc], [formula] and q' agree on Δ-formulas, but this is a contradiction since [formula].

Now, we are ready to prove ( * ) of Proposition [\ref=prop_pqequiv].

Assume that the formula φ(x;y) is NIP and φ(x;b)∈L(U) does not divide over M. Let q be a coheir of [formula]. Then for some a∈U [formula].

To simplify the exposition, we first assume that M is countable (which is all that is needed for Proposition [\ref=prop_pqequiv]). We can then restrict to a countable sublanguage, and assume that L is countable.

Let q be a coheir of [formula] and fix some N containing M and |M|+-saturated. Let I = (b'i:i < ω) in N be a Morley sequence of q over M and let b'*∈N realise q over MI. Let [formula]. By the non-dividing assumption, π(x) is consistent. Write [formula] where each qn is finite. We now try to build a sequence (bi:i < ω) of points in M such that for each n:

[formula] [formula] is consistent;

[formula] [formula].

If we succeed, then by [formula] and the argument in the proof of Lemma [\ref=lem_frechet], the sequence [formula] is converging and this contradicts [formula]. Hence we must be stuck at some finite stage. Suppose we have built (bi:i < n) but cannot find bn.

Claim: There is a* realising [formula] and such that φ(a*;b'*) holds.

Proof: Let [formula] and [formula]. By construction, the partial type [formula] is consistent. We of course have [formula] since y does not appear in ψ(x). Furthermore, the sequence (b'i:i < ω) + (b'*) is indiscernible over the parameters of φ'(x;y). We then conclude from Lemma [\ref=lem_low] that the set [formula] is consistent and this gives what we want.[formula]

Let πn(x) be the φ-type of a* over {bi:i < n} (a finite partial type). Then for some ε∈{0,1}, there is no b∈M satisfying

[formula]

As [formula] is finitely satisfiable in qn(M),

[formula]

As a* realises [formula] and φ(x;b'*), we must have ε = 0. We conclude that for any b∈qn(M) we have [formula]. As q is finitely satisfiable in qn(M), we have [formula] which proves the proposition.

The proof for uncountable M (and L) is similar, but using the idea of the proof of Lemma [\ref=lem_frechetuncount] instead of Lemma [\ref=lem_frechet]. We take I and b'* exactly as above and define π(x) in the same way. Enumerate the formulas in q|MI(y) as {θi(y):i < κ}. We try to build a family (bI:I∈S<  ω(κ)) of points in M by induction on |I| such that for each I∈S<  ω(κ), [formula] listed in increasing order:

[formula] the type [formula] is consistent, where [formula];

[formula] [formula].

If we succeed, then by [formula] and the argument in the proof of Lemma [\ref=lem_frechetuncount], [formula] exists and this contradicts [formula]. Let I be such that bJ, for J  ⊂  I have been defined, but we cannot find bI. Let n = |I| and define the increasing sequence [formula] of initial segments as in [formula]. Then the type [formula] is consistent. For i < n, define bi = bJi and set [formula]. Now the end of the proof above goes through word for word.

Local description of invariant φ-types

An interesting consequence of Theorem [\ref=th_coheirpq] is that one can view an invariant φ-type as a kind of type on finitely-satisfiable φopp-types. We explain this now.

First, let us contemplate the usual description of invariant types. Assume that p is an M-invariant φ(x;y)-type. Then it is completely described by the function: dpφ:Sy(M)  →  {0,1} defined by [formula], b∈U, if [formula]. If p is finitely satisfiable, then the function dpφ actually factors through the space Sφopp(M) of φopp-types over M. To see this, assume that b and b' of size |y| have the same φopp-type over M, then for any a∈M, we have [formula]. Therefore also [formula] as p is finitely satisfiable in M. This is no longer true if p is only assumed to be M-invariant. In fact, the function dpφ may not even factor through SL0(M) where L0 is a sublanguage containing φ(x;y). For a simple example of this, take T to be DLO in the language L0  =  {  ≤  }. Let D(x) be a new unary predicate and have D(x) name a non-definable initial segment of the universe. Take φ(x;y) = x  ≤  y and let M be any model. Let p be the M-invariant φ-type of an element a such that [formula]. Then p is definable but it does not map to an invariant type in the reduct to L0.

We now present a slightly different way to describe invariant types which only involves the formula φ and does not depend on the rest of the language.

Assume that for example [formula]. Let [formula] and [formula]. Define also i to be the unique M-invariant global extension of qi, i = 0,1. Take [formula]. Then by M-invariance of p, we have [formula]. Now [formula] is a coheir of [formula]. Hence by Theorem [\ref=th_coheirpq], there is a∈N such that [formula]. But by hypothesis on b,b', 0 and 1 must agree on formulas of the form φ(a;y), a∈N. Contradiction.

Now to any global φ-type p(x) invariant over M, one can associate a function fp from the space Sfsφopp(U,M) of global M-finitely satisfiable φopp-types to {0,1} defined by fp(q) = ε if for some (any) b∈U such that [formula] is finitely satisfiable in M and extends q|N, we have [formula]. Let q0(y)∈S(M) be a complete type and [formula]. How does one know from the function fp if [formula]? We can take any global coheir 0 of q0 and let q be its restriction to φopp-formulas. Then [formula] if and only if fp(q) = 1. In particular, this shows that fp must take the same value on all types q' such that [formula] is finitely satisfiable in M. Also this shows that p is entirely determined by the function fp.

What is the range of the map p  ↦  fp? This of course depends on the language, since increasing the language may add new invariant φ-types. However it is possible to describe exactly which functions f can arise as a function fp in some expansion of the structure. Let Ω be the set of all functions Sfsφopp(U,M)  →  {0,1} equipped with the product topology. Let also Invφ(M)  ⊆  Ω be the set of functions f∈Ω such that f = fp for some M-invariant φ-type p.

Let [formula] be |M|+-saturated and take [formula]. Consider the partial type [formula] finitely satisfiable in M, [formula]. If f is not in Invφ(M), then π(x) does not extend to a global M-invariant type. By compactness, some finite part of it does not extend to an M-invariant type. This shows that some neighborhood of f in Ω is disjoint from Invφ(M) and hence Invφ(M) is closed.

Let s∈Sφ(M) be a φ-type over M. Define the function s:Sfsφopp(U,M)  →  {0,1} by s(q)  =  ε if [formula] when [formula]. Using s  →  s, we identify Sφ(M) to a subset of Ω (the induced topology on Sφ(M) is in general strictly finer than its natural one).

Let [formula] be M-finitely satisfiable φopp-types. Take fp∈Ω. We have to find a type s∈Sφ(M) such that s agrees with fp on [formula]. Pick complete expansions [formula] of [formula] respectively, finitely satisfiable in M. Let [formula]. Then [formula] is finitely satisfiable in M. Let [formula]. Then the formula

[formula]

is in p and in particular does not divide over M. By Theorem [\ref=th_coheirpq], there is a∈U such that [formula]. Set [formula].

We conclude by showing that in some expansion M' of M, Invφ(M') is exactly the closure of Sφ(M) inside Ω.

Using the two previous lemmas, it suffices to show that any function of the form s, s∈Sφ(M) corresponds to an invariant φ-type in the sense of M'. But we have done exactly what is needed to ensure that all φ-types over M are definable. Hence s = fp where p is the global definable extension of s.

Definable (p,q)

The following is a definable version of Proposition [\ref=prop_corpq], which was conjectured in [\cite=ExtDef2] (assuming the full theory is NIP), in fact before the link with the (p,q)-theorem was noticed.

Assume that the formula φ(x;y) is NIP. Let M be a model and φ(x;b)∈L(U) non-dividing over M. Then there is a formula [formula] such that the partial type {φ(x;b):b∈ψ(M)} is consistent.

Conjecture [\ref=conj_pq] reduces to the case where L is countable because we can take a countable sublanguage containing φ(x;y). Then we may assume that M is countable, because if φ(x;b) does not divide over M, then there is a countable [formula] over which φ(x;b) does not divide. We will now prove this conjecture assuming that L and M are countable and that [formula] has only countably many coheirs.

The reduction to a countable M is explained above.

Assume that ( *  * ) holds and let q be such that φ(x;b) does not divide over M whenever [formula]. Let a be given by ( *  * ). Then the set φ(a;M) must contain a subset ψ(M), with ψ(y)∈q: Assume not, then we can easily build a sequence (bi:i < ω) of points of [formula] such that [formula] converges to q. For any non-principal ultrafilter D on ω, the limit type [formula] is a global coheir of q which does not satisfy φ(a;y).

Conversely, if the conjecture holds, let ψ(y) be given by it. Then pick a∈U such that φ(a;b) holds for all b∈ψ(M). The formula φ(a;y) is in every coheir of q.

In the following theorem, we assume NIP of the whole theory and not only of one formula φ(x;y).

Assume that L is countable and T is NIP. Let M be a countable model and φ(x;b)∈L(U) non-dividing over M. Assume that [formula] has only countably many global coheirs. Then there is a∈U such that φ(a;y) is in every global coheir of q.

Fix some N containing M and |M|+-saturated. Let (b'i:i < ω) in N be a strict Morley sequence in [formula] over M and [formula]. Then, by the facts recalled in Section [\ref=sec_fork], for any ψ(x)∈L(M), if [formula] is consistent, then it is non-forking over M.

Let [formula] list the coheirs of [formula]. Write [formula] where each q0n is finite, and build as in Theorem [\ref=th_coheirpq] a maximal sequence (bi:i < n) of points in M such that:

[formula] [formula] is consistent.

[formula] [formula].

Let [formula]. Then π'1(x) is consistent and thus does not fork over M. Let b'* realise q0n|MI and [formula] such that [formula] is M-invariant. Then as φ(a*;b'1) holds, also φ(a*;b'*) holds. We then conclude as in Theorem [\ref=th_coheirpq] that for any b∈q0n(M), we have [formula].

Set π1(x) to be the union of π0(x) and the φ-type of a* over {bi:i < n} and iterate the construction with q1 instead of q0 and π1(x) instead of π0(x). After ω steps, we obtain a consistent partial type [formula] over N with the property that if [formula] and [formula] for some m, then φ(a*;b*) must hold. Hence φ(a*;y) is in qm and we have what we were looking for.

Actually, this proof also works if the space of global coheirs of q is only assumed to be separable. Take the qn's to form a dense set and build πω as above. Let [formula]. Then the formula [formula] defines an open set in the space of coheirs of q. We know that it cannot contain any of the qn's. Hence it is empty.

The FM retraction

We now move to another topic, which is only loosely connected to the previous section. Our aim is to construct and study a canonical retraction from the space of M-invariant types to that of M-finitely satisfiable types. It is still slightly mysterious why such a retraction exists, but it turns out to be rather useful. It will permit us to give a more conceptual proof of the dichotomy proved in [\cite=invdp]: an M-invariant dp-minimal type is either definable or finitely satisfiable in M. Also, it is used in [\cite=ChePilSim] with A. Chernikov and A. Pillay to study how some notions concerning groups are invariant under naming externally definable sets.

Assumption: Throughout this section, we assume that T is NIP.

The construction

Let [formula] where [formula] is a new unary predicate. An expansion of a model of T to [formula] is called a pair. We will always write pairs as (M,A), where M is the universe of the structure and [formula] is the interpretation of [formula] in M. Let [formula] and let [formula] and consider the pair (M',M). Let also (N',N) be an |M'|+-saturated elementary extension of (M',M).

Let p be a global M-invariant type (in the language L).

Claim: The partial [formula]-type [formula] implies a complete L-type over M'.

Proof: Assume not. Then for some L-formula φ(x;b)∈L(M'), [formula] is consistent both with φ(x;b) and with [formula]. We can then construct inductively a sequence (ai:i < ω) of points of N such that:

·   [formula];

·   [formula].

In the reduct to L, the sequence (ai:i < ω) is a Morley sequence of p and as such is L-indiscernible. The formula φ(x;b) alternates infinitely often on it and this contradicts NIP, proving the claim.[formula]

Therefore there is a unique L-type q(x)∈S(M') such that [formula] is consistent. As q(x) is consistent with [formula] it must be finitely satisfiable in M. As M' is |M|+-saturated, q extends uniquely to a global M-finitely satisfiable L-type [formula]. We now define FM(p) to be equal to [formula]. It is not hard to check that this is well defined, i.e., depend on neither M' nor (N',N).

Point (i) is clear. Point (ii) is by compactness: given a formula φ(x;b) over M', if [formula], then there is some finite part p0 of p|N such that [formula] implies φ(x;b).

If p is finitely satisfiable in M, then [formula] is a consistent [formula]-type, hence FM(p) = p.

Point (iv) is easy to check from the definition.

Beware that in general we do not have [formula].

Take T to be DLO and [formula]. Let a∈M and consider the type p∈S(M) such that [formula]. Then p has two global M-invariant extensions: a definable one pdef and an M-finitely satisfiable one pfs. Then FM(pdef) = FM(pfs) = pfs.

The reverse type

We present another construction which associates a finitely satisfiable type to an invariant type, but this time over a larger base. It already appeared in [\cite=distal].

Let p be an M-invariant type and let [formula].

Claim: Given any b∈U, there is some B  ⊂  N of size |M| such that any two realisations of p|B in N have the same type over Mb.

Proof: Assume not. Then we can build inductively a sequence (ai,0ai,1:i < |M|+) in N such that ai,0,ai,1 both realize p over Ma< i,0a< i,1, but ai,0,ai,1 do not have the same type over Mb. Then for any η:|M|+  →  {0,1}, the sequence (ai,η(i):i < |M|+) is indiscernible (it is a Morley sequence of p). Pruning the sequence, we may assume that for some formula φ(x)∈L(Mb), we have [formula] for all i. Taking η to alternate infinitely often between 0 and 1, we contradict NIP.[formula]

We can now define a global type RN(p) as follows: Let b∈U and take B as given by the claim. Let a be a realisation of p|B in N and set RN(p)|Mb = tp(a / Mb). It is easy to see that the different restrictions of RN(p) defined are compatible and thus we obtain a global type RN(p). By construction, this type is N-finitely satisfiable and its restriction to N coincides with p|N.

We call RN(p) the reverse type of p over N. The reason for this terminology comes from point (i) below.

(i) Let q be M-invariant and [formula]. For any B  ⊂  N containing M and [formula], we have [formula]. Hence, by construction of RN, the stated equality holds.

(ii) Let q be M-invariant; take some d∈U, [formula] and [formula]. Let a∈N such that [formula]. Then [formula]. Also [formula], hence by M-invariance of q, [formula] and [formula].

We deduce from this that the Morley sequence of RN(p) has the same type over N as the Morley sequence of p read backwards:

In what follows, [formula] denotes the type of the first n elements in a Morley sequence of p, but with decreasing indices, hence [formula], [formula] etc.

We show the result by induction on n. We already know that p|N = RN(p)|N which gives the case n = 1.

Assume we know the result for n, then

[formula]

Hence by induction, [formula] which is equal to [formula] by Lemma [\ref=lem_reverse] (ii). As the restrictions of p and RN(p) to N agree, this last expression is equal to

[formula]

Note that we have only used in the proof the fact that RN(p) and p have the same restriction to N and the fact that those two types commute. As an N-invariant type is determined by the type of its Morley sequence over N, we deduce the following lemma.

Commutativity properties

We want to argue that FM(p) somehow captures the finitely satisfiable part of p. We do not define the "finitely satisfiable part of p", but we have in mind something like {q∈S(U):q is M-finitely satisfiable and does not commute with p}.

Let [formula] be as in the definition of FM. Take yet another extension [formula]. Let a∈N1 realise p|N. As q is finitely satisfiable in M, [formula] is consistent and is realised by some b∈N1. Then by definition [formula] is given by [formula]. But [formula], hence the result.

We know that a type is definable if and only if it commutes with all types finitely satisfiable in a small model. We show now that it is enough to check commutativity with one specific finitely satisfiable type.

Let [formula] and consider s1 and s2 two M-invariant types. Take a1,a2∈U then by Lemma [\ref=lem_reverse] (i),

[formula] ([formula] and [formula]) if and only if ([formula] and [formula]).

In particular:

[formula] If [formula] and [formula], then [formula] is M-invariant.

Assume that p commutes with FM(p) but is not definable. Then by Lemma [\ref=lem_def] there is some type q finitely satisfiable in M such that [formula]. Hence by [formula], [formula].

Let [formula] and build a maximal sequence (c0i,c1i:i < α) such that:

·   [formula] is finitely satisfiable in M;

·   [formula];

·   [formula].

By NIP such a maximal sequence exists (for any η:α  →  {0,1}, the sequence (cη(i)i:i < α) is a Morley sequence of RN(FM(p)) and as such is indiscernible. If α  ≥  |M|+, then the last bullet contradicts NIP).

Let now [formula] over everything and [formula] over everything. Then [formula].

Let s be the type of b + (c1i,c0i)i < α + a0a1 over N. This type is M-invariant by [formula]. If we apply FM to it, then the restriction to the variables corresponding to b + (c0i,c1i)i < α does not change since this type is M-finitely satisfiable. Thus we can find (g0,g1) such that b + (c0i,c1i)i < α + g0g1 realises FM(s) over N.

By [formula], [formula]. Then by Lemma [\ref=lem_fsfm] and another application of [formula], we have

[formula] [formula].

Next, notice that the tuple c0<  αc1<  α realises a Morley sequence of FM(p) over N (when ordered as [formula]). As p and FM(p) commute, we deduce that p and RN(p) have the same restriction to Nc0<  αc1<  α. Therefore [formula].

Hence by the same argument as above, we conclude

[formula] [formula].

Also, we still have [formula] since FM preserves types over M. So by [formula], g1 does not realise RN(FM(p)) over Mb. Now take g satisfying RN(FM(p)) over everything. Set c0α = g1 and c1α = g. This contradicts maximality of the sequence (c0ic1i:i < α).

Let D be an ultrafilter on M whose limit type q has the same restriction as p over MI. One then shows inductively that p and q have the same Morley sequence, hence p = q.

Let I = (ai:i < ω) be a Morley sequence of p over N. By the previous lemma, p|NI is not finitely satisfiable in N. Let [formula] be a formula witnessing it. By Lemma [\ref=lem_revmorley], we have [formula]. As [formula], necessarily [formula]. On the other hand, [formula] and [formula] have the same restriction to N, hence [formula]. So FN(p) and RN(p)(n) do not commute, hence already FN(p) and RN(p) do not commute.

Assume that p is definable. Then we know that p commutes with every N-finitely satisfiable type. Thus FN(p) and RN(p) are two N-invariant types extending p|N and commuting with p. By Lemma [\ref=lem_uniqueRn], there can be only one such type. Hence FN(p) = RN(p).

Conversely, if p is not definable, then p does not commute with FN(p) by Proposition [\ref=prop_deffm]. But RN(q) does commute with p, hence FN(p)  ≠  RN(p).

Let [formula]. Assume that q does not commute with p. Replacing q by q(ω) and using Lemma [\ref=lem_commseq], we may assume that [formula]. Let [formula] and let [formula]. Then for every k < ω, [formula]. On the other hand by Lemma [\ref=lem_fsfm], [formula]. Thus for every k, (bk,a1) does not realise [formula] over M, and [formula] is constant as k varies. If q commutes with FM(p), this contradicts Proposition [\ref=prop_finitecofinite].

Note that you cannot expect the other implication (if q commutes with p, then it commutes with FM(p)). For example if p is definable not finitely satisfiable in M, then FM(p) commutes with p, but does not commute with itself.

Application to dp-minimal types

Let p be M-invariant and [formula]. Summarising some of the results above, the situation is as follows:

·   p and RN(p) commute;

·   FN(p) commutes with RN(p) if and only if p is finitely satisfiable;

·   FN(p) commutes with p if and only if p is definable.

We have now all we need to give another, more conceptual, proof of the dichotomy for dp-minimal types proved in [\cite=invdp].

Recall that a type p is dp-minimal if for any A and any two sequences I and J mutually indiscernible over A, for any [formula], either I or J is indiscernible over Aa. In particular if p is M-invariant and dp-minimal, q and r are two M-invariant types which commute, then p commutes with either q or r. To see this let [formula] and build [formula] over N. The sequences   +  ' and   +  ' are mutually indiscernible but none is indiscernible over Na.

Let p be M-invariant and dp-minimal, then p is either finitely satisfiable in M or definable.

If p is dp-minimal, then already p|N is dp-minimal. Hence FN(p) is dp-minimal. Since RN(p) and p commute, by dp-minimality, FN(p) must commute with one or the other. From the observations above, we deduce that p is either finitely satisfiable or definable.

Amalgamation of invariant types

The results presented in this section are independent of the rest of the paper. They deal with amalgamating invariant types in NIP theories. They were used in previous, more complicated, proofs of some of the results here and we hope that they might turn out to be useful elsewhere.

Assumption: Throughout this section, we assume that T is NIP.

We know by Fact [\ref=fact_fork] (or see Corollary 3.34 of [\cite=CherKapl]) that any N-invariant consistent partial type extends to a global N-invariant type. Thus it is enough to show that [formula] is consistent. This is easy: any inconsistency can be dragged down in N by M-invariance of p and q.

We recall honest definitions. If A  ⊆  M, then the pair (M,A) is the expansion of M obtained by adding a unary predicate [formula] naming the subset A.

Otherwise, there is some θ(x;y)∈L(N), φ(x;c)∈L(U) and ψ(y;c)∈L(U) such that [formula] has no solution in N. Let (U,N) denote the expansion of U obtained by adding a unary predicate [formula] to name the submodel N. Let [formula]. By Fact [\ref=fact_honest], we can find two formulas φ'(x;c')∈L(N') and ψ'(y;c')∈L(N') such that φ(N;c) = φ'(N;c'), φ'(N';c')  ⊆  φ(N';c) and same for ψ'. It follows that [formula] has no solution in N', hence is inconsistent. As p is finitely satisfiable in N (indeed in M) and [formula], necessarily [formula]. Similarly, [formula]. Hence we conclude that [formula] is inconsistent. But this contradicts Lemma [\ref=lem_amalg].

The assumption that N is saturated over M is necessary to avoid situations such as the following: let [formula]. Let p(x) be the M-invariant global type defined by [formula] and [formula] and let q(y) be defined by [formula] for some [formula]. Then [formula] is consistent, but we cannot amalgamate [formula].

Another situation where NIP allows us to amalgamate is when the types considered fit inside indiscernible sequences. This was observed in [\cite=distal]. We recall (a special case of) Lemma 2.9 from that paper which will allow us to work over slightly more complicated bases at the expense of commutativity assumptions.

Recall the following notation: if I = (at:t∈I) is an indiscernible sequence with no last element, then lim (I / A) denotes the type [formula], which exists by NIP.

See Lemma 2.9 of [\cite=distal].

We may assume that all the sequences considered have same order type as [formula]. Then we can write I1 = (at:t∈(0,1)), I2 = (at:t∈(1,3)), J1 = (bt:t∈(0,2)) and J2 = (bt:t∈(2,3)). For l∈{0,1,2}, let Kl be the sequence of pairs 〈(at,bt):t∈(l,l + 1)〉. By mutual indiscernibility, the sequence K1 + K2 + K3 is indiscernible over A. Furthermore, we can find b'1 and a'2 such that K1 + (a,b'1) + K2 + K3 and K1 + K2 + (a'2,b) + K3 are indiscernible over A.

Now apply the previous lemma.

First, we build a sequence I1 such that I1 + a is a Morley sequence of p over Nc and I1 is a Morley sequence of p over Ncb. To show that it is possible, fix some small A  ⊂  N containing M. Let IA1  ⊂  N be a Morley sequence of p over A. Then by the commutativity assumptions, IA1 + a is a Morley sequence of p over Ac and IA1 is a Morley sequence of p over Acb. We conclude by compactness.

Next, we construct similarly a sequence J1 such that J1 + b is a Morley sequence of q over NI1c and J1 is a Morley sequence of q over NI1ca. Finally, we build I2 (resp. J2) a Morley sequence of p (resp. q) over everything, including B. We take the index set of those sequences to be without endpoints.

Now, using again the commutativity assumptions: I1 + I2 and J1 + J2 are mutually indiscernible over Nc and both I1 + a + I2 and J1 + b + J2 are indiscernible over Nc. Let I*2 (resp. J*2) be the sequence I2 (resp. J2) indexed in the opposite order. By construction lim (I*2 / B) = p|B and similarly for J*2. Thus we can apply the previous lemma to obtain what we want.

It seems possible that the commutativity assumptions can be somewhat relaxed.

Let (pi:i < α) be a family of global invariant types. Assume that the pi's are pairwise orthogonal. Then [formula] defines a complete type in the variables (xi:i < α).

Let κ be such that all types considered are invariant over a set of size <  κ.

First assume that α = 3. So let p,q,r be three invariant types which are pairwise orthogonal. In particular, they pairwise commute. Let [formula], [formula] and [formula]. Let N be some κ-saturated model containing Uc. The types p,q,r have a unique extension to an M-invariant type over N which we denote by the same letter. By Proposition [\ref=prop_betteramalg], we can find a',b' such that [formula], [formula] and [formula]. By orthogonality of p and q, we have [formula]. In particular [formula]. and [formula].

The general case follows by induction on α.

Open problems

We list here a few open problems.

First, let us recall the central conjecture of Section [\ref=sec_pq], which was first stated in [\cite=ExtDef2].

Let T be NIP and [formula]. Let φ(x;d)∈L(U) a formula, non-forking over M. Then there is [formula] such that the partial type {φ(x;d'):d'∈θ(U)} is consistent.

In dp-minimal theories, a stronger version seems plausible:

Assume that T is dp-minimal. If the formula φ(x;b) does not fork over M, then it extends to an M-definable type.

In [\cite=SimStar] written with S. Starchenko, we confirm this conjecture assuming in addition that any formula with parameters b extends to a b-definable type.

Returning to the initial problem which was mentioned in the introduction, we would like to analyse a general invariant type by a finitely satisfiable type and a definable 'quotient'. The following is a test question in that direction.

Assume that T is NIP. Let [formula], a∈U such that [formula] is M-invariant, and φ(x;y)∈L(M). Then there is b∈U and a formula ψ(x;z) such that [formula] is finitely satisfiable in M and φ(N;a) = ψ(N;b).

A positive answer to this conjecture, would imply a positive answer to the following:

Let p(x) be a global M-invariant type and Δ a finite set of formulas, then there is a finite set Δ' of formulas such that for any φ(x;y)∈Δ and b,b'∈U, if [formula], then [formula].

However, we cannot hope to be able in general to choose Δ' independently of p as the following example shows. Let L = { < ;Pn:n < ω}, where the Pn's are unary predicates. The theory T says that <   defines a dense linear order and the predicates Pn name distinct initial segments of it. For each n, we have a [formula]-definable type pn of an element satisfying Pn, but greater than all points in Pn(U).

Now take Δ  =  {  <  }. Then the previous conjecture holds for pn (and any choice of M) by taking Δ' = { < ,Pn}. However, for any Δ' in which Pn does not appear, we can find two elements b,b' having the same Δ'-type over M, such that b satisfies Pn but b' does not. Then we have [formula].

Finally, the main open question concerning FM is the following.

A positive answer would prove for example that if T has medium directionality, then there are at most |M||T| invariant types over any model M, and if T has low directionality, then any type p∈S(M) has at most 2|T| many invariant extensions.

Acknowledgments

Thanks to Gareth Boxall and Charlotte Kestner for pointing out some mistakes in an earlier version. Thanks also to the referee for many useful comments.

Supported by the European Research Council under the European Unions Seventh Framework Programme (FP7/2007-2013) / ERC Grant agreement no. 291111.