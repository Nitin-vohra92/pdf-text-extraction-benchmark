Lemma

Yet Another Hat Game

David R. Cheriton School of Computer ScienceUniversity of Waterloo Waterloo Ontario, N2L 3G1, Canada

Introduction

In this introduction, we review two popular hat games and mention some related work. In Section [\ref=new.sec], we introduce our new game and give a complete solution for it. In Section [\ref=comments.sec], we make some brief comments.

Ebert's Hat Game

The following hat game was posed in a 1998 computer science PhD thesis by Todd Ebert [\cite=Ebert]. There are three players: Alice, Bob, and Charlie. The three players enter a room and a gray or brown hat is placed on each person's head. The colour of each hat is determined by a coin toss, with the outcome of one coin toss having no effect on the others.

Each person can see the other players' hats but not his or her own hat. No communication of any sort is allowed, except for an initial strategy session before the game begins. Once they have had a chance to look at the other hats, the players must simultaneously guess the colour of their own hats, or pass. So each player's response is one of "gray", "brown" or "pass". The group shares a hypothetical $1,000,000 prize if at least one player guesses correctly and no players guess incorrectly.

It is not hard to devise a strategy that will win 50% of the time. For example, Alice could guess "gray" while Bob and Charlie pass. Is it possible to do better? Clearly, any guess has only a 50% chance of being correct. If more than one player guesses, then the probabilities are reduced: the probability that two guesses are correct is 25%, and the probability that three guesses are correct is 12.5%. Hence, it seems at first glance that it is impossible to win more than 50% of the time.

However, suppose each player uses the following rule: If he observes two hats of the same colour (i.e., gray - gray or brown - brown), then he guesses the opposite colour. Otherwise, when two hats of different colours are observed, he passes. To analyse the probability of winning when using this strategy, we consider all possible distributions of hats. There are 2  ×  2  ×  2  =  8 cases to consider. In each case, we can figure out if the players win or lose. The probability of winning is equal to the number of winning configurations divided by eight. In the following Table [\ref=tab.1], we provide an analysis of all eight cases. Boldface type is used to indicate correct votes.

The group wins in six out of eight cases, so their probability of winning is 6 / 8  =  3 / 4  =  75%. Observe that each individual guess is correct with a 50% probability. Among the eight cases, there are six correct guesses and six incorrect guesses. The six correct guesses occurred in six different cases, while the six incorrect guesses were squeezed into two cases. This is why the probability of winning is much higher than 50%, even though each guess has only a 50% chance of being correct!

Here is another way to describe the optimal 3-player strategy:

specify brown-brown-brown and gray-gray-gray as bad configurations.

If a player's hat colour could result in a bad configuration, then that player guesses the opposite colour.

If a player's hat colour could not result in a bad configuration, then that player passes.

Strategies for more players are based on this idea of specifying certain appropriately chosen bad configurations and then using a similar strategy as in the 3-player game. The bad configurations are obtained using Hamming codes, which are perfect single error correcting codes. For every integer m  ≥  2, there is a Hamming code of length n  =  2m - 1 containing 22m - m - 1  =  2n - m codewords.

In a Hamming code, every non-codeword can be changed into exactly one codeword by changing one entry. (This property allows the Hamming code to correct any single error that occurs during transmission.) If the configuration of hats is not a codeword, then there is a unique position i such that changing entry i creates a codeword. Player i will therefore guess correctly and every other player will pass. If the configuration of hats is a codeword, then everyone will guess incorrectly. Thus the group wins if and only if the configuration of hats is not a codeword.

Since there are 2n - m codewords and 2n configurations in total, the success probability is 1  -  2- m  =  1  -  1 / (n + 1). It can be proven fairly easily that this success probability is optimal, and can be attained only when a perfect 1-error correcting code exists. More generally, any strategy for this hat game on an arbitrary number n of players is "equivalent" to a covering code of length n, and thus optimal strategies (for any number of players) are known if and only if optimal covering codes are known (see [\cite=Lenstra] for additional information).

Hats-on-a-line

Another popular hat game has n players standing in a line. Hats of two colours (gray and brown) are distributed randomly to each player. Each player Pi (1  ≤  i  ≤  n) can only see the hats worn by players [formula] (i.e., the players "ahead of" Pi in the line). Each player is required to guess their hat colour, and they guess in the order [formula]. The objective is to maximise the number of correct guesses [\cite=TOAD] [\cite=Aravamuthan].

Clearly the first player's guess will be correct with probability 50%, no matter what her strategy is. However, a simple strategy can be devised in which players [formula] always guess correctly by making use of information gleaned from prior guesses.

As before, suppose that 0 corresponds to gray and 1 corresponds to brown. Let ci denote the colour of player Pi's hat, 1  ≤  i  ≤  n. Here is the strategy:

P1 knows the values [formula] (she can see the hats belonging to [formula]). P1 provides as her guess the value

[formula]

P2 hears the value g1 provided by P1 and P2 knows the values [formula]. Therefore P2 can compute

[formula]

P2's guess is c2, which is correct.

For any player Pj with j  ≥  2, Pj hears the values [formula] provided by [formula] respectively, and Pj knows the values [formula]. Therefore Pj can compute

[formula]

Pj's guess is cj, which is correct.

It is not hard to see that the same strategy can be applied for an arbitrary number of colours, q, where q  >  1. The colours are named [formula] and all computations are performed modulo q. If this is done, then P1 has probability 1 / q of guessing correctly, and the remaining n - 1 players will always guess correctly. Clearly this is optimal.

Related Work

A few years prior to the introduction of Ebert's Hat Game, in 1994, a similar game was described by Aspnes, Beigel, Furst and Rudich [\cite=ABFR]. In their version of the game, players are not allowed to pass, and the objective is for a majority of the players to guess correctly. For the three-player game, it is easy to describe a strategy that will succeed with probability 3 / 4, just as in Ebert's game:

Alice votes the opposite of Bob's hat colour;

Bob votes the opposite of Charlie's hat colour; and

Charlie votes the opposite of Alice's hat colour.

This game is analysed in Table [\ref=tab.2], where the outcomes for all the possible configurations are listed.

It is also possible to devise a strategy for the majority hats game that uses Hamming codes. We basically follow the presentation from [\cite=Buhler]. The idea, which is due to Berlekamp, is to associate a strategy for n players with an orientation of the edges of the n-dimensional cube {0,1}n. Each player's view corresponds in a natural way to an edge of the cube, and that player's guess will be determined by the head of the edge, as specified by the orientation.

If n is a power of 2 minus 1, then there is Hamming code of length n. Direct all the edges of the cube incident with a codeword away from the codeword. The remaining edges form an eulerian graph on the vertices that are not codewords; these edges can be directed according to any eulerian circuit.

The number of correct guesses for a given configuration is equal to the indegree of the corresponding vertex. From this observation, it is not difficult to see that any codeword is a losing configuration for this strategy -- in fact, every guess will be incorrect. If the configuration of hats is not a codeword, then there will be (n + 1) / 2 correct guesses and (n - 1) / 2 incorrect guesses. So the success probability is 1  -  1 / (n + 1), as in the Ebert hat game, and this can again be shown to be optimal.

Many other variations of the hat game have been proposed. We complete this section by briefly mentioning some of them.

Hats could be distributed according to a non-uniform probability distribution ([\cite=Guo]).

Usually, it is stipulated that each player gets a single guess as to his or her hat colour; however, allowing players to have multiple guesses has also been considered ([\cite=ABFR]).

When sequential responses are used, it may be the case that players can hear all the previous responses (we call this complete auditory information), or only some of them, as in [\cite=Aravamuthan].

Some games seek to guarantee that a certain minimum number of correct guesses are made, regardless of the configuration of hats, e.g., in an adversarial setting ([\cite=ABFR] [\cite=Winkler]).

In general, players' strategies can be deterministic or nondeterministic (randomized). In the situation where hat distribution is done randomly, it suffices to consider only deterministic strategies. However, in an adversarial setting, an optimal strategy may require randomization.

A New Hats-on-a-line Game

When the second author gave a talk to high school students about Ebert's Hat Game, one student asked about sequential voting. It is attractive to consider sequential voting especially in the context of the Hats-on-a-line Game, but in that game the objective is different than in Ebert's game. A natural "hybrid" game would allow sequential voting, but retain the same objective as in Ebert's game. So we consider the following new hats-on-a-line game specified as follows:

hats of q > 1 colours are distributed randomly;

visual information is restricted to the hats-on-a-line scenario;

sequential voting occurs in the order [formula] with abstentions allowed; and

the objective is that at least one player guesses correctly and no player guesses incorrectly.

We'll call this game the New Hats-on-a-line Game.

First, we observe that it is sufficient to consider strategies where only one player makes a guess. If the first player to guess is incorrect, then any subsequent guesses are irrelevant because the players have already lost the game. On the other hand, if the first player to guess is correct, then the players will win if all the later players pass.

We consider the simple strategy presented in Table [\ref=t-gray], which we term the Gray Strategy. The Gray Strategy can be applied for any number of colours (assuming that gray is one of the colours, of course!).

It is easy to analyse the success probability of the Gray Strategy:

The success probability of the Gray Strategy for the New Hats-on-a-line Game with q hat colours and n players is [formula].

The probability that P1 sees no gray hat is ((q - 1) / q)n - 1. In this case, her guess of "gray" is correct with probability 1 / q. If P1 passes, then there is at least one gray hat among the remaining n - 1 players. Let [formula]. Then players [formula] will pass and player Pj will correctly guess "gray". So the group wins if player P1 passes. Overall, the probability of winning is

[formula]

The main purpose of this section is to show that the Gray Strategy is an optimal strategy. (By the term "optimal", we mean that the strategy has the maximum possible probability of success, where the maximum is computed over all possible strategies allowed by the game.) We'll do two simple special cases before proceeding to the general proof. (The proof of the general case is independent of these two proofs, but the proofs of the special cases are still of interest due to their simplicity.)

We first show that the Gray Strategy is optimal if q = 2. In this proof and all other proofs in this section, we can restrict our attention without loss of generality to deterministic strategies.

The maximum success probability for any strategy for the New Hats-on-a-line Game with two hat colours and n players is 1  -  2- n.

The proof is by induction on n. For n = 1, the result is trivial, as any guess by P1 is correct with probability 1 / 2. So we can assume n  >  1.

Suppose there are c configurations of n - 1 hats for which player P1 guesses a colour. We consider two cases:

Considering both cases, we see that the probability of winning is at most max {1  -  2- n,1  -  2- n + 1}  =  1  -  2- n.

We observe that the above proof holds even when every player has complete visual information, as the restricted visual information in the hats-on-a-line model is not used in the proof.

We next prove optimality for the two-player game for an arbitrary number of hat colours, as follows.

The maximum success probability for any strategy for the New Hats-on-a-line Game with q hat colours and two players is

[formula]

Suppose that player P1 guesses her hat colour for r out of the q possible colours for P2's hat that she might see. Any guess she makes is correct with probability 1 / q.

We distinguish two cases:

To maximise this quantity, we take r  =  q - 1. This yields a success probability of (2q - 1) / q2.

Case 2 yields the optimal strategy because (2q - 1) / q2  >  1 / q when q  >  1.

The Main Theorem

Based on the partial results proven above, it is tempting to conjecture that the maximum success strategy is [formula], for any integers n > 1 and q > 1. In fact, we will prove that this is always the case.

The proof is done in two steps. A strategy is defined to be restricted if the any guess made by any player other than the first player is always correct. First, we show that any optimal strategy must be a restricted strategy. Then we prove optimality of the Gray Strategy by considering only restricted strategies.

In all of our proofs, we denote the colour of Pi's hat by ci, 1  ≤  i  ≤  n. The n-tuple [formula] is the configuration of hats.

Any optimal strategy for the New Hats-on-a-line Game is a restricted strategy.

Suppose S is an optimal strategy for the New Hats-on-a-line Game that is not restricted. If player P1 passes, then the outcome of the game is determined by the (n - 1)-tuple [formula], which is known to P1. Since P1 knows the strategies of all the players, she can determine exactly which (n - 1)-tuples will lead to incorrect guesses by a later player. Denote this set of (n - 1)-tuples by F. Because S is not restricted, it follows that [formula].

We create a new strategy S' by modifying S as follows:

If [formula], then P1 guesses an arbitrary colour (e.g., P1 could guess "gray").

If [formula], then proceed as in S.

It is easy to see that S' is a restricted strategy. The strategies S and S' differ only in what happens for configurations [formula] where [formula]. When [formula], S' will guess correctly with probability 1 / q. On the other hand, S always results in an incorrect guess when [formula]. Because |F|  >  1, the success probability of S' is greater than the success probability of S. This contradicts the optimality of S and the desired result follows.

Now we proceed to the second part of the proof.

The maximum success probability for any restricted strategy for the New Hats-on-a-line Game with q hat colours and n players is [formula].

Suppose an optimal restricted strategy S is being used. Let A denote the set of (n - 1)-tuples [formula] for which P1 guesses; let B denote the set of (n - 1)-tuples for which P1 passes and P2 guesses (correctly); and let C denote the set of (n - 1)-tuples for which P1 and P2 both pass. Clearly every (n - 1)-tuple is in exactly one of A, B, or C, so

[formula]

Now construct A' (B', C', resp.) from A (B, C, resp.) by deleting the first co-ordinate (i.e., the value c2) from each (n - 1)-tuple. A', B' and C' are treated as multisets. We make some simple observations:

We now define a restricted strategy [formula] for the (n - 1)-player game with players [formula] (here P2 is the "first" player). The strategy is obtained by modifying S, as follows:

P2 guesses (arbitrarily) if [formula] and P2 passes if [formula]. (This is well-defined in view of the three preceding observations.)

[formula] proceed exactly as in strategy S.

Since the set of (n - 2)-tuples for which P2 passes is the same in both of strategies S and [formula], it follows that [formula] only make correct guesses in [formula], and therefore [formula] is restricted.

Let βn denote the maximum number of (n - 1)-tuples for which the first player passes in an optimal restricted strategy. We will prove that

[formula]

This is true for n = 2, since β2  ≤  1.

Now we proceed by induction on n. We will use a few equations and inequalities. First, from (ii), it is clear that

[formula]

Next, because [formula] is a restricted strategy for n - 1 players, we have

[formula]

Finally, from the optimality of S, it must be the case that

[formula]

Applying ([\ref=eq1]), ([\ref=eq2]), ([\ref=eq3]) and ([\ref=eq4]), we have

[formula]

from which we obtain

[formula]

Applying the induction assumption, we see that

[formula]

showing that ([\ref=eq5]) is true.

Finally, using ([\ref=eq5]), the success probability of S is computed to be

[formula]

Summarizing, we have proven our main theorem.

The Gray Strategy for the New Hats-on-a-line Game with q hat colours and n players is optimal.

This is an immediate consequence of Theorem [\ref=gray.thm] and Lemmas [\ref=restricted.lem] and [\ref=restr-prob.lem].

Comments

It is interesting to compare Ebert's Hat Game, the Hats-on-a-line Game and the New Hats-on-a-line Game. The optimal solutions to Ebert's game are easily shown to be equivalent to covering codes. There are many open problems concerning these combinatorial structures, so the optimal solution to Ebert's game is not known in general. The optimal solution to the Hats-on-a-line Game is a simple arithmetic strategy, and it is obvious that the strategy is optimal. We have introduced the New Hats-on-a-line Game as a hybrid of the two preceding games. The optimal strategy is very simple, but the proof of optimality is rather delicate combinatorial proof by induction. This game does not seem to have any connection to combinatorial structures such as covering codes. The analysis of these three games utilize different techniques. At the present time, there does not appear to be any kind of unified approach that is appropriate for understanding these games and/or other types of hat games.