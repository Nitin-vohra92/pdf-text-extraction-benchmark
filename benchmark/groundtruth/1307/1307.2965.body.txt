Semantic Context Forests for Learning-Based Knee Cartilage Segmentation in 3D MR Images

Introduction

The quantitative analysis of knee cartilage is advantageous for the study of cartilage morphology and physiology. In particular, it is an important prerequisite for the clinical assessment and surgical planning of the cartilage diseases, such as knee osteoarthritis which is characterized as the cartilage deterioration and a prevalent cause of disability among elderly population. As the leading imaging modality used for articular cartilage quantification [\cite=QAOC-2004], magnetic resonance (MR) imaging provides direct and noninvasive visualization of the whole knee joint including the soft cartilage tissues (Fig. [\ref=fig:anatomy2]). However, automatic segmentation of the cartilage tissues from MR images, which is required for accurate and reproducible quantitative cartilage measures, still remains an open problem because of the inhomogeneity, small size, low tissue contrast, and shape irregularity of the cartilage.

An earlier endeavor on this problem is Folkesson et al.'s voxel classification approach [\cite=voxel_classification], which runs an approximate kNN classifier on voxel intensity and absolute position based features. However, due to the overlap of intensity distribution between cartilage and other tissues such as menisci and muscles, as well as the variability of the cartilage locations from scan to scan, the performance of this method is limited. More recently, Vincent et al. have developed a knee joint segmentation approach based on active appearance model (AAM), which captures the statistics of both object shape and image cues. Though promising results are reported in [\cite=FASO-2010], the search for the initial model pose parameter can be very time consuming even if a coarse to fine searching strategy is used.

Given the strong spatial relation between the cartilages and bones in the knee joint, most proposed cartilage segmentation methods are based on a framework that each bone is segmented first in the knee joint [\cite=fripp] [\cite=logismos] [\cite=opt_prob], which is usually easier than direct cartilage segmentation because the bones are much larger in size with more regular shapes. Fripp et al. segment the bones based on 3D active shape model (ASM) incorporating the cartilage thickness statistics, and the outer cartilage boundary is then determined by examining the intensity profile along the normal to the bone surface, while being constrained by the cartilage thickness model [\cite=fripp]. In Yin's work [\cite=logismos], the volume of interest containing the bones and cartilages is first detected using a learning-based approach, then the bones and cartilages are jointly segmented by solving an optimal multi-surface detection problem via multi-column graph cuts [\cite=multicolumn_graph_cut]. Lee et al. employ a constrained branch-and-mincut method with shape priors to obtain the bone surface, and then segment the cartilage with MRF optimization based on local shape and appearance information [\cite=opt_prob]. In spite of the differences, these approaches all require classification of bone surface voxels into bone cartilage interface (BCI) and non-BCI, which is an important intermediate step to determine the search space or impose prior constraint for cartilage segmentation. Therefore, any classification error of BCI will probably propagate to the final cartilage segmentation result.

In this paper, we present a fully automatic learning-based voxel classification method for cartilage segmentation. It also requires pre-segmentation of corresponding bones in the knee joint. However, the new approach does not rely on explicit classification of BCI. Instead, we construct distance features from each voxel to a large number of anatomical landmarks on the surface of the bones to capture the spatial relation between the cartilages and bones. By removing the intermediate step of BCI extraction, the whole framework is simplified and classification error propagation can be avoided.

Besides the connection between the cartilages and bones, strong spatial relation also exists among different cartilages which is more often overlooked in earlier approaches. For example, the femoral cartilage is always above the tibial cartilage and two cartilages touch each other in the region where two bones slide over each other during joint movements. To utilize this constraint, we introduce the iterative discriminative classification that at each iteration, the multi-class probability maps obtained by previous classifiers are used to extract semantic context features. In particular, we compare the probabilities at positions with random shift and compute the difference. These features, which we name as the random shift probability difference (RSPD) features, are more computationally efficient and more flexible for different range of context compared to the calculation of probability statistics at fixed relative positions [\cite=auto-context] [\cite=ipmi2011].

Review of Bone Segmentation

In this work, we employ a learning-based bone segmentation approach which has shown the efficiency and effectiveness in different medical image segmentation problems [\cite=HLBA-2008] [\cite=FCHM-2008]. We represent the shape of a bone by a closed triangle mesh M. Given a number of training volumes with manual bone annotations, we use the coherent point drift algorithm (CPD) [\cite=CPD] to find anatomical correspondences of the mesh points and thereof construct the statistical shape models with mean shape [formula] [\cite=ASM]. As shown in Fig. [\ref=fig:bone_seg], the whole bone segmentation framework comprises three steps.

Pose Estimation: For a volume V, the bone is first localized by searching for the (sub-)optimal pose parameters (,r̂,), i.e., the translation, rotation and anisotropic scaling, using the marginal space learning (MSL) [\cite=FCHM-2008]:

[formula]

and the shape is initialized by linearly transforming the mean shape [formula].

Model Deformation: At this stage, the shape is repeatedly deformed to fit the boundary and projected to the variation subspace until convergence.

Boundary Refinement: To further improve the segmentation accuracy, we use the random walks algorithm [\cite=random_walk] to refine the bone boundary (see Table [\ref=tab:dsc_bone] and Fig. [\ref=fig:bone_result] for results) and employ the CPD algorithm to obtain anatomically equivalent landmarks on the refined bone surface.

Cartilage Classification

Given all three knee bones being segmented, we first extract a band of interest within a maximum distance threshold from each of the bone surface, and only classify voxels in the band of interest to simplify the training and testing by removing irrelevant negative voxels.

Feature Extraction

For each voxel with spatial coordinate [formula], we construct a number of base features which can be categorized into three subsets.

Intensity Features include the voxel intensity and its gradient magnitude, respectively: [formula], [formula].

Distance Features measure the signed Euclidean distances from each voxel to different knee bone boundaries: [formula], [formula], [formula], where dF is the signed distance to the femur, dT to tibia, and dP to patella. Then we have their linear combinations:

[formula]

These features are useful because the sum features f6 and f8 measure whether voxel [formula] locates within the narrow space between two bones, and the difference features f7 and f9 measure which bone it is closer to. Fig. [\ref=fig:feature_scatter] shows how f6 and f7 in addition to intensity feature f1 separate tibial cartilage from femoral and patellar cartilages.

Given the prior knowledge that the cartilage can only grow in certain area on the bone surface, it is useful for the cartilage segmentation to not only know how close the voxel is to the bone surface, but also where it is anatomically. Therefore we define the distance features to the densely registered landmarks on the bone surface as described in Section [\ref=sec:2]: [formula], where [formula] is the spatial coordinate of the ζth landmark of all bone mesh points. ζ is randomly generated in training due to the great number of mesh points available (Fig. [\ref=fig:d2lm]).

Context Features compare the intensity of the current voxel [formula] and another voxel [formula] with random offset [formula]: [formula], where [formula] is a random offset vector. This subset of features, named as random shift intensity difference (RSID) features in this paper, capture the context information in different ranges by randomly generating a large number of different values of [formula] from a uniform distribution in training. They were earlier used to solve pose classification [\cite=kinect] and keypoint recognition [\cite=keypoint_recognition] problems.

Iterative Semantic Context Forests

In this paper, we present a multi-pass iterative classification method to automatically exploit the semantic context for multiple object segmentation problems. In each pass, the generated probability maps will be used to extract the context embedded features to enhance the classification performance of the next pass. Fig. [\ref=fig:2_pass_forest] shows a 2-pass iterative classification framework with the random forests [\cite=kinect] [\cite=keypoint_recognition] [\cite=decision_tree_1986] [\cite=random_forest_2001] [\cite=tracking_trees] [\cite=zikic] selected as the base classifier for each pass. However, the method can be extended to more iterations with the use of other discriminative classifiers.

[formula]

which is called random shift probability difference features (RSPD). RSPD provides semantic context information because the probability map values are directly associated with anatomical labels, rather than original intensity volume.

In Fig. [\ref=fig:prob_map], it can be observed that the probability map of the second pass classification is significantly enhanced with much less noisy responses, compared with the first pass.

Post-processing by Graph Cuts Optimization

After the classification, we finally use the probabilities of being the background and the three cartilages to construct the energy functions and perform multi-label graph cuts [\cite=GCO] to refine the segmentation with smoothness constraints.

The graph cuts algorithm assigns a label [formula] to each voxel [formula], such that the energy below is minimized:

[formula]

where L is the global label configuration, N is the neighborhood system, [formula] is the smoothness energy, and [formula] is the data energy. We define

[formula]

[formula] takes value 1 when [formula] and [formula] are different labels, and takes value 0 when [formula]. [formula] takes the value [formula], [formula], [formula] or [formula], depending on the label [formula]. λ and σ are two parameters. λ specifies the weight of data energy versus smoothness energy, while σ is associated with the image noise [\cite=graph_cuts].

Experimental Results

Dataset and Experiment Settings

The dataset we use in our work is the publicly available Osteoarthritis Initiative (OAI) dataset, which contains both 3D MR images and ground truth cartilage annotations, referred to as "kMRI segmentations (iMorphics)". The sagittal 3D 3T (Tesla) DESS (dual echo steady state) WE (water-excitation) MR images in OAI have high-resolution, good delineation of articular cartilage, fast acquisition time and high SNR. Our dataset consists of 176 volumes from 88 subjects, and belongs to the Progression subcohort, where all subjects show symptoms of OA. Each subject has two volumes scanned in different years. The size of each image volume is 384  ×  384  ×  160 voxels, and the voxel size is [formula].

For the validation, we divide the OAI dataset to three equally-sized subsets: D1, D2 and D3, and perform a three-fold validation. The two volumes from the same subject are always placed in the same subset. For each randomized decision tree, we set the depth of the tree to 18, and train 60 trees in each pass. During training, the number of candidates at each non-leaf node is set to 1000. The dice similarity coefficient (DSC) is used to measure the performance of our method since it is commonly reported in previous literature [\cite=voxel_classification] [\cite=fripp] [\cite=logismos] [\cite=opt_prob] [\cite=shan_liang].

Results

First, we compare the frequency of different features that is selected by the classifiers. As shown in Fig. [\ref=fig:feature_frequency], RSID, RSPD and the distance to dense landmarks are very informative features to embed spatial constraints.

Then we compare the segmentation performance with and without the use of the distance features to the anatomical dense landmarks, and also the results with different number of classification iterations. The results in Fig. [\ref=fig:bar] demonstrate the effectiveness of the distance features to dense landmarks and iterative classification with semantic context forests. In particular, 2-pass random forests achieve significant performance improvement, whereas the gain seems quite negligible by adding more passes.

Finally, the quantitative results (2-pass classification) are listed in Table [\ref=tab:dsc] together with the numbers reported in the earlier literature. Because the datasets used are different by all these approaches, the numbers in the table are only for reference. Note that only our experiments are based on a relatively large dataset. As shown in the table, we achieved high performance with regard to the femoral and tibial cartilage, whereas the DSC of patellar cartilage is notably lower than the other two cartilages. This is partly because the size of patellar cartilage is much smaller than femoral and tibial cartilage, so that the same amount of segmentation error will result in lower DSC. Besides, some patellar cartilage annotations in the dataset do not appear very consistent with others. Example segmentation results are shown in Fig. [\ref=fig:many_result].

Conclusion

We have presented a new approach to segment the three knee cartilages in 3-D MR images, which effectively exploits the semantic context information in the knee joint. By using the distance features to the bone surface as well as to the dense anatomical landmarks on the bone surface, the spatial constraints between cartilages and bones are incorporated without the need of explicit extraction of the bone cartilage interface. Furthermore, the use of multi-pass iterative classification with semantic context forests provides more spatial constraints between different cartilages to further improve the segmentation. The experiment validation shows the effectiveness of this method. Ongoing work include the joint bone-and-cartilage voxel classification in the iterative classification framework.