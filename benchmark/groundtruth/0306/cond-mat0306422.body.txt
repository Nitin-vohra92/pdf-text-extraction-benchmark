Transition matrix Monte Carlo and flat-histogram algorithm

Introduction

In traditional Monte Carlo sampling method, the computation of a thermodynamic quantity 〈Q〉 is usually through a simple arithmetic average:

[formula]

where the configurations σi are generated according to a specified distribution, such as the Boltzmann distribution. However, it is possible to collect other information in the same simulation, from which we can obtain better statistics, or estimates of quantities other than that at simulation parameters. The histogram method [\cite=histo1] and multi-histogram method [\cite=histo2] collect energy histogram at a given temperature, from which the quantity at nearby temperature can be inferred. The key observation here is that the histogram of energy is related to density of states through [formula] (in canonical ensemble). From the histogram, we can determine the density of states n(E). Once the density of states is known, we can compute most of the thermodynamic quantities at any temperature.

Histogram method has been found to be an excellent tool for study critical phenomena. Further improvement can be made by collecting 'high-order' statistics, i.e., the transition matrix [\cite=wang-tay-swendsen-PRL] [\cite=Li-thesis] [\cite=JSP]. With histogram method, each configuration provides just an '1' to a histogram entry, while in transition matrix method, each configuration gives several numbers of magnitude about N to the transition matrix elements, thus variance reduction is expected. One of the most appealing feature of transition matrix Monte Carlo is an easy and straightforward way to combine several simulations. Additionally, we can use any valid sampling algorithm in a generalized ensemble which realizes the microcanonical property that states with same energy have the same probability. The flat-histogram algorithm [\cite=wang-europhys-B] [\cite=swendsen-int] [\cite=wang-lee] is such an algorithm that realizes multicanonical ensemble in which the energy histogram distribution is a constant. In the following, we present the transition matrix Monte Carlo method, introduce the flat-histogram and other related algorithms. We discuss the performance of algorithms with examples from Monte Carlo simulation results of the Ising models. We summarize in the last section.

Transition Matrix Monte Carlo Method

First, we give the definition for the transition matrix. Let W(σ  →  σ') be the transition probability of the states from σ to σ' of a Markov chain. To be definite, we consider a single-spin-flip dynamics with a canonical distribution, but the formalism is general. The transition matrix in the space of energy from E to E' is

[formula]

where the summations are over all initial states σ with energy E and all final states σ' with energy E'. Estimates of the transition matrix can be obtained during a Monte Carlo sampling, where the summation over E divided by n(E) is interpreted as a microcanonical average of the state-space transition probabilities of the Markov chain, i.e.,

[formula]

The expression can be further simplified if we consider single-spin-flip dynamics, with a spin choosing at random. In this case, [formula], where N(σ,ΔE) is the number of sites such that a spin-flip causes the energy increasing by ΔE  =  E' - E in the current state σ. It is also the number of possible moves that one can make to change the energy by ΔE. Note that [formula], where N is the number of sites. A common choice of the single-spin-flip rate a(E  →  E') is the Metropolis rate [formula]. Since this factor is a function of E and E', the microcanonical average [formula] is performed over N(σ,ΔE) only. We have

[formula]

where we have defined a normalized N(σ,ΔE) as the infinite temperature transition matrix.

The eigenvector corresponding to the eigenvalue 1 of the transition matrix is the probability of finding states with energy E. It is also proportional to the histogram H(E). To determine the density of states, a numerically better choice is from the detailed balance. This gives us the relationship between histogram and transition matrix:

[formula]

If we use the fact that [formula] and Eq. ([\ref=Teq]), we obtain the so-called broad-histogram equation [\cite=oliveira-brasil1] [\cite=oliveira-europhys-b-2] [\cite=oliveira-broad] [\cite=berg-hansmann-europhys-b]

[formula]

This is one of the basic equation for determining the density of states, as well as for the flat-histogram algorithm below.

Flat-Histogram Algorithm

Any sampling algorithm that can realize microcanonical property, i.e., the distribution of the states is a function of energy only, can be used to collect statistics for 〈N(σ,ΔE)〉E. Using a canonical ensemble simulation, we need dozen temperatures in order to cover all the relevant energies. However, comparing to multi-histogram methods, the combination of data at different temperatures is very easy, we simply add up the matrix elements and then properly normalize.

Multicanonical ensemble [\cite=berg] is a particularly good choice for the collection of transition matrix elements, since it reaches all energy levels with equal probability. Multicanonical ensemble is defined to be H(E)  =  const, or the probability of configuration [formula]. It is purely an artificial ensemble designed for computational efficiency. To realize the multicanonical ensemble, we can perform a single-spin flip with a flip rate of [formula]. However, since the density of states n(E) is not known beforehand, we have proposed to use the count number N(σ,ΔE). From the broad-histogram equation, Eq. ([\ref=bheq]), the ratio of n(  ·  ) is related to the ratio of N(  ·  ), we have

[formula]

This is our flat-histogram flip rate. Although the microcanonical average 〈N(σ,ΔE)〉E is also not available before the simulation, it can be obtained approximately during a simulation. We use the instantaneous value and running average to replace the exact microcanonical average. Numerical tests have shown that this procedure converges to the correct ensemble for sufficiently long runs. For realizing truly a Markov chain, it is sufficient for a two-pass algorithm. The first pass is as before. In the second pass, we use a multicanonical sampling rate, using the density of states determined from the first pass.

A variation of the algorithm is equal-hit algorithm which combines the N-fold way method [\cite=bortz-kalos-lebowitz] with a flip rate that gives an extended ensemble that is uniform in probability of visiting each new energy. Reference [\cite=JSP] gives more extensive discussions, as well as comparison with Wang-Landau method [\cite=wang-landau].

Some Results

As there are more detailed balance equations among the transitions of different energies than the number of energy levels, we determine the density of states from the transition matrix by solving a least-squares problem, or more generally, a nonlinear optimization problem. The optimization can be done either in the density of states n(E), or in the transition matrix elements T(E  →  E'). There are a number of constraints that the transition matrix must satisfy. The trivial one is the normalization, [formula]. There exists a rather interesting constraint, known as TTT identity, as well:

[formula]

These constraints complicate the optimization algorithms.

While any of those extended ensemble methods reduce their efficiency as the system size increases, the accuracy of a two-pass flat-histogram/multicanonical simulation is rather good for a given fixed amount of CPU times [\cite=JSP] [\cite=binary]. The method can also give excellent result for large systems, such as a 256  ×  256 Ising lattice [\cite=MCQMC], using a parallelized version of the program. The method is also applied to a lattice protein model, the HP model, with good performance [\cite=lee-wang].

A possible measure of computational efficiency is through the tunneling times. The tunneling time is defined to be the number of Monte Carlo steps in units of a lattice sweep (N basic moves), for system making a pass from the highest energy level to lowest level, or vice versa. For the two-dimensional Ising model, this tunneling time diverges with system sizes according to L2.8 which is worse than standard random walk. On the other hand, for spin-glasses with complicated low-temperature free-energy landscape, the tunneling time is much larger. It is about L4.7 [\cite=zhan-lee-wang-physica-A] in two dimensions and L7.9 [\cite=JSP] in three dimensions. Another measure for spin glasses is given by the average first-passage times. It is defined as the average number of sweeps needed to reach a ground state. It is found in ref. [\cite=jpsj-okabe] that the first-passage time diverges exponentially rather than according to a power. In any case, the equal-hit algorithm performs comparable to 'extremal optimization' [\cite=EO] which is an optimization algorithm inspired from self-organized criticality.

Conclusion

By collection the transition matrix, more information is obtained about the system, giving more accurate results. The effect of using transition matrix is more dramatic for small systems. Although the transition matrix analysis of data can be used with any simulation algorithms, extended-ensemble-based algorithms, such as flat histogram algorithm, are excellent choices. The efficiency of the flat-histogram related algorithms has be studied.

Acknowledgments

The author thanks J. Gubernatis for invitation to this conference "The Monte Carlo method in the physical sciences: celebrating the 50th anniversary of the Metropolis algorithm" at Los Alamos. He would also like to thank Robert H. Swendsen, Lik Wee Lee, Zhifang Zhan, and Yutaka Okabe for collaborations on topics discussed here.